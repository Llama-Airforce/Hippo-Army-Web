import{_ as Q}from"./DashboardHeader-CN43-LqW.js";import{t as Y,b as z,f as G,a as X,r as B,u as F}from"./timestamp-DbzQYZiw.js";import{o as $,s as R,e as Z,n as g,a as tt,p as et,t as st,f as at,g as nt,_ as L}from"./AsyncValue-Sj7pBrIC.js";import{aJ as ot,am as it,d as v,u as x,a as U,c as f,w as W,b as T,o as y,e as h,f as p,g as c,h as u,_ as w,j as q,k,l as P,at as rt,av as ut,aw as V,m as C,a_ as lt,ai as ct}from"./index-BYo41Xup.js";import{u as M,a as E,_ as I,P as A}from"./UseLightweightChart-CFtEm1oP.js";import{_ as H}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-CKpR4_i0.js";import{_ as dt}from"./KPI-uoTtNFz4.js";import{_ as mt}from"./Table-DT-aBDRh.js";import{a as _t,_ as pt}from"./UsePagination-3nFYvzXg.js";import{u as ht}from"./UseRelativeTime-ByMkMAFO.js";import"./Tooltip-DWyUKFfl.js";const bt=$({block_timestamp:g(),tx_hash:R(),block_number:g(),operator:Z,amount:R()}).transform(n=>({blockTime:Y(n.block_timestamp),txHash:n.tx_hash,blockNumber:n.block_number,operator:n.operator,amount:parseFloat(n.amount)})),ft=$({distributions:tt(bt),count:g(),page:g(),total_pages:g()}).transform(n=>({distributions:n.distributions,count:n.count,page:n.page,totalPages:n.total_pages})),gt=$({...at,...st,...et});async function vt(n,d){const i=nt(d),{chain:r,...m}=gt.parse(n),_=z(m),t=await G(`${i}/v1/revenue/${r}/distributions${_}`,void 0,d==null?void 0:d.signal);return ft.parse(t)}function K(n){return X({queryKey:["revenue-distributions",n],queryFn:()=>vt(it(n)),placeholderData:ot})}const yt={style:{display:"flex"}},Dt={ref:"chartRef",class:"chart"},kt=v({__name:"ChartDistributions",props:{distributions:{}},setup(n){const d=x(),i=U("card"),{chart:r,series:m}=M({createChartOptions:E(),series:{type:A,name:"distributions",options:f(()=>({priceFormat:{type:"custom",formatter:t=>`$${B(t,0,"dollar")}${F(t)}`,minMove:.01},color:d.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});W(_);function _(){!r.value||!m.distributions||(m.distributions.setData(n.distributions.map(t=>({time:t.blockTime.getUTCTimestamp(),value:t.amount})).uniqWith((t,e)=>t.time===e.time).orderBy(t=>t.time,"asc").takeRight(52)),r.value.timeScale().fitContent())}return(t,e)=>{const a=H,o=I,s=w;return y(),T(s,{ref_key:"card",ref:i,title:"Distributions (1y)"},{actions:h(()=>[p("div",yt,[c(a,{filename:"distributions",series:u(m)},null,8,["series"]),c(o,{chart:u(r),target:u(i)},null,8,["chart","target"])])]),default:h(()=>[p("div",Dt,null,512)]),_:1},512)}}}),Ct={style:{display:"flex"}},$t={ref:"chartRef",class:"chart"},Tt=v({__name:"ChartDistributionsDelta",props:{distributions:{}},setup(n){const d=x(),i=U("card"),{chart:r,series:m}=M({createChartOptions:E(),series:{type:A,name:"deltas",options:f(()=>({priceFormat:{type:"custom",formatter:t=>`$${B(t,0,"dollar")}${F(t)}`,minMove:.01},color:d.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});W(_);function _(){if(!r.value||!m.deltas)return;const{colors:t}=d.value;m.deltas.setData(n.distributions.map(e=>({time:e.blockTime.getUTCTimestamp(),value:e.amount})).uniqWith((e,a)=>e.time===a.time).orderBy(e=>e.time,"asc").takeRight(53).reduce((e,a,o,s)=>{if(o===0)return e;const l=a.value-s[o-1].value,b=l<0?t.red:t.green;return e.push({time:a.time,value:l,color:b}),e},[])),r.value.timeScale().fitContent()}return(t,e)=>{const a=H,o=I,s=w;return y(),T(s,{ref_key:"card",ref:i,title:"Distributions Change (1y)"},{actions:h(()=>[p("div",Ct,[c(a,{filename:"distributions_delta",series:u(m)},null,8,["series"]),c(o,{chart:u(r),target:u(i)},null,8,["chart","target"])])]),default:h(()=>[p("div",$t,null,512)]),_:1},512)}}}),wt={class:"kpis"},Pt=v({__name:"KPIs",setup(n){const d={chain:"ethereum"},{data:i}=K(d),r=f(()=>{var t;return(t=i.value)!=null&&t.distributions?i.value.distributions.reduce((e,a)=>e+a.amount,0):null}),m=f(()=>{var e;if(!((e=i.value)!=null&&e.distributions)||i.value.distributions.length===0)return null;const t=i.value.distributions.slice(0,52);return t.reduce((a,o)=>a+o.amount,0)/t.length}),_=f(()=>{var o;if(!((o=i.value)!=null&&o.distributions)||i.value.distributions.length===0)return null;const t=i.value.distributions.slice(0,52).map(s=>s.amount),e=t.reduce((s,l)=>s+l,0)/t.length,a=t.map(s=>Math.pow(s-e,2));return Math.sqrt(a.reduce((s,l)=>s+l,0)/(t.length-1))});return(t,e)=>{const a=L,o=dt;return y(),q("div",wt,[c(o,{label:"Total","has-value":!!u(r)},{default:h(()=>[c(a,{type:"dollar",value:u(r),precision:2,"show-symbol":!1},null,8,["value"]),e[0]||(e[0]=k(" reUSD "))]),_:1,__:[0]},8,["has-value"]),c(o,{label:"Average (1y)","has-value":!!u(m)},{default:h(()=>[c(a,{type:"dollar",value:u(m),precision:2,"show-symbol":!1},null,8,["value"]),e[1]||(e[1]=k(" reUSD "))]),_:1,__:[1]},8,["has-value"]),c(o,{label:"Standard Deviation (1y)","has-value":!!u(_)},{default:h(()=>[c(a,{type:"dollar",value:u(_),precision:2,"show-symbol":!1},null,8,["value"]),e[2]||(e[2]=k(" reUSD "))]),_:1,__:[2]},8,["has-value"])])}}}),St=P(Pt,[["__scopeId","data-v-8461099e"]]),Rt=["href"],Vt={class:"period"},Bt={class:"end"},Ft={class:"end"},Lt=["href"],xt=7*24*60*60*1e3,Ut=v({__name:"TableDistributions",props:{distributions:{},count:{}},emits:["page"],setup(n,{emit:d}){const i=d,{page:r,onPage:m}=_t(),_=rt(r,200);ut(_,s=>{i("page",s)});const{relativeTime:t}=ht();function e(s){const l=new Date(Date.UTC(2025,2,20));return new Date(l.getTime()+s*xt)}function a(s){const l=e(s),b=new Date(l);return b.setDate(l.getDate()+7),b}function o(s){return`${s.toLocaleString("default",{month:"short"})} ${s.getDate()}`}return(s,l)=>{const b=pt,N=lt,O=L,j=mt,J=w;return y(),T(J,{title:"Distributions"},{actions:h(()=>[c(b,{"items-count":s.count,"items-per-page":10,page:u(r),onPage:u(m)},null,8,["items-count","page","onPage"])]),default:h(()=>[c(j,{rows:s.distributions,columns:["Period",{label:"Amount (reUSD)",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:D,idx:S})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${D.operator.address}`,onClick:l[0]||(l[0]=V(()=>{},["stop"]))},[p("div",Vt,[p("span",null,C(o(e(s.distributions.length-S-1))),1),c(N,{class:"chevron"}),p("span",null,C(o(a(s.distributions.length-S-1))),1)])],8,Rt)]),p("div",Bt,[c(O,{"show-zero":"",type:"dollar",value:D.amount,"show-symbol":!1,precision:2},null,8,["value"])]),p("div",Ft,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${D.txHash}`,onClick:l[1]||(l[1]=V(()=>{},["stop"]))},C(u(t)(D.blockTime.getUTCTimestamp())),9,Lt)])]),_:1},8,["rows"])]),_:1})}}}),Wt=P(Ut,[["__scopeId","data-v-11a72d6d"]]),qt={class:"dashboard"},Mt=v({__name:"Revenue.page",setup(n){const d=ct(1),{isFetching:i,data:r}=K(f(()=>({chain:"ethereum",page:d.value,per_page:15})));return(m,_)=>{var e,a,o,s;const t=Q;return y(),q("div",qt,[c(t,{style:{"grid-area":"header"},title:"Revenue",description:"Token revenue distribution metrics"}),c(St,{style:{"grid-area":"kpis"}}),c(kt,{style:{"grid-area":"chart"},distributions:((e=u(r))==null?void 0:e.distributions)??[]},null,8,["distributions"]),c(Tt,{style:{"grid-area":"delta"},distributions:((a=u(r))==null?void 0:a.distributions)??[]},null,8,["distributions"]),c(Wt,{style:{"grid-area":"table"},distributions:((o=u(r))==null?void 0:o.distributions)??[],count:((s=u(r))==null?void 0:s.count)??0,loading:u(i),onPage:_[0]||(_[0]=l=>d.value=l)},null,8,["distributions","count","loading"])])}}}),zt=P(Mt,[["__scopeId","data-v-f3bd6d88"]]);export{zt as default};
