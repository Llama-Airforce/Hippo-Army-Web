import{aJ as G,am as X,d as $,u as U,a as q,c as y,w as A,b as D,o as g,e as b,f as _,g as m,h as o,_ as F,j as E,k as B,l as I,at as Z,av as ee,aw as N,m as P,a_ as te,ai as M,an as se,a$ as ae,n as ne}from"./index-D_npeDaU.js";import{_ as oe}from"./ChartBalances-DzjEf805.js";import{_ as ie}from"./DashboardHeader-Wgr_JG5K.js";import{u as W,a as H,_ as x,k as K,D as re}from"./UseLightweightChart-D-YlHlPt.js";import{t as le,b as ue,f as ce,a as me,r as O,u as j}from"./timestamp-CETUM7yH.js";import{o as V,s as v,n as w,a as z,e as pe,p as de,t as _e,f as be,g as he,_ as J}from"./AsyncValue-BO2zwP8m.js";import{_ as Q}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-D0rj4F3o.js";import{_ as fe}from"./KPI-DxdSQCBv.js";import{_ as ge}from"./Table-CGC7HDtD.js";import{a as ve,_ as ye}from"./UsePagination-CbPcWqrM.js";import{u as ke}from"./UseRelativeTime-DGqJUhV1.js";import"./Tooltip-Cwwh2qOo.js";const De=V({pair_id:w(),pair_name:v(),protocol_name:v(),interest:v(),fees:v()}).transform(a=>({pairId:a.pair_id,pairName:a.pair_name,protocolName:a.protocol_name,interest:parseFloat(a.interest),fees:parseFloat(a.fees)})),we=V({block_timestamp:w(),tx_hash:v(),block_number:w(),operator:pe,amount:v(),interest_total:v(),fees_total:v(),breakdown:z(De)}).transform(a=>({blockTime:le(a.block_timestamp),txHash:a.tx_hash,blockNumber:a.block_number,operator:a.operator,amount:parseFloat(a.amount),interestTotal:parseFloat(a.interest_total),feesTotal:parseFloat(a.fees_total),breakdown:a.breakdown})),$e=V({distributions:z(we),count:w(),page:w(),total_pages:w()}).transform(a=>({distributions:a.distributions,count:a.count,page:a.page,totalPages:a.total_pages})),Ce=V({...be,..._e,...de});async function Te(a,p){const l=he(p),{chain:r,...u}=Ce.parse(a),d=ue(u),t=await ce(`${l}/v1/revenue/${r}/distributions${d}`,void 0,p==null?void 0:p.signal);return $e.parse(t)}function Y(a){return me({queryKey:["revenue-distributions",a],queryFn:()=>Te(X(a)),placeholderData:G})}const Se={style:{display:"flex"}},Be={ref:"chartRef",class:"chart"},Pe=$({__name:"ChartDistributions",props:{distributions:{}},setup(a){const p=U(),l=q("card"),{chart:r,series:u}=W({createChartOptions:H(),series:{type:K,name:"distributions",options:y(()=>({priceFormat:{type:"custom",formatter:t=>`$${O(t,0,"dollar")}${j(t)}`,minMove:.01},color:p.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});A(d);function d(){!r.value||!u.distributions||(u.distributions.setData(a.distributions.map(t=>({time:t.blockTime.getUTCTimestamp(),value:t.amount})).uniqWith((t,s)=>t.time===s.time).orderBy(t=>t.time,"asc").takeRight(52)),r.value.timeScale().fitContent())}return(t,s)=>{const n=Q,i=x,e=F;return g(),D(e,{ref_key:"card",ref:l,title:"Distributions (1y)"},{actions:b(()=>[_("div",Se,[m(n,{filename:"distributions",series:o(u)},null,8,["series"]),m(i,{chart:o(r),target:o(l)},null,8,["chart","target"])])]),default:b(()=>[_("div",Be,null,512)]),_:1},512)}}}),Fe={style:{display:"flex"}},Ve={ref:"chartRef",class:"chart"},Le=$({__name:"ChartDistributionsDelta",props:{distributions:{}},setup(a){const p=U(),l=q("card"),{chart:r,series:u}=W({createChartOptions:H(),series:{type:K,name:"deltas",options:y(()=>({priceFormat:{type:"custom",formatter:t=>`$${O(t,0,"dollar")}${j(t)}`,minMove:.01},color:p.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});A(d);function d(){if(!r.value||!u.deltas)return;const{colors:t}=p.value;u.deltas.setData(a.distributions.map(s=>({time:s.blockTime.getUTCTimestamp(),value:s.amount})).uniqWith((s,n)=>s.time===n.time).orderBy(s=>s.time,"asc").takeRight(53).reduce((s,n,i,e)=>{if(i===0)return s;const c=n.value-e[i-1].value,f=c<0?t.red:t.green;return s.push({time:n.time,value:c,color:f}),s},[])),r.value.timeScale().fitContent()}return(t,s)=>{const n=Q,i=x,e=F;return g(),D(e,{ref_key:"card",ref:l,title:"Distributions Change (1y)"},{actions:b(()=>[_("div",Fe,[m(n,{filename:"distributions_delta",series:o(u)},null,8,["series"]),m(i,{chart:o(r),target:o(l)},null,8,["chart","target"])])]),default:b(()=>[_("div",Ve,null,512)]),_:1},512)}}}),Re={class:"kpis"},Ie=$({__name:"KPIs",setup(a){const p={chain:"ethereum"},{data:l}=Y(p),r=y(()=>{var t;return(t=l.value)!=null&&t.distributions?l.value.distributions.sumBy(s=>s.amount):null}),u=y(()=>{var s;if(!((s=l.value)!=null&&s.distributions)||l.value.distributions.length===0)return null;const t=l.value.distributions.slice(0,52);return t.sumBy(n=>n.amount)/t.length}),d=y(()=>{var i;if(!((i=l.value)!=null&&i.distributions)||l.value.distributions.length===0)return null;const t=l.value.distributions.slice(0,52).map(e=>e.amount),s=t.sumBy(e=>e)/t.length,n=t.map(e=>Math.pow(e-s,2));return Math.sqrt(n.sumBy(e=>e)/(t.length-1))});return(t,s)=>{const n=J,i=fe;return g(),E("div",Re,[m(i,{label:"Total","has-value":!!o(r)},{default:b(()=>[m(n,{type:"dollar",value:o(r),precision:2,"show-symbol":!1},null,8,["value"]),s[0]||(s[0]=B(" reUSD "))]),_:1,__:[0]},8,["has-value"]),m(i,{label:"Average (1y)","has-value":!!o(u)},{default:b(()=>[m(n,{type:"dollar",value:o(u),precision:2,"show-symbol":!1},null,8,["value"]),s[1]||(s[1]=B(" reUSD "))]),_:1,__:[1]},8,["has-value"]),m(i,{label:"Standard Deviation (1y)","has-value":!!o(d)},{default:b(()=>[m(n,{type:"dollar",value:o(d),precision:2,"show-symbol":!1},null,8,["value"]),s[2]||(s[2]=B(" reUSD "))]),_:1,__:[2]},8,["has-value"])])}}}),Ne=I(Ie,[["__scopeId","data-v-e12c7e95"]]),Me=["href"],Ue={class:"period"},qe={class:"end"},Ae={class:"end"},Ee=["href"],We=7*24*60*60*1e3,He=$({__name:"TableDistributions",props:{distributions:{},count:{}},emits:["page"],setup(a,{emit:p}){const l=p,{page:r,onPage:u}=ve(),d=Z(r,200);ee(d,e=>{l("page",e)});const{relativeTime:t}=ke();function s(e){const c=new Date(Date.UTC(2025,2,20));return new Date(c.getTime()+e*We)}function n(e){const c=s(e),f=new Date(c);return f.setDate(c.getDate()+7),f}function i(e){return`${e.toLocaleString("default",{month:"short"})} ${e.getDate()}`}return(e,c)=>{const f=ye,L=te,C=J,T=ge,S=F;return g(),D(S,{title:"Distributions"},{actions:b(()=>[m(f,{"items-count":e.count,"items-per-page":10,page:o(r),onPage:o(u)},null,8,["items-count","page","onPage"])]),default:b(()=>[m(T,{rows:e.distributions,columns:["Period",{label:"Amount (reUSD)",align:"end"},{label:"Time",align:"end"}]},{row:b(({item:k,idx:h})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${k.operator.address}`,onClick:c[0]||(c[0]=N(()=>{},["stop"]))},[_("div",Ue,[_("span",null,P(i(s(e.distributions.length-h-1))),1),m(L,{class:"chevron"}),_("span",null,P(i(n(e.distributions.length-h-1))),1)])],8,Me)]),_("div",qe,[m(C,{"show-zero":"",type:"dollar",value:k.amount,"show-symbol":!1,precision:2},null,8,["value"])]),_("div",Ae,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${k.txHash}`,onClick:c[1]||(c[1]=N(()=>{},["stop"]))},P(o(t)(k.blockTime.getUTCTimestamp())),9,Ee)])]),_:1},8,["rows"])]),_:1})}}}),xe=I(He,[["__scopeId","data-v-11a72d6d"]]),Ke={class:"dashboard"},R="All",Oe=$({__name:"Revenue.page",setup(a){const p=M(1),{isFetching:l,data:r}=Y(y(()=>({chain:"ethereum",page:p.value,per_page:15}))),u=y(()=>{var n;return[R,...(((n=r.value)==null?void 0:n.distributions)??[]).flatMap(i=>i.breakdown.map(e=>e.protocolName)).uniq()]}),d=M(R),t=n=>d.value===R||n.protocolName===d.value,s=y(()=>{var i;const n=(((i=r.value)==null?void 0:i.distributions)??[]).map(e=>({timestamp:e.blockTime,fees:e.breakdown.filter(t).sumBy(c=>c.fees),interest:e.breakdown.filter(t).sumBy(c=>c.interest)}));return n.length===0?[]:[{symbol:"Fees",balances:n.map(e=>({timestamp:e.timestamp,balance:e.fees,tokenPrice:1}))},{symbol:"Interest",balances:n.map(e=>({timestamp:e.timestamp,balance:e.interest,tokenPrice:1}))}]});return(n,i)=>{var C,T,S,k;const e=ie,c=ae,f=oe,L=F;return g(),E("div",Ke,[m(e,{style:{"grid-area":"header"},title:"Revenue",description:"Token revenue distribution metrics"}),m(Ne,{style:{"grid-area":"kpis"}}),m(Pe,{style:{"grid-area":"chart"},distributions:((C=o(r))==null?void 0:C.distributions)??[]},null,8,["distributions"]),m(Le,{style:{"grid-area":"delta"},distributions:((T=o(r))==null?void 0:T.distributions)??[]},null,8,["distributions"]),m(xe,{style:{"grid-area":"table"},distributions:((S=o(r))==null?void 0:S.distributions)??[],count:((k=o(r))==null?void 0:k.count)??0,loading:o(l),onPage:i[0]||(i[0]=h=>p.value=h)},null,8,["distributions","count","loading"]),o(l)?(g(),D(L,{key:1,loading:"",title:"Breakdown",style:ne(`grid-area: chart-breakdown; min-height: ${o(re)}`)},null,8,["style"])):(g(),D(f,{key:0,style:{"grid-area":"chart-breakdown"},title:"Breakdown",balances:o(s),"show-dollars":!1},{actions:b(()=>[o(u).length>0?(g(),D(c,{key:0,options:o(u),selected:o(u).find(h=>h===o(d))??o(u)[0],onSelect:i[1]||(i[1]=h=>d.value=h)},{option:b(({option:h})=>[B(P(h),1)]),_:1},8,["options","selected"])):se("",!0)]),_:1},8,["balances"]))])}}}),nt=I(Oe,[["__scopeId","data-v-06d52893"]]);export{nt as default};
