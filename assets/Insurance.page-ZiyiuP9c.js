import{aJ as ie,am as C,d as V,c as T,b as w,o as y,e as b,g as d,h as o,_ as q,l as R,t as E,f as p,aw as x,m as F,ao as z,at as le,av as ce,ar as ue,ai as pe,j as de,n as W}from"./index-UmqmIgTN.js";import{_ as me}from"./ChartBalances-B-_1RIQc.js";import{_ as _e}from"./DashboardHeader-DhClZnbZ.js";import{D as G}from"./UseLightweightChart-B1yjCTma.js";import{o as u,k as I,s as l,n as c,_ as ge,t as S,b as P,m as he,p as B,d as Q,l as $,g as H,i as K,f as D,a as A,j as ve,r as X,u as Y}from"./timestamp-CCR-hA16.js";import{p as ye}from"./Pagination-vgbH7lYO.js";import{_ as be}from"./ChartApex-SRyd9ySA.js";import{c as fe}from"./ChartStylesApex-BAiz-vYN.js";import{_ as L}from"./Table-CthoDSZD.js";import{_ as J}from"./AsyncValue-CvWZqNRo.js";import{u as we,_ as ee,a as ke}from"./UsePagination-DOoZmtGP.js";import{u as te}from"./UseRelativeTime-DLBJXrTx.js";import"./Tooltip-Db5C-dpH.js";const se=u({event_type:ge(["deposit","withdraw"]),block_timestamp:c(),tx_hash:l(),block_number:c(),assets:l(),shares:l(),sender:I,owner:I}),ne=e=>({eventType:e.event_type,blockTime:S(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,assets:parseFloat(e.assets),shares:parseFloat(e.shares),sender:e.sender,owner:e.owner}),Pe=se.refine(e=>e.event_type==="deposit",{message:"Expected deposit event type"}).transform(ne),$e=se.extend({receiver:I}).refine(e=>e.event_type==="withdraw",{message:"Expected withdraw event type"}).transform(e=>({...ne(e),receiver:e.receiver})),Te=u({events:P(he([Pe,$e])),count:c(),page:c(),total_pages:c()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Fe=u({account:I,amount:l(),end_timestamp:c(),block_timestamp:c(),tx_hash:l()}).transform(e=>({account:e.account,amount:parseFloat(e.amount),end:S(e.end_timestamp),blockTime:S(e.block_timestamp),txHash:e.tx_hash})),Se=u({entries:P(Fe)}).transform(e=>({entries:e.entries})),Ce=u({timestamp:c(),token_address:l(),token_symbol:l(),apr:l()}).transform(e=>({timestamp:S(e.timestamp),tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),He=u({snapshots:P(Ce),count:c(),page:c(),total_pages:c()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),De=u({timestamp:c(),tvl:l()}).transform(e=>({timestamp:S(e.timestamp),tvl:parseFloat(e.tvl)}));u({data:P(De),count:c(),page:c(),total_pages:c()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages}));const Ae=u({address:l(),label:l().nullable(),ens:l().nullable(),position_value:l()}).transform(e=>({address:e.address,label:e.label,ens:e.ens,positionValue:parseFloat(e.position_value)})),Ue=u({total_tvl:l(),top_users_tvl:l(),others_tvl:l(),users:P(Ae)}).transform(e=>({totalTvl:parseFloat(e.total_tvl),topUsersTvl:parseFloat(e.top_users_tvl),othersTvl:parseFloat(e.others_tvl),users:e.users})),Ee=u({min_value:l(),max_value:l(),count:c()}).transform(e=>({minValue:parseFloat(e.min_value),maxValue:parseFloat(e.max_value),count:e.count})),xe=u({bins:P(Ee),total_users:c()}).transform(e=>({bins:e.bins,totalUsers:e.total_users})),Ve=u({timestamp:c(),total_staked:l(),cooldown_amount:l(),cooldown_percentage:l(),active_staked_amount:l(),active_staked_percentage:l()}).transform(e=>({timestamp:S(e.timestamp),totalStaked:parseFloat(e.total_staked),cooldownAmount:parseFloat(e.cooldown_amount),cooldownPercentage:parseFloat(e.cooldown_percentage),activeStakedAmount:parseFloat(e.active_staked_amount),activeStakedPercentage:parseFloat(e.active_staked_percentage)})),qe=u({data:P(Ve),count:c(),page:c(),total_pages:c()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),Re=u({...$,...Q,...B});async function Ie(e,s){const a=H(s),{chain:i,...t}=Re.parse(e),r=K(t),n=await D(`${a}/v1/insurance/${i}/events${r}`,void 0,s?.signal);return Te.parse(n)}const Be=u($);async function Qe(e,s){const a=H(s),{chain:i}=Be.parse(e),t=await D(`${a}/v1/insurance/${i}/cooldown_queue`,void 0,s?.signal);return Se.parse(t)}const Ke=u({...$,...Q,...B});async function Ne(e,s){const a=H(s),{chain:i,...t}=Ke.parse(e),r=K(t),n=await D(`${a}/v1/insurance/${i}/apr_history${r}`,void 0,s?.signal);return He.parse(n)}u({...$,...Q,...B});const je=u($);async function ze(e,s){const a=H(s),{chain:i}=je.parse(e),t=await D(`${a}/v1/insurance/${i}/top_users`,void 0,s?.signal);return Ue.parse(t)}const Le=u({...$,bin_count:c().int().positive().optional()});async function Je(e,s){const a=H(s),{chain:i,...t}=Le.parse(e),r=K(t),n=await D(`${a}/v1/insurance/${i}/position_histogram${r}`,void 0,s?.signal);return xe.parse(n)}const Me=u({...$,...Q,...B});async function Oe(e,s){const a=H(s),{chain:i,...t}=Me.parse(e),r=K(t),n=await D(`${a}/v1/insurance/${i}/insurance_pool_distribution_history${r}`,void 0,s?.signal);return qe.parse(n)}function We(e){return A({queryKey:["insurance-events",e],queryFn:()=>Ie(C(e)),placeholderData:ie})}function Ge(e){return A({queryKey:["insurance-cooldown-queue",e],queryFn:()=>Qe(C(e))})}function Xe(e){const{start:s,end:a}=ve({daysRange:90});return A({queryKey:["insurance-apr-history",e],queryFn:()=>ye((t,r)=>Ne({...C(e),page:t,per_page:r,start:s,end:a}).then(n=>n.snapshots),1,100)})}function Ye(e){return A({queryKey:["insurance-top-users",e],queryFn:()=>ze(C(e))})}function Ze(e){return A({queryKey:["insurance-position-hist",e],queryFn:()=>Je(C(e))})}function et(e){return A({queryKey:["insurance-distribution-hist",e],queryFn:()=>Oe(C(e))})}const tt=V({__name:"ChartPositions",props:{bins:{}},setup(e){const s=T(()=>fe({chart:{type:"bar",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1}},xaxis:{categories:a.value,labels:{formatter:t=>t,rotate:-60},tickPlacement:"on"},yaxis:{labels:{formatter:t=>t}},plotOptions:{bar:{columnWidth:"50%"}},dataLabels:{enabled:!1},tooltip:{followCursor:!1,enabled:!0,intersect:!0,custom:t=>{const r=t.series[0][t.dataPointIndex];return`<div><b>Range</b>: ${a.value[t.dataPointIndex]}</div><div><b>Users</b>: ${r}</div>`}}})),a=T(()=>e.bins.map(t=>{const r=t.minValue?`${X(t.minValue,0,"dollar")}${Y(t.minValue)}`:"0",n=t.maxValue?`${X(t.maxValue,0,"dollar")}${Y(t.maxValue)}`:"0";return`${r} - ${n}`})),i=T(()=>[{name:"Users",data:e.bins.map(t=>t.count)}]);return(t,r)=>{const n=be,k=q;return y(),w(k,{title:"User positions"},{default:b(()=>[d(n,{options:o(s),series:o(i)},null,8,["options","series"])]),_:1})}}}),st=R(tt,[["__scopeId","data-v-525b8a17"]]),nt=["href"],ot={class:"end"},at={class:"end"},rt=["href"],Z=10,it=V({__name:"TableCooldowns",props:{cooldowns:{}},setup(e){const{page:s,rowsPage:a,onPage:i}=we(E(()=>e.cooldowns),Z),{relativeTime:t}=te();return(r,n)=>{const k=ee,m=J,f=L,U=q;return y(),w(U,{title:"Cooldown Queue"},{actions:b(()=>[d(k,{"items-count":r.cooldowns.length,"items-per-page":Z,page:o(s),onPage:o(i)},null,8,["items-count","page","onPage"])]),default:b(()=>[d(f,{rows:o(a),columns:["User",{label:"Staked reUSD",align:"end"},{label:"Time",align:"end"}]},{row:b(({item:v})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${v.account.address}`,onClick:n[0]||(n[0]=x(()=>{},["stop"]))},F(v.account.ens||("addressShort"in r?r.addressShort:o(z))(v.account.address)),9,nt)]),p("div",ot,[d(m,{type:"dollar",value:v.amount,precision:2,"show-symbol":!1},null,8,["value"])]),p("div",at,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${v.txHash}`,onClick:n[1]||(n[1]=x(()=>{},["stop"]))},F(o(t)(v.end.getUTCTimestamp())),9,rt)])]),_:1},8,["rows"])]),_:1})}}}),lt=R(it,[["__scopeId","data-v-b4fa2168"]]),ct=["href"],ut={class:"end"},pt={class:"end"},dt=["href"],mt=V({__name:"TableEvents",props:{events:{},count:{}},emits:["page"],setup(e,{emit:s}){const a=s,{page:i,onPage:t}=ke(),r=le(i,200);ce(r,m=>{a("page",m)});const{relativeTime:n}=te(),k=m=>{switch(m.eventType){case"deposit":return"Deposit";case"withdraw":return"Withdraw"}};return(m,f)=>{const U=ee,v=J,N=L,j=q;return y(),w(j,{title:"Events"},{actions:b(()=>[d(U,{"items-count":m.count,"items-per-page":10,page:o(i),onPage:o(t)},null,8,["items-count","page","onPage"])]),default:b(()=>[d(N,{rows:m.events,columns:["Type","Owner",{label:"reUSD",align:"end"},{label:"Time",align:"end"}]},{row:b(({item:_})=>[p("div",{class:ue({green:_.eventType==="deposit",red:_.eventType==="withdraw"})},F(k(_)),3),p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${_.owner.address}`,onClick:f[0]||(f[0]=x(()=>{},["stop"]))},F(_.owner.ens||("addressShort"in m?m.addressShort:o(z))(_.owner.address)),9,ct)]),p("div",ut,[d(v,{type:"dollar",value:_.assets,precision:2,"show-symbol":!1},null,8,["value"])]),p("div",pt,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${_.txHash}`,onClick:f[1]||(f[1]=x(()=>{},["stop"]))},F(o(n)(_.blockTime.getUTCTimestamp())),9,dt)])]),_:1},8,["rows"])]),_:1})}}}),_t=R(mt,[["__scopeId","data-v-3718948b"]]),gt=["href"],ht={class:"end"},vt=V({__name:"TableTopUsers",props:{topUsers:{}},setup(e){return(s,a)=>{const i=J,t=L,r=q;return y(),w(r,{title:"Top Users"},{default:b(()=>[d(t,{rows:s.topUsers,columns:["Address",{label:"Staked reUSD",align:"end"}]},{row:b(({item:n})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${n.address}`,onClick:a[0]||(a[0]=x(()=>{},["stop"]))},F(n.ens||("addressShort"in s?s.addressShort:o(z))(n.address)),9,gt)]),p("div",ht,[d(i,{type:"dollar",value:n.positionValue,precision:2,"show-symbol":!1},null,8,["value"])])]),_:1},8,["rows"])]),_:1})}}}),yt=R(vt,[["__scopeId","data-v-d27f5415"]]),bt={class:"dashboard"},ft=V({__name:"Insurance.page",setup(e){const{isFetching:s,data:a}=Xe({chain:"ethereum"}),i=T(()=>(a.value??[]).groupBy(g=>g.tokenAddress).entries().orderBy(([,g])=>g[0].tokenSymbol,"desc").map(([,g])=>({symbol:g[0].tokenSymbol,balances:g.map(h=>({timestamp:h.timestamp,balance:h.apr,tokenPrice:1}))}))),t=pe(1),{isFetching:r,data:n}=We(T(()=>({chain:"ethereum",page:t.value,per_page:10}))),{isFetching:k,data:m}=Ye(E(()=>({chain:"ethereum"}))),{isFetching:f,data:U}=Ge(E(()=>({chain:"ethereum"}))),{isFetching:v,data:N}=Ze(E(()=>({chain:"ethereum"}))),{isFetching:j,data:_}=et(E(()=>({chain:"ethereum"}))),oe=T(()=>{const g=_.value?.data??[];return g.length===0?[]:[{symbol:"In cooldown",balances:g.map(h=>({timestamp:h.timestamp,balance:h.cooldownAmount,tokenPrice:1}))},{symbol:"Active staked",balances:g.map(h=>({timestamp:h.timestamp,balance:h.activeStakedAmount,tokenPrice:1}))}]});return(g,h)=>{const ae=_e,M=me,O=q;return y(),de("div",bt,[d(ae,{style:{"grid-area":"header"},title:"Insurance",description:"Insurance pool metrics for Resupply including APR, TVL and positions"}),o(s)?(y(),w(O,{key:1,loading:"",title:"APR",style:W(`grid-area: apr; min-height: ${o(G)}`)},null,8,["style"])):(y(),w(M,{key:0,style:{"grid-area":"apr"},title:"APR",balances:o(i),loading:o(s),"show-dollars":!1},null,8,["balances","loading"])),d(_t,{style:{"grid-area":"events"},events:o(n)?.events??[],count:o(n)?.count??0,loading:o(r),onPage:h[0]||(h[0]=re=>t.value=re)},null,8,["events","count","loading"]),d(lt,{style:{"grid-area":"cooldowns"},cooldowns:o(U)?.entries??[],loading:o(f)},null,8,["cooldowns","loading"]),o(j)?(y(),w(O,{key:3,loading:"",title:"Staked",style:W(`grid-area: chart-staked; min-height: ${o(G)}`)},null,8,["style"])):(y(),w(M,{key:2,style:{"grid-area":"chart-staked"},title:"Staked (reUSD)",balances:o(oe),"show-dollars":!1},null,8,["balances"])),d(yt,{style:{"grid-area":"top-users"},"top-users":o(m)?.users??[],loading:o(k)},null,8,["top-users","loading"]),d(st,{style:{"grid-area":"positions"},bins:o(N)?.bins??[],loading:o(v)},null,8,["bins","loading"])])}}}),xt=R(ft,[["__scopeId","data-v-869247cc"]]);export{xt as default};
