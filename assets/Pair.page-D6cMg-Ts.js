import{_ as de,a as _e}from"./TabItem.vue_vue_type_script_setup_true_lang-D6W5WPtw.js";import{at as B,aI as Q,d as C,al as J,an as A,j as b,o as h,h as D,w as g,e as i,f as _,g as k,b as R,ax as F,i as N,ao as S,u as s,_ as T,ae as G,c as w,aq as j,ay as te,av as oe,az as se,t as me,aE as he,aF as ge,ar as ve,aC as L}from"./index-DAmMJpTU.js";import{u as fe,p as be}from"./util-DEDNvvxi.js";import{u as E,r as re,a as ne}from"./Number-BwCHtbMI.js";import{a as V,f as x,_ as H}from"./fetch-S3nWqVm-.js";import{_ as ye,o as y,s as d,a as I,n as v,t as U,f as M,p as O,c as z,d as K,g as W,e as $e}from"./timestamp-Ki00Lgd1.js";import{p as ke}from"./Pagination-vgbH7lYO.js";import{_ as X}from"./Table-DQn4OZ6C.js";import{a as Y,_ as Z}from"./UsePagination-rqSrHaF6.js";import{u as ee}from"./UseRelativeTime-CKRKYyBO.js";import{_ as we}from"./KPI-DWk_VgbO.js";import{u as le,c as ie,a as ce,_ as pe}from"./UseLightweightChart-Cn6_rK2P.js";import{_ as ue}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-DFTTHLNa.js";import{b as ae,a as Ce}from"./UseTabNavigation-BMoLa5Lo.js";import"./Tooltip-Yo6BbvH-.js";const qe=ye(["borrow","add_collateral","remove_collateral","repay","redeem","liquidate","leveraged_position","repay_with_collateral"]),Te=y({token_address:d(),token_symbol:d(),apr:d()}).transform(e=>({tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),Pe=y({date_timestamp:v(),total_collateral:d(),total_underlying:d(),exchange_rate:d(),total_debt:d(),active_positions_count:v(),borrow_limit:d(),utilization_rate:d(),interest_rate:d(),claimable_fees:d(),claimable_other_fees:d(),borrow_cost_apr:d(),base_apr:d(),rewards:I(Te)}).transform(e=>({time:U(e.date_timestamp),totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),exchangeRate:parseFloat(e.exchange_rate),totalDebt:parseFloat(e.total_debt),activePositionsCount:e.active_positions_count,borrowLimit:parseFloat(e.borrow_limit),utilizationRate:parseFloat(e.utilization_rate),interestRate:parseFloat(e.interest_rate),claimableFees:parseFloat(e.claimable_fees),claimableOtherFees:parseFloat(e.claimable_other_fees),aprBorrowCost:parseFloat(e.borrow_cost_apr),aprBase:parseFloat(e.base_apr),rewards:e.rewards})),Fe=y({snapshots:I(Pe),count:v(),page:v(),total_pages:v()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),Re=y({event_type:qe,block_timestamp:v(),tx_hash:d(),block_number:v(),collateral_change:d(),debt_change:d()}).transform(e=>({eventType:e.event_type,blockTime:U(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,collateralChange:parseFloat(e.collateral_change),debtChange:parseFloat(e.debt_change)})),Se=y({events:I(Re),count:v(),page:v(),total_pages:v()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Le=y({block_timestamp:v(),tx_hash:d(),block_number:v(),caller:M,amount:d(),collateral_freed:d(),protocol_fee:d(),debt_reduction:d()}).transform(e=>({blockTime:U(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,caller:e.caller,amount:parseFloat(e.amount),collateralFreed:parseFloat(e.collateral_freed),protocolFee:parseFloat(e.protocol_fee),debtReduction:parseFloat(e.debt_reduction)})),De=y({events:I(Le),count:v(),page:v(),total_pages:v()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Ie=y({block_timestamp:v(),tx_hash:d(),block_number:v(),borrower:M,liquidator:M,collateral_for_liquidator:d(),shares_liquidated:d(),amount_liquidator_to_repay:d()}).transform(e=>({blockTime:U(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,borrower:e.borrower,liquidator:e.liquidator,collateralForLiquidator:parseFloat(e.collateral_for_liquidator),sharesLiquidated:parseFloat(e.shares_liquidated),amountLiquidatorToRepay:parseFloat(e.amount_liquidator_to_repay)})),Ne=y({events:I(Ie),count:v(),page:v(),total_pages:v()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Be=y({...K,...z,...O});async function Ae(e,o){const c=W(),{pair_id:l,...p}=Be.parse(e),a=V(p),n=await x(`${c}/v1/pairs/${l}/snapshots${a}`,void 0,o==null?void 0:o.signal);return Fe.parse(n)}const Ee=y({...K,...z,...O});async function Ve(e,o){const c=W(),{pair_id:l,...p}=Ee.parse(e),a=V(p),n=await x(`${c}/v1/pairs/${l}/collateral_events${a}`,void 0,o==null?void 0:o.signal);return Se.parse(n)}const xe=y({...K,...z,...O});async function He(e,o){const c=W(),{pair_id:l,...p}=xe.parse(e),a=V(p),n=await x(`${c}/v1/pairs/${l}/redemptions${a}`,void 0,o==null?void 0:o.signal);return De.parse(n)}const Ue=y({...K,...z,...O});async function Oe(e,o){const c=W(),{pair_id:l,...p}=Ue.parse(e),a=V(p),n=await x(`${c}/v1/pairs/${l}/liquidations${a}`,void 0,o==null?void 0:o.signal);return Ne.parse(n)}function ze(e){const{start:o,end:c}=$e({daysRange:90});return E({queryKey:["pairs-snapshots",e],queryFn:()=>ke((p,a)=>Ae({...B(e),page:p,per_page:a,start:o,end:c}).then(n=>n.snapshots),1,100)})}function Ke(e){return E({queryKey:["pairs-collateral-events",e],queryFn:()=>Ve(B(e)),placeholderData:Q})}function We(e){return E({queryKey:["pairs-redemptions",e],queryFn:()=>He(B(e)),placeholderData:Q})}function je(e){return E({queryKey:["pairs-liquidations",e],queryFn:()=>Oe(B(e)),placeholderData:Q})}const Me={class:"end"},Qe={key:0,style:{display:"flex",gap:"1ch"}},Je={class:"end"},Ge={key:0,style:{display:"flex",gap:"1ch"}},Xe={class:"end"},Ye=["href"],Ze=C({__name:"TableCollateralEvents",props:{events:{},count:{},pair:{}},emits:["page"],setup(e,{emit:o}){const c=o,{page:l,onPage:p}=Y(),a=J(l,200);A(a,r=>{c("page",r)});const{relativeTime:n}=ee(),t=r=>{switch(r.eventType){case"add_collateral":return"Add collateral";case"borrow":return"Borrow";case"remove_collateral":return"Remove collateral";case"repay":return"Repay";case"redeem":return"Redeem";case"liquidate":return"Liquidate";case"leveraged_position":return"Lev. position";case"repay_with_collateral":return"Repay with col"}};return(r,u)=>{const f=Z,P=H,$=X,m=D;return h(),b(m,{title:"Events"},{actions:g(()=>[i(f,{"items-count":r.count,"items-per-page":10,page:s(l),onPage:s(p)},null,8,["items-count","page","onPage"])]),default:g(()=>[i($,{rows:r.events,columns:["Type",{label:"Δ Debt",align:"end"},{label:"Δ Collateral",align:"end"},{label:"Time",align:"end"}]},{row:g(({item:q})=>[_("div",null,k(t(q)),1),_("div",Me,[q.debtChange!==0?(h(),R("div",Qe,[i(P,{type:"dollar",value:q.debtChange/10**18,precision:4,"show-symbol":!1},null,8,["value"]),N(" "+k(r.pair.tokenDebt.symbol),1)])):F("",!0)]),_("div",Je,[q.collateralChange!==0?(h(),R("div",Ge,[i(P,{type:"dollar",value:q.collateralChange/10**18,precision:4,"show-symbol":!1},null,8,["value"]),N(" "+k(r.pair.tokenCollateral.symbol),1)])):F("",!0)]),_("div",Xe,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${q.txHash}`,onClick:u[0]||(u[0]=S(()=>{},["stop"]))},k(s(n)(q.blockTime.getUTCTimestamp())),9,Ye)])]),_:1},8,["rows"])]),_:1})}}}),ea=T(Ze,[["__scopeId","data-v-a900c8c4"]]),aa={class:"dashboard-grid"},ta=C({__name:"Collateral",props:{pair:{}},setup(e){const o=G(1),{isFetching:c,data:l}=Ke(w(()=>({pair_id:e.pair.pairId,page:o.value,per_page:15})));return(p,a)=>{var n,t;return h(),R("div",aa,[i(ea,{events:((n=s(l))==null?void 0:n.events)??[],count:((t=s(l))==null?void 0:t.count)??0,loading:s(c),pair:p.pair,onPage:a[0]||(a[0]=r=>o.value=r)},null,8,["events","count","loading","pair"])])}}}),oa=T(ta,[["__scopeId","data-v-ff086716"]]),sa={},ra={class:"dashboard-grid"};function na(e,o){return h(),R("div",ra,"Health goes here")}const la=T(sa,[["render",na],["__scopeId","data-v-f3492742"]]),ia={class:"end"},ca=["href"],pa={class:"end"},ua=["href"],da={class:"end"},_a={class:"end"},ma={class:"end"},ha={class:"end"},ga=["href"],va=C({__name:"TableLiquidations",props:{liquidations:{},count:{}},emits:["page"],setup(e,{emit:o}){const c=o,{page:l,onPage:p}=Y(),a=J(l,200);A(a,t=>{c("page",t)});const{relativeTime:n}=ee();return(t,r)=>{const u=Z,f=H,P=X,$=D;return h(),b($,{title:"Liquidations"},{actions:g(()=>[i(u,{"items-count":t.count,"items-per-page":10,page:s(l),onPage:s(p)},null,8,["items-count","page","onPage"])]),default:g(()=>[i(P,{rows:t.liquidations,columns:["Borrower","Liquidator",{label:"Shares liquidated",align:"end"},{label:"Collat for liquidator",align:"end"},{label:"Amount to repay",align:"end"},{label:"Time",align:"end"}]},{row:g(({item:m})=>[_("div",ia,[_("a",{target:"_blank",href:`https://etherscan.io/address/${m.borrower}`,onClick:r[0]||(r[0]=S(()=>{},["stop"]))},k(m.borrower.ens||("addressShort"in t?t.addressShort:s(j))(m.borrower.address)),9,ca)]),_("div",pa,[_("a",{target:"_blank",href:`https://etherscan.io/address/${m.liquidator}`,onClick:r[1]||(r[1]=S(()=>{},["stop"]))},k(m.liquidator.ens||("addressShort"in t?t.addressShort:s(j))(m.liquidator.address)),9,ua)]),_("div",da,[i(f,{type:"dollar",value:m.sharesLiquidated,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",_a,[i(f,{type:"dollar",value:m.collateralForLiquidator,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",ma,[i(f,{type:"dollar",value:m.amountLiquidatorToRepay,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",ha,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${m.txHash}`,onClick:r[2]||(r[2]=S(()=>{},["stop"]))},k(s(n)(m.blockTime.getUTCTimestamp())),9,ga)])]),_:1},8,["rows"])]),_:1})}}}),fa=T(va,[["__scopeId","data-v-e5fce9da"]]),ba={class:"dashboard-grid"},ya=C({__name:"Liquidations",props:{pair:{}},setup(e){const o=G(1),{isFetching:c,data:l}=je(w(()=>({pair_id:e.pair.pairId,page:o.value,per_page:15})));return(p,a)=>{var n,t;return h(),R("div",ba,[i(fa,{liquidations:((n=s(l))==null?void 0:n.events)??[],count:((t=s(l))==null?void 0:t.count)??0,loading:s(c),onPage:a[0]||(a[0]=r=>o.value=r)},null,8,["liquidations","count","loading"])])}}}),$a=T(ya,[["__scopeId","data-v-0dd6af85"]]),ka={style:{display:"flex"}},wa={ref:"chartRef",class:"chart"},Ca=C({__name:"ChartApr",props:{apr:{}},setup(e){const o=te(),c=oe("card"),{chart:l,series:p}=le({createChartOptions:ce(),series:ie({name:"apr",color:w(()=>o.value.colors.blue),formatter:n=>`$${re(n,1,"dollar")}${ne(n)}`,minMove:.01})});se(a);function a(){if(!l.value||!p.apr)return;const n=e.apr.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.apr})).uniqWith((t,r)=>t.time===r.time).orderBy(t=>t.time,"asc");n.length>0&&p.apr.setData(n),l.value.timeScale().fitContent()}return(n,t)=>{const r=ue,u=pe,f=D;return h(),b(f,{ref_key:"card",ref:c,title:"APR"},{actions:g(()=>[_("div",ka,[i(r,{filename:"apr",series:s(p)},null,8,["series"]),i(u,{chart:s(l),target:s(c)},null,8,["chart","target"])])]),default:g(()=>[_("div",wa,null,512)]),_:1},512)}}}),qa={style:{display:"flex"}},Ta={ref:"chartRef",class:"chart"},Pa=C({__name:"ChartTvl",props:{tvl:{}},setup(e){const o=te(),c=oe("card"),{chart:l,series:p}=le({createChartOptions:ce(),series:ie({name:"tvl",color:w(()=>o.value.colors.blue),formatter:n=>`$${re(n,1,"dollar")}${ne(n)}`})});se(a);function a(){if(!l.value||!p.tvl)return;const n=e.tvl.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.tvl})).uniqWith((t,r)=>t.time===r.time).orderBy(t=>t.time,"asc");n.length>0&&p.tvl.setData(n),l.value.timeScale().fitContent()}return(n,t)=>{const r=ue,u=pe,f=D;return h(),b(f,{ref_key:"card",ref:c,title:"TVL"},{actions:g(()=>[_("div",qa,[i(r,{filename:"tvl",series:s(p)},null,8,["series"]),i(u,{chart:s(l),target:s(c)},null,8,["chart","target"])])]),default:g(()=>[_("div",Ta,null,512)]),_:1},512)}}}),Fa={class:"dashboard-grid"},Ra=C({__name:"Overview",props:{pair:{}},setup(e){const{isFetching:o,data:c}=ze(me(()=>({pair_id:e.pair.pairId}))),l=w(()=>(c.value??[]).map(a=>({timestamp:a.time,tvl:a.totalCollateral/10**21}))),p=w(()=>(c.value??[]).map(a=>({timestamp:a.time,apr:a.aprBase})));return(a,n)=>{const t=H,r=we;return h(),R("div",Fa,[i(r,{style:{"grid-area":"kpi1"},label:"Positions","has-value":!!a.pair},{default:g(()=>{var u;return[i(t,{precision:0,value:(u=a.pair)==null?void 0:u.activePositionsCount},null,8,["value"])]}),_:1},8,["has-value"]),i(r,{style:{"grid-area":"kpi2"},label:"TVL","has-value":!!a.pair},{default:g(()=>{var u;return[i(t,{type:"dollar",precision:2,value:((u=a.pair)==null?void 0:u.totalCollateral)&&a.pair.totalCollateral/10**21,"show-symbol":!1},null,8,["value"]),N(" "+k(a.pair.tokenUnderlying.symbol),1)]}),_:1},8,["has-value"]),i(r,{style:{"grid-area":"kpi3"},label:"Interest Rate","has-value":!!a.pair},{default:g(()=>{var u;return[i(t,{type:"percentage",precision:2,value:((u=a.pair)==null?void 0:u.interestRate)&&a.pair.interestRate/10**8},null,8,["value"])]}),_:1},8,["has-value"]),i(r,{style:{"grid-area":"kpi4"},label:"Utilization Rate","has-value":!!a.pair},{default:g(()=>{var u;return[i(t,{type:"percentage",precision:2,value:(u=a.pair)==null?void 0:u.utilizationRate},null,8,["value"])]}),_:1},8,["has-value"]),i(Pa,{style:{"grid-area":"tvl"},tvl:s(l),loading:s(o)},null,8,["tvl","loading"]),i(Ca,{style:{"grid-area":"apr"},apr:s(p),loading:s(o)},null,8,["apr","loading"])])}}}),Sa=T(Ra,[["__scopeId","data-v-d0afe2d4"]]),La={class:"end"},Da=["href"],Ia={class:"end"},Na={class:"end"},Ba={class:"end",style:{display:"flex",gap:"1ch"}},Aa={class:"end"},Ea={class:"end"},Va=["href"],xa=C({__name:"TableRedemptions",props:{redemptions:{},count:{},pair:{}},emits:["page"],setup(e,{emit:o}){const c=o,{page:l,onPage:p}=Y(),a=J(l,200);A(a,t=>{c("page",t)});const{relativeTime:n}=ee();return(t,r)=>{const u=Z,f=H,P=X,$=D;return h(),b($,{title:"Redemptions"},{actions:g(()=>[i(u,{"items-count":t.count,"items-per-page":10,page:s(l),onPage:s(p)},null,8,["items-count","page","onPage"])]),default:g(()=>[i(P,{rows:t.redemptions,columns:["Caller",{label:"reUSD",align:"end"},{label:"Debt reduction",align:"end"},{label:"Collateral freed",align:"end"},{label:"Protocol fee",align:"end"},{label:"Time",align:"end"}]},{row:g(({item:m})=>[_("div",La,[_("a",{target:"_blank",href:`https://etherscan.io/address/${m.caller}`,onClick:r[0]||(r[0]=S(()=>{},["stop"]))},k(m.caller.ens||("addressShort"in t?t.addressShort:s(j))(m.caller.address)),9,Da)]),_("div",Ia,[i(f,{type:"dollar",value:m.amount/10**18,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Na,[i(f,{type:"dollar",value:m.debtReduction/10**18,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Ba,[i(f,{type:"dollar",value:m.collateralFreed/10**18,precision:2,"show-symbol":!1},null,8,["value"]),N(" "+k(t.pair.tokenCollateral.symbol),1)]),_("div",Aa,[i(f,{type:"dollar",value:m.protocolFee/10**18,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Ea,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${m.txHash}`,onClick:r[1]||(r[1]=S(()=>{},["stop"]))},k(s(n)(m.blockTime.getUTCTimestamp())),9,Va)])]),_:1},8,["rows"])]),_:1})}}}),Ha=T(xa,[["__scopeId","data-v-bb85efe6"]]),Ua={class:"dashboard-grid"},Oa=C({__name:"Redemptions",props:{pair:{}},setup(e){const o=G(1),{isFetching:c,data:l}=We(w(()=>({pair_id:e.pair.pairId,page:o.value,per_page:15})));return(p,a)=>{var n,t;return h(),R("div",Ua,[i(Ha,{redemptions:((n=s(l))==null?void 0:n.events)??[],count:((t=s(l))==null?void 0:t.count)??0,loading:s(c),pair:p.pair,onPage:a[0]||(a[0]=r=>o.value=r)},null,8,["redemptions","count","loading","pair"])])}}}),za=T(Oa,[["__scopeId","data-v-eda307c4"]]),Ka={class:"dashboard"},Wa=C({__name:"Pair.page",setup(e){const o=ae("protocolName"),c=ae("pairId",void 0,{transform:Number}),{isFetching:l,data:p}=fe(w(()=>({chain:"ethereum",protocol_name:o.value})),w(()=>!!o.value)),a=w(()=>(p.value??[]).find(u=>u.pairId===c.value)),{crumbs:n}=he(ge());A(a,u=>{n.value=[{id:"protocols",label:"Protocols",pathName:"protocols",params:()=>({protocolName:o.value})},{id:"protocol",label:o.value,pathName:"protocols",params:()=>({protocolName:o.value})},{id:"pair",label:`Pair: ${u!=null&&u.name?be(u.name):"?"}`}]},{immediate:!0});const{tabActive:t,tabActiveIndex:r}=Ce(["overview","collateral","redemptions","liquidations","health"],"pair",void 0,{tabParamName:"pairTab"});return(u,f)=>{const P=ve,$=de,m=_e;return h(),R("div",Ka,[i(P,{loading:s(l)},null,8,["loading"]),!s(l)&&s(a)?(h(),b(m,{key:0,active:s(r),onTab:f[0]||(f[0]=q=>r.value=q.index)},{default:g(()=>[i($,{header:"Overview"},{default:g(()=>[(h(),b(L,null,[s(t)==="overview"?(h(),b(Sa,{key:0,pair:s(a)},null,8,["pair"])):F("",!0)],1024))]),_:1}),i($,{header:"Collateral"},{default:g(()=>[(h(),b(L,null,[s(t)==="collateral"?(h(),b(oa,{key:0,pair:s(a)},null,8,["pair"])):F("",!0)],1024))]),_:1}),i($,{header:"Redemptions"},{default:g(()=>[(h(),b(L,null,[s(t)==="redemptions"?(h(),b(za,{key:0,pair:s(a)},null,8,["pair"])):F("",!0)],1024))]),_:1}),i($,{header:"Liquidation"},{default:g(()=>[(h(),b(L,null,[s(t)==="liquidations"?(h(),b($a,{key:0,pair:s(a)},null,8,["pair"])):F("",!0)],1024))]),_:1}),i($,{header:"Health"},{default:g(()=>[(h(),b(L,null,[s(t)==="health"?(h(),b(la,{key:0,pair:s(a)},null,8,["pair"])):F("",!0)],1024))]),_:1})]),_:1},8,["active"])):F("",!0)])}}}),lt=T(Wa,[["__scopeId","data-v-84d1405d"]]);export{lt as default};
