var I=e=>{throw TypeError(e)};var x=(e,t,s)=>t.has(e)||I("Cannot "+s);var i=(e,t,s)=>(x(e,t,"read from private field"),s?s.call(e):t.get(e)),f=(e,t,s)=>t.has(e)?I("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),p=(e,t,s,r)=>(x(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),_=(e,t,s)=>(x(e,t,"access private method"),s);import{Q as Z,t as L,f as T,b as ee,a as j}from"./Number-D-_ywgC3.js";import{aN as te,aO as A,aP as se,aQ as re,c as w,h as oe,aR as ne,aS as ie,aq as B,ai as ae,aw as J}from"./index-C4bxLmri.js";import{o as y,s as a,n as b,a as H,f as V,p as le,g as G}from"./AsyncValue-Brd_Goit.js";import{p as ce}from"./Pagination-vgbH7lYO.js";function K(e,t){return e.filter(s=>!t.includes(s))}function ue(e,t,s){const r=e.slice(0);return r[t]=s,r}var k,h,O,R,m,v,C,P,q,u,S,U,M,$,z,N,pe=(N=class extends te{constructor(t,s,r){super();f(this,u);f(this,k);f(this,h);f(this,O);f(this,R);f(this,m);f(this,v);f(this,C);f(this,P);f(this,q,[]);p(this,k,t),p(this,R,r),p(this,O,[]),p(this,m,[]),p(this,h,[]),this.setQueries(s)}onSubscribe(){this.listeners.size===1&&i(this,m).forEach(t=>{t.subscribe(s=>{_(this,u,$).call(this,t,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,i(this,m).forEach(t=>{t.destroy()})}setQueries(t,s){p(this,O,t),p(this,R,s),A.batch(()=>{const r=i(this,m),n=_(this,u,M).call(this,i(this,O));p(this,q,n),n.forEach(c=>c.observer.setOptions(c.defaultedQueryOptions));const o=n.map(c=>c.observer),l=o.map(c=>c.getCurrentResult()),d=o.some((c,g)=>c!==r[g]);r.length===o.length&&!d||(p(this,m,o),p(this,h,l),this.hasListeners()&&(K(r,o).forEach(c=>{c.destroy()}),K(o,r).forEach(c=>{c.subscribe(g=>{_(this,u,$).call(this,c,g)})}),_(this,u,z).call(this)))})}getCurrentResult(){return i(this,h)}getQueries(){return i(this,m).map(t=>t.getCurrentQuery())}getObservers(){return i(this,m)}getOptimisticResult(t,s){const r=_(this,u,M).call(this,t),n=r.map(o=>o.observer.getOptimisticResult(o.defaultedQueryOptions));return[n,o=>_(this,u,U).call(this,o??n,s),()=>_(this,u,S).call(this,n,r)]}},k=new WeakMap,h=new WeakMap,O=new WeakMap,R=new WeakMap,m=new WeakMap,v=new WeakMap,C=new WeakMap,P=new WeakMap,q=new WeakMap,u=new WeakSet,S=function(t,s){return s.map((r,n)=>{const o=t[n];return r.defaultedQueryOptions.notifyOnChangeProps?o:r.observer.trackResult(o,l=>{s.forEach(d=>{d.observer.trackProp(l)})})})},U=function(t,s){return s?((!i(this,v)||i(this,h)!==i(this,P)||s!==i(this,C))&&(p(this,C,s),p(this,P,i(this,h)),p(this,v,se(i(this,v),s(t)))),i(this,v)):t},M=function(t){const s=new Map(i(this,m).map(n=>[n.options.queryHash,n])),r=[];return t.forEach(n=>{const o=i(this,k).defaultQueryOptions(n),l=s.get(o.queryHash);l?r.push({defaultedQueryOptions:o,observer:l}):r.push({defaultedQueryOptions:o,observer:new Z(i(this,k),o)})}),r},$=function(t,s){const r=i(this,m).indexOf(t);r!==-1&&(p(this,h,ue(i(this,h),r,s)),_(this,u,z).call(this))},z=function(){var t;if(this.hasListeners()){const s=i(this,v),r=_(this,u,S).call(this,i(this,h),i(this,q)),n=_(this,u,U).call(this,r,(t=i(this,R))==null?void 0:t.combine);s!==n&&A.batch(()=>{this.listeners.forEach(o=>{o(i(this,h))})})}},N);function he({queries:e,...t},s){const r=re(),n=w(()=>oe(e).map(D=>{const Q=ne(D);typeof Q.enabled=="function"&&(Q.enabled=D.enabled());const E=r.defaultQueryOptions(Q);return E._optimisticResults=r.isRestoring.value?"isRestoring":"optimistic",E})),o=new pe(r,n.value,t),l=()=>{const[g,D]=o.getOptimisticResult(n.value,t.combine);return D(g.map((Q,E)=>({...Q,refetch:async(...X)=>{const[{[E]:Y}]=o.getOptimisticResult(n.value,t.combine);return Y.refetch(...X)}})))},d=ie(l());let c=()=>{};return B(r.isRestoring,g=>{g||(c(),c=o.subscribe(()=>{d.value=l()}),d.value=l())},{immediate:!0}),B(n,g=>{o.setQueries(g,t),d.value=l()}),ae(()=>{c()}),d}const me=y({name:a(),protocol_id:b(),pairs_count:b(),active_positions_count:b(),total_collateral:a(),total_underlying:a(),total_debt:a()}).transform(e=>({name:e.name,protocolId:e.protocol_id,pairsCount:e.pairs_count,activePositionsCount:e.active_positions_count,totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),totalDebt:parseFloat(e.total_debt)})),be=y({protocols:H(me),count:b()}).transform(e=>({protocols:e.protocols,count:e.count})),F=y({symbol:a(),name:a(),address:a(),precision:b()}).transform(e=>({symbol:e.symbol,name:e.name,address:e.address,precision:e.precision})),fe=y({token_address:a(),token_symbol:a(),apr:a()}).transform(e=>({tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),_e=y({pair_id:b(),name:a(),address:a(),total_collateral:a(),total_underlying:a(),exchange_rate:a(),total_debt:a(),active_positions_count:b(),borrow_limit:a(),utilization_rate:a(),interest_rate:a(),claimable_fees:a(),claimable_other_fees:a(),block_timestamp:b(),last_redemption:b().nullable(),redemption_fee_10k:a(),borrow_cost_apr:a(),base_apr:a(),rewards:H(fe),collateral_token:F,debt_token:F,underlying_token:F,pair_collateral_token:F,pair_underlying_token:F}).transform(e=>({pairId:e.pair_id,name:e.name,address:e.address,totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),exchangeRate:parseFloat(e.exchange_rate),totalDebt:parseFloat(e.total_debt),activePositionsCount:e.active_positions_count,borrowLimit:parseFloat(e.borrow_limit),utilizationRate:parseFloat(e.utilization_rate),interestRate:parseFloat(e.interest_rate),claimableFees:parseFloat(e.claimable_fees),claimableOtherFees:parseFloat(e.claimable_other_fees),blockTime:L(e.block_timestamp),lastRedemption:e.last_redemption?L(e.last_redemption):null,redemptionFee10k:parseFloat(e.redemption_fee_10k),aprBorrowCost:parseFloat(e.borrow_cost_apr),aprBase:parseFloat(e.base_apr),rewards:e.rewards,tokenCollateral:e.collateral_token,tokenDebt:e.debt_token,tokenUnderlying:e.underlying_token,tokenPairCollateral:e.pair_collateral_token,tokenPairUnderyling:e.pair_underlying_token})),de=y({pairs:H(_e),count:b(),page:b(),total_pages:b()}).transform(e=>({pairs:e.pairs,count:e.count,page:e.page,totalPages:e.total_pages})),ge=y(V);async function ve(e,t){const s=G(t),{chain:r}=ge.parse(e),n=await T(`${s}/v1/protocols/overview/${r}`,void 0,t==null?void 0:t.signal);return be.parse(n)}const ye=y({...V,...le,protocol_name:a()});async function we(e,t){const s=G(t),{chain:r,protocol_name:n,...o}=ye.parse(e),l=ee(o),d=await T(`${s}/v1/protocols/${r}/${n}/pairs${l}`,void 0,t==null?void 0:t.signal);return de.parse(d)}function ke(e){return j({queryKey:["protocols-overview",e],queryFn:()=>ve(J(e))})}function W(e){return{queryKey:["protocols-pairs",e],queryFn:()=>ce((s,r)=>we({...J(e),page:s,per_page:r}).then(n=>n.pairs),1,100)}}function Pe(e,t){return j({...W(e),enabled:t})}function qe(){const{data:e}=ke({chain:"ethereum"}),t=w(()=>{var o;return(((o=e.value)==null?void 0:o.protocols)??[]).map(l=>l.name)}),s=w(()=>{var o;return(((o=e.value)==null?void 0:o.count)??0)>0}),r=w(()=>t.value.map(o=>({...W({chain:"ethereum",protocol_name:o}),enabled:s}))),n=he({queries:r,combine:o=>({data:o.map(l=>l.data).filter(l=>l!==void 0).flat(),pending:o.some(l=>l.isPending)})});return{data:w(()=>n.value.data),pending:w(()=>n.value.pending)}}export{Pe as a,ke as b,qe as u};
