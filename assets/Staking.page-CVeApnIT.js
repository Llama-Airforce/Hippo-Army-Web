import{aJ as ke,am as C,d as S,u as se,a as ae,c as w,w as ne,b as T,o as $,e as y,f as _,g as p,h as n,_ as H,l as W,t as B,aw as L,m as R,ao as z,at as we,av as $e,ar as Te,ai as Pe,j as Fe,n as Ue}from"./index-B0gvS3y9.js";import{_ as Ce}from"./ChartBalances-CW4DgbpS.js";import{_ as Se}from"./DashboardHeader-CMB-54fF.js";import{u as oe,c as re,a as le,_ as ie,b as He,G as De,r as qe,d as Ae,D as Re}from"./UseLightweightChart-Bf1kabtb.js";import{o as d,k as ce,s as r,n as m,_ as Ve,t as U,b as P,p as N,d as j,l as F,v as xe,g as D,i as Q,f as q,a as A,j as ue,r as I,u as O}from"./timestamp-BJgOM8hi.js";import{p as pe}from"./Pagination-vgbH7lYO.js";import{_ as me}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-CcQE5jHi.js";import{_ as Ee}from"./ChartApex-CTwMso4z.js";import{c as Be}from"./ChartStylesApex-YEbRUwTF.js";import{_ as G}from"./Table-BgLz0Y9y.js";import{_ as M}from"./AsyncValue-a7yWNq_Y.js";import{u as Le,_ as de,a as Ie}from"./UsePagination-DoETbJsw.js";import{u as _e}from"./UseRelativeTime-CLGh7MnE.js";import"./Tooltip-uzcDmwPt.js";const We=d({event_type:Ve(["stake","unstake"]),block_timestamp:m(),tx_hash:r(),block_number:m(),amount:r(),amount_usd:r(),account:ce}).transform(e=>({eventType:e.event_type,blockTime:U(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,amount:parseFloat(e.amount),amountUsd:parseFloat(e.amount_usd),account:e.account})),Qe=d({events:P(We),count:m(),page:m(),total_pages:m()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Ke=d({account:ce,amount:r(),amount_usd:r(),end_timestamp:m(),block_timestamp:m(),tx_hash:r()}).transform(e=>({account:e.account,amount:parseFloat(e.amount),amountUsd:parseFloat(e.amount_usd),end:U(e.end_timestamp),blockTime:U(e.block_timestamp),txHash:e.tx_hash})),Oe=d({entries:P(Ke)}).transform(e=>({entries:e.entries})),Ne=d({timestamp:m(),token_address:r(),token_symbol:r(),apr:r()}).transform(e=>({timestamp:U(e.timestamp),tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),je=d({snapshots:P(Ne),count:m(),page:m(),total_pages:m()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),ze=d({timestamp:m(),tvl:r(),tvl_usd:r()}).transform(e=>({timestamp:U(e.timestamp),tvl:parseFloat(e.tvl),tvlUsd:parseFloat(e.tvl_usd)})),Ge=d({data:P(ze),count:m(),page:m(),total_pages:m()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),Me=d({address:r(),label:r().nullable(),ens:r().nullable(),position_value:r(),position_value_usd:r()}).transform(e=>({address:e.address,label:e.label,ens:e.ens,positionValue:parseFloat(e.position_value),positionValueUsd:parseFloat(e.position_value_usd)})),Je=d({total_tvl:r(),total_tvl_usd:r(),top_users_tvl:r(),top_users_tvl_usd:r(),others_tvl:r(),others_tvl_usd:r(),users:P(Me)}).transform(e=>({totalTvl:parseFloat(e.total_tvl),totalTvlUsd:parseFloat(e.total_tvl_usd),topUsersTvl:parseFloat(e.top_users_tvl),topUsersTvlUsd:parseFloat(e.top_users_tvl_usd),othersTvl:parseFloat(e.others_tvl),othersTvlUsd:parseFloat(e.others_tvl_usd),users:e.users})),Xe=d({min_value_usd:r(),max_value_usd:r(),count:m()}).transform(e=>({minValueUsd:parseFloat(e.min_value_usd),maxValueUsd:parseFloat(e.max_value_usd),count:e.count})),Ye=d({bins:P(Xe),total_users:m()}).transform(e=>({bins:e.bins,totalUsers:e.total_users})),Ze=d({epoch:m(),timestamp:m(),weight:r(),relative_weight:r()}).transform(e=>({epoch:e.epoch,timestamp:U(e.timestamp),weight:parseFloat(e.weight),weightRelative:parseFloat(e.relative_weight)}));d({address:r(),weights:P(Ze)}).transform(e=>({adress:e.address,weights:e.weights}));const et=d({timestamp:m(),total_staked:r(),cooldown_amount:r(),cooldown_percentage:r(),regular_staked_amount:r(),regular_staked_percentage:r(),perma_staked_amount:r(),perma_staked_percentage:r(),cooldown_percentage_excluding_perma:r(),regular_staked_percentage_excluding_perma:r()}).transform(e=>({timestamp:U(e.timestamp),totalStaked:parseFloat(e.total_staked),cooldownAmount:parseFloat(e.cooldown_amount),cooldownPercentage:parseFloat(e.cooldown_percentage),regularStakedAmount:parseFloat(e.regular_staked_amount),regularStakedPercentage:parseFloat(e.regular_staked_percentage),permaStakedAmount:parseFloat(e.perma_staked_amount),permaStakedPercentage:parseFloat(e.perma_staked_percentage),cooldownPercentageExcludingPerma:parseFloat(e.cooldown_percentage_excluding_perma),regularStakedPercentageExcludingPerma:parseFloat(e.regular_staked_percentage_excluding_perma)})),tt=d({data:P(et),count:m(),page:m(),total_pages:m()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),st=d({...F,...j,...N});async function at(e,t){const l=D(t),{chain:o,...s}=st.parse(e),i=Q(s),a=await q(`${l}/v1/staking/${o}/events${i}`,void 0,t==null?void 0:t.signal);return Qe.parse(a)}const nt=d(F);async function ot(e,t){const l=D(t),{chain:o}=nt.parse(e),s=await q(`${l}/v1/staking/${o}/cooldown_queue`,void 0,t==null?void 0:t.signal);return Oe.parse(s)}const rt=d({...F,...j,...N});async function lt(e,t){const l=D(t),{chain:o,...s}=rt.parse(e),i=Q(s),a=await q(`${l}/v1/staking/${o}/apr_history${i}`,void 0,t==null?void 0:t.signal);return je.parse(a)}const it=d({...F,...j,...N});async function ct(e,t){const l=D(t),{chain:o,...s}=it.parse(e),i=Q(s),a=await q(`${l}/v1/staking/${o}/tvl_history${i}`,void 0,t==null?void 0:t.signal);return Ge.parse(a)}const ut=d(F);async function pt(e,t){const l=D(t),{chain:o}=ut.parse(e),s=await q(`${l}/v1/staking/${o}/top_users`,void 0,t==null?void 0:t.signal);return Je.parse(s)}const mt=d({...F,bin_count:m().int().positive().optional()});async function dt(e,t){const l=D(t),{chain:o,...s}=mt.parse(e),i=Q(s),a=await q(`${l}/v1/staking/${o}/position_histogram${i}`,void 0,t==null?void 0:t.signal);return Ye.parse(a)}d({...F,...xe});const _t=d({...F,...j,...N});async function gt(e,t){const l=D(t),{chain:o,...s}=_t.parse(e),i=Q(s),a=await q(`${l}/v1/staking/${o}/distribution_history${i}`,void 0,t==null?void 0:t.signal);return tt.parse(a)}function ht(e){return A({queryKey:["staking-events",e],queryFn:()=>at(C(e)),placeholderData:ke})}function vt(e){return A({queryKey:["staking-cooldown-queue",e],queryFn:()=>ot(C(e))})}function ft(e){const{start:t,end:l}=ue({daysRange:90});return A({queryKey:["staking-apr-history",e],queryFn:()=>pe((s,i)=>lt({...C(e),page:s,per_page:i,start:t,end:l}).then(a=>a.snapshots),1,100)})}function yt(e){const{start:t,end:l}=ue({daysRange:90});return A({queryKey:["staking-tvl-history",e],queryFn:()=>pe((s,i)=>ct({...C(e),page:s,per_page:i,start:t,end:l}).then(a=>a.data),1,100)})}function bt(e){return A({queryKey:["staking-top-users",e],queryFn:()=>pt(C(e))})}function kt(e){return A({queryKey:["staking-position-hist",e],queryFn:()=>dt(C(e))})}function wt(e){return A({queryKey:["staking-distribution-hist",e],queryFn:()=>gt(C(e))})}const $t={style:{display:"flex"}},Tt={ref:"chartRef",class:"chart"},Pt=S({__name:"ChartApr",props:{apr:{}},setup(e){const t=se(),l=ae("card"),{chart:o,series:s}=oe({createChartOptions:le(),series:re({name:"apr",color:w(()=>t.value.colors.blue),formatter:a=>`${I(a,0,"percentage")}%`,minMove:.01})});ne(i);function i(){if(!o.value||!s.apr)return;const a=e.apr.map(u=>({time:u.timestamp.getUTCTimestamp(),value:u.apr})).uniqWith((u,g)=>u.time===g.time).orderBy(u=>u.time,"asc");a.length>0&&s.apr.setData(a),o.value.timeScale().fitContent()}return(a,u)=>{const g=me,c=ie,h=H;return $(),T(h,{ref_key:"card",ref:l,title:"APR"},{actions:y(()=>[_("div",$t,[p(g,{filename:"apr",series:n(s)},null,8,["series"]),p(c,{chart:n(o),target:n(l)},null,8,["chart","target"])])]),default:y(()=>[_("div",Tt,null,512)]),_:1},512)}}}),Ft=S({__name:"ChartPositions",props:{bins:{}},setup(e){const t=w(()=>Be({chart:{type:"bar",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1}},xaxis:{categories:l.value,labels:{formatter:s=>s,rotate:-60},tickPlacement:"on"},yaxis:{labels:{formatter:s=>s}},plotOptions:{bar:{columnWidth:"50%"}},dataLabels:{enabled:!1},tooltip:{followCursor:!1,enabled:!0,intersect:!0,custom:s=>{const i=s.series[0][s.dataPointIndex];return`<div><b>Range</b>: ${l.value[s.dataPointIndex]}</div><div><b>Users</b>: ${i}</div>`}}})),l=w(()=>e.bins.map(s=>{const i=s.minValueUsd?`${I(s.minValueUsd,0,"dollar")}${O(s.minValueUsd)}`:"0",a=s.maxValueUsd?`${I(s.maxValueUsd,0,"dollar")}${O(s.maxValueUsd)}`:"0";return`${i} - ${a}`})),o=w(()=>[{name:"Users",data:e.bins.map(s=>s.count)}]);return(s,i)=>{const a=Ee,u=H;return $(),T(u,{title:"User positions"},{default:y(()=>[p(a,{options:n(t),series:n(o)},null,8,["options","series"])]),_:1})}}}),Ut=W(Ft,[["__scopeId","data-v-791d1a3d"]]),Ct={style:{display:"flex"}},St={ref:"chartRef",class:"chart"},Ht=S({__name:"ChartTvl",props:{tvl:{}},setup(e){const t=se(),{items:l,toggles:o,disabled:s}=He(()=>[{id:"rsup",label:"RSUP",color:t.value.colorsArray[0],togglable:!0},{id:"dollars",label:"Dollars",color:t.value.colorsArray[1],togglable:!0}]),i=ae("card"),{chart:a,series:u}=oe({createChartOptions:le(),series:[re({name:"rsup",color:w(()=>t.value.colors.blue),formatter:c=>`${I(c,1,"dollar")}${O(c)}`}),{type:De,name:"dollars",options:w(()=>({priceFormat:{type:"custom",formatter:c=>`$${I(c,1,"dollar")}${O(c)}`},lineWidth:2,lineType:qe.WithSteps,color:t.value.colors.yellow,lastValueVisible:!1,priceLineVisible:!1}))}]});ne(g);function g(){!a.value||!u.rsup||!u.dollars||(u.rsup.setData(e.tvl.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.tvl})).uniqWith((c,h)=>c.time===h.time).orderBy(c=>c.time,"asc")),u.dollars.setData(e.tvl.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.tvlUsd})).uniqWith((c,h)=>c.time===h.time).orderBy(c=>c.time,"asc")),u.rsup.applyOptions({visible:o.rsup.value}),u.dollars.applyOptions({visible:o.dollars.value}),a.value.timeScale().fitContent())}return(c,h)=>{const v=me,V=ie,x=Ae,f=H;return $(),T(f,{ref_key:"card",ref:i,title:"TVL"},{actions:y(()=>[_("div",Ct,[p(v,{filename:"tvl",series:n(u)},null,8,["series"]),p(V,{chart:n(a),target:n(i)},null,8,["chart","target"])])]),"actions-secondary":y(()=>[p(x,{items:n(l),disabled:n(s),onToggle:h[0]||(h[0]=K=>n(o)[K].value=!n(o)[K].value)},null,8,["items","disabled"])]),default:y(()=>[_("div",St,null,512)]),_:1},512)}}}),Dt=["href"],qt={class:"end"},At={class:"end"},Rt={class:"end"},Vt=["href"],te=10,xt=S({__name:"TableCooldowns",props:{cooldowns:{}},setup(e){const{page:t,rowsPage:l,onPage:o}=Le(B(()=>e.cooldowns),te),{relativeTime:s}=_e();return(i,a)=>{const u=de,g=M,c=G,h=H;return $(),T(h,{title:"Cooldown Queue"},{actions:y(()=>[p(u,{"items-count":i.cooldowns.length,"items-per-page":te,page:n(t),onPage:n(o)},null,8,["items-count","page","onPage"])]),default:y(()=>[p(c,{rows:n(l),columns:["User",{label:"RSUP",align:"end"},{label:"Dollars",align:"end"},{label:"Time",align:"end"}]},{row:y(({item:v})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${v.account.address}`,onClick:a[0]||(a[0]=L(()=>{},["stop"]))},R(v.account.ens||("addressShort"in i?i.addressShort:n(z))(v.account.address)),9,Dt)]),_("div",qt,[p(g,{type:"dollar",value:v.amount,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",At,[p(g,{type:"dollar",value:v.amountUsd,precision:2},null,8,["value"])]),_("div",Rt,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${v.txHash}`,onClick:a[1]||(a[1]=L(()=>{},["stop"]))},R(n(s)(v.end.getUTCTimestamp())),9,Vt)])]),_:1},8,["rows"])]),_:1})}}}),Et=W(xt,[["__scopeId","data-v-6228b228"]]),Bt=["href"],Lt={class:"end"},It={class:"end"},Wt={class:"end"},Qt=["href"],Kt=S({__name:"TableEvents",props:{events:{},count:{}},emits:["page"],setup(e,{emit:t}){const l=t,{page:o,onPage:s}=Ie(),i=we(o,200);$e(i,g=>{l("page",g)});const{relativeTime:a}=_e(),u=g=>{switch(g.eventType){case"stake":return"Stake";case"unstake":return"Unstake"}};return(g,c)=>{const h=de,v=M,V=G,x=H;return $(),T(x,{title:"Events"},{actions:y(()=>[p(h,{"items-count":g.count,"items-per-page":10,page:n(o),onPage:n(s)},null,8,["items-count","page","onPage"])]),default:y(()=>[p(V,{rows:g.events,columns:["Type","Owner",{label:"RSUP",align:"end"},{label:"Dollars",align:"end"},{label:"Time",align:"end"}]},{row:y(({item:f})=>[_("div",{class:Te({green:f.eventType==="stake",red:f.eventType==="unstake"})},R(u(f)),3),_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${f.account.address}`,onClick:c[0]||(c[0]=L(()=>{},["stop"]))},R(f.account.ens||("addressShort"in g?g.addressShort:n(z))(f.account.address)),9,Bt)]),_("div",Lt,[p(v,{type:"dollar",value:f.amount,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",It,[p(v,{type:"dollar",value:f.amountUsd,precision:2},null,8,["value"])]),_("div",Wt,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${f.txHash}`,onClick:c[1]||(c[1]=L(()=>{},["stop"]))},R(n(a)(f.blockTime.getUTCTimestamp())),9,Qt)])]),_:1},8,["rows"])]),_:1})}}}),Ot=W(Kt,[["__scopeId","data-v-a959b9d4"]]),Nt=["href"],jt={class:"end"},zt={class:"end"},Gt=S({__name:"TableTopUsers",props:{topUsers:{}},setup(e){return(t,l)=>{const o=M,s=G,i=H;return $(),T(i,{title:"Top Users"},{default:y(()=>[p(s,{rows:t.topUsers,columns:["Address",{label:"RSUP",align:"end"},{label:"Dollars",align:"end"}]},{row:y(({item:a})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${a.address}`,onClick:l[0]||(l[0]=L(()=>{},["stop"]))},R(a.ens||("addressShort"in t?t.addressShort:n(z))(a.address)),9,Nt)]),_("div",jt,[p(o,{type:"dollar",value:a.positionValue,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",zt,[p(o,{type:"dollar",value:a.positionValueUsd,precision:2},null,8,["value"])])]),_:1},8,["rows"])]),_:1})}}}),Mt=W(Gt,[["__scopeId","data-v-d5d8af2d"]]),Jt={class:"dashboard"},Xt=S({__name:"Staking.page",setup(e){const{isFetching:t,data:l}=ft({chain:"ethereum"}),o=w(()=>(l.value??[]).map(b=>({timestamp:b.timestamp,apr:b.apr}))),{isFetching:s,data:i}=yt({chain:"ethereum"}),a=w(()=>(i.value??[]).map(b=>({timestamp:b.timestamp,tvl:b.tvl,tvlUsd:b.tvlUsd}))),u=Pe(1),{isFetching:g,data:c}=ht(w(()=>({chain:"ethereum",page:u.value,per_page:10}))),{isFetching:h,data:v}=bt(B(()=>({chain:"ethereum"}))),{isFetching:V,data:x}=vt(B(()=>({chain:"ethereum"}))),{isFetching:f,data:K}=kt(B(()=>({chain:"ethereum"}))),{isFetching:ge,data:he}=wt(B(()=>({chain:"ethereum"}))),ve=w(()=>{var E;const b=((E=he.value)==null?void 0:E.data)??[];return b.length===0?[]:[{symbol:"In cooldown",balances:b.map(k=>({timestamp:k.timestamp,balance:k.cooldownAmount,tokenPrice:1}))},{symbol:"Regular staked",balances:b.map(k=>({timestamp:k.timestamp,balance:k.regularStakedAmount-k.cooldownAmount,tokenPrice:1}))},{symbol:"Perma staked",balances:b.map(k=>({timestamp:k.timestamp,balance:k.permaStakedAmount,tokenPrice:1}))}]});return(b,E)=>{var J,X,Y,Z,ee;const k=Se,fe=Ce,ye=H;return $(),Fe("div",Jt,[p(k,{style:{"grid-area":"header"},title:"Staking",description:"User governance staking metrics (RSUP)"}),p(Pt,{style:{"grid-area":"apr"},apr:n(o),loading:n(t)},null,8,["apr","loading"]),p(Ht,{style:{"grid-area":"tvl"},tvl:n(a),loading:n(s)},null,8,["tvl","loading"]),p(Ot,{style:{"grid-area":"events"},events:((J=n(c))==null?void 0:J.events)??[],count:((X=n(c))==null?void 0:X.count)??0,loading:n(g),onPage:E[0]||(E[0]=be=>u.value=be)},null,8,["events","count","loading"]),p(Et,{style:{"grid-area":"cooldowns"},cooldowns:((Y=n(x))==null?void 0:Y.entries)??[],loading:n(V)},null,8,["cooldowns","loading"]),n(ge)?($(),T(ye,{key:1,loading:"",title:"Staked",style:Ue(`grid-area: chart-staked; min-height: ${n(Re)}`)},null,8,["style"])):($(),T(fe,{key:0,style:{"grid-area":"chart-staked"},title:"Staked",balances:n(ve),"show-dollars":!1},null,8,["balances"])),p(Mt,{style:{"grid-area":"top-users"},"top-users":((Z=n(v))==null?void 0:Z.users)??[],loading:n(h)},null,8,["top-users","loading"]),p(Ut,{style:{"grid-area":"positions"},bins:((ee=n(K))==null?void 0:ee.bins)??[],loading:n(f)},null,8,["bins","loading"])])}}}),ms=W(Xt,[["__scopeId","data-v-76bf2ec1"]]);export{ms as default};
