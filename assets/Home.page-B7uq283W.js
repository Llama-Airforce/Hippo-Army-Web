var R=Object.defineProperty;var E=(t,e,a)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var P=(t,e,a)=>E(t,typeof e!="symbol"?e+"":e,a);import{d as v,u as V,a as q,c as b,w as K,b as y,o as _,e as f,f as m,g as l,h as n,_ as C,E as L,t as w,R as M,i as F,j as H,k as N,l as B,n as $}from"./index-eREEKl5L.js";import{_ as S}from"./ChartBalances-DdGhx-Md.js";import{u as O,c as Q,a as W,_ as j,D as k}from"./UseLightweightChart-D2pZoVZ3.js";import{u as z,a as G}from"./protocols-DhGlxhY5.js";import{u as J}from"./stablecoin-DJUMc4V0.js";import{_ as X}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-kfvPP31c.js";import{r as Y,u as Z,f as I,a as x}from"./timestamp-DcP9Bt_c.js";import{_ as ee}from"./KPI-CgyzPJO4.js";import{g as te,_ as ae}from"./AsyncValue-IM55AzVv.js";import"./Tooltip-BC3yTzdv.js";import"./Pagination-vgbH7lYO.js";const se="/assets/hippo-ghibli-DCzfPtIQ.png",re={style:{display:"flex"}},ne={ref:"chartRef",class:"chart"},oe=v({__name:"ChartPrice",props:{price:{}},setup(t){const e=V(),a=q("card"),{chart:r,series:p}=O({createChartOptions:W(),series:Q({name:"price",color:b(()=>e.value.colors.purple),formatter:o=>`$${Y(o,4,"dollar")}${Z(o)}`,minMove:.001,autoscaleInfoProvider:()=>({priceRange:{minValue:Math.max(Math.min(...t.price.map(o=>o.price)),.95),maxValue:Math.min(Math.max(...t.price.map(o=>o.price)),1.05)}})})});K(d);function d(){if(!r.value||!p.price)return;const o=t.price.map(i=>({time:i.timestamp.getUTCTimestamp(),value:i.price})).uniqWith((i,u)=>i.time===u.time).orderBy(i=>i.time,"asc");o.length>0&&p.price.setData(o),r.value.timeScale().fitContent()}return(o,i)=>{const u=X,c=j,s=C;return _(),y(s,{ref_key:"card",ref:a,title:"Stablecoin Price (reUSD)"},{actions:f(()=>[m("div",re,[l(u,{filename:"tvl",series:n(p)},null,8,["series"]),l(c,{chart:n(r),target:n(a)},null,8,["chart","target"])])]),default:f(()=>[m("div",ne,null,512)]),_:1},512)}}});class ie{async fetch(e,a,r){return I(e,a,r)}}class ce extends ie{constructor(a){super();P(this,"host");this.host=a}async getHost(){return await this.host}}class le extends ce{async getPrice(e){const a=await this.getHost(),r=`ethereum:${e}`;return this.fetch(`${a}/price/${e}`).then(p=>p[r])}async getPrices(e){const a=await this.getHost(),r=e.join(",");return this.fetch(`${a}/price/${r}`)}}const ue={laf:"https://api.llama.airforce",ha:"https://api2.hippo.army",cb:void 0,cm:"https://api2.curvemonitor.com"},pe=["cb","laf","ha","cm"];function me(){const t="ha";if(!pe.includes(t)){const e=`Unknown app for useApp(): ${t}`;throw L({text:e,type:"error"}),new Error(e)}return t}const g={};function de(t){return ue[t]}async function T(t){const e=me(),a=e;if(g[a])return Promise.resolve(g[a]);const r=de(e);return g[a]=r,g[a]}const he=new le(T());function D(t){return x({queryKey:["token-price",t],queryFn:async({queryKey:[,e]})=>he.getPrice(e),enabled:b(()=>!!t.value),initialDataUpdatedAt:0})}async function _e(t){const e=te(t);return await I(`${e}/stats`,void 0,t==null?void 0:t.signal)}function fe(){return x({queryKey:["stats"],queryFn:async()=>{const t=await T();return _e({host:t})}})}const ye={class:"kpis"},ge=v({__name:"KPIs",setup(t){const{data:e}=D(w(()=>M)),{data:a}=D(w(()=>F)),{data:r}=fe();return(p,d)=>{var u,c;const o=ae,i=ee;return _(),H("div",ye,[l(i,{class:"border-special",label:"RSUP Price","has-value":!!n(e)},{default:f(()=>{var s;return[l(o,{type:"dollar",value:((s=n(e))==null?void 0:s.price)??1/0,precision:3},null,8,["value"])]}),_:1},8,["has-value"]),l(i,{class:"border-special",label:"reUSD Price","has-value":!!n(a)},{default:f(()=>{var s;return[l(o,{type:"dollar",value:((s=n(a))==null?void 0:s.price)??1/0,precision:3},null,8,["value"])]}),_:1},8,["has-value"]),l(i,{class:"border-special",label:"Total reUSD borrowed","has-value":!!((u=n(r))!=null&&u.borrowed)},{default:f(()=>{var s;return[l(o,{type:"dollar",value:((s=n(r))==null?void 0:s.borrowed)??1/0,precision:0,"show-symbol":!1},null,8,["value"]),d[0]||(d[0]=N(" reUSD "))]}),_:1,__:[0]},8,["has-value"]),l(i,{class:"border-special",label:"Total collateral","has-value":!!((c=n(r))!=null&&c.collateral)},{default:f(()=>{var s;return[l(o,{type:"dollar",value:((s=n(r))==null?void 0:s.collateral)??1/0,precision:0},null,8,["value"])]}),_:1},8,["has-value"])])}}}),be=B(ge,[["__scopeId","data-v-a8311ac2"]]),ve={class:"dashboard"},Pe={class:"highlights"},we={class:"dashboard-grid charts"},$e=v({__name:"Home.page",setup(t){z();const{isFetching:e,data:a}=J(),{isFetching:r,data:p}=G({chain:"ethereum"}),d=u=>{var c;return(((c=p.value)==null?void 0:c.snapshots)??[]).map(s=>({symbol:s.name,balances:[{timestamp:s.timestamp,balance:s[u],tokenPrice:1}]})).groupBy(s=>s.symbol).entries().map(([s,U])=>({symbol:s,balances:U.flatMap(h=>h.balances).groupBy(h=>h.timestamp.getTime()).entries().map(([,h])=>({timestamp:h[0].timestamp,balance:h.sumBy(A=>A.balance),tokenPrice:h[0].tokenPrice}))}))},o=b(()=>d("totalUnderlying")),i=b(()=>d("totalDebt"));return(u,c)=>{const s=C;return _(),H("div",ve,[c[0]||(c[0]=m("div",{class:"description"},[m("span",{class:"title"},"Hippo Army"),m("span",{class:"tag"},"Resupplying your portobello with hippo insights.")],-1)),c[1]||(c[1]=m("img",{class:"hippo",src:se},null,-1)),m("div",Pe,[l(be)]),m("div",we,[l(oe,{style:{"grid-area":"price"},price:n(a),loading:n(e)},null,8,["price","loading"]),n(r)?(_(),y(s,{key:1,loading:"",title:"TVL",style:$(`grid-area: underlying; min-height: ${n(k)}`)},null,8,["style"])):(_(),y(S,{key:0,style:{"grid-area":"underlying"},title:"TVL",balances:n(o),"show-dollars":!1},null,8,["balances"])),n(r)?(_(),y(s,{key:3,loading:"",title:"Debt",style:$(`grid-area: debt; min-height: ${n(k)}`)},null,8,["style"])):(_(),y(S,{key:2,style:{"grid-area":"debt"},title:"Debt",balances:n(i),"show-dollars":!1},null,8,["balances"]))])])}}}),Ee=B($e,[["__scopeId","data-v-4aad93f4"]]);export{Ee as default};
