import{aJ as H,am as W,d as C,u as x,a as K,c as y,w as Y,b as D,o as v,e as b,f as d,g as u,h as a,_ as F,j as L,k as T,l as I,at as j,av as z,aw as R,m as $,aY as J,ai as V,an as O,aZ as Q,n as G}from"./index-PoaDd28P.js";import{_ as Z}from"./ChartBalances-hSvwKw-i.js";import{_ as X}from"./DashboardHeader-ZOnZ-_d1.js";import{u as ee,a as te,_ as se,k as oe,D as ae}from"./UseLightweightChart-v9UZ1eMO.js";import{o as S,s as f,n as k,b as A,k as ne,t as ie,p as re,d as le,l as ue,g as ce,i as pe,f as me,a as _e,r as de,u as be}from"./timestamp-CnCs2YLF.js";import{_ as he}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-CWTFpjdc.js";import{_ as ge}from"./KPI-CgrOCMEj.js";import{_ as M}from"./AsyncValue-CRYfR47y.js";import{_ as fe}from"./Table-o5-0HqXd.js";import{a as ve,_ as ye}from"./UsePagination-Cfj7UDOK.js";import{u as ke}from"./UseRelativeTime-B8Zq4E-K.js";import"./Tooltip-BACmjZtt.js";const De=S({pair_id:k(),pair_name:f(),protocol_name:f(),interest:f(),fees:f()}).transform(t=>({pairId:t.pair_id,pairName:t.pair_name,protocolName:t.protocol_name,interest:parseFloat(t.interest),fees:parseFloat(t.fees)})),we=S({block_timestamp:k(),tx_hash:f(),block_number:k(),operator:ne,amount:f(),interest_total:f(),fees_total:f(),breakdown:A(De)}).transform(t=>({blockTime:ie(t.block_timestamp),txHash:t.tx_hash,blockNumber:t.block_number,operator:t.operator,amount:parseFloat(t.amount),interestTotal:parseFloat(t.interest_total),feesTotal:parseFloat(t.fees_total),breakdown:t.breakdown})),Te=S({distributions:A(we),count:k(),page:k(),total_pages:k()}).transform(t=>({distributions:t.distributions,count:t.count,page:t.page,totalPages:t.total_pages})),$e=S({...ue,...le,...re});async function Ce(t,_){const r=ce(_),{chain:l,...c}=$e.parse(t),m=pe(c),o=await me(`${r}/v1/revenue/${l}/distributions${m}`,void 0,_?.signal);return Te.parse(o)}function U(t){return _e({queryKey:["revenue-distributions",t],queryFn:()=>Ce(W(t)),placeholderData:H})}const Se={style:{display:"flex"}},Pe={ref:"chartRef",class:"chart"},Be=C({__name:"ChartDistributionsDelta",props:{distributions:{}},setup(t){const _=x(),r=K("card"),{chart:l,series:c}=ee({createChartOptions:te(),series:{type:oe,name:"deltas",options:y(()=>({priceFormat:{type:"custom",formatter:o=>`$${de(o,0,"dollar")}${be(o)}`,minMove:.01},color:_.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});Y(m);function m(){if(!l.value||!c.deltas)return;const{colors:o}=_.value;c.deltas.setData(t.distributions.map(s=>({time:s.blockTime.getUTCTimestamp(),value:s.amount})).uniqWith((s,n)=>s.time===n.time).orderBy(s=>s.time,"asc").takeRight(53).reduce((s,n,e,i)=>{if(e===0)return s;const p=n.value-i[e-1].value,h=p<0?o.red:o.green;return s.push({time:n.time,value:p,color:h}),s},[])),l.value.timeScale().fitContent()}return(o,s)=>{const n=he,e=se,i=F;return v(),D(i,{ref_key:"card",ref:r,title:"Distributions Change (1y)"},{actions:b(()=>[d("div",Se,[u(n,{filename:"distributions_delta",series:a(c)},null,8,["series"]),u(e,{chart:a(l),target:a(r)},null,8,["chart","target"])])]),default:b(()=>[d("div",Pe,null,512)]),_:1},512)}}}),Fe={class:"kpis"},Ie=C({__name:"KPIs",setup(t){const _={chain:"ethereum"},{data:r}=U(_),l=y(()=>r.value?.distributions?r.value.distributions.sumBy(o=>o.amount):null),c=y(()=>{if(!r.value?.distributions||r.value.distributions.length===0)return null;const o=r.value.distributions.slice(0,52);return o.sumBy(s=>s.amount)/o.length}),m=y(()=>{if(!r.value?.distributions||r.value.distributions.length===0)return null;const o=r.value.distributions.slice(0,52).map(e=>e.amount),s=o.sumBy(e=>e)/o.length,n=o.map(e=>Math.pow(e-s,2));return Math.sqrt(n.sumBy(e=>e)/(o.length-1))});return(o,s)=>{const n=M,e=ge;return v(),L("div",Fe,[u(e,{label:"Total","has-value":!!a(l)},{default:b(()=>[u(n,{type:"dollar",value:a(l),precision:2,"show-symbol":!1},null,8,["value"]),s[0]||(s[0]=T(" reUSD "))]),_:1,__:[0]},8,["has-value"]),u(e,{label:"Average (1y)","has-value":!!a(c)},{default:b(()=>[u(n,{type:"dollar",value:a(c),precision:2,"show-symbol":!1},null,8,["value"]),s[1]||(s[1]=T(" reUSD "))]),_:1,__:[1]},8,["has-value"]),u(e,{label:"Standard Deviation (1y)","has-value":!!a(m)},{default:b(()=>[u(n,{type:"dollar",value:a(m),precision:2,"show-symbol":!1},null,8,["value"]),s[2]||(s[2]=T(" reUSD "))]),_:1,__:[2]},8,["has-value"])])}}}),Ne=I(Ie,[["__scopeId","data-v-e12c7e95"]]),Re=["href"],Ve={class:"period"},Le={class:"end"},Ae={class:"end"},Me=["href"],Ue=7*24*60*60*1e3,qe=C({__name:"TableDistributions",props:{distributions:{},count:{}},emits:["page"],setup(t,{emit:_}){const r=_,{page:l,onPage:c}=ve(),m=j(l,200);z(m,i=>{r("page",i)});const{relativeTime:o}=ke();function s(i){const p=new Date(Date.UTC(2025,2,20));return new Date(p.getTime()+i*Ue)}function n(i){const p=s(i),h=new Date(p);return h.setDate(p.getDate()+7),h}function e(i){return`${i.toLocaleString("default",{month:"short"})} ${i.getDate()}`}return(i,p)=>{const h=ye,P=J,g=M,q=fe,E=F;return v(),D(E,{title:"Distributions"},{actions:b(()=>[u(h,{"items-count":i.count,"items-per-page":10,page:a(l),onPage:a(c)},null,8,["items-count","page","onPage"])]),default:b(()=>[u(q,{rows:i.distributions,columns:["Period",{label:"Amount (reUSD)",align:"end"},{label:"Time",align:"end"}]},{row:b(({item:w,idx:N})=>[d("div",null,[d("a",{target:"_blank",href:`https://etherscan.io/address/${w.operator.address}`,onClick:p[0]||(p[0]=R(()=>{},["stop"]))},[d("div",Ve,[d("span",null,$(e(s(i.distributions.length-N-1))),1),u(P,{class:"chevron"}),d("span",null,$(e(n(i.distributions.length-N-1))),1)])],8,Re)]),d("div",Le,[u(g,{"show-zero":"",type:"dollar",value:w.amount,"show-symbol":!1,precision:2},null,8,["value"])]),d("div",Ae,[d("a",{target:"_blank",href:`https://etherscan.io/tx/${w.txHash}`,onClick:p[1]||(p[1]=R(()=>{},["stop"]))},$(a(o)(w.blockTime.getUTCTimestamp())),9,Me)])]),_:1},8,["rows"])]),_:1})}}}),Ee=I(qe,[["__scopeId","data-v-11a72d6d"]]),He={class:"dashboard"},B="All",We=C({__name:"Revenue.page",setup(t){const _=V(1),{isFetching:r,data:l}=U(y(()=>({chain:"ethereum",page:_.value,per_page:15}))),c=y(()=>[B,...(l.value?.distributions??[]).flatMap(n=>n.breakdown.map(e=>e.protocolName)).uniq()]),m=V(B),o=n=>m.value===B||n.protocolName===m.value,s=y(()=>{const n=(l.value?.distributions??[]).map(e=>({timestamp:e.blockTime,fees:e.breakdown.filter(o).sumBy(i=>i.fees),interest:e.breakdown.filter(o).sumBy(i=>i.interest)}));return n.length===0?[]:[{symbol:"Fees",balances:n.map(e=>({timestamp:e.timestamp,balance:e.fees,tokenPrice:1}))},{symbol:"Interest",balances:n.map(e=>({timestamp:e.timestamp,balance:e.interest,tokenPrice:1}))}]});return(n,e)=>{const i=X,p=Q,h=Z,P=F;return v(),L("div",He,[u(i,{style:{"grid-area":"header"},title:"Revenue",description:"Token revenue distribution metrics"}),u(Ne,{style:{"grid-area":"kpis"}}),a(r)?(v(),D(P,{key:1,loading:"",title:"Breakdown",style:G(`grid-area: chart; min-height: ${a(ae)}`)},null,8,["style"])):(v(),D(h,{key:0,style:{"grid-area":"chart"},title:"Breakdown","chart-type":"bars",balances:a(s),"show-dollars":!1},{actions:b(()=>[a(c).length>0?(v(),D(p,{key:0,options:a(c),selected:a(c).find(g=>g===a(m))??a(c)[0],onSelect:e[0]||(e[0]=g=>m.value=g)},{option:b(({option:g})=>[T($(g),1)]),_:1},8,["options","selected"])):O("",!0)]),_:1},8,["balances"])),u(Be,{style:{"grid-area":"delta"},distributions:a(l)?.distributions??[]},null,8,["distributions"]),u(Ee,{style:{"grid-area":"table"},distributions:a(l)?.distributions??[],count:a(l)?.count??0,loading:a(r),onPage:e[1]||(e[1]=g=>_.value=g)},null,8,["distributions","count","loading"])])}}}),tt=I(We,[["__scopeId","data-v-c9e30e33"]]);export{tt as default};
