import{_ as j}from"./DashboardHeader-Dq35Htxz.js";import{t as J,b as Q,f as Y,a as z,r as V,u as x}from"./timestamp-DJ1YwJUy.js";import{o as C,s as W,e as G,n as v,a as X,p as Z,t as tt,f as et,g as st,_ as B}from"./AsyncValue-Befmow8u.js";import{aJ as at,am as nt,d as D,u as F,a as L,c as g,w as M,b as T,o as y,e as h,f as p,g as u,h as l,_ as w,j as O,k,l as P,at as ot,av as it,aw as R,m as $,a_ as rt,ai as lt}from"./index-ubWCN88q.js";import{u as q,a as U,_ as I,P as A}from"./UseLightweightChart-vEBfyHR1.js";import{_ as E}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-CUJSKRE5.js";import{_ as ut}from"./KPI-BHgzsKMx.js";import{_ as ct}from"./Table-EXH8bS0J.js";import{a as dt,_ as mt}from"./UsePagination-C155jocX.js";import{u as _t}from"./UseRelativeTime-BQcSW5ST.js";import"./Tooltip-CsZ4ys_a.js";const pt=C({block_timestamp:v(),tx_hash:W(),block_number:v(),operator:G,amount:W()}).transform(o=>({blockTime:J(o.block_timestamp),txHash:o.tx_hash,blockNumber:o.block_number,operator:o.operator,amount:parseFloat(o.amount)})),ht=C({distributions:X(pt),count:v(),page:v(),total_pages:v()}).transform(o=>({distributions:o.distributions,count:o.count,page:o.page,totalPages:o.total_pages})),ft=C({...et,...tt,...Z});async function bt(o,d){const i=st(d),{chain:r,...m}=ft.parse(o),_=Q(m),t=await Y(`${i}/v1/revenue/${r}/distributions${_}`,void 0,d==null?void 0:d.signal);return ht.parse(t)}function H(o){return z({queryKey:["revenue-distributions",o],queryFn:()=>bt(nt(o)),placeholderData:at})}const gt={style:{display:"flex"}},vt={ref:"chartRef",class:"chart"},Dt=D({__name:"ChartDistributions",props:{distributions:{}},setup(o){const d=F(),i=L("card"),{chart:r,series:m}=q({createChartOptions:U(),series:{type:A,name:"distributions",options:g(()=>({priceFormat:{type:"custom",formatter:t=>`$${V(t,0,"dollar")}${x(t)}`,minMove:.01},color:d.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});M(_);function _(){!r.value||!m.distributions||(m.distributions.setData(o.distributions.map(t=>({time:t.blockTime.getUTCTimestamp(),value:t.amount})).uniqWith((t,e)=>t.time===e.time).orderBy(t=>t.time,"asc").takeRight(52)),r.value.timeScale().fitContent())}return(t,e)=>{const n=E,a=I,s=w;return y(),T(s,{ref_key:"card",ref:i,title:"Distributions (1y)"},{actions:h(()=>[p("div",gt,[u(n,{filename:"distributions",series:l(m)},null,8,["series"]),u(a,{chart:l(r),target:l(i)},null,8,["chart","target"])])]),default:h(()=>[p("div",vt,null,512)]),_:1},512)}}}),yt={style:{display:"flex"}},kt={ref:"chartRef",class:"chart"},$t=D({__name:"ChartDistributionsDelta",props:{distributions:{}},setup(o){const d=F(),i=L("card"),{chart:r,series:m}=q({createChartOptions:U(),series:{type:A,name:"deltas",options:g(()=>({priceFormat:{type:"custom",formatter:t=>`$${V(t,0,"dollar")}${x(t)}`,minMove:.01},color:d.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});M(_);function _(){if(!r.value||!m.deltas)return;const{colors:t}=d.value;m.deltas.setData(o.distributions.map(e=>({time:e.blockTime.getUTCTimestamp(),value:e.amount})).uniqWith((e,n)=>e.time===n.time).orderBy(e=>e.time,"asc").takeRight(53).reduce((e,n,a,s)=>{if(a===0)return e;const c=n.value-s[a-1].value,f=c<0?t.red:t.green;return e.push({time:n.time,value:c,color:f}),e},[])),r.value.timeScale().fitContent()}return(t,e)=>{const n=E,a=I,s=w;return y(),T(s,{ref_key:"card",ref:i,title:"Distributions Change (1y)"},{actions:h(()=>[p("div",yt,[u(n,{filename:"distributions_delta",series:l(m)},null,8,["series"]),u(a,{chart:l(r),target:l(i)},null,8,["chart","target"])])]),default:h(()=>[p("div",kt,null,512)]),_:1},512)}}}),Ct={class:"kpis"},Tt=D({__name:"KPIs",setup(o){const d={chain:"ethereum"},{data:i}=H(d),r=g(()=>{var t;return(t=i.value)!=null&&t.distributions?i.value.distributions.reduce((e,n)=>e+n.amount,0):null}),m=g(()=>{var e;if(!((e=i.value)!=null&&e.distributions)||i.value.distributions.length===0)return null;const t=i.value.distributions.slice(0,52);return t.reduce((n,a)=>n+a.amount,0)/t.length}),_=g(()=>{var a;if(!((a=i.value)!=null&&a.distributions)||i.value.distributions.length===0)return null;const t=i.value.distributions.slice(0,52).map(s=>s.amount),e=t.reduce((s,c)=>s+c,0)/t.length,n=t.map(s=>Math.pow(s-e,2));return Math.sqrt(n.reduce((s,c)=>s+c,0)/(t.length-1))});return(t,e)=>{const n=B,a=ut;return y(),O("div",Ct,[u(a,{label:"Total","has-value":!!l(r)},{default:h(()=>[u(n,{type:"dollar",value:l(r),precision:2,"show-symbol":!1},null,8,["value"]),e[0]||(e[0]=k(" reUSD "))]),_:1},8,["has-value"]),u(a,{label:"Average (1y)","has-value":!!l(m)},{default:h(()=>[u(n,{type:"dollar",value:l(m),precision:2,"show-symbol":!1},null,8,["value"]),e[1]||(e[1]=k(" reUSD "))]),_:1},8,["has-value"]),u(a,{label:"Standard Deviation (1y)","has-value":!!l(_)},{default:h(()=>[u(n,{type:"dollar",value:l(_),precision:2,"show-symbol":!1},null,8,["value"]),e[2]||(e[2]=k(" reUSD "))]),_:1},8,["has-value"])])}}}),wt=P(Tt,[["__scopeId","data-v-8461099e"]]),Pt=["href"],St={class:"period"},Wt={class:"end"},Rt={class:"end"},Vt=["href"],xt=D({__name:"TableDistributions",props:{distributions:{},count:{}},emits:["page"],setup(o,{emit:d}){const i=d,{page:r,onPage:m}=dt(),_=ot(r,200);it(_,a=>{i("page",a)});const{relativeTime:t}=_t();function e(a){const s=new Date(a);s.setDate(a.getDate()+4);const c=new Date(s);return c.setDate(s.getDate()-s.getDay()),`${c.toLocaleString("default",{month:"short"})} ${c.getDate()}`}function n(a){const s=new Date(a);s.setDate(a.getDate()+4);const c=new Date(s);c.setDate(s.getDate()-s.getDay());const f=new Date(c);return f.setDate(c.getDate()+4),`${f.toLocaleString("default",{month:"short"})} ${f.getDate()}`}return(a,s)=>{const c=mt,f=rt,S=B,K=ct,N=w;return y(),T(N,{title:"Distributions"},{actions:h(()=>[u(c,{"items-count":a.count,"items-per-page":10,page:l(r),onPage:l(m)},null,8,["items-count","page","onPage"])]),default:h(()=>[u(K,{rows:a.distributions,columns:["Period",{label:"Amount (reUSD)",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:b})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${b.operator.address}`,onClick:s[0]||(s[0]=R(()=>{},["stop"]))},[p("div",St,[p("span",null,$(e(b.blockTime)),1),u(f,{class:"chevron"}),p("span",null,$(n(b.blockTime)),1)])],8,Pt)]),p("div",Wt,[u(S,{"show-zero":"",type:"dollar",value:b.amount,"show-symbol":!1,precision:2},null,8,["value"])]),p("div",Rt,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${b.txHash}`,onClick:s[1]||(s[1]=R(()=>{},["stop"]))},$(l(t)(b.blockTime.getUTCTimestamp())),9,Vt)])]),_:1},8,["rows"])]),_:1})}}}),Bt=P(xt,[["__scopeId","data-v-daf29cb9"]]),Ft={class:"dashboard"},Lt=D({__name:"Revenue.page",setup(o){const d=lt(1),{isFetching:i,data:r}=H(g(()=>({chain:"ethereum",page:d.value,per_page:15})));return(m,_)=>{var e,n,a,s;const t=j;return y(),O("div",Ft,[u(t,{style:{"grid-area":"header"},title:"Revenue",description:"Token revenue distribution metrics"}),u(wt,{style:{"grid-area":"kpis"}}),u(Dt,{style:{"grid-area":"chart"},distributions:((e=l(r))==null?void 0:e.distributions)??[]},null,8,["distributions"]),u($t,{style:{"grid-area":"delta"},distributions:((n=l(r))==null?void 0:n.distributions)??[]},null,8,["distributions"]),u(Bt,{style:{"grid-area":"table"},distributions:((a=l(r))==null?void 0:a.distributions)??[],count:((s=l(r))==null?void 0:s.count)??0,loading:l(i),onPage:_[0]||(_[0]=c=>d.value=c)},null,8,["distributions","count","loading"])])}}}),Jt=P(Lt,[["__scopeId","data-v-f3bd6d88"]]);export{Jt as default};
