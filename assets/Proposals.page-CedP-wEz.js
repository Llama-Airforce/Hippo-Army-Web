import{q as ne,al as z,d as f,ak as le,c as _,j as g,o as u,f as t,aB as A,aY as E,h as n,aq as b,m as y,an as N,g as c,l as $,ah as C,x as re,am as q,k as L,aC as K,aZ as W,e as w,b as D,aX as H,a_ as ce,aG as pe,av as ie,E as de,_ as ue,as as _e,ad as ve,ax as he}from"./index-B_NxFp7S.js";import{a as ge,_ as me}from"./UsePagination-S9IasDbG.js";import{_ as fe}from"./InputText-DZ1bz3ff.js";import{a as ye,_ as $e}from"./TabItem.vue_vue_type_script_setup_true_lang-Bx_QDcjR.js";import{_ as be}from"./DashboardHeader-D9I1fKJE.js";import{t as M,b as j,f as G,a as Q}from"./Number-BHD65MO0.js";import{d as J,o as P,s as h,n as v,a as F,p as X,i as we,g as Z,_ as O}from"./AsyncValue-DhIyIA2R.js";import{p as ee}from"./Pagination-vgbH7lYO.js";import{_ as Y}from"./KPI-FcbaH0Vu.js";import"./Tooltip-DxrDaZQc.js";/**
 * @license lucide-vue-next v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=ne("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),Se=J(["all","active","failed","cancelled","executed","executable"]),Pe=P({index:v(),target:h(),calldata:h(),decoded_calldata:h()}).transform(e=>({index:e.index,target:e.target,calldata:e.calldata,decodedCalldata:e.decoded_calldata})),ke=P({proposal_id:v(),on_chain_id:v(),description:h(),creator:h(),creator_ens:h().nullable(),creator_label:h().nullable(),status:Se,epoch:v(),created_at:v(),quorum_weight:v(),execution_tx:h().nullable(),cancellation_tx:h().nullable(),actions:F(Pe),weight_yes:v(),weight_no:v(),voters_count:v(),creation_tx_hash:h()}).transform(e=>({proposalId:e.proposal_id,onChainId:e.on_chain_id,description:e.description,creator:e.creator,creatorEns:e.creator_ens,creatorLabel:e.creator_label,status:e.status,epoch:e.epoch,createdAt:M(e.created_at),end:new Date(M(e.created_at).getTime()+7*24*60*60*1e3),quorumWeight:e.quorum_weight,executionTx:e.execution_tx,cancellationTx:e.cancellation_tx,actions:e.actions,weightYes:e.weight_yes,weightNo:e.weight_no,votersCount:e.voters_count,creationTxHash:e.creation_tx_hash})),Te=P({proposals:F(ke),page:v(),count:v()}).transform(e=>({proposals:e.proposals,page:e.page,count:e.count})),Ce=P({voter:h(),voter_ens:h().nullable(),voter_label:h().nullable(),weight_yes:v(),weight_no:v(),tx_hash:h(),timestamp:v()}).transform(e=>({voter:e.voter,voterEns:e.voter_ens,voterLabel:e.voter_label,weightYes:e.weight_yes,weightNo:e.weight_no,txHash:e.tx_hash,time:M(e.timestamp)})),De=P({votes:F(Ce),total_votes:v()}).transform(e=>({votes:e.votes,totalVotes:e.total_votes})),Ie=P({search_string:h().optional(),order_by:J(["created_at","creator","voters_count"]).optional(),...X});async function Ve(e,o){const a=Z(o),i=Ie.parse(e),p=j(i),s=await G(`${a}/v1/dao/proposals${p}`,void 0,o==null?void 0:o.signal);return Te.parse(s)}const Le=P({...we,...X});async function Ae(e,o){const a=Z(o),{proposal_id:i,...p}=Le.parse(e),s=j(p),l=await G(`${a}/v1/dao/proposals/${i}/votes${s}`,void 0,o==null?void 0:o.signal);return De.parse(l)}function Ee(e){return Q({queryKey:["dao-proposals",e],queryFn:()=>ee((a,i)=>Ve({...z(e),page:a,per_page:i}).then(p=>p.proposals),1,100)})}function Ne(e){return Q({queryKey:["dao-proposal-votes",e],queryFn:()=>ee((a,i)=>Ae({...z(e),page:a,per_page:i}).then(p=>p.votes),1,100)})}const qe={class:"voters"},Me={class:"for"},Fe={class:"address"},Ye=["href"],Be={class:"amount"},He={class:"percentage"},Re={class:"against"},Ue={class:"percentage"},ze={class:"amount"},Ke={class:"address"},We=["href"],je=f({__name:"Voters",props:{proposal:{},votes:{}},setup(e){const{address:o}=le(),a=_(()=>e.votes?e.votes.filter(s=>s.weightYes).orderBy(s=>s.weightYes,"desc"):null),i=_(()=>e.votes?e.votes.filter(s=>s.weightNo).orderBy(s=>s.weightNo,"desc"):null),p=s=>s===o.value;return(s,l)=>{const r=O;return u(),g("div",qe,[t("div",Me,[l[0]||(l[0]=t("div",{class:"title"},"For",-1)),(u(!0),g(A,null,E(n(a),d=>(u(),g("div",{key:d.voter,class:"vote font-mono"},[t("div",Fe,[t("a",{target:"_blank",href:`https://etherscan.io/address/${d.voter}`,class:b({you:p(d.voter)})},y(d.voterEns||("addressShort"in s?s.addressShort:n(N))(d.voter)),11,Ye)]),t("div",Be,[c(r,{type:"dollar",value:d.weightYes,precision:2,"show-symbol":!1},null,8,["value"])]),t("div",He,[c(r,{type:"percentage",value:d.weightYes/s.proposal.weightYes*100,precision:0},null,8,["value"])])]))),128))]),t("div",Re,[l[1]||(l[1]=t("div",{class:"title"},"Against",-1)),(u(!0),g(A,null,E(n(i),d=>(u(),g("div",{key:d.voter,class:"vote font-mono"},[t("div",Ue,[c(r,{type:"percentage",value:d.weightNo/s.proposal.weightNo*100,precision:0},null,8,["value"])]),t("div",ze,[c(r,{type:"dollar",value:d.weightNo,precision:2,"show-symbol":!1},null,8,["value"])]),t("div",Ke,[t("a",{target:"_blank",href:`https://etherscan.io/address/${d.voter}`,class:b({you:p(d.voter)})},y(d.voterEns||("addressShort"in s?s.addressShort:n(N))(d.voter)),11,We)])]))),128))])])}}}),Ge=$(je,[["__scopeId","data-v-c5d03c10"]]),Qe={class:"technicals"},Je={class:"technical"},Xe={class:"description"},Ze={class:"technical"},Oe={class:"technical"},es=["href"],ss={key:0,class:"technical"},os=["href"],ts={class:"technical"},as=["innerHTML"],ns=f({__name:"Technicals",props:{proposal:{},votes:{}},setup(e){const o=C(!0),a=C(e.proposal.votersCount>0),i=_(()=>e.votes.uniqWith((s,l)=>s.voter===l.voter).length),p=_(()=>e.proposal.actions.reduce((s,l)=>s+l.decodedCalldata,"").replace(/(?:\r\n|\r|\n)/g,"<br>").replace("/├/g","├").replace("/─/g","─").replace(/0x[a-fA-F0-9]{40}/g,s=>/[A-F]/g.test(s)&&re(s)?`<a target='_blank' href='https://etherscan.io/address/${s}'>${s}</a>`:s));return(s,l)=>{var m;const r=K,d=W;return u(),g("div",Qe,[t("div",Je,[l[2]||(l[2]=t("div",{class:"heading"},"Description",-1)),t("div",Xe,y(s.proposal.description),1)]),t("div",Ze,[t("div",{class:"heading",onClick:l[0]||(l[0]=x=>a.value=!n(a))},[L(" Voters ("+y(n(i)??"?")+") ",1),c(r,{class:b(["expander",{expandedVoters:n(a)}])},null,8,["class"])]),c(d,{expanded:n(a)},{default:w(()=>[s.proposal?(u(),D(Ge,{key:0,class:"voters",proposal:s.proposal,votes:s.votes},null,8,["proposal","votes"])):q("",!0)]),_:1},8,["expanded"])]),t("div",Oe,[l[3]||(l[3]=t("div",{class:"heading"},"Creation transaction",-1)),t("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.creationTxHash}`},y(s.proposal.creationTxHash),9,es)]),(m=s.proposal)!=null&&m.executionTx?(u(),g("div",ss,[l[4]||(l[4]=t("div",{class:"heading"},"Execution transaction",-1)),t("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.executionTx}`},y(s.proposal.executionTx),9,os)])):q("",!0),t("div",ts,[t("div",{class:"heading",onClick:l[1]||(l[1]=x=>o.value=!n(o))},[l[5]||(l[5]=L(" Calldata ")),c(r,{class:b(["expander",{expandedCallData:n(o)}])},null,8,["class"])]),c(d,{expanded:n(o)},{default:w(()=>[t("div",{class:"calldata font-mono",innerHTML:n(p)},null,8,as)]),_:1},8,["expanded"])])])}}}),ls=$(ns,[["__scopeId","data-v-03e3a5e4"]]),rs={class:"results"},cs={class:"choice"},ps={class:"amount"},is={class:"left"},ds={class:"right"},us={class:"choice"},_s={class:"amount"},vs={class:"left"},hs={class:"right"},R=4,gs=f({__name:"VotingResults",props:{votes:{}},setup(e){const o=_(()=>e.votes.reduce((l,r)=>l+r.weightYes,0)),a=_(()=>e.votes.reduce((l,r)=>l+r.weightNo,0)),i=_(()=>o.value+a.value),p=_(()=>o.value/i.value*100),s=_(()=>a.value/i.value*100);return(l,r)=>{const d=O;return u(),g("div",rs,[r[8]||(r[8]=t("div",{class:"heading"},"Results",-1)),t("div",cs,[r[3]||(r[3]=t("div",{class:"label"},"For",-1)),t("div",ps,[t("div",is,[c(d,{"show-zero":"",type:"dollar",value:n(o),precision:0,"show-symbol":!1},null,8,["value"]),r[0]||(r[0]=t("span",null," RSUP",-1))]),t("div",ds,[r[1]||(r[1]=t("span",null,"(",-1)),c(d,{"show-zero":"",type:"percentage",value:n(p),precision:2},null,8,["value"]),r[2]||(r[2]=t("span",null,")",-1))])]),t("div",{class:"bar",style:H({width:`${Math.max(R,n(p))}%`})},null,4)]),t("div",us,[r[7]||(r[7]=t("div",{class:"label"},"Against",-1)),t("div",_s,[t("div",vs,[c(d,{"show-zero":"",type:"dollar",value:n(a),precision:0,"show-symbol":!1},null,8,["value"]),r[4]||(r[4]=t("span",null," RSUP",-1))]),t("div",hs,[r[5]||(r[5]=t("span",null,"(",-1)),c(d,{"show-zero":"",type:"percentage",value:n(s),precision:2},null,8,["value"]),r[6]||(r[6]=t("span",null,")",-1))])]),t("div",{class:"bar",style:H({width:`${Math.max(R,n(s))}%`})},null,4)])])}}}),ms=$(gs,[["__scopeId","data-v-4d9c269d"]]),fs={class:"voting"},ys=f({__name:"Voting",props:{votes:{}},setup(e){return(o,a)=>(u(),g("div",fs,[c(ms,{votes:o.votes},null,8,["votes"])]))}}),$s=$(ys,[["__scopeId","data-v-214162ab"]]),bs={class:"proposal-details"},ws={class:"proposal-details-container"},xs=f({__name:"ProposalDetails",props:{proposal:{}},setup(e){const{data:o}=Ne({proposal_id:e.proposal.proposalId});return(a,i)=>(u(),g("div",bs,[t("div",ws,[c(ls,{proposal:a.proposal,votes:n(o)??[]},null,8,["proposal","votes"]),c($s,{votes:n(o)??[]},null,8,["votes"])])]))}}),Ss=$(xs,[["__scopeId","data-v-413585ab"]]);function Ps(e){function o(k){return k<10?"0"+k.toString():k.toString()}const a=e.getTime()-new Date().getTime();if(a<=0)return"00:00:00:00";const i=1e3,p=i*60,s=p*60,l=s*24,r=Math.floor(a/l),d=Math.floor(a%l/s),m=Math.floor(a%s/p),x=Math.floor(a%p/i);return o(r)+":"+o(d)+":"+o(m)+":"+o(x)}const U=f({__name:"Date",props:{proposal:{},type:{}},setup(e){let o;const a=C(""),i=_(()=>{switch(e.type){case"start":return"Start";case"end":return"End";default:return"Unk. Type"}}),p=_(()=>{switch(e.type){case"start":return e.proposal.createdAt.toLocaleDateString();case"end":return e.proposal.end>new Date?a.value:e.proposal.end.toLocaleDateString();default:return new Date(0).toLocaleDateString()}}),s=_(()=>{switch(e.type){case"start":return`
        ${e.proposal.createdAt.toLocaleDateString()} ${e.proposal.createdAt.toTimeString()}
      `;case"end":return`
        ${e.proposal.end.toLocaleDateString()} ${e.proposal.end.toTimeString()}
      `;default:return new Date(0).toLocaleDateString()}});ce(()=>{l()});const l=()=>{o&&clearInterval(o),o=setInterval(()=>{a.value=Ps(e.proposal.end)})};return(r,d)=>{const m=Y;return u(),D(m,{"has-value":"",class:"date","tooltip-type":"underline",label:n(i),value:n(p),tooltip:n(s)},null,8,["label","value","tooltip"])}}}),ks=["href"],Ts=f({__name:"Proposer",props:{proposal:{}},setup(e){return(o,a)=>{const i=Y;return u(),D(i,{"has-value":"",class:"proposer",label:"Proposer"},{default:w(()=>[t("a",{target:"_blank",href:`https://etherscan.io/address/${o.proposal.creator}`},y(o.proposal.creatorEns||("addressShort"in o?o.addressShort:n(N))(o.proposal.creator)),9,ks)]),_:1})}}}),Cs=f({__name:"Status",props:{proposal:{}},setup(e){const o=_(()=>{switch(e.proposal.status){case"active":return"Active";case"failed":return"Failed";case"cancelled":return"Cancelled";case"executable":return"Executable";case"executed":return"Executed";case"all":return"All";default:return"Unk. Status"}});return(a,i)=>{const p=Y;return u(),D(p,{"has-value":"",class:"status","tooltip-type":"underline",label:"Status"},{default:w(()=>[t("span",{class:b(["status-value",a.proposal.status])},y(n(o)),3)]),_:1})}}}),Ds=$(Cs,[["__scopeId","data-v-39bb27db"]]),Is={class:"row"},Vs=f({__name:"ProposalSummary",props:{proposal:{},expanded:{type:Boolean}},emits:["toggleExpand"],setup(e,{emit:o}){const a=o,i=_(()=>`/dao/proposal/${e.proposal.proposalId}`),p=async()=>{await navigator.clipboard.writeText(`${window.location.origin}/dao/proposal/${e.proposal.proposalId}`),de({text:`Copied url for proposal ${e.proposal.proposalId}`,type:"success"})};return(s,l)=>{const r=xe,d=pe("router-link"),m=K;return u(),g("div",{class:"proposal-summary",onClick:l[0]||(l[0]=x=>a("toggleExpand"))},[t("div",{class:b(["title",{"no-title":s.proposal.creatorLabel}])},[t("span",{class:"id",onClick:ie(p,["stop"])},[c(r),L(" "+y(s.proposal.proposalId),1)]),c(d,{class:"metadata",to:n(i)},{default:w(()=>[L(y(s.proposal.creatorLabel||"< No Title >"),1)]),_:1},8,["to"])],2),t("div",Is,[c(Ds,{class:"item",proposal:s.proposal},null,8,["proposal"]),c(Ts,{class:"item",proposal:s.proposal},null,8,["proposal"]),c(U,{class:"item",type:"start",proposal:s.proposal},null,8,["proposal"]),c(U,{class:"item",type:"end",proposal:s.proposal},null,8,["proposal"]),t("div",{class:b(["item expander",{expanded:s.expanded}])},[c(m)],2)])])}}}),Ls=$(Vs,[["__scopeId","data-v-038d236f"]]),As=f({__name:"Proposal",props:{proposal:{},initExpanded:{type:Boolean,default:!1}},setup(e){const o=C(e.initExpanded);return(a,i)=>{const p=W,s=ue;return u(),D(s,{compact:"",class:"proposal"},{default:w(()=>[c(Ls,{proposal:a.proposal,expanded:n(o),onToggleExpand:i[0]||(i[0]=l=>o.value=!n(o))},null,8,["proposal","expanded"]),c(p,{class:"proposal-details-collapsible",expanded:n(o)},{default:w(()=>[c(Ss,{proposal:a.proposal,expanded:n(o)},null,8,["proposal","expanded"])]),_:1},8,["expanded"])]),_:1})}}}),Es=$(As,[["__scopeId","data-v-9a8a8fe5"]]),Ns={class:"dashboard"},qs={class:"filters"},Ms={class:"proposals-content"},Fs={key:0},Ys=f({__name:"Proposals.page",setup(e){const o=C(0),{page:a,onPage:i}=ge(),p=C(""),s=_e(p,300),l=_(()=>{switch(o.value){case 0:return"all";case 1:return"active";case 2:return"executable";case 3:return"failed";case 4:return"executed";default:return"all"}}),r=_(()=>s.value.toLocaleLowerCase()),{isFetching:d,data:m}=Ee(_(()=>({search_string:r.value}))),x=_(()=>{var S;return((S=m.value)==null?void 0:S.length)??0}),k=_(()=>(m.value??[]).filter(S=>l.value==="all"||S.status===l.value).orderBy(S=>S.createdAt.getDate(),"desc"));return(S,V)=>{const se=be,I=ye,oe=$e,te=fe,B=me,ae=he;return u(),g("div",Ns,[c(se,{title:"Governance proposals",description:"View and search for governance proposals"}),c(oe,{onTab:V[0]||(V[0]=T=>o.value=T.index)},{default:w(()=>[c(I,{header:"All"}),c(I,{header:"Active"}),c(I,{header:"Passed"}),c(I,{header:"Denied"}),c(I,{header:"Executed"})]),_:1}),t("div",qs,[c(te,{modelValue:n(p),"onUpdate:modelValue":V[1]||(V[1]=T=>ve(p)?p.value=T:null),search:"",style:{"flex-grow":"1"},placeholder:"Search for Resupply proposals"},null,8,["modelValue"]),c(B,{class:"pagination","items-count":n(x),"items-per-page":10,page:n(a),onPage:n(i)},null,8,["items-count","page","onPage"])]),t("div",Ms,[(u(!0),g(A,null,E(n(k),T=>(u(),D(Es,{key:T.proposalId,class:b(["loading-backdrop",{loading:n(d)}]),proposal:T},null,8,["proposal","class"]))),128)),c(B,{class:"pagination","items-count":n(x),"items-per-page":10,page:n(a),onPage:n(i)},null,8,["items-count","page","onPage"]),n(k).length===0?(u(),g("div",Fs,"No proposals could be found.")):q("",!0),c(ae,{loading:n(d)},null,8,["loading"])])])}}}),Js=$(Ys,[["__scopeId","data-v-4b0ace7f"]]);export{Js as default};
