import{_ as ye}from"./DashboardHeader-jjU4oyqz.js";import{u as k,r as R,a as W}from"./Number-BwCHtbMI.js";import{a as I,f as P,_ as M}from"./fetch-S3nWqVm-.js";import{o as m,f as B,s as d,n as _,_ as be,t as E,a as x,i as we,p as K,c as z,h as S,j as $e,g as F,e as se}from"./timestamp-Ki00Lgd1.js";import{p as ae}from"./Pagination-vgbH7lYO.js";import{aI as Te,at as D,d as w,ay as O,av as ne,c as b,az as oe,j as U,o as $,w as g,f as p,e as u,u as r,h as q,_ as H,t as V,ao as A,g as C,aq as j,al as Ce,an as ke,ak as Pe,ae as xe,b as Se}from"./index-DAmMJpTU.js";import{u as re,c as ie,a as le,_ as ce}from"./UseLightweightChart-Cn6_rK2P.js";import{_ as ue}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-DFTTHLNa.js";import{_ as Fe}from"./ChartApex-CtY4pqhq.js";import{_ as N}from"./Table-DQn4OZ6C.js";import{u as De,_ as pe,a as Ue}from"./UsePagination-rqSrHaF6.js";import{u as de}from"./UseRelativeTime-CKRKYyBO.js";function me(e,t){const o={...e};for(const a in t)Array.isArray(t[a])?o[a]=[...t[a]]:typeof t[a]=="object"&&t[a]!==null?o[a]=me(o[a],t[a]):o[a]=t[a];return o}const _e=m({event_type:be(["deposit","withdraw"]),block_timestamp:_(),tx_hash:d(),block_number:_(),assets:d(),shares:d(),sender:B,owner:B}),he=e=>({eventType:e.event_type,blockTime:E(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,assets:parseFloat(e.assets),shares:parseFloat(e.shares),sender:e.sender,owner:e.owner}),qe=_e.refine(e=>e.event_type==="deposit",{message:"Expected deposit event type"}).transform(he),Ee=_e.extend({receiver:B}).refine(e=>e.event_type==="withdraw",{message:"Expected withdraw event type"}).transform(e=>({...he(e),receiver:e.receiver})),Ae=m({events:x(we([qe,Ee])),count:_(),page:_(),total_pages:_()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),He=m({account:B,amount:d(),end_timestamp:_(),block_timestamp:_(),tx_hash:d()}).transform(e=>({account:e.account,amount:parseFloat(e.amount),end:E(e.end_timestamp),blockTime:E(e.block_timestamp),txHash:e.tx_hash})),Ve=m({entries:x(He)}).transform(e=>({entries:e.entries})),Re=m({timestamp:_(),token_address:d(),token_symbol:d(),apr:d()}).transform(e=>({timestamp:E(e.timestamp),tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),Be=m({snapshots:x(Re),count:_(),page:_(),total_pages:_()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),Ie=m({timestamp:_(),tvl:d()}).transform(e=>({timestamp:E(e.timestamp),tvl:parseFloat(e.tvl)})),Qe=m({data:x(Ie),count:_(),page:_(),total_pages:_()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),Le=m({address:d(),label:d().nullable(),ens:d().nullable(),position_value:d()}).transform(e=>({address:e.address,label:e.label,ens:e.ens,positionValue:parseFloat(e.position_value)})),We=m({total_tvl:d(),top_users_tvl:d(),others_tvl:d(),users:x(Le)}).transform(e=>({totalTvl:parseFloat(e.total_tvl),topUsersTvl:parseFloat(e.top_users_tvl),othersTvl:parseFloat(e.others_tvl),users:e.users})),Me=m({min_value:d(),max_value:d(),count:_()}).transform(e=>({minValue:parseFloat(e.min_value),maxValue:parseFloat(e.max_value),count:e.count})),Ke=m({bins:x(Me),total_users:_()}).transform(e=>({bins:e.bins,totalUsers:e.total_users})),ze=m({...S,...z,...K});async function Oe(e,t){const o=F(),{chain:a,...s}=ze.parse(e),i=I(s),n=await P(`${o}/v1/insurance/${a}/events${i}`,void 0,t==null?void 0:t.signal);return Ae.parse(n)}const je=m(S);async function Ne(e,t){const o=F(),{chain:a}=je.parse(e),s=await P(`${o}/v1/insurance/${a}/cooldown_queue`,void 0,t==null?void 0:t.signal);return Ve.parse(s)}const Je=m({...S,...z,...K});async function Ye(e,t){const o=F(),{chain:a,...s}=Je.parse(e),i=I(s),n=await P(`${o}/v1/insurance/${a}/apr_history${i}`,void 0,t==null?void 0:t.signal);return Be.parse(n)}const Ge=m({...S,...z,...K});async function Xe(e,t){const o=F(),{chain:a,...s}=Ge.parse(e),i=I(s),n=await P(`${o}/v1/insurance/${a}/tvl_history${i}`,void 0,t==null?void 0:t.signal);return Qe.parse(n)}const Ze=m(S);async function et(e,t){const o=F(),{chain:a}=Ze.parse(e),s=await P(`${o}/v1/insurance/${a}/top_users`,void 0,t==null?void 0:t.signal);return We.parse(s)}const tt=m({...S,bin_count:$e().positive().optional()});async function st(e,t){const o=F(),{chain:a,...s}=tt.parse(e),i=I(s),n=await P(`${o}/v1/insurance/${a}/position_histogram${i}`,void 0,t==null?void 0:t.signal);return Ke.parse(n)}function at(e){return k({queryKey:["insurance-events",e],queryFn:()=>Oe(D(e)),placeholderData:Te})}function nt(e){return k({queryKey:["insurance-cooldown-queue",e],queryFn:()=>Ne(D(e))})}function ot(e){const{start:t,end:o}=se({daysRange:90});return k({queryKey:["insurance-apr-history",e],queryFn:()=>ae((s,i)=>Ye({...D(e),page:s,per_page:i,start:t,end:o}).then(n=>n.snapshots),1,100)})}function rt(e){const{start:t,end:o}=se({daysRange:90});return k({queryKey:["insurance-tvl-history",e],queryFn:()=>ae((s,i)=>Xe({...D(e),page:s,per_page:i,start:t,end:o}).then(n=>n.data),1,100)})}function it(e){return k({queryKey:["insurance-top-users",e],queryFn:()=>et(D(e))})}function lt(e){return k({queryKey:["insurance-position-hist",e],queryFn:()=>st(D(e))})}const ct={style:{display:"flex"}},ut={ref:"chartRef",class:"chart"},pt=w({__name:"ChartApr",props:{apr:{}},setup(e){const t=O(),o=ne("card"),{chart:a,series:s}=re({createChartOptions:le(),series:ie({name:"apr",color:b(()=>t.value.colors.blue),formatter:n=>`${R(n,0,"percentage")}%`,minMove:.01})});oe(i);function i(){if(!a.value||!s.apr)return;const n=e.apr.map(l=>({time:l.timestamp.getUTCTimestamp(),value:l.apr})).uniqWith((l,c)=>l.time===c.time).orderBy(l=>l.time,"asc");n.length>0&&s.apr.setData(n),a.value.timeScale().fitContent()}return(n,l)=>{const c=ue,h=ce,y=q;return $(),U(y,{ref_key:"card",ref:o,title:"APR"},{actions:g(()=>[p("div",ct,[u(c,{filename:"apr",series:r(s)},null,8,["series"]),u(h,{chart:r(a),target:r(o)},null,8,["chart","target"])])]),default:g(()=>[p("div",ut,null,512)]),_:1},512)}}}),dt=e=>({chart:{id:"chart",background:"transparant",foreColor:e.colors.level5,fontFamily:"ui-monospace, SFMono-Regular, SF Mono, Menlo, Monaco, Consolas, monospace",toolbar:{autoSelected:"zoom",tools:{download:!1,pan:!1}},zoom:{autoScaleYaxis:!0}},colors:e.colorsArray,grid:{borderColor:e.colors.level5,strokeDashArray:4,xaxis:{lines:{show:!1}}},fill:{type:"solid",opacity:1},stroke:{curve:"smooth",width:2},theme:{mode:"dark"},xaxis:{type:"category",axisBorder:{color:e.colors.level5,height:1},axisTicks:{color:e.colors.level5},title:{color:e.colors.level5}},yaxis:{tickAmount:4,axisBorder:{color:e.colors.level5},axisTicks:{color:e.colors.level5},title:{color:e.colors.level5}}});function mt(e,t){t??(t=O());const o=dt(t.value);return e?me(o,e):o}const _t=w({__name:"ChartPositions",props:{bins:{}},setup(e){const t=b(()=>mt({chart:{type:"bar",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1}},xaxis:{categories:o.value,labels:{formatter:s=>s,rotate:-60},tickPlacement:"on"},yaxis:{labels:{formatter:s=>s}},plotOptions:{bar:{columnWidth:"50%"}},dataLabels:{enabled:!1},tooltip:{followCursor:!1,enabled:!0,intersect:!0,custom:s=>{const i=s.series[0][s.dataPointIndex];return`<div><b>Range</b>: ${o.value[s.dataPointIndex]}</div><div><b>Users</b>: ${i}</div>`}}})),o=b(()=>e.bins.map(s=>{const i=s.minValue?`${R(s.minValue,0,"dollar")}${W(s.minValue)}`:"0",n=s.maxValue?`${R(s.maxValue,0,"dollar")}${W(s.maxValue)}`:"0";return`${i} - ${n}`})),a=b(()=>[{name:"Users",data:e.bins.map(s=>s.count)}]);return(s,i)=>{const n=Fe,l=q;return $(),U(l,{title:"User positions"},{default:g(()=>[u(n,{options:r(t),series:r(a)},null,8,["options","series"])]),_:1})}}}),ht=H(_t,[["__scopeId","data-v-525b8a17"]]),gt={style:{display:"flex"}},vt={ref:"chartRef",class:"chart"},ft=w({__name:"ChartTvl",props:{tvl:{}},setup(e){const t=O(),o=ne("card"),{chart:a,series:s}=re({createChartOptions:le(),series:ie({name:"tvl",color:b(()=>t.value.colors.blue),formatter:n=>`${R(n,1,"dollar")}${W(n)}`})});oe(i);function i(){if(!a.value||!s.tvl)return;const n=e.tvl.map(l=>({time:l.timestamp.getUTCTimestamp(),value:l.tvl})).uniqWith((l,c)=>l.time===c.time).orderBy(l=>l.time,"asc");n.length>0&&s.tvl.setData(n),a.value.timeScale().fitContent()}return(n,l)=>{const c=ue,h=ce,y=q;return $(),U(y,{ref_key:"card",ref:o,title:"TVL (reUSD)"},{actions:g(()=>[p("div",gt,[u(c,{filename:"tvl",series:r(s)},null,8,["series"]),u(h,{chart:r(a),target:r(o)},null,8,["chart","target"])])]),default:g(()=>[p("div",vt,null,512)]),_:1},512)}}}),yt=["href"],bt={class:"end"},wt={class:"end"},$t=["href"],te=10,Tt=w({__name:"TableCooldowns",props:{cooldowns:{}},setup(e){const{page:t,rowsPage:o,onPage:a}=De(V(()=>e.cooldowns),te),{relativeTime:s}=de();return(i,n)=>{const l=pe,c=M,h=N,y=q;return $(),U(y,{title:"Cooldown Queue"},{actions:g(()=>[u(l,{"items-count":i.cooldowns.length,"items-per-page":te,page:r(t),onPage:r(a)},null,8,["items-count","page","onPage"])]),default:g(()=>[u(h,{rows:r(o),columns:["User",{label:"Staked reUSD",align:"end"},{label:"Time",align:"end"}]},{row:g(({item:f})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${f.account.address}`,onClick:n[0]||(n[0]=A(()=>{},["stop"]))},C(f.account.ens||("addressShort"in i?i.addressShort:r(j))(f.account.address)),9,yt)]),p("div",bt,[u(c,{type:"dollar",value:f.amount,precision:2,"show-symbol":!1},null,8,["value"])]),p("div",wt,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${f.txHash}`,onClick:n[1]||(n[1]=A(()=>{},["stop"]))},C(r(s)(f.end.getUTCTimestamp())),9,$t)])]),_:1},8,["rows"])]),_:1})}}}),Ct=H(Tt,[["__scopeId","data-v-68d34664"]]),kt=["href"],Pt={class:"end"},xt={class:"end"},St=["href"],Ft=w({__name:"TableEvents",props:{events:{},count:{}},emits:["page"],setup(e,{emit:t}){const o=t,{page:a,onPage:s}=Ue(),i=Ce(a,200);ke(i,c=>{o("page",c)});const{relativeTime:n}=de(),l=c=>{switch(c.eventType){case"deposit":return"Deposit";case"withdraw":return"Withdraw"}};return(c,h)=>{const y=pe,f=M,Q=N,L=q;return $(),U(L,{title:"Events"},{actions:g(()=>[u(y,{"items-count":c.count,"items-per-page":10,page:r(a),onPage:r(s)},null,8,["items-count","page","onPage"])]),default:g(()=>[u(Q,{rows:c.events,columns:["Type","Owner",{label:"reUSD",align:"end"},{label:"Time",align:"end"}]},{row:g(({item:v})=>[p("div",{class:Pe({green:v.eventType==="deposit",red:v.eventType==="withdraw"})},C(l(v)),3),p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${v.owner.address}`,onClick:h[0]||(h[0]=A(()=>{},["stop"]))},C(v.owner.ens||("addressShort"in c?c.addressShort:r(j))(v.owner.address)),9,kt)]),p("div",Pt,[u(f,{type:"dollar",value:v.assets,precision:2,"show-symbol":!1},null,8,["value"])]),p("div",xt,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${v.txHash}`,onClick:h[1]||(h[1]=A(()=>{},["stop"]))},C(r(n)(v.blockTime.getUTCTimestamp())),9,St)])]),_:1},8,["rows"])]),_:1})}}}),Dt=H(Ft,[["__scopeId","data-v-3f720b56"]]),Ut=["href"],qt={class:"end"},Et=w({__name:"TableTopUsers",props:{topUsers:{}},setup(e){return(t,o)=>{const a=M,s=N,i=q;return $(),U(i,{title:"Top Users"},{default:g(()=>[u(s,{rows:t.topUsers,columns:["Address",{label:"Staked reUSD",align:"end"}]},{row:g(({item:n})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${n.address}`,onClick:o[0]||(o[0]=A(()=>{},["stop"]))},C(n.ens||("addressShort"in t?t.addressShort:r(j))(n.address)),9,Ut)]),p("div",qt,[u(a,{type:"dollar",value:n.positionValue,precision:2,"show-symbol":!1},null,8,["value"])])]),_:1},8,["rows"])]),_:1})}}}),At=H(Et,[["__scopeId","data-v-4cc4818c"]]),Ht={class:"dashboard"},Vt=w({__name:"Insurance.page",setup(e){const{isFetching:t,data:o}=ot({chain:"ethereum"}),a=b(()=>(o.value??[]).map(T=>({timestamp:T.timestamp,apr:T.apr}))),{isFetching:s,data:i}=rt({chain:"ethereum"}),n=b(()=>(i.value??[]).map(T=>({timestamp:T.timestamp,tvl:T.tvl}))),l=xe(1),{isFetching:c,data:h}=at(b(()=>({chain:"ethereum",page:l.value,per_page:10}))),{isFetching:y,data:f}=it(V(()=>({chain:"ethereum"}))),{isFetching:Q,data:L}=nt(V(()=>({chain:"ethereum"}))),{isFetching:v,data:ge}=lt(V(()=>({chain:"ethereum"})));return(T,J)=>{var Y,G,X,Z,ee;const ve=ye;return $(),Se("div",Ht,[u(ve,{style:{"grid-area":"header"},title:"Insurance",description:"Insurance pool metrics for Resupply including APR, TVL and positions"}),u(pt,{style:{"grid-area":"apr"},apr:r(a),loading:r(t)},null,8,["apr","loading"]),u(ft,{style:{"grid-area":"tvl"},tvl:r(n),loading:r(s)},null,8,["tvl","loading"]),u(Dt,{style:{"grid-area":"events"},events:((Y=r(h))==null?void 0:Y.events)??[],count:((G=r(h))==null?void 0:G.count)??0,loading:r(c),onPage:J[0]||(J[0]=fe=>l.value=fe)},null,8,["events","count","loading"]),u(At,{style:{"grid-area":"top-users"},"top-users":((X=r(f))==null?void 0:X.users)??[],loading:r(y)},null,8,["top-users","loading"]),u(Ct,{style:{"grid-area":"cooldowns"},cooldowns:((Z=r(L))==null?void 0:Z.entries)??[],loading:r(Q)},null,8,["cooldowns","loading"]),u(ht,{style:{"grid-area":"positions"},bins:((ee=r(ge))==null?void 0:ee.bins)??[],loading:r(v)},null,8,["bins","loading"])])}}}),Jt=H(Vt,[["__scopeId","data-v-978a25a4"]]);export{Jt as default};
