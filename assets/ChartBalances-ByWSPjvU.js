import{d as O,ap as U,aq as q,b as D,o as T,az as P,ar as j,e as r,as as W,l as N,u as z,a as F,a_ as $,c as B,w as A,_ as G,f as w,g as h,h as i,an as I,aZ as J,k as V,m as Y}from"./index-V38PSwR-.js";import{b as Z,u as H,J as K,r as Q,a as X,d as x,_ as ee}from"./UseLightweightChart-CLSj911F.js";import{_ as ae}from"./Tooltip-Dyx_j7GF.js";import{r as L,u as te}from"./timestamp-CFR8-yJ3.js";const se=O({__name:"ButtonToggle",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:U(["change"],["update:modelValue"]),setup(o,{emit:m}){const p=q(o,"modelValue"),_=m;return(g,v)=>{const u=P;return T(),D(u,{class:j({toggled:p.value}),onClick:v[0]||(v[0]=C=>_("change",!p.value))},{default:r(()=>[W(g.$slots,"default",{},void 0,!0)]),_:3},8,["class"])}}}),le=N(se,[["__scopeId","data-v-1a55ee48"]]),ne={class:"actions"},oe={ref:"chartRef",class:"chart"},ce="chart_pool_balances_dollars",ie="chart_pool_balances_type",re=O({__name:"ChartBalances",props:{balances:{},title:{},showDollars:{type:Boolean,default:!0},chartType:{default:"area"}},setup(o){const m=z(),{items:p,toggles:_,disabled:g}=Z(()=>o.balances.map(({symbol:e},a)=>({id:e,label:e,color:m.value.colorsArray[a],togglable:!0}))),v=F("card"),u=$(ce,!1),C=["unstacked","stacked","100%"],y=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],b=$(ie,C[0]),{chart:k,series:l}=H({createChartOptions:X(),series:[...o.balances.map(({symbol:e},a)=>({type:K,name:e,options:B(()=>({lineWidth:2,lineType:Q.WithSteps,color:m.value.colorsArray[a],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stackedArea",options:B(()=>({colors:p.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!g.value.includes(e.id)).map(({i:e})=>e).map(e=>m.value.colorsArray[e]).map(e=>({line:e,area:e+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))},{type:"StackedBars",name:"stackedBars",options:B(()=>({colors:p.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!g.value.includes(e.id)).map(({i:e})=>e).map(e=>m.value.colorsArray[e]),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});A(()=>{k.value&&k.value.applyOptions({localization:{priceFormatter:b.value==="100%"?e=>`${L(e,0,"percentage")}%`:e=>`${L(e,1,"dollar")}${te(e)}`}})}),A(R);function R(){if(!(!k.value||Object.values(l).length<0)){for(const e of Object.values(l))e?.setData([]);b.value==="unstacked"?E():M(b.value==="100%"),k.value.timeScale().fitContent()}}function E(){for(const{symbol:e,balances:a}of o.balances.values()){if(!_[e].value){l[e]?.setData([]);continue}const d=o.showDollars&&u.value,s=a.map(t=>({time:t.timestamp.getUTCTimestamp(),value:d?t.balance*t.tokenPrice:t.balance})).uniqWith((t,n)=>t.time===n.time).orderBy(t=>t.time,"asc");s.length>0&&l[e]?.setData(s)}}function M(e){if(!l.stackedArea||!l.stackedBars)return;const a=o.showDollars&&u.value,d=[...o.balances.values()].filter(({symbol:s,balances:t})=>_[s].value&&t.length>0).flatMap(({symbol:s,balances:t})=>t.map(n=>({symbol:s,timestamp:n.timestamp,balance:a?n.balance*n.tokenPrice:n.balance}))).groupBy(s=>s.timestamp.getTime()).entries().map(([s,t])=>{const n=e&&t.sumBy(f=>f.balance)||1,S=t.map(f=>e?f.balance/n*100:f.balance);return{time:Number(s)/1e3,values:S}}).uniqWith((s,t)=>s.time===t.time).orderBy(s=>s.time,"asc");d.length>0&&(o.chartType==="area"?(l.stackedArea.setData(d),l.stackedBars.setData([])):(l.stackedArea.setData([]),l.stackedBars.setData(d)))}return(e,a)=>{const d=J,s=le,t=ae,n=ee,S=x,f=G;return T(),D(f,{ref_key:"card",ref:v,class:"stack-actions",title:e.title??"Balances"},{actions:r(()=>[w("div",ne,[W(e.$slots,"actions",{},void 0,!0),h(d,{options:y,selected:y.find(c=>c.id===i(b))??y[0],onSelect:a[0]||(a[0]=c=>b.value=c.id)},{option:r(({option:c})=>[V(Y(c.label),1)]),_:1},8,["selected"]),e.showDollars?(T(),D(t,{key:0},{trigger:r(()=>[h(s,{"model-value":i(u),onClick:a[1]||(a[1]=c=>u.value=!i(u))},{default:r(()=>a[3]||(a[3]=[V(" $ ")])),_:1,__:[3]},8,["model-value"])]),default:r(()=>[a[4]||(a[4]=V(" Show token balances in USD. "))]),_:1,__:[4]})):I("",!0),h(n,{chart:i(k),target:i(v)},null,8,["chart","target"])])]),"actions-secondary":r(()=>[h(S,{items:i(p),disabled:i(g),onToggle:a[2]||(a[2]=c=>i(_)[c].value=!i(_)[c].value)},null,8,["items","disabled"])]),default:r(()=>[w("div",oe,null,512)]),_:3},8,["title"])}}}),_e=N(re,[["__scopeId","data-v-ca373428"]]);export{_e as _};
