import{O as R,d as f,V as B,W as M,c as v,b as g,o as _,n as y,f as o,j as S,v as P,X as Y,A as L,u as l,w as x,i as I,g as b,Y as ae,_ as $,x as z,Z as ne,$ as D,a0 as N,B as E,e as c,r as T,a1 as le,C as U,a2 as K,a3 as j,q as re,E as ie,h as pe,z as ce,a4 as de,H as ue}from"./index-DsSu0Rud.js";import{z as n,t as O,p as W,h as _e,g as Q,e as ve,_ as he}from"./UsePagination-AMK_SP_b.js";import{_ as ge,a as me}from"./TabItem.vue_vue_type_script_setup_true_lang-h3_s0Q7z.js";import{a as J,f as X,u as Z,_ as G}from"./fetch-7WrayJG1.js";import{p as ee}from"./Pagination-vgbH7lYO.js";import{_ as q}from"./KPI-B2wIEWIa.js";/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=R("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=R("search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),ye={class:"input-form"},$e={key:0,class:"icon"},we=["type","value","placeholder"],xe=f({__name:"InputText",props:B({placeholder:{default:""},options:{default:()=>[]},search:{type:Boolean,default:!1},filter:{type:Function,default:()=>!0},sort:{type:Function,default:null},direction:{default:"down"}},{modelValue:{required:!0},modelModifiers:{},open:{type:Boolean,default:!1},openModifiers:{}}),emits:B(["input","select"],["update:modelValue","update:open"]),setup(e,{emit:t}){const r=M(e,"modelValue"),d=M(e,"open"),u=t,s=v(()=>{const a=[...e.options].filter(w=>e.filter(r.value,w));return e.sort?a.sort(e.sort):a});function i(a){const h=a.target.value;r.value=h,d.value=!!h,u("input",h)}function p(a){d.value=!1,u("select",a)}return(a,h)=>{const w=be,A=ae;return _(),g("div",{class:y(["input-text",{search:a.search}])},[o("div",ye,[a.search||a.$slots.icon?(_(),g("span",$e,[Y(a.$slots,"icon",{},()=>[a.search?(_(),S(w,{key:0})):P("",!0)],!0)])):P("",!0),o("input",{class:y([{open:d.value},a.direction]),type:a.search?"search":"text",value:r.value,placeholder:a.placeholder,onInput:L(i,["stop"]),onSelect:h[0]||(h[0]=L(()=>{},["stop"]))},null,42,we)]),l(s).length>0?(_(),S(A,{key:0,open:d.value,"onUpdate:open":h[1]||(h[1]=m=>d.value=m),direction:a.direction,options:l(s),onSelect:p},{option:x(({option:m,idx:k})=>[Y(a.$slots,"option",{option:m,idx:k},()=>[I(b(m),1)],!0)]),_:3},8,["open","direction","options"])):P("",!0)],2)}}}),Se=$(xe,[["__scopeId","data-v-798ed46a"]]),ke=n.enum(["all","active","failed","cancelled","executed","executable"]),Ce=n.object({index:n.number(),target:n.string(),calldata:n.string(),decoded_calldata:n.string()}).transform(e=>({index:e.index,target:e.target,calldata:e.calldata,decodedCalldata:e.decoded_calldata})),Pe=n.object({proposal_id:n.number(),on_chain_id:n.number(),creator:n.string(),creator_ens:n.string().nullable(),creator_label:n.string().nullable(),status:ke,epoch:n.number(),created_at:n.number(),quorum_weight:n.number(),execution_tx:n.string().nullable(),cancellation_tx:n.string().nullable(),actions:n.array(Ce),weight_yes:n.number(),weight_no:n.number(),voters_count:n.number(),creation_tx_hash:n.string()}).transform(e=>({proposalId:e.proposal_id,onChainId:e.on_chain_id,creator:e.creator,creatorEns:e.creator_ens,creatorLabel:e.creator_label,status:e.status,epoch:e.epoch,createdAt:O(e.created_at),quorumWeight:e.quorum_weight,executionTx:e.execution_tx,cancellationTx:e.cancellation_tx,actions:e.actions,weightYes:e.weight_yes,weightNo:e.weight_no,votersCount:e.voters_count,creationTxHash:e.creation_tx_hash})),Ve=n.object({proposals:n.array(Pe),page:n.number(),count:n.number()}).transform(e=>({proposals:e.proposals,page:e.page,count:e.count})),Ie=n.object({voter:n.string(),voter_ens:n.string().nullable(),voter_label:n.string().nullable(),weight_yes:n.number(),weight_no:n.number(),tx_hash:n.string(),timestamp:n.number()}).transform(e=>({voter:e.voter,voterEns:e.voter_ens,voterLabel:e.voter_label,weightYes:e.weight_yes,weightNo:e.weight_no,txHash:e.tx_hash,time:O(e.timestamp)})),Te=n.object({votes:n.array(Ie),total_votes:n.number()}).transform(e=>({votes:e.votes,totalVotes:e.total_votes})),Ae=n.object({search_string:n.string().optional(),order_by:n.enum(["created_at","creator","voters_count"]).optional(),...W});async function Le(e,t){const r=Q(),d=Ae.parse(e),u=J(d),s=await X(`${r}/v1/dao/proposals${u}`,void 0,t==null?void 0:t.signal);return Ve.parse(s)}const De=n.object({..._e,...W});async function Ne(e,t){const r=Q(),{proposal_id:d,...u}=De.parse(e),s=J(u),i=await X(`${r}/v1/dao/proposals/${d}/votes${s}`,void 0,t==null?void 0:t.signal);return Te.parse(i)}function Ee(e){return Z({queryKey:["dao-proposals",e],queryFn:()=>ee((r,d)=>Le({...z(e),page:r,per_page:d}).then(u=>u.proposals),1,100)})}function qe(e){return Z({queryKey:["dao-proposal-votes",e],queryFn:()=>ee((r,d)=>Ne({...z(e),page:r,per_page:d}).then(u=>u.votes),1,100)})}const Fe={class:"voters"},Be={class:"for"},Me={class:"address"},Ye=["href"],je={class:"amount"},He={class:"percentage"},Re={class:"against"},ze={class:"percentage"},Ue={class:"amount"},Ke={class:"address"},Oe=["href"],We=f({__name:"Voters",props:{proposal:{},votes:{}},setup(e){const{address:t}=ne(),r=v(()=>e.votes?e.votes.filter(s=>s.weightYes).orderBy(s=>s.weightYes,"desc"):null),d=v(()=>e.votes?e.votes.filter(s=>s.weightNo).orderBy(s=>s.weightNo,"desc"):null),u=s=>s===t.value;return(s,i)=>{const p=G;return _(),g("div",Fe,[o("div",Be,[i[0]||(i[0]=o("div",{class:"title"},"For",-1)),(_(!0),g(D,null,N(l(r),a=>(_(),g("div",{key:a.voter,class:"vote font-mono"},[o("div",Me,[o("a",{target:"_blank",href:`https://etherscan.io/address/${a.voter}`,class:y({you:u(a.voter)})},b(a.voterEns||("addressShort"in s?s.addressShort:l(E))(a.voter)),11,Ye)]),o("div",je,[c(p,{type:"dollar",value:a.weightYes,precision:2,"show-symbol":!1},null,8,["value"])]),o("div",He,[c(p,{type:"percentage",value:a.weightYes/s.proposal.weightYes*100,precision:0},null,8,["value"])])]))),128))]),o("div",Re,[i[1]||(i[1]=o("div",{class:"title"},"Against",-1)),(_(!0),g(D,null,N(l(d),a=>(_(),g("div",{key:a.voter,class:"vote font-mono"},[o("div",ze,[c(p,{type:"percentage",value:a.weightNo/s.proposal.weightNo*100,precision:0},null,8,["value"])]),o("div",Ue,[c(p,{type:"dollar",value:a.weightNo,precision:2,"show-symbol":!1},null,8,["value"])]),o("div",Ke,[o("a",{target:"_blank",href:`https://etherscan.io/address/${a.voter}`,class:y({you:u(a.voter)})},b(a.voterEns||("addressShort"in s?s.addressShort:l(E))(a.voter)),11,Oe)])]))),128))])])}}}),Qe=$(We,[["__scopeId","data-v-c5d03c10"]]),Je={class:"technicals"},Xe={class:"technical"},Ze={class:"technical"},Ge=["href"],es={key:0,class:"technical"},ss=["href"],os={class:"technical"},ts=["innerHTML"],as=f({__name:"Technicals",props:{proposal:{},votes:{}},setup(e){const t=T(!0),r=T(e.proposal.votersCount>0),d=v(()=>e.votes.uniqWith((s,i)=>s.voter===i.voter).length),u=v(()=>e.proposal.actions.reduce((s,i)=>s+i.decodedCalldata,"").replace(/(?:\r\n|\r|\n)/g,"<br>").replace("/├/g","├").replace("/─/g","─").replace(/0x[a-fA-F0-9]{40}/g,s=>/[A-F]/g.test(s)&&le(s)?`<a target='_blank' href='https://etherscan.io/address/${s}'>${s}</a>`:s));return(s,i)=>{var h;const p=U,a=K;return _(),g("div",Je,[i[5]||(i[5]=o("div",{class:"technical"},[o("div",{class:"heading"},"Description"),o("div",{class:"description"},"DESCRIPTION TODO")],-1)),o("div",Xe,[o("div",{class:"heading",onClick:i[0]||(i[0]=w=>r.value=!l(r))},[I(" Voters ("+b(l(d)??"?")+") ",1),c(p,{class:y(["expander",{expandedVoters:l(r)}])},null,8,["class"])]),c(a,{expanded:l(r)},{default:x(()=>[s.proposal?(_(),S(Qe,{key:0,class:"voters",proposal:s.proposal,votes:s.votes},null,8,["proposal","votes"])):P("",!0)]),_:1},8,["expanded"])]),o("div",Ze,[i[2]||(i[2]=o("div",{class:"heading"},"Creation transaction",-1)),o("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.creationTxHash}`},b(s.proposal.creationTxHash),9,Ge)]),(h=s.proposal)!=null&&h.executionTx?(_(),g("div",es,[i[3]||(i[3]=o("div",{class:"heading"},"Execution transaction",-1)),o("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.executionTx}`},b(s.proposal.executionTx),9,ss)])):P("",!0),o("div",os,[o("div",{class:"heading",onClick:i[1]||(i[1]=w=>t.value=!l(t))},[i[4]||(i[4]=I(" Calldata ")),c(p,{class:y(["expander",{expandedCallData:l(t)}])},null,8,["class"])]),c(a,{expanded:l(t)},{default:x(()=>[o("div",{class:"calldata font-mono",innerHTML:l(u)},null,8,ts)]),_:1},8,["expanded"])])])}}}),ns=$(as,[["__scopeId","data-v-e295b27a"]]),ls={class:"results"},rs={class:"choice"},is={class:"amount"},ps={class:"left"},cs={class:"right"},ds={class:"choice"},us={class:"amount"},_s={class:"left"},vs={class:"right"},H=4,hs=f({__name:"VotingResults",props:{votes:{}},setup(e){const t=v(()=>e.votes.reduce((i,p)=>i+p.weightYes,0)),r=v(()=>e.votes.reduce((i,p)=>i+p.weightNo,0)),d=v(()=>t.value+r.value),u=v(()=>t.value/d.value*100),s=v(()=>r.value/d.value*100);return(i,p)=>{const a=G;return _(),g("div",ls,[p[8]||(p[8]=o("div",{class:"heading"},"Results",-1)),o("div",rs,[p[3]||(p[3]=o("div",{class:"label"},"For",-1)),o("div",is,[o("div",ps,[c(a,{"show-zero":"",type:"dollar",value:l(t),precision:0,"show-symbol":!1},null,8,["value"]),p[0]||(p[0]=o("span",null," veCRV",-1))]),o("div",cs,[p[1]||(p[1]=o("span",null,"(",-1)),c(a,{"show-zero":"",type:"percentage",value:l(u),precision:2},null,8,["value"]),p[2]||(p[2]=o("span",null,")",-1))])]),o("div",{class:"bar",style:j({width:`${Math.max(H,l(u))}%`})},null,4)]),o("div",ds,[p[7]||(p[7]=o("div",{class:"label"},"Against",-1)),o("div",us,[o("div",_s,[c(a,{"show-zero":"",type:"dollar",value:l(r),precision:0,"show-symbol":!1},null,8,["value"]),p[4]||(p[4]=o("span",null," veCRV",-1))]),o("div",vs,[p[5]||(p[5]=o("span",null,"(",-1)),c(a,{"show-zero":"",type:"percentage",value:l(s),precision:2},null,8,["value"]),p[6]||(p[6]=o("span",null,")",-1))])]),o("div",{class:"bar",style:j({width:`${Math.max(H,l(s))}%`})},null,4)])])}}}),gs=$(hs,[["__scopeId","data-v-f01664c7"]]),ms={class:"voting"},fs=f({__name:"Voting",props:{votes:{}},setup(e){return(t,r)=>(_(),g("div",ms,[c(gs,{votes:t.votes},null,8,["votes"])]))}}),bs=$(fs,[["__scopeId","data-v-214162ab"]]),ys={class:"proposal-details"},$s={class:"proposal-details-container"},ws=f({__name:"ProposalDetails",props:{proposal:{}},setup(e){const{data:t}=qe({proposal_id:e.proposal.proposalId});return(r,d)=>(_(),g("div",ys,[o("div",$s,[c(ns,{proposal:r.proposal,votes:l(t)??[]},null,8,["proposal","votes"]),c(bs,{votes:l(t)??[]},null,8,["votes"])])]))}}),xs=$(ws,[["__scopeId","data-v-50a113ff"]]),Ss=f({__name:"Date",props:{proposal:{}},setup(e){const t=v(()=>e.proposal.createdAt.toLocaleDateString()+e.proposal.createdAt.toTimeString());return(r,d)=>{const u=q;return _(),S(u,{"has-value":"",class:"date","tooltip-type":"underline",label:"Start",value:r.proposal.createdAt.toLocaleDateString(),tooltip:l(t)},null,8,["value","tooltip"])}}}),ks=["href"],Cs=f({__name:"Proposer",props:{proposal:{}},setup(e){return(t,r)=>{const d=q;return _(),S(d,{"has-value":"",class:"proposer",label:"Proposer"},{default:x(()=>[o("a",{target:"_blank",href:`https://etherscan.io/address/${t.proposal.creator}`},b(t.proposal.creatorEns||("addressShort"in t?t.addressShort:l(E))(t.proposal.creator)),9,ks)]),_:1})}}}),Ps=f({__name:"Status",props:{proposal:{}},setup(e){const t=v(()=>{switch(e.proposal.status){case"active":return"Active";case"failed":return"Failed";case"cancelled":return"Cancelled";case"executable":return"Executable";case"executed":return"Executed";case"all":return"All";default:return"Unk. Status"}});return(r,d)=>{const u=q;return _(),S(u,{"has-value":"",class:"status","tooltip-type":"underline",label:"Status"},{default:x(()=>[o("span",{class:y(["status-value",r.proposal.status])},b(l(t)),3)]),_:1})}}}),Vs=$(Ps,[["__scopeId","data-v-39bb27db"]]),Is={class:"row"},Ts=f({__name:"ProposalSummary",props:{proposal:{},expanded:{type:Boolean}},emits:["toggleExpand"],setup(e,{emit:t}){const r=t,d=v(()=>`/dao/proposal/${e.proposal.proposalId}`),u=async()=>{await navigator.clipboard.writeText(`${window.location.origin}/dao/proposal/${e.proposal.proposalId}`),ie({text:`Copied url for proposal ${e.proposal.proposalId}`,type:"success"})};return(s,i)=>{const p=fe,a=re("router-link"),h=U;return _(),g("div",{class:"proposal-summary",onClick:i[0]||(i[0]=w=>r("toggleExpand"))},[o("div",{class:y(["title",{"no-title":s.proposal.creatorLabel}])},[o("span",{class:"id",onClick:L(u,["stop"])},[c(p),I(" "+b(s.proposal.proposalId),1)]),c(a,{class:"metadata",to:l(d)},{default:x(()=>[I(b(s.proposal.creatorLabel||"< No Title >"),1)]),_:1},8,["to"])],2),o("div",Is,[c(Vs,{class:"item",proposal:s.proposal},null,8,["proposal"]),c(Cs,{class:"item",proposal:s.proposal},null,8,["proposal"]),c(Ss,{class:"item",type:"start",proposal:s.proposal},null,8,["proposal"]),o("div",{class:y(["item expander",{expanded:s.expanded}])},[c(h)],2)])])}}}),As=$(Ts,[["__scopeId","data-v-21defc45"]]),Ls=f({__name:"Proposal",props:{proposal:{},initExpanded:{type:Boolean,default:!1}},setup(e){const t=T(e.initExpanded);return(r,d)=>{const u=K,s=pe;return _(),S(s,{compact:"",class:"proposal"},{default:x(()=>[c(As,{proposal:r.proposal,expanded:l(t),onToggleExpand:d[0]||(d[0]=i=>t.value=!l(t))},null,8,["proposal","expanded"]),c(u,{class:"proposal-details-collapsible",expanded:l(t)},{default:x(()=>[c(xs,{proposal:r.proposal,expanded:l(t)},null,8,["proposal","expanded"])]),_:1},8,["expanded"])]),_:1})}}}),Ds=$(Ls,[["__scopeId","data-v-9a8a8fe5"]]),Ns={class:"dashboard"},Es={class:"filters"},qs={style:{display:"flex",gap:"1rem","flex-wrap":"wrap"}},Fs={class:"proposals-content"},Bs={key:0},Ms=f({__name:"Proposals.page",setup(e){const t=T(0),{page:r,onPage:d}=ve(),u=T(""),s=ce(u,300),i=v(()=>{switch(t.value){case 0:return"all";case 1:return"active";case 2:return"executable";case 3:return"failed";case 4:return"executed";default:return"all"}}),p=v(()=>s.value.toLocaleLowerCase()),{isFetching:a,data:h}=Ee(v(()=>({search_string:p.value}))),w=v(()=>{var m;return((m=h.value)==null?void 0:m.length)??0}),A=v(()=>(h.value??[]).filter(m=>m.status===i.value).orderBy(m=>m.createdAt.getDate(),"desc"));return(m,k)=>{const V=ge,se=me,oe=Se,F=he,te=ue;return _(),g("div",Ns,[c(se,{onTab:k[0]||(k[0]=C=>t.value=C.index)},{default:x(()=>[c(V,{header:"All"}),c(V,{header:"Active"}),c(V,{header:"Passed"}),c(V,{header:"Denied"}),c(V,{header:"Executed"})]),_:1}),o("div",Es,[c(oe,{modelValue:l(u),"onUpdate:modelValue":k[1]||(k[1]=C=>de(u)?u.value=C:null),search:"",placeholder:"Search for Curve proposals"},null,8,["modelValue"]),o("div",qs,[c(F,{class:"pagination","items-count":l(w),"items-per-page":10,page:l(r),onPage:l(d)},null,8,["items-count","page","onPage"])])]),o("div",Fs,[(_(!0),g(D,null,N(l(A),C=>(_(),S(Ds,{key:C.proposalId,class:y(["loading-backdrop",{loading:l(a)}]),proposal:C},null,8,["proposal","class"]))),128)),c(F,{class:"pagination","items-count":l(w),"items-per-page":10,page:l(r),onPage:l(d)},null,8,["items-count","page","onPage"]),l(A).length===0?(_(),g("div",Bs,"No proposals could be found.")):P("",!0),c(te,{loading:l(a)},null,8,["loading"])])])}}}),Ks=$(Ms,[["__scopeId","data-v-3f894fee"]]);export{Ks as default};
