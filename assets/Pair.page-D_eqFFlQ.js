import{_ as le,a as ie}from"./TabItem.vue_vue_type_script_setup_true_lang-h3_s0Q7z.js";import{x as S,y as K,d as $,z as O,p as D,j as v,o as h,h as L,w as g,e as c,f as _,g as w,A as F,u as r,_ as q,r as Q,c as y,b as P,B as W,D as Y,F as Z,G as ee,t as ce,s as ue,l as pe,v as T,H as de,K as R}from"./index-DsSu0Rud.js";import{c as X,u as _e,b as me}from"./UseTabNavigation-C2NdHVqb.js";import{a as I,f as B,u as V,_ as A,r as te,b as ae}from"./fetch-7WrayJG1.js";import{z as t,t as N,a as z,p as j,b as x,c as E,g as H,d as ge,e as U,_ as M}from"./UsePagination-AMK_SP_b.js";import{p as he}from"./Pagination-vgbH7lYO.js";import{_ as G}from"./Table-CnvyLu7P.js";import{u as J}from"./UseRelativeTime-D0NwtcMW.js";import{_ as be}from"./KPI-B2wIEWIa.js";import{u as oe,c as se,_ as re,a as ne,b as ve}from"./UseLightweightChart-BnlEwl_w.js";const fe=t.enum(["borrow","add_collateral","remove_collateral","repay","redeem","liquidate","leveraged_position","repay_with_collateral"]),ye=t.object({token_address:t.string(),token_symbol:t.string(),apr:t.string()}).transform(e=>({tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),$e=t.object({date_timestamp:t.number(),total_collateral:t.string(),total_underlying:t.string(),exchange_rate:t.string(),total_debt:t.string(),active_positions_count:t.number(),borrow_limit:t.string(),utilization_rate:t.string(),interest_rate:t.string(),claimable_fees:t.string(),claimable_other_fees:t.string(),borrow_cost_apr:t.string(),base_apr:t.string(),rewards:t.array(ye)}).transform(e=>({time:N(e.date_timestamp),totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),exchangeRate:parseFloat(e.exchange_rate),totalDebt:parseFloat(e.total_debt),activePositionsCount:e.active_positions_count,borrowLimit:parseFloat(e.borrow_limit),utilizationRate:parseFloat(e.utilization_rate),interestRate:parseFloat(e.interest_rate),claimableFees:parseFloat(e.claimable_fees),claimableOtherFees:parseFloat(e.claimable_other_fees),aprBorrowCost:parseFloat(e.borrow_cost_apr),aprBase:parseFloat(e.base_apr),rewards:e.rewards})),qe=t.object({snapshots:t.array($e),count:t.number(),page:t.number(),total_pages:t.number()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),Ce=t.object({event_type:fe,block_timestamp:t.number(),tx_hash:t.string(),block_number:t.number(),collateral_change:t.string(),debt_change:t.string()}).transform(e=>({eventType:e.event_type,blockTime:N(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,collateralChange:parseFloat(e.collateral_change),debtChange:parseFloat(e.debt_change)})),ke=t.object({events:t.array(Ce),count:t.number(),page:t.number(),total_pages:t.number()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),we=t.object({block_timestamp:t.number(),tx_hash:t.string(),block_number:t.number(),caller:z,amount:t.string(),collateral_freed:t.string(),protocol_fee:t.string(),debt_reduction:t.string()}).transform(e=>({blockTime:N(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,caller:e.caller,amount:parseFloat(e.amount),collateralFreed:parseFloat(e.collateral_freed),protocolFee:parseFloat(e.protocol_fee),debtReduction:parseFloat(e.debt_reduction)})),Te=t.object({events:t.array(we),count:t.number(),page:t.number(),total_pages:t.number()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Fe=t.object({block_timestamp:t.number(),tx_hash:t.string(),block_number:t.number(),borrower:z,liquidator:z,collateral_for_liquidator:t.string(),shares_liquidated:t.string(),amount_liquidator_to_repay:t.string()}).transform(e=>({blockTime:N(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,borrower:e.borrower,liquidator:e.liquidator,collateralForLiquidator:parseFloat(e.collateral_for_liquidator),sharesLiquidated:parseFloat(e.shares_liquidated),amountLiquidatorToRepay:parseFloat(e.amount_liquidator_to_repay)})),Pe=t.object({events:t.array(Fe),count:t.number(),page:t.number(),total_pages:t.number()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Re=t.object({...E,...x,...j});async function Le(e,s){const u=H(),{pair_id:i,...p}=Re.parse(e),a=I(p),n=await B(`${u}/v1/pairs/${i}/snapshots${a}`,void 0,s==null?void 0:s.signal);return qe.parse(n)}const Se=t.object({...E,...x,...j});async function De(e,s){const u=H(),{pair_id:i,...p}=Se.parse(e),a=I(p),n=await B(`${u}/v1/pairs/${i}/collateral_events${a}`,void 0,s==null?void 0:s.signal);return ke.parse(n)}const Ie=t.object({...E,...x,...j});async function Be(e,s){const u=H(),{pair_id:i,...p}=Ie.parse(e),a=I(p),n=await B(`${u}/v1/pairs/${i}/redemptions${a}`,void 0,s==null?void 0:s.signal);return Te.parse(n)}const Ve=t.object({...E,...x,...j});async function Ae(e,s){const u=H(),{pair_id:i,...p}=Ve.parse(e),a=I(p),n=await B(`${u}/v1/pairs/${i}/liquidations${a}`,void 0,s==null?void 0:s.signal);return Pe.parse(n)}function Ne(e){const{start:s,end:u}=ge({daysRange:90});return V({queryKey:["pairs-snapshots",e],queryFn:()=>he((p,a)=>Le({...S(e),page:p,per_page:a,start:s,end:u}).then(n=>n.snapshots),1,100)})}function je(e){return V({queryKey:["pairs-collateral-events",e],queryFn:()=>De(S(e)),placeholderData:K})}function xe(e){return V({queryKey:["pairs-redemption",e],queryFn:()=>Be(S(e)),placeholderData:K})}function Ee(e){return V({queryKey:["pairs-liquidations",e],queryFn:()=>Ae(S(e)),placeholderData:K})}const He={class:"end"},We={class:"end"},ze={class:"end"},Ke=["href"],Oe=$({__name:"TableCollateralEvents",props:{events:{},count:{}},emits:["page"],setup(e,{emit:s}){const u=s,{page:i,onPage:p}=U(),a=O(i,200);D(a,l=>{u("page",l)});const{relativeTime:n}=J(),o=l=>{switch(l.eventType){case"add_collateral":return"Add collateral";case"borrow":return"Borrow";case"remove_collateral":return"Remove collateral";case"repay":return"Repay";case"redeem":return"Redeem";case"liquidate":return"Liquidate";case"leveraged_position":return"Lev. position";case"repay_with_collateral":return"Repay with col"}};return(l,d)=>{const b=M,C=A,f=G,m=L;return h(),v(m,{title:"Events"},{actions:g(()=>[c(b,{"items-count":l.count,"items-per-page":10,page:r(i),onPage:r(p)},null,8,["items-count","page","onPage"])]),default:g(()=>[c(f,{rows:l.events,columns:["Type",{label:"Debt Δ",align:"end"},{label:"Collateral Δ",align:"end"},{label:"Time",align:"end"}]},{row:g(({item:k})=>[_("div",null,w(o(k)),1),_("div",He,[c(C,{value:k.debtChange},null,8,["value"])]),_("div",We,[c(C,{value:k.collateralChange},null,8,["value"])]),_("div",ze,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${k.txHash}`,onClick:d[0]||(d[0]=F(()=>{},["stop"]))},w(r(n)(k.blockTime.getUTCTimestamp())),9,Ke)])]),_:1},8,["rows"])]),_:1})}}}),Qe=q(Oe,[["__scopeId","data-v-7ca0bfd7"]]),Ue={class:"dashboard-grid"},Me=$({__name:"Collateral",props:{pair:{}},setup(e){const s=Q(1),{isFetching:u,data:i}=je(y(()=>({pair_id:e.pair.pairId,page:s.value,per_page:15})));return(p,a)=>{var n,o;return h(),P("div",Ue,[c(Qe,{events:((n=r(i))==null?void 0:n.events)??[],count:((o=r(i))==null?void 0:o.count)??0,loading:r(u),onPage:a[0]||(a[0]=l=>s.value=l)},null,8,["events","count","loading"])])}}}),Ge=q(Me,[["__scopeId","data-v-833838f0"]]),Je={},Xe={class:"dashboard-grid"};function Ye(e,s){return h(),P("div",Xe,"Health goes here")}const Ze=q(Je,[["render",Ye],["__scopeId","data-v-f3492742"]]),et={class:"end"},tt=["href"],at={class:"end"},ot=["href"],st={class:"end"},rt={class:"end"},nt={class:"end"},lt={class:"end"},it=["href"],ct=$({__name:"TableLiquidations",props:{liquidations:{},count:{}},emits:["page"],setup(e,{emit:s}){const u=s,{page:i,onPage:p}=U(),a=O(i,200);D(a,o=>{u("page",o)});const{relativeTime:n}=J();return(o,l)=>{const d=M,b=A,C=G,f=L;return h(),v(f,{title:"Liquidations"},{actions:g(()=>[c(d,{"items-count":o.count,"items-per-page":10,page:r(i),onPage:r(p)},null,8,["items-count","page","onPage"])]),default:g(()=>[c(C,{rows:o.liquidations,columns:["Borrower","Liquidator",{label:"Shares liquidated",align:"end"},{label:"Collat for liquidator",align:"end"},{label:"Amount to repay",align:"end"},{label:"Time",align:"end"}]},{row:g(({item:m})=>[_("div",et,[_("a",{target:"_blank",href:`https://etherscan.io/address/${m.borrower}`,onClick:l[0]||(l[0]=F(()=>{},["stop"]))},w(m.borrower.ens||("addressShort"in o?o.addressShort:r(W))(m.borrower.address)),9,tt)]),_("div",at,[_("a",{target:"_blank",href:`https://etherscan.io/address/${m.liquidator}`,onClick:l[1]||(l[1]=F(()=>{},["stop"]))},w(m.liquidator.ens||("addressShort"in o?o.addressShort:r(W))(m.liquidator.address)),9,ot)]),_("div",st,[c(b,{value:m.sharesLiquidated},null,8,["value"])]),_("div",rt,[c(b,{value:m.collateralForLiquidator},null,8,["value"])]),_("div",nt,[c(b,{value:m.amountLiquidatorToRepay},null,8,["value"])]),_("div",lt,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${m.txHash}`,onClick:l[2]||(l[2]=F(()=>{},["stop"]))},w(r(n)(m.blockTime.getUTCTimestamp())),9,it)])]),_:1},8,["rows"])]),_:1})}}}),ut=q(ct,[["__scopeId","data-v-b4b970d7"]]),pt={class:"dashboard-grid"},dt=$({__name:"Liquidations",props:{pair:{}},setup(e){const s=Q(1),{isFetching:u,data:i}=Ee(y(()=>({pair_id:e.pair.pairId,page:s.value,per_page:15})));return(p,a)=>{var n,o;return h(),P("div",pt,[c(ut,{liquidations:((n=r(i))==null?void 0:n.events)??[],count:((o=r(i))==null?void 0:o.count)??0,loading:r(u),onPage:a[0]||(a[0]=l=>s.value=l)},null,8,["liquidations","count","loading"])])}}}),_t=q(dt,[["__scopeId","data-v-8c64c258"]]),mt={style:{display:"flex"}},gt={ref:"chartRef",class:"chart"},ht=$({__name:"ChartApr",props:{apr:{}},setup(e){const s=Y(),u=Z("card"),{chart:i,series:p}=oe({createChartOptions:se(),series:{type:"Line",name:"apr",options:y(()=>({priceFormat:{type:"custom",formatter:n=>`$${te(n,1,"dollar")}${ae(n)}`,minMove:.01},lineWidth:2,color:s.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});ee(a);function a(){if(!i.value||!p.apr)return;const n=e.apr.map(o=>({time:o.timestamp.getUTCTimestamp(),value:o.apr})).uniqWith((o,l)=>o.time===l.time).orderBy(o=>o.time,"asc");n.length>0&&p.apr.setData(n),i.value.timeScale().fitContent()}return(n,o)=>{const l=re,d=ne,b=L;return h(),v(b,{ref_key:"card",ref:u,title:"APR"},{actions:g(()=>[_("div",mt,[c(l,{filename:"apr",series:r(p)},null,8,["series"]),c(d,{chart:r(i),target:r(u)},null,8,["chart","target"])])]),default:g(()=>[_("div",gt,null,512)]),_:1},512)}}}),bt={style:{display:"flex"}},vt={ref:"chartRef",class:"chart"},ft=$({__name:"ChartTvl",props:{tvl:{}},setup(e){const s=Y(),u=Z("card"),{chart:i,series:p}=oe({createChartOptions:se(),series:{type:"Area",name:"tvl",options:y(()=>({priceFormat:{type:"custom",formatter:n=>`$${te(n,1,"dollar")}${ae(n)}`},lineWidth:2,lineType:ve.WithSteps,lineColor:s.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});ee(a);function a(){if(!i.value||!p.tvl)return;const n=e.tvl.map(o=>({time:o.timestamp.getUTCTimestamp(),value:o.tvl})).uniqWith((o,l)=>o.time===l.time).orderBy(o=>o.time,"asc");n.length>0&&p.tvl.setData(n),i.value.timeScale().fitContent()}return(n,o)=>{const l=re,d=ne,b=L;return h(),v(b,{ref_key:"card",ref:u,title:"TVL"},{actions:g(()=>[_("div",bt,[c(l,{filename:"tvl",series:r(p)},null,8,["series"]),c(d,{chart:r(i),target:r(u)},null,8,["chart","target"])])]),default:g(()=>[_("div",vt,null,512)]),_:1},512)}}}),yt={class:"dashboard-grid"},$t=$({__name:"Overview",props:{pair:{}},setup(e){const{isFetching:s,data:u}=Ne(ce(()=>({pair_id:e.pair.pairId}))),i=y(()=>(u.value??[]).map(a=>({timestamp:a.time,tvl:a.totalCollateral/10**21}))),p=y(()=>(u.value??[]).map(a=>({timestamp:a.time,apr:a.aprBase})));return(a,n)=>{const o=A,l=be;return h(),P("div",yt,[c(l,{style:{"grid-area":"kpi1"},label:"Positions","has-value":!!a.pair},{default:g(()=>{var d;return[c(o,{precision:0,value:(d=a.pair)==null?void 0:d.activePositionsCount},null,8,["value"])]}),_:1},8,["has-value"]),c(l,{style:{"grid-area":"kpi2"},label:"TVL","has-value":!!a.pair},{default:g(()=>{var d;return[c(o,{type:"dollar",precision:2,value:((d=a.pair)==null?void 0:d.totalCollateral)&&a.pair.totalCollateral/10**21},null,8,["value"])]}),_:1},8,["has-value"]),c(l,{style:{"grid-area":"kpi3"},label:"Interest Rate","has-value":!!a.pair},{default:g(()=>{var d;return[c(o,{type:"percentage",precision:2,value:((d=a.pair)==null?void 0:d.interestRate)&&a.pair.interestRate/10**8},null,8,["value"])]}),_:1},8,["has-value"]),c(l,{style:{"grid-area":"kpi4"},label:"Utilization Rate","has-value":!!a.pair},{default:g(()=>{var d;return[c(o,{type:"percentage",precision:2,value:(d=a.pair)==null?void 0:d.utilizationRate},null,8,["value"])]}),_:1},8,["has-value"]),c(ft,{style:{"grid-area":"tvl"},tvl:r(i),loading:r(s)},null,8,["tvl","loading"]),c(ht,{style:{"grid-area":"apr"},apr:r(p),loading:r(s)},null,8,["apr","loading"])])}}}),qt=q($t,[["__scopeId","data-v-fce2899f"]]),Ct={class:"end"},kt=["href"],wt={class:"end"},Tt={class:"end"},Ft={class:"end"},Pt={class:"end"},Rt={class:"end"},Lt=["href"],St=$({__name:"TableRedemptions",props:{redemptions:{},count:{}},emits:["page"],setup(e,{emit:s}){const u=s,{page:i,onPage:p}=U(),a=O(i,200);D(a,o=>{u("page",o)});const{relativeTime:n}=J();return(o,l)=>{const d=M,b=A,C=G,f=L;return h(),v(f,{title:"Redemptions"},{actions:g(()=>[c(d,{"items-count":o.count,"items-per-page":10,page:r(i),onPage:r(p)},null,8,["items-count","page","onPage"])]),default:g(()=>[c(C,{rows:o.redemptions,columns:["Caller",{label:"Amount",align:"end"},{label:"Debt reduction",align:"end"},{label:"Collateral freed",align:"end"},{label:"Protocol fee",align:"end"},{label:"Time",align:"end"}]},{row:g(({item:m})=>[_("div",Ct,[_("a",{target:"_blank",href:`https://etherscan.io/address/${m.caller}`,onClick:l[0]||(l[0]=F(()=>{},["stop"]))},w(m.caller.ens||("addressShort"in o?o.addressShort:r(W))(m.caller.address)),9,kt)]),_("div",wt,[c(b,{value:m.amount},null,8,["value"])]),_("div",Tt,[c(b,{value:m.debtReduction},null,8,["value"])]),_("div",Ft,[c(b,{value:m.collateralFreed},null,8,["value"])]),_("div",Pt,[c(b,{value:m.protocolFee},null,8,["value"])]),_("div",Rt,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${m.txHash}`,onClick:l[1]||(l[1]=F(()=>{},["stop"]))},w(r(n)(m.blockTime.getUTCTimestamp())),9,Lt)])]),_:1},8,["rows"])]),_:1})}}}),Dt=q(St,[["__scopeId","data-v-e485abed"]]),It={class:"dashboard-grid"},Bt=$({__name:"Redemptions",props:{pair:{}},setup(e){const s=Q(1),{isFetching:u,data:i}=xe(y(()=>({pair_id:e.pair.pairId,page:s.value,per_page:15})));return(p,a)=>{var n,o;return h(),P("div",It,[c(Dt,{redemptions:((n=r(i))==null?void 0:n.events)??[],count:((o=r(i))==null?void 0:o.count)??0,loading:r(u),onPage:a[0]||(a[0]=l=>s.value=l)},null,8,["redemptions","count","loading"])])}}}),Vt=q(Bt,[["__scopeId","data-v-66d9b8dc"]]),At={class:"dashboard"},Nt=$({__name:"Pair.page",setup(e){const s=X("protocolName"),u=X("pairId",void 0,{transform:Number}),{isFetching:i,data:p}=_e(y(()=>({chain:"ethereum",protocol_name:s.value})),y(()=>!!s.value)),a=y(()=>(p.value??[]).find(d=>d.pairId===u.value)),{crumbs:n}=ue(pe());D(a,d=>{n.value=[{id:"protocols",label:"Protocols",pathName:"protocols",params:()=>({protocolName:s.value})},{id:"protocol",label:s.value,pathName:"protocols",params:()=>({protocolName:s.value})},{id:"pair",label:`Pair: ${(d==null?void 0:d.name)??"?"}`}]},{immediate:!0});const{tabActive:o,tabActiveIndex:l}=me(["overview","collateral","redemptions","liquidations","health"],"pair",void 0,{tabParamName:"pairTab"});return(d,b)=>{const C=de,f=le,m=ie;return h(),P("div",At,[c(C,{loading:r(i)},null,8,["loading"]),!r(i)&&r(a)?(h(),v(m,{key:0,active:r(l),onTab:b[0]||(b[0]=k=>l.value=k.index)},{default:g(()=>[c(f,{header:"Overview"},{default:g(()=>[(h(),v(R,null,[r(o)==="overview"?(h(),v(qt,{key:0,pair:r(a)},null,8,["pair"])):T("",!0)],1024))]),_:1}),c(f,{header:"Collateral"},{default:g(()=>[(h(),v(R,null,[r(o)==="collateral"?(h(),v(Ge,{key:0,pair:r(a)},null,8,["pair"])):T("",!0)],1024))]),_:1}),c(f,{header:"Redemptions"},{default:g(()=>[(h(),v(R,null,[r(o)==="redemptions"?(h(),v(Vt,{key:0,pair:r(a)},null,8,["pair"])):T("",!0)],1024))]),_:1}),c(f,{header:"Liquidation"},{default:g(()=>[(h(),v(R,null,[r(o)==="liquidations"?(h(),v(_t,{key:0,pair:r(a)},null,8,["pair"])):T("",!0)],1024))]),_:1}),c(f,{header:"Health"},{default:g(()=>[(h(),v(R,null,[r(o)==="health"?(h(),v(Ze,{key:0,pair:r(a)},null,8,["pair"])):T("",!0)],1024))]),_:1})]),_:1},8,["active"])):T("",!0)])}}}),Mt=q(Nt,[["__scopeId","data-v-8cdadd1c"]]);export{Mt as default};
