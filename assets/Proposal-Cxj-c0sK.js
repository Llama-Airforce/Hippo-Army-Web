import{r as O,am as D,d as m,al as Z,c as h,j as g,o as u,f as o,aC as F,aK as B,h as p,ar as b,m as f,ao as I,g as d,l as y,ai as P,y as ss,an as H,k as S,aD as K,aW as W,e as x,b as C,n as k,aX as es,aH as os,aw as ts,E as as,_ as ns}from"./index-PoaDd28P.js";import{_ as z,o as $,s as _,n as v,b as L,t as V,p as Q,q as j,g as q,i as J,f as A,a as E}from"./timestamp-CnCs2YLF.js";import{p as X}from"./Pagination-vgbH7lYO.js";import{_ as N}from"./AsyncValue-CRYfR47y.js";import{_ as M}from"./KPI-CgrOCMEj.js";/**
 * @license lucide-vue-next v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=O("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),rs=z(["all","active","failed","cancelled","executed","executable"]),ps=$({index:v(),target:_(),calldata:_(),decoded_calldata:_()}).transform(s=>({index:s.index,target:s.target,calldata:s.calldata,decodedCalldata:s.decoded_calldata})),G=$({proposal_id:v(),on_chain_id:v(),description:_(),creator:_(),creator_ens:_().nullable(),creator_label:_().nullable(),status:rs,epoch:v(),created_at:v(),quorum_weight:v(),execution_tx:_().nullable(),cancellation_tx:_().nullable(),actions:L(ps),weight_yes:v(),weight_no:v(),voters_count:v(),creation_tx_hash:_()}).transform(s=>({proposalId:s.proposal_id,onChainId:s.on_chain_id,description:s.description,creator:s.creator,creatorEns:s.creator_ens,creatorLabel:s.creator_label,status:s.status,epoch:s.epoch,createdAt:V(s.created_at),end:new Date(V(s.created_at).getTime()+7*24*60*60*1e3),quorumWeight:s.quorum_weight,executionTx:s.execution_tx,cancellationTx:s.cancellation_tx,actions:s.actions,weightYes:s.weight_yes,weightNo:s.weight_no,votersCount:s.voters_count,creationTxHash:s.creation_tx_hash})),is=$({proposals:L(G),page:v(),count:v()}).transform(s=>({proposals:s.proposals,page:s.page,count:s.count})),cs=G,ds=$({voter:_(),voter_ens:_().nullable(),voter_label:_().nullable(),weight_yes:v(),weight_no:v(),tx_hash:_(),timestamp:v()}).transform(s=>({voter:s.voter,voterEns:s.voter_ens,voterLabel:s.voter_label,weightYes:s.weight_yes,weightNo:s.weight_no,txHash:s.tx_hash,time:V(s.timestamp)})),us=$({votes:L(ds),total_votes:v()}).transform(s=>({votes:s.votes,totalVotes:s.total_votes})),vs=$({search_string:_().optional(),order_by:z(["created_at","creator","voters_count"]).optional(),...Q});async function _s(s,t){const a=q(t),n=vs.parse(s),r=J(n),e=await A(`${a}/v1/dao/proposals${r}`,void 0,t?.signal);return is.parse(e)}const hs=$({...j});async function gs(s,t){const a=q(t),{proposal_id:n}=hs.parse(s),r=await A(`${a}/v1/dao/proposals/${n}/details`,void 0,t?.signal);return cs.parse(r)}const ms=$({...j,...Q});async function fs(s,t){const a=q(t),{proposal_id:n,...r}=ms.parse(s),e=J(r),l=await A(`${a}/v1/dao/proposals/${n}/votes${e}`,void 0,t?.signal);return us.parse(l)}function Te(s){return E({queryKey:["dao-proposals",s],queryFn:()=>X((a,n)=>_s({...D(s),page:a,per_page:n}).then(r=>r.proposals),1,100)})}function Ie(s){return E({queryKey:["dao-proposal",s],queryFn:()=>gs(D(s))})}function ys(s){return E({queryKey:["dao-proposal-votes",s],queryFn:()=>X((a,n)=>fs({...D(s),page:a,per_page:n}).then(r=>r.votes),1,100)})}const $s={class:"voters"},ws={class:"for"},bs={class:"address"},xs=["href"],Ss={class:"amount"},Cs={class:"percentage"},Ps={class:"against"},ks={class:"percentage"},Ts={class:"amount"},Is={class:"address"},Vs=["href"],Ds=m({__name:"Voters",props:{proposal:{},votes:{}},setup(s){const{address:t}=Z(),a=h(()=>s.votes?s.votes.filter(e=>e.weightYes).orderBy(e=>e.weightYes,"desc"):null),n=h(()=>s.votes?s.votes.filter(e=>e.weightNo).orderBy(e=>e.weightNo,"desc"):null),r=e=>e===t.value;return(e,l)=>{const i=N;return u(),g("div",$s,[o("div",ws,[l[0]||(l[0]=o("div",{class:"title"},"For",-1)),(u(!0),g(F,null,B(p(a),c=>(u(),g("div",{key:c.voter,class:"vote font-mono"},[o("div",bs,[o("a",{target:"_blank",href:`https://etherscan.io/address/${c.voter}`,class:b({you:r(c.voter)})},f(c.voterEns||("addressShort"in e?e.addressShort:p(I))(c.voter)),11,xs)]),o("div",Ss,[d(i,{type:"dollar",value:c.weightYes,precision:2,"show-symbol":!1},null,8,["value"])]),o("div",Cs,[d(i,{type:"percentage",value:c.weightYes/e.proposal.weightYes*100,precision:0},null,8,["value"])])]))),128))]),o("div",Ps,[l[1]||(l[1]=o("div",{class:"title"},"Against",-1)),(u(!0),g(F,null,B(p(n),c=>(u(),g("div",{key:c.voter,class:"vote font-mono"},[o("div",ks,[d(i,{type:"percentage",value:c.weightNo/e.proposal.weightNo*100,precision:0},null,8,["value"])]),o("div",Ts,[d(i,{type:"dollar",value:c.weightNo,precision:2,"show-symbol":!1},null,8,["value"])]),o("div",Is,[o("a",{target:"_blank",href:`https://etherscan.io/address/${c.voter}`,class:b({you:r(c.voter)})},f(c.voterEns||("addressShort"in e?e.addressShort:p(I))(c.voter)),11,Vs)])]))),128))])])}}}),Ls=y(Ds,[["__scopeId","data-v-be60e1b4"]]),qs={class:"technicals"},As={class:"technical"},Es={class:"description"},Ns={class:"technical"},Ms={class:"technical"},Ys=["href"],Fs={key:0,class:"technical"},Bs=["href"],Hs={class:"technical"},Rs=["innerHTML"],Us=m({__name:"Technicals",props:{proposal:{},votes:{}},setup(s){const t=P(!0),a=P(s.proposal.votersCount>0),n=h(()=>s.votes.uniqWith((e,l)=>e.voter===l.voter).length),r=h(()=>s.proposal.actions.reduce((e,l)=>e+l.decodedCalldata,"").replace(/(?:\r\n|\r|\n)/g,"<br>").replace("/├/g","├").replace("/─/g","─").replace(/0x[a-fA-F0-9]{40}/g,e=>/[A-F]/g.test(e)&&ss(e)?`<a target='_blank' href='https://etherscan.io/address/${e}'>${e}</a>`:e));return(e,l)=>{const i=K,c=W;return u(),g("div",qs,[o("div",As,[l[2]||(l[2]=o("div",{class:"heading"},"Description",-1)),o("div",Es,f(e.proposal.description),1)]),o("div",Ns,[o("div",{class:"heading",onClick:l[0]||(l[0]=w=>a.value=!p(a))},[S(" Voters ("+f(p(n)??"?")+") ",1),d(i,{class:b(["expander",{expandedVoters:p(a)}])},null,8,["class"])]),d(c,{expanded:p(a)},{default:x(()=>[e.proposal?(u(),C(Ls,{key:0,class:"voters",proposal:e.proposal,votes:e.votes},null,8,["proposal","votes"])):H("",!0)]),_:1},8,["expanded"])]),o("div",Ms,[l[3]||(l[3]=o("div",{class:"heading"},"Creation transaction",-1)),o("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${e.proposal.creationTxHash}`},f(e.proposal.creationTxHash),9,Ys)]),e.proposal?.executionTx?(u(),g("div",Fs,[l[4]||(l[4]=o("div",{class:"heading"},"Execution transaction",-1)),o("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${e.proposal.executionTx}`},f(e.proposal.executionTx),9,Bs)])):H("",!0),o("div",Hs,[o("div",{class:"heading",onClick:l[1]||(l[1]=w=>t.value=!p(t))},[l[5]||(l[5]=S(" Calldata ")),d(i,{class:b(["expander",{expandedCallData:p(t)}])},null,8,["class"])]),d(c,{expanded:p(t)},{default:x(()=>[o("div",{class:"calldata font-mono",innerHTML:p(r)},null,8,Rs)]),_:1},8,["expanded"])])])}}}),Ks=y(Us,[["__scopeId","data-v-1c5e1409"]]),Ws={class:"quorum"},zs={class:"amount"},Qs={class:"bar"},js=m({__name:"VotingQuorum",props:{proposal:{}},setup(s){const t=h(()=>s.proposal.weightYes/s.proposal.quorumWeight*100);return(a,n)=>{const r=N;return u(),g("div",Ws,[n[2]||(n[2]=o("div",{class:"heading"},"Quorum",-1)),o("div",zs,[d(r,{type:"dollar",value:a.proposal.weightYes,precision:0,"show-symbol":!1},null,8,["value"]),n[0]||(n[0]=S(" / ")),d(r,{type:"dollar",value:a.proposal.quorumWeight,precision:0,"show-symbol":!1},null,8,["value"]),n[1]||(n[1]=S(" RSUP "))]),o("div",Qs,[o("div",{class:"support",style:k({width:`${p(t)}%`})},null,4),o("div",{class:"quorum",style:k({width:`${100-p(t)}%`})},null,4)]),n[3]||(n[3]=o("div",{class:"percentages"},[o("div",null,"0%"),o("div",null,"100%")],-1))])}}}),Js=y(js,[["__scopeId","data-v-877e1212"]]),Xs={class:"results"},Gs={class:"choice"},Os={class:"amount"},Zs={class:"left"},se={class:"right"},ee={class:"choice"},oe={class:"amount"},te={class:"left"},ae={class:"right"},R=4,ne=m({__name:"VotingResults",props:{votes:{}},setup(s){const t=h(()=>s.votes.sumBy(l=>l.weightYes)),a=h(()=>s.votes.sumBy(l=>l.weightNo)),n=h(()=>t.value+a.value),r=h(()=>t.value/n.value*100),e=h(()=>a.value/n.value*100);return(l,i)=>{const c=N;return u(),g("div",Xs,[i[8]||(i[8]=o("div",{class:"heading"},"Results",-1)),o("div",Gs,[i[3]||(i[3]=o("div",{class:"label"},"For",-1)),o("div",Os,[o("div",Zs,[d(c,{"show-zero":"",type:"dollar",value:p(t),precision:0,"show-symbol":!1},null,8,["value"]),i[0]||(i[0]=o("span",null," RSUP",-1))]),o("div",se,[i[1]||(i[1]=o("span",null,"(",-1)),d(c,{"show-zero":"",type:"percentage",value:p(r),precision:2},null,8,["value"]),i[2]||(i[2]=o("span",null,")",-1))])]),o("div",{class:"bar",style:k({width:`${Math.max(R,p(r))}%`})},null,4)]),o("div",ee,[i[7]||(i[7]=o("div",{class:"label"},"Against",-1)),o("div",oe,[o("div",te,[d(c,{"show-zero":"",type:"dollar",value:p(a),precision:0,"show-symbol":!1},null,8,["value"]),i[4]||(i[4]=o("span",null," RSUP",-1))]),o("div",ae,[i[5]||(i[5]=o("span",null,"(",-1)),d(c,{"show-zero":"",type:"percentage",value:p(e),precision:2},null,8,["value"]),i[6]||(i[6]=o("span",null,")",-1))])]),o("div",{class:"bar",style:k({width:`${Math.max(R,p(e))}%`})},null,4)])])}}}),le=y(ne,[["__scopeId","data-v-03202824"]]),re={class:"voting"},pe=m({__name:"Voting",props:{proposal:{},votes:{}},setup(s){return(t,a)=>(u(),g("div",re,[d(le,{votes:t.votes},null,8,["votes"]),d(Js,{proposal:t.proposal},null,8,["proposal"])]))}}),ie=y(pe,[["__scopeId","data-v-10fc5a28"]]),ce={class:"proposal-details"},de={class:"proposal-details-container"},ue=m({__name:"ProposalDetails",props:{proposal:{}},setup(s){const{data:t}=ys({proposal_id:s.proposal.proposalId});return(a,n)=>(u(),g("div",ce,[o("div",de,[d(Ks,{proposal:a.proposal,votes:p(t)??[]},null,8,["proposal","votes"]),d(ie,{proposal:a.proposal,votes:p(t)??[]},null,8,["proposal","votes"])])]))}}),ve=y(ue,[["__scopeId","data-v-c1dddb5e"]]);function _e(s){function t(T){return T<10?"0"+T.toString():T.toString()}const a=s.getTime()-new Date().getTime();if(a<=0)return"00:00:00:00";const n=1e3,r=n*60,e=r*60,l=e*24,i=Math.floor(a/l),c=Math.floor(a%l/e),w=Math.floor(a%e/r),Y=Math.floor(a%r/n);return t(i)+":"+t(c)+":"+t(w)+":"+t(Y)}const U=m({__name:"Date",props:{proposal:{},type:{}},setup(s){let t;const a=P(""),n=h(()=>{switch(s.type){case"start":return"Start";case"end":return"End";default:return"Unk. Type"}}),r=h(()=>{switch(s.type){case"start":return s.proposal.createdAt.toLocaleDateString();case"end":return s.proposal.end>new Date?a.value:s.proposal.end.toLocaleDateString();default:return new Date(0).toLocaleDateString()}}),e=h(()=>{switch(s.type){case"start":return`
        ${s.proposal.createdAt.toLocaleDateString()} ${s.proposal.createdAt.toTimeString()}
      `;case"end":return`
        ${s.proposal.end.toLocaleDateString()} ${s.proposal.end.toTimeString()}
      `;default:return new Date(0).toLocaleDateString()}});es(()=>{l()});const l=()=>{t&&clearInterval(t),t=setInterval(()=>{a.value=_e(s.proposal.end)})};return(i,c)=>{const w=M;return u(),C(w,{"has-value":"",class:"date","tooltip-type":"underline",label:p(n),value:p(r),tooltip:p(e)},null,8,["label","value","tooltip"])}}}),he=["href"],ge=m({__name:"Proposer",props:{proposal:{}},setup(s){return(t,a)=>{const n=M;return u(),C(n,{"has-value":"",class:"proposer",label:"Proposer"},{default:x(()=>[o("a",{target:"_blank",href:`https://etherscan.io/address/${t.proposal.creator}`},f(t.proposal.creatorEns||("addressShort"in t?t.addressShort:p(I))(t.proposal.creator)),9,he)]),_:1})}}}),me=m({__name:"Status",props:{proposal:{}},setup(s){const t=h(()=>{switch(s.proposal.status){case"active":return"Active";case"failed":return"Failed";case"cancelled":return"Cancelled";case"executable":return"Executable";case"executed":return"Executed";case"all":return"All";default:return"Unk. Status"}});return(a,n)=>{const r=M;return u(),C(r,{"has-value":"",class:"status","tooltip-type":"underline",label:"Status"},{default:x(()=>[o("span",{class:b(["status-value",a.proposal.status])},f(p(t)),3)]),_:1})}}}),fe=y(me,[["__scopeId","data-v-39bb27db"]]),ye={class:"row"},$e=m({__name:"ProposalSummary",props:{proposal:{},expanded:{type:Boolean}},emits:["toggleExpand"],setup(s,{emit:t}){const a=t,n=h(()=>`/dao/proposal/${s.proposal.proposalId}`),r=async()=>{await navigator.clipboard.writeText(`${window.location.origin}/dao/proposal/${s.proposal.proposalId}`),as({text:`Copied url for proposal ${s.proposal.proposalId}`,type:"success"})};return(e,l)=>{const i=ls,c=os("router-link"),w=K;return u(),g("div",{class:"proposal-summary",onClick:l[0]||(l[0]=Y=>a("toggleExpand"))},[o("div",{class:b(["title",{"no-title":e.proposal.creatorLabel}])},[o("span",{class:"id",onClick:ts(r,["stop"])},[d(i),S(" "+f(e.proposal.onChainId),1)]),d(c,{class:"metadata",to:p(n)},{default:x(()=>[S(f(e.proposal.description||"< No Title >"),1)]),_:1},8,["to"])],2),o("div",ye,[d(fe,{class:"item",proposal:e.proposal},null,8,["proposal"]),d(ge,{class:"item",proposal:e.proposal},null,8,["proposal"]),d(U,{class:"item",type:"start",proposal:e.proposal},null,8,["proposal"]),d(U,{class:"item",type:"end",proposal:e.proposal},null,8,["proposal"]),o("div",{class:b(["item expander",{expanded:e.expanded}])},[d(w)],2)])])}}}),we=y($e,[["__scopeId","data-v-ceb9cfbf"]]),be=m({__name:"Proposal",props:{proposal:{},initExpanded:{type:Boolean,default:!1}},setup(s){const t=P(s.initExpanded);return(a,n)=>{const r=W,e=ns;return u(),C(e,{compact:"",class:"proposal"},{default:x(()=>[d(we,{proposal:a.proposal,expanded:p(t),onToggleExpand:n[0]||(n[0]=l=>t.value=!p(t))},null,8,["proposal","expanded"]),d(r,{class:"proposal-details-collapsible",expanded:p(t)},{default:x(()=>[d(ve,{proposal:a.proposal,expanded:p(t)},null,8,["proposal","expanded"])]),_:1},8,["expanded"])]),_:1})}}}),Ve=y(be,[["__scopeId","data-v-9a8a8fe5"]]);export{Ve as P,Ie as a,Te as u};
