import{m as ee,ar as H,d as m,ax as se,c as v,b as g,o as _,f as o,aQ as T,aS as D,u as n,aD as b,g as h,ao as A,e as r,_ as f,ae as k,q as oe,aw as L,i as I,aC as R,aT as Y,w as y,j as C,aR as F,aH as te,am as ae,E as ne,h as re,aj as le,aa as pe,ap as ie}from"./index--6aQy66t.js";import{a as ce,_ as de}from"./UsePagination-BUVeOBbV.js";import{_ as ue}from"./InputText-pMxNLloa.js";import{_ as _e,a as ve}from"./TabItem.vue_vue_type_script_setup_true_lang-By3qrmS3.js";import{_ as ge}from"./DashboardHeader-CBTrQLFq.js";import{z as a,t as B,p as M,f as me,g as z}from"./timestamp-D1DOFXxn.js";import{a as K,f as Q,_ as U}from"./fetch-CzIKldv6.js";import{u as W}from"./Number-JCDnKITR.js";import{p as O}from"./Pagination-vgbH7lYO.js";import{_ as N}from"./KPI-Do90NnUD.js";import"./Tooltip-ZsHLl0Z0.js";/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=ee("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),fe=a.enum(["all","active","failed","cancelled","executed","executable"]),be=a.object({index:a.number(),target:a.string(),calldata:a.string(),decoded_calldata:a.string()}).transform(e=>({index:e.index,target:e.target,calldata:e.calldata,decodedCalldata:e.decoded_calldata})),ye=a.object({proposal_id:a.number(),on_chain_id:a.number(),creator:a.string(),creator_ens:a.string().nullable(),creator_label:a.string().nullable(),status:fe,epoch:a.number(),created_at:a.number(),quorum_weight:a.number(),execution_tx:a.string().nullable(),cancellation_tx:a.string().nullable(),actions:a.array(be),weight_yes:a.number(),weight_no:a.number(),voters_count:a.number(),creation_tx_hash:a.string()}).transform(e=>({proposalId:e.proposal_id,onChainId:e.on_chain_id,creator:e.creator,creatorEns:e.creator_ens,creatorLabel:e.creator_label,status:e.status,epoch:e.epoch,createdAt:B(e.created_at),quorumWeight:e.quorum_weight,executionTx:e.execution_tx,cancellationTx:e.cancellation_tx,actions:e.actions,weightYes:e.weight_yes,weightNo:e.weight_no,votersCount:e.voters_count,creationTxHash:e.creation_tx_hash})),$e=a.object({proposals:a.array(ye),page:a.number(),count:a.number()}).transform(e=>({proposals:e.proposals,page:e.page,count:e.count})),we=a.object({voter:a.string(),voter_ens:a.string().nullable(),voter_label:a.string().nullable(),weight_yes:a.number(),weight_no:a.number(),tx_hash:a.string(),timestamp:a.number()}).transform(e=>({voter:e.voter,voterEns:e.voter_ens,voterLabel:e.voter_label,weightYes:e.weight_yes,weightNo:e.weight_no,txHash:e.tx_hash,time:B(e.timestamp)})),xe=a.object({votes:a.array(we),total_votes:a.number()}).transform(e=>({votes:e.votes,totalVotes:e.total_votes})),Ce=a.object({search_string:a.string().optional(),order_by:a.enum(["created_at","creator","voters_count"]).optional(),...M});async function Pe(e,t){const l=z(),u=Ce.parse(e),c=K(u),s=await Q(`${l}/v1/dao/proposals${c}`,void 0,t==null?void 0:t.signal);return $e.parse(s)}const Se=a.object({...me,...M});async function ke(e,t){const l=z(),{proposal_id:u,...c}=Se.parse(e),s=K(c),p=await Q(`${l}/v1/dao/proposals/${u}/votes${s}`,void 0,t==null?void 0:t.signal);return xe.parse(p)}function Ve(e){return W({queryKey:["dao-proposals",e],queryFn:()=>O((l,u)=>Pe({...H(e),page:l,per_page:u}).then(c=>c.proposals),1,100)})}function Ie(e){return W({queryKey:["dao-proposal-votes",e],queryFn:()=>O((l,u)=>ke({...H(e),page:l,per_page:u}).then(c=>c.votes),1,100)})}const Te={class:"voters"},De={class:"for"},Ae={class:"address"},Le=["href"],Ne={class:"amount"},Ee={class:"percentage"},qe={class:"against"},Fe={class:"percentage"},je={class:"amount"},He={class:"address"},Re=["href"],Ye=m({__name:"Voters",props:{proposal:{},votes:{}},setup(e){const{address:t}=se(),l=v(()=>e.votes?e.votes.filter(s=>s.weightYes).orderBy(s=>s.weightYes,"desc"):null),u=v(()=>e.votes?e.votes.filter(s=>s.weightNo).orderBy(s=>s.weightNo,"desc"):null),c=s=>s===t.value;return(s,p)=>{const i=U;return _(),g("div",Te,[o("div",De,[p[0]||(p[0]=o("div",{class:"title"},"For",-1)),(_(!0),g(T,null,D(n(l),d=>(_(),g("div",{key:d.voter,class:"vote font-mono"},[o("div",Ae,[o("a",{target:"_blank",href:`https://etherscan.io/address/${d.voter}`,class:b({you:c(d.voter)})},h(d.voterEns||("addressShort"in s?s.addressShort:n(A))(d.voter)),11,Le)]),o("div",Ne,[r(i,{type:"dollar",value:d.weightYes,precision:2,"show-symbol":!1},null,8,["value"])]),o("div",Ee,[r(i,{type:"percentage",value:d.weightYes/s.proposal.weightYes*100,precision:0},null,8,["value"])])]))),128))]),o("div",qe,[p[1]||(p[1]=o("div",{class:"title"},"Against",-1)),(_(!0),g(T,null,D(n(u),d=>(_(),g("div",{key:d.voter,class:"vote font-mono"},[o("div",Fe,[r(i,{type:"percentage",value:d.weightNo/s.proposal.weightNo*100,precision:0},null,8,["value"])]),o("div",je,[r(i,{type:"dollar",value:d.weightNo,precision:2,"show-symbol":!1},null,8,["value"])]),o("div",He,[o("a",{target:"_blank",href:`https://etherscan.io/address/${d.voter}`,class:b({you:c(d.voter)})},h(d.voterEns||("addressShort"in s?s.addressShort:n(A))(d.voter)),11,Re)])]))),128))])])}}}),Be=f(Ye,[["__scopeId","data-v-c5d03c10"]]),Me={class:"technicals"},ze={class:"technical"},Ke={class:"technical"},Qe=["href"],Ue={key:0,class:"technical"},We=["href"],Oe={class:"technical"},Ge=["innerHTML"],Je=m({__name:"Technicals",props:{proposal:{},votes:{}},setup(e){const t=k(!0),l=k(e.proposal.votersCount>0),u=v(()=>e.votes.uniqWith((s,p)=>s.voter===p.voter).length),c=v(()=>e.proposal.actions.reduce((s,p)=>s+p.decodedCalldata,"").replace(/(?:\r\n|\r|\n)/g,"<br>").replace("/├/g","├").replace("/─/g","─").replace(/0x[a-fA-F0-9]{40}/g,s=>/[A-F]/g.test(s)&&oe(s)?`<a target='_blank' href='https://etherscan.io/address/${s}'>${s}</a>`:s));return(s,p)=>{var $;const i=R,d=Y;return _(),g("div",Me,[p[5]||(p[5]=o("div",{class:"technical"},[o("div",{class:"heading"},"Description"),o("div",{class:"description"},"DESCRIPTION TODO")],-1)),o("div",ze,[o("div",{class:"heading",onClick:p[0]||(p[0]=P=>l.value=!n(l))},[I(" Voters ("+h(n(u)??"?")+") ",1),r(i,{class:b(["expander",{expandedVoters:n(l)}])},null,8,["class"])]),r(d,{expanded:n(l)},{default:y(()=>[s.proposal?(_(),C(Be,{key:0,class:"voters",proposal:s.proposal,votes:s.votes},null,8,["proposal","votes"])):L("",!0)]),_:1},8,["expanded"])]),o("div",Ke,[p[2]||(p[2]=o("div",{class:"heading"},"Creation transaction",-1)),o("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.creationTxHash}`},h(s.proposal.creationTxHash),9,Qe)]),($=s.proposal)!=null&&$.executionTx?(_(),g("div",Ue,[p[3]||(p[3]=o("div",{class:"heading"},"Execution transaction",-1)),o("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.executionTx}`},h(s.proposal.executionTx),9,We)])):L("",!0),o("div",Oe,[o("div",{class:"heading",onClick:p[1]||(p[1]=P=>t.value=!n(t))},[p[4]||(p[4]=I(" Calldata ")),r(i,{class:b(["expander",{expandedCallData:n(t)}])},null,8,["class"])]),r(d,{expanded:n(t)},{default:y(()=>[o("div",{class:"calldata font-mono",innerHTML:n(c)},null,8,Ge)]),_:1},8,["expanded"])])])}}}),Xe=f(Je,[["__scopeId","data-v-e295b27a"]]),Ze={class:"results"},es={class:"choice"},ss={class:"amount"},os={class:"left"},ts={class:"right"},as={class:"choice"},ns={class:"amount"},rs={class:"left"},ls={class:"right"},j=4,ps=m({__name:"VotingResults",props:{votes:{}},setup(e){const t=v(()=>e.votes.reduce((p,i)=>p+i.weightYes,0)),l=v(()=>e.votes.reduce((p,i)=>p+i.weightNo,0)),u=v(()=>t.value+l.value),c=v(()=>t.value/u.value*100),s=v(()=>l.value/u.value*100);return(p,i)=>{const d=U;return _(),g("div",Ze,[i[8]||(i[8]=o("div",{class:"heading"},"Results",-1)),o("div",es,[i[3]||(i[3]=o("div",{class:"label"},"For",-1)),o("div",ss,[o("div",os,[r(d,{"show-zero":"",type:"dollar",value:n(t),precision:0,"show-symbol":!1},null,8,["value"]),i[0]||(i[0]=o("span",null," veCRV",-1))]),o("div",ts,[i[1]||(i[1]=o("span",null,"(",-1)),r(d,{"show-zero":"",type:"percentage",value:n(c),precision:2},null,8,["value"]),i[2]||(i[2]=o("span",null,")",-1))])]),o("div",{class:"bar",style:F({width:`${Math.max(j,n(c))}%`})},null,4)]),o("div",as,[i[7]||(i[7]=o("div",{class:"label"},"Against",-1)),o("div",ns,[o("div",rs,[r(d,{"show-zero":"",type:"dollar",value:n(l),precision:0,"show-symbol":!1},null,8,["value"]),i[4]||(i[4]=o("span",null," veCRV",-1))]),o("div",ls,[i[5]||(i[5]=o("span",null,"(",-1)),r(d,{"show-zero":"",type:"percentage",value:n(s),precision:2},null,8,["value"]),i[6]||(i[6]=o("span",null,")",-1))])]),o("div",{class:"bar",style:F({width:`${Math.max(j,n(s))}%`})},null,4)])])}}}),is=f(ps,[["__scopeId","data-v-f01664c7"]]),cs={class:"voting"},ds=m({__name:"Voting",props:{votes:{}},setup(e){return(t,l)=>(_(),g("div",cs,[r(is,{votes:t.votes},null,8,["votes"])]))}}),us=f(ds,[["__scopeId","data-v-214162ab"]]),_s={class:"proposal-details"},vs={class:"proposal-details-container"},gs=m({__name:"ProposalDetails",props:{proposal:{}},setup(e){const{data:t}=Ie({proposal_id:e.proposal.proposalId});return(l,u)=>(_(),g("div",_s,[o("div",vs,[r(Xe,{proposal:l.proposal,votes:n(t)??[]},null,8,["proposal","votes"]),r(us,{votes:n(t)??[]},null,8,["votes"])])]))}}),ms=f(gs,[["__scopeId","data-v-50a113ff"]]),hs=m({__name:"Date",props:{proposal:{}},setup(e){const t=v(()=>e.proposal.createdAt.toLocaleDateString()+e.proposal.createdAt.toTimeString());return(l,u)=>{const c=N;return _(),C(c,{"has-value":"",class:"date","tooltip-type":"underline",label:"Start",value:l.proposal.createdAt.toLocaleDateString(),tooltip:n(t)},null,8,["value","tooltip"])}}}),fs=["href"],bs=m({__name:"Proposer",props:{proposal:{}},setup(e){return(t,l)=>{const u=N;return _(),C(u,{"has-value":"",class:"proposer",label:"Proposer"},{default:y(()=>[o("a",{target:"_blank",href:`https://etherscan.io/address/${t.proposal.creator}`},h(t.proposal.creatorEns||("addressShort"in t?t.addressShort:n(A))(t.proposal.creator)),9,fs)]),_:1})}}}),ys=m({__name:"Status",props:{proposal:{}},setup(e){const t=v(()=>{switch(e.proposal.status){case"active":return"Active";case"failed":return"Failed";case"cancelled":return"Cancelled";case"executable":return"Executable";case"executed":return"Executed";case"all":return"All";default:return"Unk. Status"}});return(l,u)=>{const c=N;return _(),C(c,{"has-value":"",class:"status","tooltip-type":"underline",label:"Status"},{default:y(()=>[o("span",{class:b(["status-value",l.proposal.status])},h(n(t)),3)]),_:1})}}}),$s=f(ys,[["__scopeId","data-v-39bb27db"]]),ws={class:"row"},xs=m({__name:"ProposalSummary",props:{proposal:{},expanded:{type:Boolean}},emits:["toggleExpand"],setup(e,{emit:t}){const l=t,u=v(()=>`/dao/proposal/${e.proposal.proposalId}`),c=async()=>{await navigator.clipboard.writeText(`${window.location.origin}/dao/proposal/${e.proposal.proposalId}`),ne({text:`Copied url for proposal ${e.proposal.proposalId}`,type:"success"})};return(s,p)=>{const i=he,d=te("router-link"),$=R;return _(),g("div",{class:"proposal-summary",onClick:p[0]||(p[0]=P=>l("toggleExpand"))},[o("div",{class:b(["title",{"no-title":s.proposal.creatorLabel}])},[o("span",{class:"id",onClick:ae(c,["stop"])},[r(i),I(" "+h(s.proposal.proposalId),1)]),r(d,{class:"metadata",to:n(u)},{default:y(()=>[I(h(s.proposal.creatorLabel||"< No Title >"),1)]),_:1},8,["to"])],2),o("div",ws,[r($s,{class:"item",proposal:s.proposal},null,8,["proposal"]),r(bs,{class:"item",proposal:s.proposal},null,8,["proposal"]),r(hs,{class:"item",type:"start",proposal:s.proposal},null,8,["proposal"]),o("div",{class:b(["item expander",{expanded:s.expanded}])},[r($)],2)])])}}}),Cs=f(xs,[["__scopeId","data-v-21defc45"]]),Ps=m({__name:"Proposal",props:{proposal:{},initExpanded:{type:Boolean,default:!1}},setup(e){const t=k(e.initExpanded);return(l,u)=>{const c=Y,s=re;return _(),C(s,{compact:"",class:"proposal"},{default:y(()=>[r(Cs,{proposal:l.proposal,expanded:n(t),onToggleExpand:u[0]||(u[0]=p=>t.value=!n(t))},null,8,["proposal","expanded"]),r(c,{class:"proposal-details-collapsible",expanded:n(t)},{default:y(()=>[r(ms,{proposal:l.proposal,expanded:n(t)},null,8,["proposal","expanded"])]),_:1},8,["expanded"])]),_:1})}}}),Ss=f(Ps,[["__scopeId","data-v-9a8a8fe5"]]),ks={class:"dashboard"},Vs={class:"filters"},Is={class:"proposals-content"},Ts={key:0},Ds=m({__name:"Proposals.page",setup(e){const t=k(0),{page:l,onPage:u}=ce(),c=k(""),s=le(c,300),p=v(()=>{switch(t.value){case 0:return"all";case 1:return"active";case 2:return"executable";case 3:return"failed";case 4:return"executed";default:return"all"}}),i=v(()=>s.value.toLocaleLowerCase()),{isFetching:d,data:$}=Ve(v(()=>({search_string:i.value}))),P=v(()=>{var w;return((w=$.value)==null?void 0:w.length)??0}),E=v(()=>($.value??[]).filter(w=>w.status===p.value).orderBy(w=>w.createdAt.getDate(),"desc"));return(w,V)=>{const G=ge,S=_e,J=ve,X=ue,q=de,Z=ie;return _(),g("div",ks,[r(G,{title:"Governance proposals",description:"View and search for governance proposals"}),r(J,{onTab:V[0]||(V[0]=x=>t.value=x.index)},{default:y(()=>[r(S,{header:"All"}),r(S,{header:"Active"}),r(S,{header:"Passed"}),r(S,{header:"Denied"}),r(S,{header:"Executed"})]),_:1}),o("div",Vs,[r(X,{modelValue:n(c),"onUpdate:modelValue":V[1]||(V[1]=x=>pe(c)?c.value=x:null),search:"",style:{"flex-grow":"1"},placeholder:"Search for Curve proposals"},null,8,["modelValue"]),r(q,{class:"pagination","items-count":n(P),"items-per-page":10,page:n(l),onPage:n(u)},null,8,["items-count","page","onPage"])]),o("div",Is,[(_(!0),g(T,null,D(n(E),x=>(_(),C(Ss,{key:x.proposalId,class:b(["loading-backdrop",{loading:n(d)}]),proposal:x},null,8,["proposal","class"]))),128)),r(q,{class:"pagination","items-count":n(P),"items-per-page":10,page:n(l),onPage:n(u)},null,8,["items-count","page","onPage"]),n(E).length===0?(_(),g("div",Ts,"No proposals could be found.")):L("",!0),r(Z,{loading:n(d)},null,8,["loading"])])])}}}),Ms=f(Ds,[["__scopeId","data-v-575a512f"]]);export{Ms as default};
