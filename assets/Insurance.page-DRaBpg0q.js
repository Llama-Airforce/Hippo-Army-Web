const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vue3-apexcharts-DCTLGW4h.js","assets/index-DsSu0Rud.js","assets/index-B7p6bFxF.css"])))=>i.map(i=>d[i]);
import{a as R,f as C,u as k,r as q,b as D,_ as Q}from"./fetch-7WrayJG1.js";import{z as t,a as H,t as A,p as I,b as L,f as P,g as x,d as Z,u as _e,_ as ee,e as ge}from"./UsePagination-AMK_SP_b.js";import{p as te}from"./Pagination-vgbH7lYO.js";import{y as he,x as F,d as b,D as W,F as se,c as f,G as ne,j as w,o as y,w as _,f as m,e as p,u as i,h as S,M as ve,N as fe,_ as V,t as j,A as E,g as T,B as M,z as be,p as ye,n as we,r as $e,b as Te}from"./index-DsSu0Rud.js";import{u as ae,c as oe,_ as re,a as ie,b as Ce}from"./UseLightweightChart-BnlEwl_w.js";import{_ as z}from"./Table-CnvyLu7P.js";import{u as le}from"./UseRelativeTime-D0NwtcMW.js";function ce(e,s){const a={...e};for(const o in s)Array.isArray(s[o])?a[o]=[...s[o]]:typeof s[o]=="object"&&s[o]!==null?a[o]=ce(a[o],s[o]):a[o]=s[o];return a}const ue=t.object({event_type:t.enum(["deposit","withdraw"]),block_timestamp:t.number(),tx_hash:t.string(),block_number:t.number(),assets:t.string(),shares:t.string(),sender:H,owner:H}),pe=e=>({eventType:e.event_type,blockTime:A(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,assets:parseFloat(e.assets),shares:parseFloat(e.shares),sender:e.sender,owner:e.owner}),ke=ue.refine(e=>e.event_type==="deposit",{message:"Expected deposit event type"}).transform(pe),Pe=ue.extend({receiver:H}).refine(e=>e.event_type==="withdraw",{message:"Expected withdraw event type"}).transform(e=>({...pe(e),receiver:e.receiver})),xe=t.object({events:t.array(t.union([ke,Pe])),count:t.number(),page:t.number(),total_pages:t.number()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Fe=t.object({account:H,amount:t.string(),end_timestamp:t.number(),block_timestamp:t.number(),tx_hash:t.string()}).transform(e=>({account:e.account,amount:parseFloat(e.amount),end:A(e.end_timestamp),blockTime:A(e.block_timestamp),txHash:e.tx_hash})),Se=t.object({entries:t.array(Fe)}).transform(e=>({entries:e.entries})),Ve=t.object({timestamp:t.number(),token_address:t.string(),token_symbol:t.string(),apr:t.string()}).transform(e=>({timestamp:A(e.timestamp),tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),Ae=t.object({snapshots:t.array(Ve),count:t.number(),page:t.number(),total_pages:t.number()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),Ee=t.object({timestamp:t.number(),tvl:t.string()}).transform(e=>({timestamp:A(e.timestamp),tvl:parseFloat(e.tvl)})),je=t.object({data:t.array(Ee),count:t.number(),page:t.number(),total_pages:t.number()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),qe=t.object({address:t.string(),label:t.string().nullable(),ens:t.string().nullable(),position_value:t.string()}).transform(e=>({address:e.address,label:e.label,ens:e.ens,positionValue:parseFloat(e.position_value)})),De=t.object({total_tvl:t.string(),top_users_tvl:t.string(),others_tvl:t.string(),users:t.array(qe)}).transform(e=>({totalTvl:parseFloat(e.total_tvl),topUsersTvl:parseFloat(e.top_users_tvl),othersTvl:parseFloat(e.others_tvl),users:e.users})),He=t.object({min_value:t.string(),max_value:t.string(),count:t.number()}).transform(e=>({minValue:parseFloat(e.min_value),maxValue:parseFloat(e.max_value),count:e.count})),Re=t.object({bins:t.array(He),total_users:t.number()}).transform(e=>({bins:e.bins,totalUsers:e.total_users})),Ue=t.object({...P,...L,...I});async function Be(e,s){const a=x(),{chain:o,...n}=Ue.parse(e),l=R(n),r=await C(`${a}/v1/insurance/${o}/events${l}`,void 0,s==null?void 0:s.signal);return xe.parse(r)}const Qe=t.object(P);async function Ie(e,s){const a=x(),{chain:o}=Qe.parse(e),n=await C(`${a}/v1/insurance/${o}/cooldown_queue`,void 0,s==null?void 0:s.signal);return Se.parse(n)}const Le=t.object({...P,...L,...I});async function We(e,s){const a=x(),{chain:o,...n}=Le.parse(e),l=R(n),r=await C(`${a}/v1/insurance/${o}/apr_history${l}`,void 0,s==null?void 0:s.signal);return Ae.parse(r)}const Me=t.object({...P,...L,...I});async function ze(e,s){const a=x(),{chain:o,...n}=Me.parse(e),l=R(n),r=await C(`${a}/v1/insurance/${o}/tvl_history${l}`,void 0,s==null?void 0:s.signal);return je.parse(r)}const Ke=t.object(P);async function Oe(e,s){const a=x(),{chain:o}=Ke.parse(e),n=await C(`${a}/v1/insurance/${o}/top_users`,void 0,s==null?void 0:s.signal);return De.parse(n)}const Ne=t.object({...P,bin_count:t.number().int().positive().optional()});async function Ge(e,s){const a=x(),{chain:o,...n}=Ne.parse(e),l=R(n),r=await C(`${a}/v1/insurance/${o}/position_histogram${l}`,void 0,s==null?void 0:s.signal);return Re.parse(r)}function Je(e){return k({queryKey:["insurance-events",e],queryFn:()=>Be(F(e)),placeholderData:he})}function Ye(e){return k({queryKey:["insurance-cooldown-queue",e],queryFn:()=>Ie(F(e))})}function Xe(e){const{start:s,end:a}=Z({daysRange:90});return k({queryKey:["insurance-apr-history",e],queryFn:()=>te((n,l)=>We({...F(e),page:n,per_page:l,start:s,end:a}).then(r=>r.snapshots),1,100)})}function Ze(e){const{start:s,end:a}=Z({daysRange:90});return k({queryKey:["insurance-tvl-history",e],queryFn:()=>te((n,l)=>ze({...F(e),page:n,per_page:l,start:s,end:a}).then(r=>r.data),1,100)})}function et(e){return k({queryKey:["insurance-top-users",e],queryFn:()=>Oe(F(e))})}function tt(e){return k({queryKey:["insurance-position-hist",e],queryFn:()=>Ge(F(e))})}const st={style:{display:"flex"}},nt={ref:"chartRef",class:"chart"},at=b({__name:"ChartApr",props:{apr:{}},setup(e){const s=W(),a=se("card"),{chart:o,series:n}=ae({createChartOptions:oe(),series:{type:"Line",name:"apr",options:f(()=>({priceFormat:{type:"custom",formatter:r=>`$${q(r,1,"dollar")}${D(r)}`,minMove:.01},lineWidth:2,color:s.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});ne(l);function l(){if(!o.value||!n.apr)return;const r=e.apr.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.apr})).uniqWith((c,u)=>c.time===u.time).orderBy(c=>c.time,"asc");r.length>0&&n.apr.setData(r),o.value.timeScale().fitContent()}return(r,c)=>{const u=re,d=ie,v=S;return y(),w(v,{ref_key:"card",ref:a,title:"APR"},{actions:_(()=>[m("div",st,[p(u,{filename:"apr",series:i(n)},null,8,["series"]),p(d,{chart:i(o),target:i(a)},null,8,["chart","target"])])]),default:_(()=>[m("div",nt,null,512)]),_:1},512)}}}),ot=b({__name:"ChartApex",props:{options:{},series:{}},setup(e){const s=ve(()=>fe(()=>import("./vue3-apexcharts-DCTLGW4h.js"),__vite__mapDeps([0,1,2])));return(a,o)=>(y(),w(i(s),{class:"chart",height:"100%",options:a.options,series:a.series},null,8,["options","series"]))}}),rt=V(ot,[["__scopeId","data-v-55416172"]]),it=e=>({chart:{id:"chart",background:"transparant",foreColor:e.colors.level5,fontFamily:"ui-monospace, SFMono-Regular, SF Mono, Menlo, Monaco, Consolas, monospace",toolbar:{autoSelected:"zoom",tools:{download:!1,pan:!1}},zoom:{autoScaleYaxis:!0}},colors:e.colorsArray,grid:{borderColor:e.colors.level5,strokeDashArray:4,xaxis:{lines:{show:!1}}},fill:{type:"solid",opacity:1},stroke:{curve:"smooth",width:2},theme:{mode:"dark"},xaxis:{type:"category",axisBorder:{color:e.colors.level5,height:1},axisTicks:{color:e.colors.level5},title:{color:e.colors.level5}},yaxis:{tickAmount:4,axisBorder:{color:e.colors.level5},axisTicks:{color:e.colors.level5},title:{color:e.colors.level5}}});function lt(e,s){s??(s=W());const a=it(s.value);return e?ce(a,e):a}const ct=b({__name:"ChartPositions",props:{bins:{}},setup(e){const s=f(()=>lt({chart:{type:"bar",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1}},xaxis:{categories:a.value,labels:{formatter:n=>n,rotate:-60},tickPlacement:"on"},yaxis:{labels:{formatter:n=>n}},plotOptions:{bar:{columnWidth:"50%"}},dataLabels:{enabled:!1},tooltip:{followCursor:!1,enabled:!0,intersect:!0,custom:n=>{const l=n.series[0][n.dataPointIndex];return`<div><b>Range</b>: ${a.value[n.dataPointIndex]}</div><div><b>Users</b>: ${l}</div>`}}})),a=f(()=>e.bins.map(n=>{const l=n.minValue?`${q(n.minValue,0,"dollar")}${D(n.minValue)}`:"0",r=n.maxValue?`${q(n.maxValue,0,"dollar")}${D(n.maxValue)}`:"0";return`${l} - ${r}`})),o=f(()=>[{name:"Users",data:e.bins.map(n=>n.count)}]);return(n,l)=>{const r=rt,c=S;return y(),w(c,{title:"User positions"},{default:_(()=>[p(r,{options:i(s),series:i(o)},null,8,["options","series"])]),_:1})}}}),ut=V(ct,[["__scopeId","data-v-525b8a17"]]),pt={style:{display:"flex"}},mt={ref:"chartRef",class:"chart"},dt=b({__name:"ChartTvl",props:{tvl:{}},setup(e){const s=W(),a=se("card"),{chart:o,series:n}=ae({createChartOptions:oe(),series:{type:"Area",name:"tvl",options:f(()=>({priceFormat:{type:"custom",formatter:r=>`$${q(r,1,"dollar")}${D(r)}`},lineWidth:2,lineType:Ce.WithSteps,lineColor:s.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});ne(l);function l(){if(!o.value||!n.tvl)return;const r=e.tvl.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.tvl})).uniqWith((c,u)=>c.time===u.time).orderBy(c=>c.time,"asc");r.length>0&&n.tvl.setData(r),o.value.timeScale().fitContent()}return(r,c)=>{const u=re,d=ie,v=S;return y(),w(v,{ref_key:"card",ref:a,title:"TVL"},{actions:_(()=>[m("div",pt,[p(u,{filename:"tvl",series:i(n)},null,8,["series"]),p(d,{chart:i(o),target:i(a)},null,8,["chart","target"])])]),default:_(()=>[m("div",mt,null,512)]),_:1},512)}}}),_t=["href"],gt={class:"end"},ht={class:"end"},vt=["href"],X=10,ft=b({__name:"TableCooldowns",props:{cooldowns:{}},setup(e){const{page:s,rowsPage:a,onPage:o}=_e(j(()=>e.cooldowns),X),{relativeTime:n}=le();return(l,r)=>{const c=ee,u=Q,d=z,v=S;return y(),w(v,{title:"Cooldown Queue"},{actions:_(()=>[p(c,{"items-count":l.cooldowns.length,"items-per-page":X,page:i(s),onPage:i(o)},null,8,["items-count","page","onPage"])]),default:_(()=>[p(d,{rows:i(a),columns:["User",{label:"Amount",align:"end"},{label:"Time",align:"end"}]},{row:_(({item:h})=>[m("div",null,[m("a",{target:"_blank",href:`https://etherscan.io/address/${h.account.address}`,onClick:r[0]||(r[0]=E(()=>{},["stop"]))},T(h.account.ens||("addressShort"in l?l.addressShort:i(M))(h.account.address)),9,_t)]),m("div",gt,[p(u,{value:h.amount},null,8,["value"])]),m("div",ht,[m("a",{target:"_blank",href:`https://etherscan.io/tx/${h.txHash}`,onClick:r[1]||(r[1]=E(()=>{},["stop"]))},T(i(n)(h.end.getUTCTimestamp())),9,vt)])]),_:1},8,["rows"])]),_:1})}}}),bt=V(ft,[["__scopeId","data-v-d9c59380"]]),yt=["href"],wt={class:"end"},$t={class:"end"},Tt={class:"end"},Ct=["href"],kt=b({__name:"TableEvents",props:{events:{},count:{}},emits:["page"],setup(e,{emit:s}){const a=s,{page:o,onPage:n}=ge(),l=be(o,200);ye(l,u=>{a("page",u)});const{relativeTime:r}=le(),c=u=>{switch(u.eventType){case"deposit":return"Deposit";case"withdraw":return"Withdraw"}};return(u,d)=>{const v=ee,h=Q,U=z,B=S;return y(),w(B,{title:"Events"},{actions:_(()=>[p(v,{"items-count":u.count,"items-per-page":10,page:i(o),onPage:i(n)},null,8,["items-count","page","onPage"])]),default:_(()=>[p(U,{rows:u.events,columns:["Type","Owner",{label:"Assets",align:"end"},{label:"Shares",align:"end"},{label:"Time",align:"end"}]},{row:_(({item:g})=>[m("div",{class:we({green:g.eventType==="deposit",red:g.eventType==="withdraw"})},T(c(g)),3),m("div",null,[m("a",{target:"_blank",href:`https://etherscan.io/address/${g.owner.address}`,onClick:d[0]||(d[0]=E(()=>{},["stop"]))},T(g.owner.ens||("addressShort"in u?u.addressShort:i(M))(g.owner.address)),9,yt)]),m("div",wt,[p(h,{value:g.assets},null,8,["value"])]),m("div",$t,[p(h,{value:g.shares},null,8,["value"])]),m("div",Tt,[m("a",{target:"_blank",href:`https://etherscan.io/tx/${g.txHash}`,onClick:d[1]||(d[1]=E(()=>{},["stop"]))},T(i(r)(g.blockTime.getUTCTimestamp())),9,Ct)])]),_:1},8,["rows"])]),_:1})}}}),Pt=V(kt,[["__scopeId","data-v-3cb43629"]]),xt=["href"],Ft={class:"end"},St=b({__name:"TableTopUsers",props:{topUsers:{}},setup(e){return(s,a)=>{const o=Q,n=z,l=S;return y(),w(l,{title:"Top Users"},{default:_(()=>[p(n,{rows:s.topUsers,columns:["Address",{label:"Position value",align:"end"}]},{row:_(({item:r})=>[m("div",null,[m("a",{target:"_blank",href:`https://etherscan.io/address/${r.address}`,onClick:a[0]||(a[0]=E(()=>{},["stop"]))},T(r.ens||("addressShort"in s?s.addressShort:i(M))(r.address)),9,xt)]),m("div",Ft,[p(o,{value:r.positionValue},null,8,["value"])])]),_:1},8,["rows"])]),_:1})}}}),Vt=V(St,[["__scopeId","data-v-9a790ef4"]]),At={class:"dashboard"},Et=b({__name:"Insurance.page",setup(e){const{isFetching:s,data:a}=Xe({chain:"ethereum"}),o=f(()=>(a.value??[]).map($=>({timestamp:$.timestamp,apr:$.apr}))),{isFetching:n,data:l}=Ze({chain:"ethereum"}),r=f(()=>(l.value??[]).map($=>({timestamp:$.timestamp,tvl:$.tvl}))),c=$e(1),{isFetching:u,data:d}=Je(f(()=>({chain:"ethereum",page:c.value,per_page:10}))),{isFetching:v,data:h}=et(j(()=>({chain:"ethereum"}))),{isFetching:U,data:B}=Ye(j(()=>({chain:"ethereum"}))),{isFetching:g,data:me}=tt(j(()=>({chain:"ethereum"})));return($,K)=>{var O,N,G,J,Y;return y(),Te("div",At,[p(at,{style:{"grid-area":"apr"},apr:i(o),loading:i(s)},null,8,["apr","loading"]),p(dt,{style:{"grid-area":"tvl"},tvl:i(r),loading:i(n)},null,8,["tvl","loading"]),p(Pt,{style:{"grid-area":"events"},events:((O=i(d))==null?void 0:O.events)??[],count:((N=i(d))==null?void 0:N.count)??0,loading:i(u),onPage:K[0]||(K[0]=de=>c.value=de)},null,8,["events","count","loading"]),p(Vt,{style:{"grid-area":"top-users"},"top-users":((G=i(h))==null?void 0:G.users)??[],loading:i(v)},null,8,["top-users","loading"]),p(bt,{style:{"grid-area":"cooldowns"},cooldowns:((J=i(B))==null?void 0:J.entries)??[],loading:i(U)},null,8,["cooldowns","loading"]),p(ut,{style:{"grid-area":"positions"},bins:((Y=i(me))==null?void 0:Y.bins)??[],loading:i(g)},null,8,["bins","loading"])])}}}),Qt=V(Et,[["__scopeId","data-v-c3f0b920"]]);export{Qt as default};
