import{q as X,al as V,d as f,ak as Z,c as h,j as g,o as u,f as t,aB as M,aV as F,h as i,aq as b,m,an as I,g as d,l as $,ah as C,x as ee,am as Y,k as P,aC as U,a_ as z,e as x,b as S,aU as B,a$ as se,aG as oe,av as te,E as ae,_ as ne}from"./index-BgPU8Sw7.js";import{t as D,b as K,f as L,a as q}from"./Number-DpAK-pXX.js";import{d as W,o as w,s as _,n as v,a as A,p as j,i as Q,g as E,_ as G}from"./AsyncValue-iTYOvWr4.js";import{p as J}from"./Pagination-vgbH7lYO.js";import{_ as N}from"./KPI-CngUDtHK.js";/**
 * @license lucide-vue-next v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=X("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),le=W(["all","active","failed","cancelled","executed","executable"]),ie=w({index:v(),target:_(),calldata:_(),decoded_calldata:_()}).transform(e=>({index:e.index,target:e.target,calldata:e.calldata,decodedCalldata:e.decoded_calldata})),O=w({proposal_id:v(),on_chain_id:v(),description:_(),creator:_(),creator_ens:_().nullable(),creator_label:_().nullable(),status:le,epoch:v(),created_at:v(),quorum_weight:v(),execution_tx:_().nullable(),cancellation_tx:_().nullable(),actions:A(ie),weight_yes:v(),weight_no:v(),voters_count:v(),creation_tx_hash:_()}).transform(e=>({proposalId:e.proposal_id,onChainId:e.on_chain_id,description:e.description,creator:e.creator,creatorEns:e.creator_ens,creatorLabel:e.creator_label,status:e.status,epoch:e.epoch,createdAt:D(e.created_at),end:new Date(D(e.created_at).getTime()+7*24*60*60*1e3),quorumWeight:e.quorum_weight,executionTx:e.execution_tx,cancellationTx:e.cancellation_tx,actions:e.actions,weightYes:e.weight_yes,weightNo:e.weight_no,votersCount:e.voters_count,creationTxHash:e.creation_tx_hash})),pe=w({proposals:A(O),page:v(),count:v()}).transform(e=>({proposals:e.proposals,page:e.page,count:e.count})),ce=O,de=w({voter:_(),voter_ens:_().nullable(),voter_label:_().nullable(),weight_yes:v(),weight_no:v(),tx_hash:_(),timestamp:v()}).transform(e=>({voter:e.voter,voterEns:e.voter_ens,voterLabel:e.voter_label,weightYes:e.weight_yes,weightNo:e.weight_no,txHash:e.tx_hash,time:D(e.timestamp)})),ue=w({votes:A(de),total_votes:v()}).transform(e=>({votes:e.votes,totalVotes:e.total_votes})),ve=w({search_string:_().optional(),order_by:W(["created_at","creator","voters_count"]).optional(),...j});async function _e(e,o){const a=E(o),l=ve.parse(e),p=K(l),s=await L(`${a}/v1/dao/proposals${p}`,void 0,o==null?void 0:o.signal);return pe.parse(s)}const he=w({...Q});async function ge(e,o){const a=E(o),{proposal_id:l}=he.parse(e),p=await L(`${a}/v1/dao/proposals/${l}/details`,void 0,o==null?void 0:o.signal);return ce.parse(p)}const me=w({...Q,...j});async function fe(e,o){const a=E(o),{proposal_id:l,...p}=me.parse(e),s=K(p),n=await L(`${a}/v1/dao/proposals/${l}/votes${s}`,void 0,o==null?void 0:o.signal);return ue.parse(n)}function xs(e){return q({queryKey:["dao-proposals",e],queryFn:()=>J((a,l)=>_e({...V(e),page:a,per_page:l}).then(p=>p.proposals),1,100)})}function Ss(e){return q({queryKey:["dao-proposal",e],queryFn:()=>ge(V(e))})}function ye(e){return q({queryKey:["dao-proposal-votes",e],queryFn:()=>J((a,l)=>fe({...V(e),page:a,per_page:l}).then(p=>p.votes),1,100)})}const $e={class:"voters"},we={class:"for"},be={class:"address"},xe=["href"],Se={class:"amount"},ke={class:"percentage"},Ce={class:"against"},Pe={class:"percentage"},Te={class:"amount"},Ie={class:"address"},De=["href"],Ve=f({__name:"Voters",props:{proposal:{},votes:{}},setup(e){const{address:o}=Z(),a=h(()=>e.votes?e.votes.filter(s=>s.weightYes).orderBy(s=>s.weightYes,"desc"):null),l=h(()=>e.votes?e.votes.filter(s=>s.weightNo).orderBy(s=>s.weightNo,"desc"):null),p=s=>s===o.value;return(s,n)=>{const r=G;return u(),g("div",$e,[t("div",we,[n[0]||(n[0]=t("div",{class:"title"},"For",-1)),(u(!0),g(M,null,F(i(a),c=>(u(),g("div",{key:c.voter,class:"vote font-mono"},[t("div",be,[t("a",{target:"_blank",href:`https://etherscan.io/address/${c.voter}`,class:b({you:p(c.voter)})},m(c.voterEns||("addressShort"in s?s.addressShort:i(I))(c.voter)),11,xe)]),t("div",Se,[d(r,{type:"dollar",value:c.weightYes,precision:2,"show-symbol":!1},null,8,["value"])]),t("div",ke,[d(r,{type:"percentage",value:c.weightYes/s.proposal.weightYes*100,precision:0},null,8,["value"])])]))),128))]),t("div",Ce,[n[1]||(n[1]=t("div",{class:"title"},"Against",-1)),(u(!0),g(M,null,F(i(l),c=>(u(),g("div",{key:c.voter,class:"vote font-mono"},[t("div",Pe,[d(r,{type:"percentage",value:c.weightNo/s.proposal.weightNo*100,precision:0},null,8,["value"])]),t("div",Te,[d(r,{type:"dollar",value:c.weightNo,precision:2,"show-symbol":!1},null,8,["value"])]),t("div",Ie,[t("a",{target:"_blank",href:`https://etherscan.io/address/${c.voter}`,class:b({you:p(c.voter)})},m(c.voterEns||("addressShort"in s?s.addressShort:i(I))(c.voter)),11,De)])]))),128))])])}}}),Le=$(Ve,[["__scopeId","data-v-c5d03c10"]]),qe={class:"technicals"},Ae={class:"technical"},Ee={class:"description"},Ne={class:"technical"},Me={class:"technical"},Fe=["href"],Ye={key:0,class:"technical"},Be=["href"],He={class:"technical"},Re=["innerHTML"],Ue=f({__name:"Technicals",props:{proposal:{},votes:{}},setup(e){const o=C(!0),a=C(e.proposal.votersCount>0),l=h(()=>e.votes.uniqWith((s,n)=>s.voter===n.voter).length),p=h(()=>e.proposal.actions.reduce((s,n)=>s+n.decodedCalldata,"").replace(/(?:\r\n|\r|\n)/g,"<br>").replace("/├/g","├").replace("/─/g","─").replace(/0x[a-fA-F0-9]{40}/g,s=>/[A-F]/g.test(s)&&ee(s)?`<a target='_blank' href='https://etherscan.io/address/${s}'>${s}</a>`:s));return(s,n)=>{var y;const r=U,c=z;return u(),g("div",qe,[t("div",Ae,[n[2]||(n[2]=t("div",{class:"heading"},"Description",-1)),t("div",Ee,m(s.proposal.description),1)]),t("div",Ne,[t("div",{class:"heading",onClick:n[0]||(n[0]=k=>a.value=!i(a))},[P(" Voters ("+m(i(l)??"?")+") ",1),d(r,{class:b(["expander",{expandedVoters:i(a)}])},null,8,["class"])]),d(c,{expanded:i(a)},{default:x(()=>[s.proposal?(u(),S(Le,{key:0,class:"voters",proposal:s.proposal,votes:s.votes},null,8,["proposal","votes"])):Y("",!0)]),_:1},8,["expanded"])]),t("div",Me,[n[3]||(n[3]=t("div",{class:"heading"},"Creation transaction",-1)),t("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.creationTxHash}`},m(s.proposal.creationTxHash),9,Fe)]),(y=s.proposal)!=null&&y.executionTx?(u(),g("div",Ye,[n[4]||(n[4]=t("div",{class:"heading"},"Execution transaction",-1)),t("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.executionTx}`},m(s.proposal.executionTx),9,Be)])):Y("",!0),t("div",He,[t("div",{class:"heading",onClick:n[1]||(n[1]=k=>o.value=!i(o))},[n[5]||(n[5]=P(" Calldata ")),d(r,{class:b(["expander",{expandedCallData:i(o)}])},null,8,["class"])]),d(c,{expanded:i(o)},{default:x(()=>[t("div",{class:"calldata font-mono",innerHTML:i(p)},null,8,Re)]),_:1},8,["expanded"])])])}}}),ze=$(Ue,[["__scopeId","data-v-1c5e1409"]]),Ke={class:"results"},We={class:"choice"},je={class:"amount"},Qe={class:"left"},Ge={class:"right"},Je={class:"choice"},Oe={class:"amount"},Xe={class:"left"},Ze={class:"right"},H=4,es=f({__name:"VotingResults",props:{votes:{}},setup(e){const o=h(()=>e.votes.reduce((n,r)=>n+r.weightYes,0)),a=h(()=>e.votes.reduce((n,r)=>n+r.weightNo,0)),l=h(()=>o.value+a.value),p=h(()=>o.value/l.value*100),s=h(()=>a.value/l.value*100);return(n,r)=>{const c=G;return u(),g("div",Ke,[r[8]||(r[8]=t("div",{class:"heading"},"Results",-1)),t("div",We,[r[3]||(r[3]=t("div",{class:"label"},"For",-1)),t("div",je,[t("div",Qe,[d(c,{"show-zero":"",type:"dollar",value:i(o),precision:0,"show-symbol":!1},null,8,["value"]),r[0]||(r[0]=t("span",null," RSUP",-1))]),t("div",Ge,[r[1]||(r[1]=t("span",null,"(",-1)),d(c,{"show-zero":"",type:"percentage",value:i(p),precision:2},null,8,["value"]),r[2]||(r[2]=t("span",null,")",-1))])]),t("div",{class:"bar",style:B({width:`${Math.max(H,i(p))}%`})},null,4)]),t("div",Je,[r[7]||(r[7]=t("div",{class:"label"},"Against",-1)),t("div",Oe,[t("div",Xe,[d(c,{"show-zero":"",type:"dollar",value:i(a),precision:0,"show-symbol":!1},null,8,["value"]),r[4]||(r[4]=t("span",null," RSUP",-1))]),t("div",Ze,[r[5]||(r[5]=t("span",null,"(",-1)),d(c,{"show-zero":"",type:"percentage",value:i(s),precision:2},null,8,["value"]),r[6]||(r[6]=t("span",null,")",-1))])]),t("div",{class:"bar",style:B({width:`${Math.max(H,i(s))}%`})},null,4)])])}}}),ss=$(es,[["__scopeId","data-v-4d9c269d"]]),os={class:"voting"},ts=f({__name:"Voting",props:{votes:{}},setup(e){return(o,a)=>(u(),g("div",os,[d(ss,{votes:o.votes},null,8,["votes"])]))}}),as=$(ts,[["__scopeId","data-v-214162ab"]]),ns={class:"proposal-details"},rs={class:"proposal-details-container"},ls=f({__name:"ProposalDetails",props:{proposal:{}},setup(e){const{data:o}=ye({proposal_id:e.proposal.proposalId});return(a,l)=>(u(),g("div",ns,[t("div",rs,[d(ze,{proposal:a.proposal,votes:i(o)??[]},null,8,["proposal","votes"]),d(as,{votes:i(o)??[]},null,8,["votes"])])]))}}),is=$(ls,[["__scopeId","data-v-413585ab"]]);function ps(e){function o(T){return T<10?"0"+T.toString():T.toString()}const a=e.getTime()-new Date().getTime();if(a<=0)return"00:00:00:00";const l=1e3,p=l*60,s=p*60,n=s*24,r=Math.floor(a/n),c=Math.floor(a%n/s),y=Math.floor(a%s/p),k=Math.floor(a%p/l);return o(r)+":"+o(c)+":"+o(y)+":"+o(k)}const R=f({__name:"Date",props:{proposal:{},type:{}},setup(e){let o;const a=C(""),l=h(()=>{switch(e.type){case"start":return"Start";case"end":return"End";default:return"Unk. Type"}}),p=h(()=>{switch(e.type){case"start":return e.proposal.createdAt.toLocaleDateString();case"end":return e.proposal.end>new Date?a.value:e.proposal.end.toLocaleDateString();default:return new Date(0).toLocaleDateString()}}),s=h(()=>{switch(e.type){case"start":return`
        ${e.proposal.createdAt.toLocaleDateString()} ${e.proposal.createdAt.toTimeString()}
      `;case"end":return`
        ${e.proposal.end.toLocaleDateString()} ${e.proposal.end.toTimeString()}
      `;default:return new Date(0).toLocaleDateString()}});se(()=>{n()});const n=()=>{o&&clearInterval(o),o=setInterval(()=>{a.value=ps(e.proposal.end)})};return(r,c)=>{const y=N;return u(),S(y,{"has-value":"",class:"date","tooltip-type":"underline",label:i(l),value:i(p),tooltip:i(s)},null,8,["label","value","tooltip"])}}}),cs=["href"],ds=f({__name:"Proposer",props:{proposal:{}},setup(e){return(o,a)=>{const l=N;return u(),S(l,{"has-value":"",class:"proposer",label:"Proposer"},{default:x(()=>[t("a",{target:"_blank",href:`https://etherscan.io/address/${o.proposal.creator}`},m(o.proposal.creatorEns||("addressShort"in o?o.addressShort:i(I))(o.proposal.creator)),9,cs)]),_:1})}}}),us=f({__name:"Status",props:{proposal:{}},setup(e){const o=h(()=>{switch(e.proposal.status){case"active":return"Active";case"failed":return"Failed";case"cancelled":return"Cancelled";case"executable":return"Executable";case"executed":return"Executed";case"all":return"All";default:return"Unk. Status"}});return(a,l)=>{const p=N;return u(),S(p,{"has-value":"",class:"status","tooltip-type":"underline",label:"Status"},{default:x(()=>[t("span",{class:b(["status-value",a.proposal.status])},m(i(o)),3)]),_:1})}}}),vs=$(us,[["__scopeId","data-v-39bb27db"]]),_s={class:"row"},hs=f({__name:"ProposalSummary",props:{proposal:{},expanded:{type:Boolean}},emits:["toggleExpand"],setup(e,{emit:o}){const a=o,l=h(()=>`/dao/proposal/${e.proposal.proposalId}`),p=async()=>{await navigator.clipboard.writeText(`${window.location.origin}/dao/proposal/${e.proposal.proposalId}`),ae({text:`Copied url for proposal ${e.proposal.proposalId}`,type:"success"})};return(s,n)=>{const r=re,c=oe("router-link"),y=U;return u(),g("div",{class:"proposal-summary",onClick:n[0]||(n[0]=k=>a("toggleExpand"))},[t("div",{class:b(["title",{"no-title":s.proposal.creatorLabel}])},[t("span",{class:"id",onClick:te(p,["stop"])},[d(r),P(" "+m(s.proposal.proposalId),1)]),d(c,{class:"metadata",to:i(l)},{default:x(()=>[P(m(s.proposal.description||"< No Title >"),1)]),_:1},8,["to"])],2),t("div",_s,[d(vs,{class:"item",proposal:s.proposal},null,8,["proposal"]),d(ds,{class:"item",proposal:s.proposal},null,8,["proposal"]),d(R,{class:"item",type:"start",proposal:s.proposal},null,8,["proposal"]),d(R,{class:"item",type:"end",proposal:s.proposal},null,8,["proposal"]),t("div",{class:b(["item expander",{expanded:s.expanded}])},[d(y)],2)])])}}}),gs=$(hs,[["__scopeId","data-v-43ae8cb3"]]),ms=f({__name:"Proposal",props:{proposal:{},initExpanded:{type:Boolean,default:!1}},setup(e){const o=C(e.initExpanded);return(a,l)=>{const p=z,s=ne;return u(),S(s,{compact:"",class:"proposal"},{default:x(()=>[d(gs,{proposal:a.proposal,expanded:i(o),onToggleExpand:l[0]||(l[0]=n=>o.value=!i(o))},null,8,["proposal","expanded"]),d(p,{class:"proposal-details-collapsible",expanded:i(o)},{default:x(()=>[d(is,{proposal:a.proposal,expanded:i(o)},null,8,["proposal","expanded"])]),_:1},8,["expanded"])]),_:1})}}}),ks=$(ms,[["__scopeId","data-v-9a8a8fe5"]]);export{ks as P,Ss as a,xs as u};
