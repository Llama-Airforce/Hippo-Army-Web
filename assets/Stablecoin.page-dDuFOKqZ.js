import{_ as Q}from"./DashboardHeader-BZxATxlq.js";import{d as L,u as E,a as x,aT as j,c as S,w as R,b as A,o as B,_ as M,e as f,f as w,g as d,h as t,aU as Z,k as W,m as X,l as I,ah as ee,aV as te,aW as ae,t as U,i as oe,j as Y,aA as se,aX as D}from"./index-C4bxLmri.js";import{a as le,b as ne,c as re,d as ce}from"./stablecoin-Dm7G7S6K.js";import{u as ie,_ as me}from"./UseLegend-p1jgbDxG.js";import{u as q,b as ue,a as H,_ as N,c as z,D as de}from"./UseLightweightChart-C12vCX9v.js";import{_ as pe}from"./Tooltip-DPMfqQ_8.js";import{_ as J}from"./ButtonToggle-DhugfV-N.js";import{r as F,u as V}from"./Number-D-_ywgC3.js";import{_ as K}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-CH9iGe7u.js";const _e={style:{display:"flex"}},he={ref:"chartRef",class:"chart"},fe="chart_pool_balances_dollars",ve="chart_pool_balances_type",ge=L({__name:"ChartBalances",props:{balances:{}},setup(i){const p=E(),{items:u,toggles:c,disabled:_}=ie(()=>i.balances.map(({symbol:e},s)=>({id:e,label:e,color:p.value.colorsArray[s],togglable:!0}))),y=x("card"),n=j(fe,!1),r=["unstacked","stacked","100%"],m=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],a=j(ve,r[0]),{chart:l,series:o}=q({createChartOptions:H(),series:[...i.balances.map(({symbol:e},s)=>({type:"Line",name:e,options:S(()=>({priceFormat:{type:"custom",formatter:v=>`${F(v,1,"dollar")}${V(v)}`},lineWidth:2,lineType:ue.WithSteps,color:p.value.colorsArray[s],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stacked",options:S(()=>({priceFormat:{type:"custom",formatter:e=>`${F(e,1,"dollar")}${V(e)}`},colors:u.value.map((e,s)=>({item:e,i:s})).filter(({item:e})=>!_.value.includes(e.id)).map(({i:e})=>e).map(e=>p.value.colorsArray[e]).map(e=>({line:e,area:e+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});R(k);function k(){if(!(!l.value||Object.values(o).length<0)){for(const e of Object.values(o))e==null||e.setData([]);a.value==="unstacked"?P():O(a.value==="100%"),l.value.timeScale().fitContent()}}function P(){var e,s;for(const{symbol:v,balances:h}of i.balances.values()){if(!c[v].value){(e=o[v])==null||e.setData([]);continue}const g=n.value,C=h.map(b=>({time:b.timestamp.getUTCTimestamp(),value:g?b.balance*b.tokenPrice:b.balance})).uniqWith((b,T)=>b.time===T.time).orderBy(b=>b.time,"asc");C.length>0&&((s=o[v])==null||s.setData(C))}}function O(e){if(!o.stacked)return;const s=n.value,v=[...i.balances.values()].filter(({symbol:h,balances:g})=>c[h].value&&g.length>0).flatMap(({symbol:h,balances:g})=>g.map(C=>({symbol:h,timestamp:C.timestamp,balance:s?C.balance*C.tokenPrice:C.balance}))).groupBy(h=>h.timestamp.getTime()).entries().map(([h,g])=>{const C=e?g.reduce((T,$)=>T+$.balance,0):1,b=g.map(T=>e?T.balance/C*100:T.balance);return{time:Number(h)/1e3,values:b}}).uniqWith((h,g)=>h.time===g.time).orderBy(h=>h.time,"asc");v.length>0&&o.stacked.setData(v)}return(e,s)=>{const v=Z,h=J,g=pe,C=N,b=me,T=M;return B(),A(T,{ref_key:"card",ref:y,class:"stack-actions",title:"Balances"},{actions:f(()=>[w("div",_e,[d(v,{options:m,selected:m.find($=>$.id===t(a))??m[0],onSelect:s[0]||(s[0]=$=>a.value=$.id)},{option:f(({option:$})=>[W(X($.label),1)]),_:1},8,["selected"]),d(g,null,{trigger:f(()=>[d(h,{style:{"margin-right":"1rem"},"model-value":t(n),onClick:s[1]||(s[1]=$=>n.value=!t(n))},{default:f(()=>s[3]||(s[3]=[W(" $ ")])),_:1},8,["model-value"])]),default:f(()=>[s[4]||(s[4]=W(" Show token balances in USD. "))]),_:1}),d(C,{chart:t(l),target:t(y)},null,8,["chart","target"])])]),"actions-secondary":f(()=>[d(b,{items:t(u),disabled:t(_),onToggle:s[2]||(s[2]=$=>t(c)[$].value=!t(c)[$].value)},null,8,["items","disabled"])]),default:f(()=>[w("div",he,null,512)]),_:1},512)}}}),be=I(ge,[["__scopeId","data-v-e9381c7d"]]),ye={class:"controls"},Ce={ref:"chartRef",class:"chart"},$e=L({__name:"ChartPrice",props:{ohlc:{},minMove:{}},setup(i){const p=E(),u=ee(!1);let c=1,_=0;const{chart:y,series:n}=q({createChartOptions:H(),series:{type:"Candlestick",name:"ohlc",options:S(()=>{const{colors:a}=p.value;return{priceFormat:{type:"custom",formatter:m,minMove:i.minMove},upColor:a.green,borderUpColor:a.green,wickUpColor:a.green,downColor:a.red,borderDownColor:a.red,wickDownColor:a.red}})}});R(r);function r(){if(!y.value||!n.ohlc)return;const a=u.value?-1:1,l=i.ohlc.map(o=>({time:o.time.getUTCTimestamp(),open:Math.pow(o.open,a),high:Math.pow(o.high,a),low:Math.pow(o.low,a),close:Math.pow(o.close,a)})).uniqWith((o,k)=>o.time===k.time).orderBy(o=>o.time,"asc");l.length>0&&(n.ohlc.setData(l),_=Math.min(...l.map(o=>o.low)),c=Math.max(...l.map(o=>o.high))),y.value.timeScale().fitContent()}function m(a){const l=c-_,o=l>1?l-Math.floor(l):l,k=-Math.floor(Math.log10(o)+1)+2;return`${F(a,k,"dollar")}${V(a)}`}return(a,l)=>{const o=J,k=M;return B(),A(k,{title:"Price"},{actions:f(()=>[w("div",ye,[d(o,{"model-value":t(u),onClick:l[0]||(l[0]=P=>u.value=!t(u))},{default:f(()=>l[1]||(l[1]=[W(" Invert ")])),_:1},8,["model-value"])])]),default:f(()=>[w("div",Ce,null,512)]),_:1})}}}),Se=I($e,[["__scopeId","data-v-c58213e5"]]),ke={style:{display:"flex"}},we={ref:"chartRef",class:"chart"},Te=L({__name:"ChartTvl",props:{tvl:{}},setup(i){const p=E(),u=x("card"),{chart:c,series:_}=q({createChartOptions:H(),series:z({name:"tvl",color:S(()=>p.value.colors.blue),formatter:n=>`$${F(n,1,"dollar")}${V(n)}`})});R(y);function y(){if(!c.value||!_.tvl)return;const n=i.tvl.map(r=>({time:r.timestamp.getUTCTimestamp(),value:r.tvl})).uniqWith((r,m)=>r.time===m.time).orderBy(r=>r.time,"asc");n.length>0&&_.tvl.setData(n),c.value.timeScale().fitContent()}return(n,r)=>{const m=K,a=N,l=M;return B(),A(l,{ref_key:"card",ref:u,title:"TVL"},{actions:f(()=>[w("div",ke,[d(m,{filename:"tvl",series:t(_)},null,8,["series"]),d(a,{chart:t(c),target:t(u)},null,8,["chart","target"])])]),default:f(()=>[w("div",we,null,512)]),_:1},512)}}}),Be={style:{display:"flex"}},De={ref:"chartRef",class:"chart"},Ae=L({__name:"ChartVolume",props:{volume:{}},setup(i){const p=E(),u=x("card"),{chart:c,series:_}=q({createChartOptions:H(),series:z({name:"volume",color:S(()=>p.value.colors.blue),formatter:n=>`$${F(n,1,"dollar")}${V(n)}`})});R(y);function y(){if(!c.value||!_.volume)return;const n=i.volume.map(r=>({time:r.timestamp.getUTCTimestamp(),value:r.volume})).uniqWith((r,m)=>r.time===m.time).orderBy(r=>r.time,"asc");n.length>0&&_.volume.setData(n),c.value.timeScale().fitContent()}return(n,r)=>{const m=K,a=N,l=M;return B(),A(l,{ref_key:"card",ref:u,title:"Volume"},{actions:f(()=>[w("div",Be,[d(m,{filename:"volume",series:t(_)},null,8,["series"]),d(a,{chart:t(c),target:t(u)},null,8,["chart","target"])])]),default:f(()=>[w("div",De,null,512)]),_:1},512)}}}),Le=L({__name:"Pool",props:{pool:{}},setup(i){const p=S(()=>{switch(i.pool){case"scrvusd":return"0xc522A6606BBA746d7960404F22a3DB936B6F4F50";case"sfrxusd":return"0xed785Af60bEd688baa8990cD5c4166221599A441";default:throw new Error(`Unknown pool: ${i.pool}`)}}),u=S(()=>{switch(i.pool){case"scrvusd":return ae;case"sfrxusd":return te;default:throw new Error(`Unknown pool: ${i.pool}`)}}),{isFetching:c,data:_}=le(U(()=>"ethereum"),p,u,U(()=>oe)),{isFetching:y,data:n}=ne(U(()=>"ethereum"),p),{isFetching:r,data:m}=re(U(()=>"ethereum"),p),{isFetching:a,data:l}=ce(U(()=>"ethereum"),p.value),o=S(()=>n.value.map(e=>({timestamp:e.timestamp,volume:e.volume}))),k=S(()=>m.value.map(e=>({timestamp:e.timestamp,tvl:e.tvlUSD}))),P=S(()=>!l.value||m.value.length===0?[]:l.value.coins.map(e=>({symbol:e.symbol,balances:m.value.map(s=>({timestamp:s.timestamp,balance:s.balances[e.poolIndex],tokenPrice:s.tokenPrices[e.poolIndex]}))}))),O=S(()=>a.value||r.value);return(e,s)=>{const v=M;return B(),Y(se,null,[w("div",{class:"title",style:D(`grid-area: title-${e.pool}`)}," Pool: "+X(e.pool),5),d(Se,{style:D(`grid-area: price-${e.pool}`),ohlc:t(_),loading:t(c),"min-move":.001},null,8,["style","ohlc","loading"]),d(Ae,{style:D(`grid-area: volume-${e.pool}`),volume:t(o),loading:t(y)},null,8,["style","volume","loading"]),d(Te,{style:D(`grid-area: tvl-${e.pool}`),tvl:t(k),loading:t(r)},null,8,["style","tvl","loading"]),t(O)?(B(),A(v,{key:1,loading:"",title:"Balances",style:D(`grid-area: balances-${e.pool}; min-height: ${t(de)}`)},null,8,["style"])):(B(),A(be,{key:0,style:D(`grid-area: balances-${e.pool}`),balances:t(P),loading:t(O)},null,8,["style","balances","loading"]))],64)}}}),G=I(Le,[["__scopeId","data-v-b59a0214"]]),Ue={class:"dashboard"},Fe=L({__name:"Stablecoin.page",setup(i){return(p,u)=>{const c=Q;return B(),Y("div",Ue,[d(c,{style:{"grid-area":"header"},title:"Stablecoin",description:"reUSD stablecoin metrics and liquidity pool analytics"}),d(G,{pool:"scrvusd"}),d(G,{pool:"sfrxusd"})])}}}),He=I(Fe,[["__scopeId","data-v-70317081"]]);export{He as default};
