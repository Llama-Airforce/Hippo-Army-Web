import{_ as X}from"./DashboardHeader-DIUaj5yv.js";import{d as V,ao as Z,ap as ee,b as D,o as w,ay as te,aq as ae,e as v,ar as oe,l as F,u as E,a as x,aQ as N,c as S,w as I,_ as P,f as B,g as _,h as t,aR as se,k as W,m as z,ah as le,aS as ne,aT as re,t as U,i as ce,j as Q,aB as ie,aU as M}from"./index-BgPU8Sw7.js";import{a as ue,b as me,c as de,d as pe}from"./stablecoin-DtEeYUv3.js";import{u as _e,_ as fe}from"./UseLegend-Jz1Vac8l.js";import{u as q,G as ve,r as he,a as H,_ as G,S as ge,c as Y,D as be}from"./UseLightweightChart-Bx3pg8jN.js";import{_ as ye}from"./Tooltip-DzxxnI9b.js";import{r as A,u as L}from"./Number-DpAK-pXX.js";import{_ as J}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-BmD2VBda.js";const Ce=V({__name:"ButtonToggle",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:Z(["change"],["update:modelValue"]),setup(i,{emit:m}){const u=ee(i,"modelValue"),c=m;return(d,h)=>{const a=te;return w(),D(a,{class:ae({toggled:u.value}),onClick:h[0]||(h[0]=r=>c("change",!u.value))},{default:v(()=>[oe(d.$slots,"default",{},void 0,!0)]),_:3},8,["class"])}}}),K=F(Ce,[["__scopeId","data-v-1a55ee48"]]),$e={style:{display:"flex"}},Se={ref:"chartRef",class:"chart"},ke="chart_pool_balances_dollars",we="chart_pool_balances_type",Be=V({__name:"ChartBalances",props:{balances:{}},setup(i){const m=E(),{items:u,toggles:c,disabled:d}=_e(()=>i.balances.map(({symbol:e},l)=>({id:e,label:e,color:m.value.colorsArray[l],togglable:!0}))),h=x("card"),a=N(ke,!1),r=["unstacked","stacked","100%"],p=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],o=N(we,r[0]),{chart:n,series:s}=q({createChartOptions:H(),series:[...i.balances.map(({symbol:e},l)=>({type:ve,name:e,options:S(()=>({priceFormat:{type:"custom",formatter:g=>`${A(g,1,"dollar")}${L(g)}`},lineWidth:2,lineType:he.WithSteps,color:m.value.colorsArray[l],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stacked",options:S(()=>({priceFormat:{type:"custom",formatter:e=>`${A(e,1,"dollar")}${L(e)}`},colors:u.value.map((e,l)=>({item:e,i:l})).filter(({item:e})=>!d.value.includes(e.id)).map(({i:e})=>e).map(e=>m.value.colorsArray[e]).map(e=>({line:e,area:e+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});I(k);function k(){if(!(!n.value||Object.values(s).length<0)){for(const e of Object.values(s))e==null||e.setData([]);o.value==="unstacked"?O():R(o.value==="100%"),n.value.timeScale().fitContent()}}function O(){var e,l;for(const{symbol:g,balances:f}of i.balances.values()){if(!c[g].value){(e=s[g])==null||e.setData([]);continue}const b=a.value,C=f.map(y=>({time:y.timestamp.getUTCTimestamp(),value:b?y.balance*y.tokenPrice:y.balance})).uniqWith((y,T)=>y.time===T.time).orderBy(y=>y.time,"asc");C.length>0&&((l=s[g])==null||l.setData(C))}}function R(e){if(!s.stacked)return;const l=a.value,g=[...i.balances.values()].filter(({symbol:f,balances:b})=>c[f].value&&b.length>0).flatMap(({symbol:f,balances:b})=>b.map(C=>({symbol:f,timestamp:C.timestamp,balance:l?C.balance*C.tokenPrice:C.balance}))).groupBy(f=>f.timestamp.getTime()).entries().map(([f,b])=>{const C=e?b.reduce((T,$)=>T+$.balance,0):1,y=b.map(T=>e?T.balance/C*100:T.balance);return{time:Number(f)/1e3,values:y}}).uniqWith((f,b)=>f.time===b.time).orderBy(f=>f.time,"asc");g.length>0&&s.stacked.setData(g)}return(e,l)=>{const g=se,f=K,b=ye,C=G,y=fe,T=P;return w(),D(T,{ref_key:"card",ref:h,class:"stack-actions",title:"Balances"},{actions:v(()=>[B("div",$e,[_(g,{options:p,selected:p.find($=>$.id===t(o))??p[0],onSelect:l[0]||(l[0]=$=>o.value=$.id)},{option:v(({option:$})=>[W(z($.label),1)]),_:1},8,["selected"]),_(b,null,{trigger:v(()=>[_(f,{style:{"margin-right":"1rem"},"model-value":t(a),onClick:l[1]||(l[1]=$=>a.value=!t(a))},{default:v(()=>l[3]||(l[3]=[W(" $ ")])),_:1},8,["model-value"])]),default:v(()=>[l[4]||(l[4]=W(" Show token balances in USD. "))]),_:1}),_(C,{chart:t(n),target:t(h)},null,8,["chart","target"])])]),"actions-secondary":v(()=>[_(y,{items:t(u),disabled:t(d),onToggle:l[2]||(l[2]=$=>t(c)[$].value=!t(c)[$].value)},null,8,["items","disabled"])]),default:v(()=>[B("div",Se,null,512)]),_:1},512)}}}),Te=F(Be,[["__scopeId","data-v-43570596"]]),De={class:"controls"},Ve={ref:"chartRef",class:"chart"},Me=V({__name:"ChartPrice",props:{ohlc:{},minMove:{default:()=>{}}},setup(i){const m=E(),u=le(!1);let c=1,d=0;const{chart:h,series:a}=q({createChartOptions:H(),series:{type:ge,name:"ohlc",options:S(()=>{const{colors:o}=m.value;return{priceFormat:{type:"custom",formatter:p,minMove:i.minMove},upColor:o.green,borderUpColor:o.green,wickUpColor:o.green,downColor:o.red,borderDownColor:o.red,wickDownColor:o.red}})}});I(r);function r(){if(!h.value||!a.ohlc)return;const o=u.value?-1:1,n=i.ohlc.map(s=>({time:s.time.getUTCTimestamp(),open:Math.pow(s.open,o),high:Math.pow(s.high,o),low:Math.pow(s.low,o),close:Math.pow(s.close,o)})).uniqWith((s,k)=>s.time===k.time).orderBy(s=>s.time,"asc");n.length>0&&(a.ohlc.setData(n),d=Math.min(...n.map(s=>s.low)),c=Math.max(...n.map(s=>s.high))),h.value.timeScale().fitContent()}function p(o){const n=c-d,s=n>1?n-Math.floor(n):n,k=-Math.floor(Math.log10(s)+1)+2;return`${A(o,k,"dollar")}${L(o)}`}return(o,n)=>{const s=K,k=P;return w(),D(k,{title:"Price"},{actions:v(()=>[B("div",De,[_(s,{"model-value":t(u),onClick:n[0]||(n[0]=O=>u.value=!t(u))},{default:v(()=>n[1]||(n[1]=[W(" Invert ")])),_:1},8,["model-value"])])]),default:v(()=>[B("div",Ve,null,512)]),_:1})}}}),Ue=F(Me,[["__scopeId","data-v-251bffbb"]]),Ae={style:{display:"flex"}},Le={ref:"chartRef",class:"chart"},Fe=V({__name:"ChartTvl",props:{tvl:{}},setup(i){const m=E(),u=x("card"),{chart:c,series:d}=q({createChartOptions:H(),series:Y({name:"tvl",color:S(()=>m.value.colors.blue),formatter:a=>`$${A(a,1,"dollar")}${L(a)}`})});I(h);function h(){if(!c.value||!d.tvl)return;const a=i.tvl.map(r=>({time:r.timestamp.getUTCTimestamp(),value:r.tvl})).uniqWith((r,p)=>r.time===p.time).orderBy(r=>r.time,"asc");a.length>0&&d.tvl.setData(a),c.value.timeScale().fitContent()}return(a,r)=>{const p=J,o=G,n=P;return w(),D(n,{ref_key:"card",ref:u,title:"TVL"},{actions:v(()=>[B("div",Ae,[_(p,{filename:"tvl",series:t(d)},null,8,["series"]),_(o,{chart:t(c),target:t(u)},null,8,["chart","target"])])]),default:v(()=>[B("div",Le,null,512)]),_:1},512)}}}),Pe={style:{display:"flex"}},Oe={ref:"chartRef",class:"chart"},Re=V({__name:"ChartVolume",props:{volume:{}},setup(i){const m=E(),u=x("card"),{chart:c,series:d}=q({createChartOptions:H(),series:Y({name:"volume",color:S(()=>m.value.colors.blue),formatter:a=>`$${A(a,1,"dollar")}${L(a)}`})});I(h);function h(){if(!c.value||!d.volume)return;const a=i.volume.map(r=>({time:r.timestamp.getUTCTimestamp(),value:r.volume})).uniqWith((r,p)=>r.time===p.time).orderBy(r=>r.time,"asc");a.length>0&&d.volume.setData(a),c.value.timeScale().fitContent()}return(a,r)=>{const p=J,o=G,n=P;return w(),D(n,{ref_key:"card",ref:u,title:"Volume"},{actions:v(()=>[B("div",Pe,[_(p,{filename:"volume",series:t(d)},null,8,["series"]),_(o,{chart:t(c),target:t(u)},null,8,["chart","target"])])]),default:v(()=>[B("div",Oe,null,512)]),_:1},512)}}}),We=V({__name:"Pool",props:{pool:{}},setup(i){const m=S(()=>{switch(i.pool){case"scrvusd":return"0xc522A6606BBA746d7960404F22a3DB936B6F4F50";case"sfrxusd":return"0xed785Af60bEd688baa8990cD5c4166221599A441";default:throw new Error(`Unknown pool: ${i.pool}`)}}),u=S(()=>{switch(i.pool){case"scrvusd":return re;case"sfrxusd":return ne;default:throw new Error(`Unknown pool: ${i.pool}`)}}),{isFetching:c,data:d}=ue(U(()=>"ethereum"),m,u,U(()=>ce)),{isFetching:h,data:a}=me(U(()=>"ethereum"),m),{isFetching:r,data:p}=de(U(()=>"ethereum"),m),{isFetching:o,data:n}=pe(U(()=>"ethereum"),m.value),s=S(()=>a.value.map(e=>({timestamp:e.timestamp,volume:e.volume}))),k=S(()=>p.value.map(e=>({timestamp:e.timestamp,tvl:e.tvlUSD}))),O=S(()=>!n.value||p.value.length===0?[]:n.value.coins.map(e=>({symbol:e.symbol,balances:p.value.map(l=>({timestamp:l.timestamp,balance:l.balances[e.poolIndex],tokenPrice:l.tokenPrices[e.poolIndex]}))}))),R=S(()=>o.value||r.value);return(e,l)=>{const g=P;return w(),Q(ie,null,[B("div",{class:"title",style:M(`grid-area: title-${e.pool}`)}," Pool: "+z(e.pool),5),_(Ue,{style:M(`grid-area: price-${e.pool}`),ohlc:t(d),loading:t(c),"min-move":.001},null,8,["style","ohlc","loading"]),_(Re,{style:M(`grid-area: volume-${e.pool}`),volume:t(s),loading:t(h)},null,8,["style","volume","loading"]),_(Fe,{style:M(`grid-area: tvl-${e.pool}`),tvl:t(k),loading:t(r)},null,8,["style","tvl","loading"]),t(R)?(w(),D(g,{key:1,loading:"",title:"Balances",style:M(`grid-area: balances-${e.pool}; min-height: ${t(be)}`)},null,8,["style"])):(w(),D(Te,{key:0,style:M(`grid-area: balances-${e.pool}`),balances:t(O),loading:t(R)},null,8,["style","balances","loading"]))],64)}}}),j=F(We,[["__scopeId","data-v-b59a0214"]]),Ee={class:"dashboard"},Ie=V({__name:"Stablecoin.page",setup(i){return(m,u)=>{const c=X;return w(),Q("div",Ee,[_(c,{style:{"grid-area":"header"},title:"Stablecoin",description:"reUSD stablecoin metrics and liquidity pool analytics"}),_(j,{pool:"scrvusd"}),_(j,{pool:"sfrxusd"})])}}}),Ye=F(Ie,[["__scopeId","data-v-70317081"]]);export{Ye as default};
