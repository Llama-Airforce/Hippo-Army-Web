var T=e=>{throw TypeError(e)};var U=(e,t,s)=>t.has(e)||T("Cannot "+s);var i=(e,t,s)=>(U(e,t,"read from private field"),s?s.call(e):t.get(e)),g=(e,t,s)=>t.has(e)?T("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),h=(e,t,s,r)=>(U(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),d=(e,t,s)=>(U(e,t,"access private method"),s);import{Q as se,t as $,f as K,b as X,a as N}from"./timestamp-DbzQYZiw.js";import{aL as re,aM as J,aN as oe,aO as ne,c as k,h as ae,aP as ie,aQ as le,av as V,aj as ce,aR as ue,ak as pe,am as j}from"./index-BYo41Xup.js";import{o as m,s as a,n as l,a as D,f as S,p as A,t as Y,g as B}from"./AsyncValue-Sj7pBrIC.js";import{p as he}from"./Pagination-vgbH7lYO.js";function G(e,t){return e.filter(s=>!t.includes(s))}function me(e,t,s){const r=e.slice(0);return r[t]=s,r}var w,_,R,O,b,v,P,C,q,p,M,H,z,I,L,W,_e=(W=class extends re{constructor(t,s,r){super();g(this,p);g(this,w);g(this,_);g(this,R);g(this,O);g(this,b);g(this,v);g(this,P);g(this,C);g(this,q,[]);h(this,w,t),h(this,O,r),h(this,R,[]),h(this,b,[]),h(this,_,[]),this.setQueries(s)}onSubscribe(){this.listeners.size===1&&i(this,b).forEach(t=>{t.subscribe(s=>{d(this,p,I).call(this,t,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,i(this,b).forEach(t=>{t.destroy()})}setQueries(t,s){h(this,R,t),h(this,O,s),J.batch(()=>{const r=i(this,b),n=d(this,p,z).call(this,i(this,R));h(this,q,n),n.forEach(u=>u.observer.setOptions(u.defaultedQueryOptions));const o=n.map(u=>u.observer),c=o.map(u=>u.getCurrentResult()),f=o.some((u,y)=>u!==r[y]);r.length===o.length&&!f||(h(this,b,o),h(this,_,c),this.hasListeners()&&(G(r,o).forEach(u=>{u.destroy()}),G(o,r).forEach(u=>{u.subscribe(y=>{d(this,p,I).call(this,u,y)})}),d(this,p,L).call(this)))})}getCurrentResult(){return i(this,_)}getQueries(){return i(this,b).map(t=>t.getCurrentQuery())}getObservers(){return i(this,b)}getOptimisticResult(t,s){const r=d(this,p,z).call(this,t),n=r.map(o=>o.observer.getOptimisticResult(o.defaultedQueryOptions));return[n,o=>d(this,p,H).call(this,o??n,s),()=>d(this,p,M).call(this,n,r)]}},w=new WeakMap,_=new WeakMap,R=new WeakMap,O=new WeakMap,b=new WeakMap,v=new WeakMap,P=new WeakMap,C=new WeakMap,q=new WeakMap,p=new WeakSet,M=function(t,s){return s.map((r,n)=>{const o=t[n];return r.defaultedQueryOptions.notifyOnChangeProps?o:r.observer.trackResult(o,c=>{s.forEach(f=>{f.observer.trackProp(c)})})})},H=function(t,s){return s?((!i(this,v)||i(this,_)!==i(this,C)||s!==i(this,P))&&(h(this,P,s),h(this,C,i(this,_)),h(this,v,oe(i(this,v),s(t)))),i(this,v)):t},z=function(t){const s=new Map(i(this,b).map(n=>[n.options.queryHash,n])),r=[];return t.forEach(n=>{const o=i(this,w).defaultQueryOptions(n),c=s.get(o.queryHash);c?r.push({defaultedQueryOptions:o,observer:c}):r.push({defaultedQueryOptions:o,observer:new se(i(this,w),o)})}),r},I=function(t,s){const r=i(this,b).indexOf(t);r!==-1&&(h(this,_,me(i(this,_),r,s)),d(this,p,L).call(this))},L=function(){var t;if(this.hasListeners()){const s=i(this,v),r=d(this,p,M).call(this,i(this,_),i(this,q)),n=d(this,p,H).call(this,r,(t=i(this,O))==null?void 0:t.combine);s!==n&&J.batch(()=>{this.listeners.forEach(o=>{o(i(this,_))})})}},W);function be({queries:e,...t},s){const r=ne(),n=k(()=>ae(e).map(x=>{const F=ie(x);typeof F.enabled=="function"&&(F.enabled=x.enabled());const E=r.defaultQueryOptions(F);return E._optimisticResults=r.isRestoring.value?"isRestoring":"optimistic",E})),o=new _e(r,n.value,t),c=()=>{const[y,x]=o.getOptimisticResult(n.value,t.combine);return x(y.map((F,E)=>({...F,refetch:async(...ee)=>{const[{[E]:te}]=o.getOptimisticResult(n.value,t.combine);return te.refetch(...ee)}})))},f=le(c());let u=()=>{};return V(r.isRestoring,y=>{y||(u(),u=o.subscribe(()=>{f.value=c()}),f.value=c())},{immediate:!0}),V(n,y=>{o.setQueries(y,t),f.value=c()}),ce(()=>{u()}),t.shallow?ue(f):pe(f)}const fe=m({name:a(),protocol_id:l(),pairs_count:l(),active_positions_count:l(),total_collateral:a(),total_underlying:a(),total_debt:a()}).transform(e=>({name:e.name,protocolId:e.protocol_id,pairsCount:e.pairs_count,activePositionsCount:e.active_positions_count,totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),totalDebt:parseFloat(e.total_debt)})),ge=m({protocols:D(fe),count:l()}).transform(e=>({protocols:e.protocols,count:e.count})),Q=m({symbol:a(),name:a(),address:a(),precision:l()}).transform(e=>({symbol:e.symbol,name:e.name,address:e.address,precision:e.precision})),de=m({token_address:a(),token_symbol:a(),apr:a()}).transform(e=>({tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),ye=m({pair_id:l(),name:a(),address:a(),total_collateral:a(),total_underlying:a(),exchange_rate:a(),total_debt:a(),active_positions_count:l(),borrow_limit:a(),utilization_rate:a(),interest_rate:a(),claimable_fees:a(),claimable_other_fees:a(),block_timestamp:l(),last_redemption:l().nullable(),redemption_fee_10k:a(),borrow_cost_apr:a(),base_apr:a(),rewards:D(de),collateral_token:Q,debt_token:Q,underlying_token:Q,pair_collateral_token:Q,pair_underlying_token:Q}).transform(e=>({pairId:e.pair_id,name:e.name,address:e.address,totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),exchangeRate:parseFloat(e.exchange_rate),totalDebt:parseFloat(e.total_debt),activePositionsCount:e.active_positions_count,borrowLimit:parseFloat(e.borrow_limit),utilizationRate:parseFloat(e.utilization_rate),interestRate:parseFloat(e.interest_rate),claimableFees:parseFloat(e.claimable_fees),claimableOtherFees:parseFloat(e.claimable_other_fees),blockTime:$(e.block_timestamp),lastRedemption:e.last_redemption?$(e.last_redemption):null,redemptionFee10k:parseFloat(e.redemption_fee_10k),aprBorrowCost:parseFloat(e.borrow_cost_apr),aprBase:parseFloat(e.base_apr),rewards:e.rewards,tokenCollateral:e.collateral_token,tokenDebt:e.debt_token,tokenUnderlying:e.underlying_token,tokenPairCollateral:e.pair_collateral_token,tokenPairUnderyling:e.pair_underlying_token})),ve=m({pairs:D(ye),count:l(),page:l(),total_pages:l()}).transform(e=>({pairs:e.pairs,count:e.count,page:e.page,totalPages:e.total_pages})),ke=m({crvusd_price:a(),frxusd_price:a(),block_number:l(),block_timestamp:l()}).transform(e=>({crvusd:parseFloat(e.crvusd_price),frxusd:parseFloat(e.frxusd_price),blockNumber:e.block_number,timestamp:$(e.block_timestamp)}));m({prices:D(ke),count:l(),page:l(),total_pages:l()}).transform(e=>({prices:e.prices,count:e.count,page:e.page,totalPages:e.total_pages}));const we=m({name:a(),protocol_id:l(),pairs_count:l(),active_positions_count:l(),total_collateral:a(),total_underlying:a(),total_debt:a(),timestamp:l()}).transform(e=>({timestamp:$(e.timestamp),name:e.name,protocolId:e.protocol_id,pairsCount:e.pairs_count,totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),totalDebt:parseFloat(e.total_debt)})),Re=m({snapshots:D(we),count:l(),page:l(),total_pages:l()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),Oe=m(S);async function Fe(e,t){const s=B(t),{chain:r}=Oe.parse(e),n=await K(`${s}/v1/protocols/overview/${r}`,void 0,t==null?void 0:t.signal);return ge.parse(n)}const Qe=m({...S,...A,protocol_name:a()});async function Pe(e,t){const s=B(t),{chain:r,protocol_name:n,...o}=Qe.parse(e),c=X(o),f=await K(`${s}/v1/protocols/${r}/${n}/pairs${c}`,void 0,t==null?void 0:t.signal);return ve.parse(f)}m({...S,...Y,...A});const Ce=m({...S,...Y,...A});async function qe(e,t){const s=B(t),{chain:r,...n}=Ce.parse(e),o=X(n),c=await K(`${s}/v1/protocols/history/${r}${o}`,void 0,t==null?void 0:t.signal);return Re.parse(c)}function De(e){return N({queryKey:["protocols-overview",e],queryFn:()=>Fe(j(e))})}function Z(e){return{queryKey:["protocols-pairs",e],queryFn:()=>he((s,r)=>Pe({...j(e),page:s,per_page:r}).then(n=>n.pairs),1,100)}}function Me(e,t){return N({...Z(e),enabled:t})}function He(){const{data:e}=De({chain:"ethereum"}),t=k(()=>{var o;return(((o=e.value)==null?void 0:o.protocols)??[]).map(c=>c.name)}),s=k(()=>{var o;return(((o=e.value)==null?void 0:o.count)??0)>0}),r=k(()=>t.value.map(o=>({...Z({chain:"ethereum",protocol_name:o}),enabled:s}))),n=be({queries:r,combine:o=>({data:o.map(c=>c.data).filter(c=>c!==void 0).flat(),pending:o.some(c=>c.isPending)})});return{data:k(()=>n.value.data),pending:k(()=>n.value.pending)}}function ze(e){return N({queryKey:["protocols-history",e],queryFn:()=>qe(j(e))})}export{ze as a,Me as b,De as c,He as u};
