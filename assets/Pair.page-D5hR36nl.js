import{a as me,_ as ge}from"./TabItem.vue_vue_type_script_setup_true_lang-B-6dAmy-.js";import{aw as A,aJ as Q,d as C,ao as G,aq as E,b as v,o as d,_ as I,e as h,aB as $,f as _,m as w,j as F,g as i,k as N,ar as D,h as s,l as T,ah as X,c as q,at as J,u as se,a as ne,w as re,t as he,aG as ve,aH as fe,au as be,aD as L}from"./index-C4bxLmri.js";import{a as ye}from"./protocols-Dq__jjai.js";import{b as oe,p as ke,a as $e}from"./UseTabNavigation-DJjOj5ia.js";import{t as V,b as H,f as x,a as U,g as we,r as le,u as ie}from"./Number-D-_ywgC3.js";import{d as qe,o as y,s as m,a as B,n as f,e as M,p as O,t as K,c as W,g as z,_ as j}from"./AsyncValue-Brd_Goit.js";import{p as Ce}from"./Pagination-vgbH7lYO.js";import{_ as Y}from"./NoData-CCKe-Sh0.js";import{_ as Z}from"./Table-CDZZfuyN.js";import{a as ee,_ as ae}from"./UsePagination-C4qACSg2.js";import{u as te}from"./UseRelativeTime-BFrqfvoq.js";import{_ as Te}from"./KPI-BvSL3471.js";import{u as ce,c as pe,a as ue,_ as de}from"./UseLightweightChart-C12vCX9v.js";import{_ as _e}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-CH9iGe7u.js";import"./Tooltip-DPMfqQ_8.js";const Pe=qe(["borrow","add_collateral","remove_collateral","repay","redeem","liquidate","leveraged_position","repay_with_collateral"]),Fe=y({token_address:m(),token_symbol:m(),apr:m()}).transform(e=>({tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),Re=y({date_timestamp:f(),total_collateral:m(),total_underlying:m(),exchange_rate:m(),total_debt:m(),active_positions_count:f(),borrow_limit:m(),utilization_rate:m(),interest_rate:m(),claimable_fees:m(),claimable_other_fees:m(),borrow_cost_apr:m(),base_apr:m(),rewards:B(Fe)}).transform(e=>({time:V(e.date_timestamp),totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),exchangeRate:parseFloat(e.exchange_rate),totalDebt:parseFloat(e.total_debt),activePositionsCount:e.active_positions_count,borrowLimit:parseFloat(e.borrow_limit),utilizationRate:parseFloat(e.utilization_rate),interestRate:parseFloat(e.interest_rate),claimableFees:parseFloat(e.claimable_fees),claimableOtherFees:parseFloat(e.claimable_other_fees),aprBorrowCost:parseFloat(e.borrow_cost_apr),aprBase:parseFloat(e.base_apr),rewards:e.rewards})),Se=y({snapshots:B(Re),count:f(),page:f(),total_pages:f()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),De=y({event_type:Pe,block_timestamp:f(),tx_hash:m(),block_number:f(),collateral_change:m(),debt_change:m()}).transform(e=>({eventType:e.event_type,blockTime:V(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,collateralChange:parseFloat(e.collateral_change),debtChange:parseFloat(e.debt_change)})),Le=y({events:B(De),count:f(),page:f(),total_pages:f()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Ie=y({block_timestamp:f(),tx_hash:m(),block_number:f(),caller:M,amount:m(),collateral_freed:m(),protocol_fee:m(),debt_reduction:m()}).transform(e=>({blockTime:V(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,caller:e.caller,amount:parseFloat(e.amount),collateralFreed:parseFloat(e.collateral_freed),protocolFee:parseFloat(e.protocol_fee),debtReduction:parseFloat(e.debt_reduction)})),Be=y({events:B(Ie),count:f(),page:f(),total_pages:f()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Ne=y({block_timestamp:f(),tx_hash:m(),block_number:f(),borrower:M,liquidator:M,collateral_for_liquidator:m(),shares_liquidated:m(),amount_liquidator_to_repay:m()}).transform(e=>({blockTime:V(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,borrower:e.borrower,liquidator:e.liquidator,collateralForLiquidator:parseFloat(e.collateral_for_liquidator),sharesLiquidated:parseFloat(e.shares_liquidated),amountLiquidatorToRepay:parseFloat(e.amount_liquidator_to_repay)})),Ae=y({events:B(Ne),count:f(),page:f(),total_pages:f()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Ee=y({...W,...K,...O});async function Ve(e,o){const c=z(o),{pair_id:l,...p}=Ee.parse(e),a=H(p),r=await x(`${c}/v1/pairs/${l}/snapshots${a}`,void 0,o==null?void 0:o.signal);return Se.parse(r)}const He=y({...W,...K,...O});async function xe(e,o){const c=z(o),{pair_id:l,...p}=He.parse(e),a=H(p),r=await x(`${c}/v1/pairs/${l}/collateral_events${a}`,void 0,o==null?void 0:o.signal);return Le.parse(r)}const Ue=y({...W,...K,...O});async function Oe(e,o){const c=z(o),{pair_id:l,...p}=Ue.parse(e),a=H(p),r=await x(`${c}/v1/pairs/${l}/redemptions${a}`,void 0,o==null?void 0:o.signal);return Be.parse(r)}const Ke=y({...W,...K,...O});async function We(e,o){const c=z(o),{pair_id:l,...p}=Ke.parse(e),a=H(p),r=await x(`${c}/v1/pairs/${l}/liquidations${a}`,void 0,o==null?void 0:o.signal);return Ae.parse(r)}function ze(e){const{start:o,end:c}=we({daysRange:90});return U({queryKey:["pairs-snapshots",e],queryFn:()=>Ce((p,a)=>Ve({...A(e),page:p,per_page:a,start:o,end:c}).then(r=>r.snapshots),1,100)})}function je(e){return U({queryKey:["pairs-collateral-events",e],queryFn:()=>xe(A(e)),placeholderData:Q})}function Je(e){return U({queryKey:["pairs-redemptions",e],queryFn:()=>Oe(A(e)),placeholderData:Q})}function Me(e){return U({queryKey:["pairs-liquidations",e],queryFn:()=>We(A(e)),placeholderData:Q})}const Qe={class:"end"},Ge={key:0,style:{display:"flex",gap:"1ch"}},Xe={class:"end"},Ye={key:0,style:{display:"flex",gap:"1ch"}},Ze={class:"end"},ea=["href"],aa=C({__name:"TableCollateralEvents",props:{events:{},count:{},pair:{},loading:{type:Boolean}},emits:["page"],setup(e,{emit:o}){const c=o,{page:l,onPage:p}=ee(),a=G(l,200);E(a,n=>{c("page",n)});const{relativeTime:r}=te(),t=n=>{switch(n.eventType){case"add_collateral":return"Add collateral";case"borrow":return"Borrow";case"remove_collateral":return"Remove collateral";case"repay":return"Repay";case"redeem":return"Redeem";case"liquidate":return"Liquidate";case"leveraged_position":return"Lev. position";case"repay_with_collateral":return"Repay with col"}};return(n,u)=>{const b=ae,P=j,k=Z,R=Y,g=I;return d(),v(g,{title:"Events"},{actions:h(()=>[i(b,{"items-count":n.count,"items-per-page":10,page:s(l),onPage:s(p)},null,8,["items-count","page","onPage"])]),default:h(()=>[e.events.length>0?(d(),v(k,{key:0,rows:e.events,columns:["Type",{label:"Δ Debt",align:"end"},{label:"Δ Collateral",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:S})=>[_("div",null,w(t(S)),1),_("div",Qe,[S.debtChange!==0?(d(),F("div",Ge,[i(P,{type:"dollar",value:S.debtChange/10**18,precision:4,"show-symbol":!1},null,8,["value"]),N(" "+w(n.pair.tokenDebt.symbol),1)])):$("",!0)]),_("div",Xe,[S.collateralChange!==0?(d(),F("div",Ye,[i(P,{type:"dollar",value:S.collateralChange/10**18,precision:4,"show-symbol":!1},null,8,["value"]),N(" "+w(n.pair.tokenCollateral.symbol),1)])):$("",!0)]),_("div",Ze,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${S.txHash}`,onClick:u[0]||(u[0]=D(()=>{},["stop"]))},w(s(r)(S.blockTime.getUTCTimestamp())),9,ea)])]),_:1},8,["rows"])):n.loading?$("",!0):(d(),v(R,{key:1,message:"There are no events"}))]),_:1})}}}),ta=T(aa,[["__scopeId","data-v-1dea2319"]]),oa={class:"dashboard-grid"},sa=C({__name:"Collateral",props:{pair:{}},setup(e){const o=X(1),{isFetching:c,data:l}=je(q(()=>({pair_id:e.pair.pairId,page:o.value,per_page:15})));return(p,a)=>{var r,t;return d(),F("div",oa,[i(ta,{events:((r=s(l))==null?void 0:r.events)??[],count:((t=s(l))==null?void 0:t.count)??0,loading:s(c),pair:p.pair,onPage:a[0]||(a[0]=n=>o.value=n)},null,8,["events","count","loading","pair"])])}}}),na=T(sa,[["__scopeId","data-v-ff086716"]]),ra={},la={class:"dashboard-grid"};function ia(e,o){return d(),F("div",la,"Health goes here")}const ca=T(ra,[["render",ia],["__scopeId","data-v-f3492742"]]),pa=["href"],ua=["href"],da={class:"end"},_a={class:"end"},ma={class:"end"},ga={class:"end"},ha=["href"],va=C({__name:"TableLiquidations",props:{liquidations:{},count:{},loading:{type:Boolean}},emits:["page"],setup(e,{emit:o}){const c=o,{page:l,onPage:p}=ee(),a=G(l,200);E(a,t=>{c("page",t)});const{relativeTime:r}=te();return(t,n)=>{const u=ae,b=j,P=Z,k=Y,R=I;return d(),v(R,{title:"Liquidations"},{actions:h(()=>[i(u,{"items-count":t.count,"items-per-page":10,page:s(l),onPage:s(p)},null,8,["items-count","page","onPage"])]),default:h(()=>[e.liquidations.length>0?(d(),v(P,{key:0,rows:e.liquidations,columns:["Borrower","Liquidator",{label:"Shares liquidated",align:"end"},{label:"Collat for liquidator",align:"end"},{label:"Amount to repay",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:g})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${g.borrower}`,onClick:n[0]||(n[0]=D(()=>{},["stop"]))},w(g.borrower.ens||("addressShort"in t?t.addressShort:s(J))(g.borrower.address)),9,pa)]),_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${g.liquidator}`,onClick:n[1]||(n[1]=D(()=>{},["stop"]))},w(g.liquidator.ens||("addressShort"in t?t.addressShort:s(J))(g.liquidator.address)),9,ua)]),_("div",da,[i(b,{type:"dollar",value:g.sharesLiquidated,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",_a,[i(b,{type:"dollar",value:g.collateralForLiquidator,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",ma,[i(b,{type:"dollar",value:g.amountLiquidatorToRepay,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",ga,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${g.txHash}`,onClick:n[2]||(n[2]=D(()=>{},["stop"]))},w(s(r)(g.blockTime.getUTCTimestamp())),9,ha)])]),_:1},8,["rows"])):t.loading?$("",!0):(d(),v(k,{key:1,message:"There are no liquidations"}))]),_:1})}}}),fa=T(va,[["__scopeId","data-v-1e2df879"]]),ba={class:"dashboard-grid"},ya=C({__name:"Liquidations",props:{pair:{}},setup(e){const o=X(1),{isFetching:c,data:l}=Me(q(()=>({pair_id:e.pair.pairId,page:o.value,per_page:15})));return(p,a)=>{var r,t;return d(),F("div",ba,[i(fa,{liquidations:((r=s(l))==null?void 0:r.events)??[],count:((t=s(l))==null?void 0:t.count)??0,loading:s(c),onPage:a[0]||(a[0]=n=>o.value=n)},null,8,["liquidations","count","loading"])])}}}),ka=T(ya,[["__scopeId","data-v-0dd6af85"]]),$a={style:{display:"flex"}},wa={ref:"chartRef",class:"chart"},qa=C({__name:"ChartApr",props:{apr:{}},setup(e){const o=se(),c=ne("card"),{chart:l,series:p}=ce({createChartOptions:ue(),series:pe({name:"apr",color:q(()=>o.value.colors.blue),formatter:r=>`$${le(r,1,"dollar")}${ie(r)}`,minMove:.01})});re(a);function a(){if(!l.value||!p.apr)return;const r=e.apr.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.apr})).uniqWith((t,n)=>t.time===n.time).orderBy(t=>t.time,"asc");r.length>0&&p.apr.setData(r),l.value.timeScale().fitContent()}return(r,t)=>{const n=_e,u=de,b=I;return d(),v(b,{ref_key:"card",ref:c,title:"APR"},{actions:h(()=>[_("div",$a,[i(n,{filename:"apr",series:s(p)},null,8,["series"]),i(u,{chart:s(l),target:s(c)},null,8,["chart","target"])])]),default:h(()=>[_("div",wa,null,512)]),_:1},512)}}}),Ca={style:{display:"flex"}},Ta={ref:"chartRef",class:"chart"},Pa=C({__name:"ChartTvl",props:{tvl:{}},setup(e){const o=se(),c=ne("card"),{chart:l,series:p}=ce({createChartOptions:ue(),series:pe({name:"tvl",color:q(()=>o.value.colors.blue),formatter:r=>`$${le(r,1,"dollar")}${ie(r)}`})});re(a);function a(){if(!l.value||!p.tvl)return;const r=e.tvl.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.tvl})).uniqWith((t,n)=>t.time===n.time).orderBy(t=>t.time,"asc");r.length>0&&p.tvl.setData(r),l.value.timeScale().fitContent()}return(r,t)=>{const n=_e,u=de,b=I;return d(),v(b,{ref_key:"card",ref:c,title:"TVL"},{actions:h(()=>[_("div",Ca,[i(n,{filename:"tvl",series:s(p)},null,8,["series"]),i(u,{chart:s(l),target:s(c)},null,8,["chart","target"])])]),default:h(()=>[_("div",Ta,null,512)]),_:1},512)}}}),Fa={class:"dashboard-grid"},Ra={class:"kpis",style:{"grid-area":"kpis"}},Sa=C({__name:"Overview",props:{pair:{}},setup(e){const{isFetching:o,data:c}=ze(he(()=>({pair_id:e.pair.pairId}))),l=q(()=>(c.value??[]).map(a=>({timestamp:a.time,tvl:a.totalCollateral/10**21}))),p=q(()=>(c.value??[]).map(a=>({timestamp:a.time,apr:a.aprBase})));return(a,r)=>{const t=j,n=Te;return d(),F("div",Fa,[_("div",Ra,[i(n,{label:"Positions","has-value":!!a.pair},{default:h(()=>{var u;return[i(t,{precision:0,value:(u=a.pair)==null?void 0:u.activePositionsCount},null,8,["value"])]}),_:1},8,["has-value"]),i(n,{label:"TVL","has-value":!!a.pair},{default:h(()=>{var u;return[i(t,{type:"dollar",precision:2,value:((u=a.pair)==null?void 0:u.totalCollateral)&&a.pair.totalCollateral/10**21,"show-symbol":!1},null,8,["value"]),N(" "+w(a.pair.tokenUnderlying.symbol),1)]}),_:1},8,["has-value"]),i(n,{label:"Interest Rate","has-value":!!a.pair},{default:h(()=>{var u;return[i(t,{type:"percentage",precision:2,value:((u=a.pair)==null?void 0:u.interestRate)&&a.pair.interestRate/10**8},null,8,["value"])]}),_:1},8,["has-value"]),i(n,{label:"Utilization Rate","has-value":!!a.pair},{default:h(()=>{var u;return[i(t,{type:"percentage",precision:2,value:(u=a.pair)==null?void 0:u.utilizationRate},null,8,["value"])]}),_:1},8,["has-value"])]),i(Pa,{style:{"grid-area":"tvl"},tvl:s(l),loading:s(o)},null,8,["tvl","loading"]),i(qa,{style:{"grid-area":"apr"},apr:s(p),loading:s(o)},null,8,["apr","loading"])])}}}),Da=T(Sa,[["__scopeId","data-v-ae7c7fd0"]]),La=["href"],Ia={class:"end"},Ba={class:"end"},Na={class:"end",style:{display:"flex",gap:"1ch"}},Aa={class:"end"},Ea={class:"end"},Va=["href"],Ha=C({__name:"TableRedemptions",props:{redemptions:{},count:{},pair:{},loading:{type:Boolean}},emits:["page"],setup(e,{emit:o}){const c=o,{page:l,onPage:p}=ee(),a=G(l,200);E(a,t=>{c("page",t)});const{relativeTime:r}=te();return(t,n)=>{const u=ae,b=j,P=Z,k=Y,R=I;return d(),v(R,{title:"Redemptions"},{actions:h(()=>[i(u,{"items-count":t.count,"items-per-page":10,page:s(l),onPage:s(p)},null,8,["items-count","page","onPage"])]),default:h(()=>[e.redemptions.length>0?(d(),v(P,{key:0,rows:e.redemptions,columns:["Caller",{label:"reUSD",align:"end"},{label:"Debt reduction",align:"end"},{label:"Collateral freed",align:"end"},{label:"Protocol fee",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:g})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${g.caller}`,onClick:n[0]||(n[0]=D(()=>{},["stop"]))},w(g.caller.ens||("addressShort"in t?t.addressShort:s(J))(g.caller.address)),9,La)]),_("div",Ia,[i(b,{type:"dollar",value:g.amount/10**18,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Ba,[i(b,{type:"dollar",value:g.debtReduction/10**18,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Na,[i(b,{type:"dollar",value:g.collateralFreed/10**18,precision:2,"show-symbol":!1},null,8,["value"]),N(" "+w(t.pair.tokenCollateral.symbol),1)]),_("div",Aa,[i(b,{type:"dollar",value:g.protocolFee/10**18,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Ea,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${g.txHash}`,onClick:n[1]||(n[1]=D(()=>{},["stop"]))},w(s(r)(g.blockTime.getUTCTimestamp())),9,Va)])]),_:1},8,["rows"])):t.loading?$("",!0):(d(),v(k,{key:1,message:"There are no redemptions"}))]),_:1})}}}),xa=T(Ha,[["__scopeId","data-v-bbc74a72"]]),Ua={class:"dashboard-grid"},Oa=C({__name:"Redemptions",props:{pair:{}},setup(e){const o=X(1),{isFetching:c,data:l}=Je(q(()=>({pair_id:e.pair.pairId,page:o.value,per_page:15})));return(p,a)=>{var r,t;return d(),F("div",Ua,[i(xa,{redemptions:((r=s(l))==null?void 0:r.events)??[],count:((t=s(l))==null?void 0:t.count)??0,loading:s(c),pair:p.pair,onPage:a[0]||(a[0]=n=>o.value=n)},null,8,["redemptions","count","loading","pair"])])}}}),Ka=T(Oa,[["__scopeId","data-v-eda307c4"]]),Wa={class:"dashboard"},za=C({__name:"Pair.page",setup(e){const o=oe("protocolName"),c=oe("pairId",void 0,{transform:Number}),{isFetching:l,data:p}=ye(q(()=>({chain:"ethereum",protocol_name:o.value})),q(()=>!!o.value)),a=q(()=>(p.value??[]).find(u=>u.pairId===c.value)),{crumbs:r}=ve(fe());E(a,u=>{r.value=[{id:"protocols",label:"Protocols",pathName:"protocols",params:()=>({protocolName:o.value})},{id:"protocol",label:o.value,pathName:"protocols",params:()=>({protocolName:o.value})},{id:"pair",label:`Pair: ${u!=null&&u.name?ke(u.name):"?"}`}]},{immediate:!0});const{tabActive:t,tabActiveIndex:n}=$e(["overview","collateral","redemptions","liquidations","health"],"pair",void 0,{tabParamName:"pairTab"});return(u,b)=>{const P=be,k=me,R=ge;return d(),F("div",Wa,[i(P,{loading:s(l)},null,8,["loading"]),!s(l)&&s(a)?(d(),v(R,{key:0,active:s(n),onTab:b[0]||(b[0]=g=>n.value=g.index)},{default:h(()=>[i(k,{header:"Overview"},{default:h(()=>[(d(),v(L,null,[s(t)==="overview"?(d(),v(Da,{key:0,pair:s(a)},null,8,["pair"])):$("",!0)],1024))]),_:1}),i(k,{header:"Collateral"},{default:h(()=>[(d(),v(L,null,[s(t)==="collateral"?(d(),v(na,{key:0,pair:s(a)},null,8,["pair"])):$("",!0)],1024))]),_:1}),i(k,{header:"Redemptions"},{default:h(()=>[(d(),v(L,null,[s(t)==="redemptions"?(d(),v(Ka,{key:0,pair:s(a)},null,8,["pair"])):$("",!0)],1024))]),_:1}),i(k,{header:"Liquidation"},{default:h(()=>[(d(),v(L,null,[s(t)==="liquidations"?(d(),v(ka,{key:0,pair:s(a)},null,8,["pair"])):$("",!0)],1024))]),_:1}),i(k,{header:"Health"},{default:h(()=>[(d(),v(L,null,[s(t)==="health"?(d(),v(ca,{key:0,pair:s(a)},null,8,["pair"])):$("",!0)],1024))]),_:1})]),_:1},8,["active"])):$("",!0)])}}}),lt=T(za,[["__scopeId","data-v-9fb4fef3"]]);export{lt as default};
