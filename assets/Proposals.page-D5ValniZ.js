import{m as ae,at as M,d as m,au as ne,c as _,b as g,o as u,f as o,aQ as A,aS as L,u as a,ak as b,g as f,aq as N,e as n,_ as y,ae as I,q as le,ay as E,i as D,aD as z,aT as K,w as $,j as k,aR as Y,aH as re,ao as pe,E as ce,h as ie,al as de,aa as ue,ar as _e}from"./index-Ci__0x6w.js";import{a as ve,_ as he}from"./UsePagination-DPOOP3UB.js";import{_ as ge}from"./InputText-B8ExCJQ6.js";import{_ as me,a as fe}from"./TabItem.vue_vue_type_script_setup_true_lang-B1PPBc_Z.js";import{_ as ye}from"./DashboardHeader-B9DjZVb_.js";import{a as U,f as j,_ as W}from"./fetch-DRLrqTU_.js";import{_ as O,o as C,s as h,n as v,a as q,t as Q,p as G,j as be,g as J}from"./timestamp-D2Yelcgj.js";import{u as X}from"./Number-BVeBD89l.js";import{p as Z}from"./Pagination-vgbH7lYO.js";import{_ as F}from"./KPI-DZVNiHl0.js";import"./Tooltip-CMs6kQZ9.js";/**
 * @license lucide-vue-next v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=ae("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),we=O(["all","active","failed","cancelled","executed","executable"]),xe=C({index:v(),target:h(),calldata:h(),decoded_calldata:h()}).transform(e=>({index:e.index,target:e.target,calldata:e.calldata,decodedCalldata:e.decoded_calldata})),Ce=C({proposal_id:v(),on_chain_id:v(),creator:h(),creator_ens:h().nullable(),creator_label:h().nullable(),status:we,epoch:v(),created_at:v(),quorum_weight:v(),execution_tx:h().nullable(),cancellation_tx:h().nullable(),actions:q(xe),weight_yes:v(),weight_no:v(),voters_count:v(),creation_tx_hash:h()}).transform(e=>({proposalId:e.proposal_id,onChainId:e.on_chain_id,creator:e.creator,creatorEns:e.creator_ens,creatorLabel:e.creator_label,status:e.status,epoch:e.epoch,createdAt:Q(e.created_at),quorumWeight:e.quorum_weight,executionTx:e.execution_tx,cancellationTx:e.cancellation_tx,actions:e.actions,weightYes:e.weight_yes,weightNo:e.weight_no,votersCount:e.voters_count,creationTxHash:e.creation_tx_hash})),Pe=C({proposals:q(Ce),page:v(),count:v()}).transform(e=>({proposals:e.proposals,page:e.page,count:e.count})),ke=C({voter:h(),voter_ens:h().nullable(),voter_label:h().nullable(),weight_yes:v(),weight_no:v(),tx_hash:h(),timestamp:v()}).transform(e=>({voter:e.voter,voterEns:e.voter_ens,voterLabel:e.voter_label,weightYes:e.weight_yes,weightNo:e.weight_no,txHash:e.tx_hash,time:Q(e.timestamp)})),Se=C({votes:q(ke),total_votes:v()}).transform(e=>({votes:e.votes,totalVotes:e.total_votes})),Ve=C({search_string:h().optional(),order_by:O(["created_at","creator","voters_count"]).optional(),...G});async function Ie(e,t){const l=J(),d=Ve.parse(e),c=U(d),s=await j(`${l}/v1/dao/proposals${c}`,void 0,t==null?void 0:t.signal);return Pe.parse(s)}const Te=C({...be,...G});async function De(e,t){const l=J(),{proposal_id:d,...c}=Te.parse(e),s=U(c),r=await j(`${l}/v1/dao/proposals/${d}/votes${s}`,void 0,t==null?void 0:t.signal);return Se.parse(r)}function Ae(e){return X({queryKey:["dao-proposals",e],queryFn:()=>Z((l,d)=>Ie({...M(e),page:l,per_page:d}).then(c=>c.proposals),1,100)})}function Le(e){return X({queryKey:["dao-proposal-votes",e],queryFn:()=>Z((l,d)=>De({...M(e),page:l,per_page:d}).then(c=>c.votes),1,100)})}const Ne={class:"voters"},Ee={class:"for"},qe={class:"address"},Fe=["href"],He={class:"amount"},Re={class:"percentage"},Ye={class:"against"},Be={class:"percentage"},Me={class:"amount"},ze={class:"address"},Ke=["href"],Ue=m({__name:"Voters",props:{proposal:{},votes:{}},setup(e){const{address:t}=ne(),l=_(()=>e.votes?e.votes.filter(s=>s.weightYes).orderBy(s=>s.weightYes,"desc"):null),d=_(()=>e.votes?e.votes.filter(s=>s.weightNo).orderBy(s=>s.weightNo,"desc"):null),c=s=>s===t.value;return(s,r)=>{const p=W;return u(),g("div",Ne,[o("div",Ee,[r[0]||(r[0]=o("div",{class:"title"},"For",-1)),(u(!0),g(A,null,L(a(l),i=>(u(),g("div",{key:i.voter,class:"vote font-mono"},[o("div",qe,[o("a",{target:"_blank",href:`https://etherscan.io/address/${i.voter}`,class:b({you:c(i.voter)})},f(i.voterEns||("addressShort"in s?s.addressShort:a(N))(i.voter)),11,Fe)]),o("div",He,[n(p,{type:"dollar",value:i.weightYes,precision:2,"show-symbol":!1},null,8,["value"])]),o("div",Re,[n(p,{type:"percentage",value:i.weightYes/s.proposal.weightYes*100,precision:0},null,8,["value"])])]))),128))]),o("div",Ye,[r[1]||(r[1]=o("div",{class:"title"},"Against",-1)),(u(!0),g(A,null,L(a(d),i=>(u(),g("div",{key:i.voter,class:"vote font-mono"},[o("div",Be,[n(p,{type:"percentage",value:i.weightNo/s.proposal.weightNo*100,precision:0},null,8,["value"])]),o("div",Me,[n(p,{type:"dollar",value:i.weightNo,precision:2,"show-symbol":!1},null,8,["value"])]),o("div",ze,[o("a",{target:"_blank",href:`https://etherscan.io/address/${i.voter}`,class:b({you:c(i.voter)})},f(i.voterEns||("addressShort"in s?s.addressShort:a(N))(i.voter)),11,Ke)])]))),128))])])}}}),je=y(Ue,[["__scopeId","data-v-c5d03c10"]]),We={class:"technicals"},Oe={class:"technical"},Qe={class:"technical"},Ge=["href"],Je={key:0,class:"technical"},Xe=["href"],Ze={class:"technical"},es=["innerHTML"],ss=m({__name:"Technicals",props:{proposal:{},votes:{}},setup(e){const t=I(!0),l=I(e.proposal.votersCount>0),d=_(()=>e.votes.uniqWith((s,r)=>s.voter===r.voter).length),c=_(()=>e.proposal.actions.reduce((s,r)=>s+r.decodedCalldata,"").replace(/(?:\r\n|\r|\n)/g,"<br>").replace("/├/g","├").replace("/─/g","─").replace(/0x[a-fA-F0-9]{40}/g,s=>/[A-F]/g.test(s)&&le(s)?`<a target='_blank' href='https://etherscan.io/address/${s}'>${s}</a>`:s));return(s,r)=>{var w;const p=z,i=K;return u(),g("div",We,[r[5]||(r[5]=o("div",{class:"technical"},[o("div",{class:"heading"},"Description"),o("div",{class:"description"},"DESCRIPTION TODO")],-1)),o("div",Oe,[o("div",{class:"heading",onClick:r[0]||(r[0]=S=>l.value=!a(l))},[D(" Voters ("+f(a(d)??"?")+") ",1),n(p,{class:b(["expander",{expandedVoters:a(l)}])},null,8,["class"])]),n(i,{expanded:a(l)},{default:$(()=>[s.proposal?(u(),k(je,{key:0,class:"voters",proposal:s.proposal,votes:s.votes},null,8,["proposal","votes"])):E("",!0)]),_:1},8,["expanded"])]),o("div",Qe,[r[2]||(r[2]=o("div",{class:"heading"},"Creation transaction",-1)),o("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.creationTxHash}`},f(s.proposal.creationTxHash),9,Ge)]),(w=s.proposal)!=null&&w.executionTx?(u(),g("div",Je,[r[3]||(r[3]=o("div",{class:"heading"},"Execution transaction",-1)),o("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.executionTx}`},f(s.proposal.executionTx),9,Xe)])):E("",!0),o("div",Ze,[o("div",{class:"heading",onClick:r[1]||(r[1]=S=>t.value=!a(t))},[r[4]||(r[4]=D(" Calldata ")),n(p,{class:b(["expander",{expandedCallData:a(t)}])},null,8,["class"])]),n(i,{expanded:a(t)},{default:$(()=>[o("div",{class:"calldata font-mono",innerHTML:a(c)},null,8,es)]),_:1},8,["expanded"])])])}}}),os=y(ss,[["__scopeId","data-v-e295b27a"]]),ts={class:"results"},as={class:"choice"},ns={class:"amount"},ls={class:"left"},rs={class:"right"},ps={class:"choice"},cs={class:"amount"},is={class:"left"},ds={class:"right"},B=4,us=m({__name:"VotingResults",props:{votes:{}},setup(e){const t=_(()=>e.votes.reduce((r,p)=>r+p.weightYes,0)),l=_(()=>e.votes.reduce((r,p)=>r+p.weightNo,0)),d=_(()=>t.value+l.value),c=_(()=>t.value/d.value*100),s=_(()=>l.value/d.value*100);return(r,p)=>{const i=W;return u(),g("div",ts,[p[8]||(p[8]=o("div",{class:"heading"},"Results",-1)),o("div",as,[p[3]||(p[3]=o("div",{class:"label"},"For",-1)),o("div",ns,[o("div",ls,[n(i,{"show-zero":"",type:"dollar",value:a(t),precision:0,"show-symbol":!1},null,8,["value"]),p[0]||(p[0]=o("span",null," veCRV",-1))]),o("div",rs,[p[1]||(p[1]=o("span",null,"(",-1)),n(i,{"show-zero":"",type:"percentage",value:a(c),precision:2},null,8,["value"]),p[2]||(p[2]=o("span",null,")",-1))])]),o("div",{class:"bar",style:Y({width:`${Math.max(B,a(c))}%`})},null,4)]),o("div",ps,[p[7]||(p[7]=o("div",{class:"label"},"Against",-1)),o("div",cs,[o("div",is,[n(i,{"show-zero":"",type:"dollar",value:a(l),precision:0,"show-symbol":!1},null,8,["value"]),p[4]||(p[4]=o("span",null," veCRV",-1))]),o("div",ds,[p[5]||(p[5]=o("span",null,"(",-1)),n(i,{"show-zero":"",type:"percentage",value:a(s),precision:2},null,8,["value"]),p[6]||(p[6]=o("span",null,")",-1))])]),o("div",{class:"bar",style:Y({width:`${Math.max(B,a(s))}%`})},null,4)])])}}}),_s=y(us,[["__scopeId","data-v-f01664c7"]]),vs={class:"voting"},hs=m({__name:"Voting",props:{votes:{}},setup(e){return(t,l)=>(u(),g("div",vs,[n(_s,{votes:t.votes},null,8,["votes"])]))}}),gs=y(hs,[["__scopeId","data-v-214162ab"]]),ms={class:"proposal-details"},fs={class:"proposal-details-container"},ys=m({__name:"ProposalDetails",props:{proposal:{}},setup(e){const{data:t}=Le({proposal_id:e.proposal.proposalId});return(l,d)=>(u(),g("div",ms,[o("div",fs,[n(os,{proposal:l.proposal,votes:a(t)??[]},null,8,["proposal","votes"]),n(gs,{votes:a(t)??[]},null,8,["votes"])])]))}}),bs=y(ys,[["__scopeId","data-v-413585ab"]]),$s=m({__name:"Date",props:{proposal:{}},setup(e){const t=_(()=>e.proposal.createdAt.toLocaleDateString()+e.proposal.createdAt.toTimeString());return(l,d)=>{const c=F;return u(),k(c,{"has-value":"",class:"date","tooltip-type":"underline",label:"Start",value:l.proposal.createdAt.toLocaleDateString(),tooltip:a(t)},null,8,["value","tooltip"])}}}),ws=["href"],xs=m({__name:"Proposer",props:{proposal:{}},setup(e){return(t,l)=>{const d=F;return u(),k(d,{"has-value":"",class:"proposer",label:"Proposer"},{default:$(()=>[o("a",{target:"_blank",href:`https://etherscan.io/address/${t.proposal.creator}`},f(t.proposal.creatorEns||("addressShort"in t?t.addressShort:a(N))(t.proposal.creator)),9,ws)]),_:1})}}}),Cs=m({__name:"Status",props:{proposal:{}},setup(e){const t=_(()=>{switch(e.proposal.status){case"active":return"Active";case"failed":return"Failed";case"cancelled":return"Cancelled";case"executable":return"Executable";case"executed":return"Executed";case"all":return"All";default:return"Unk. Status"}});return(l,d)=>{const c=F;return u(),k(c,{"has-value":"",class:"status","tooltip-type":"underline",label:"Status"},{default:$(()=>[o("span",{class:b(["status-value",l.proposal.status])},f(a(t)),3)]),_:1})}}}),Ps=y(Cs,[["__scopeId","data-v-39bb27db"]]),ks={class:"row"},Ss=m({__name:"ProposalSummary",props:{proposal:{},expanded:{type:Boolean}},emits:["toggleExpand"],setup(e,{emit:t}){const l=t,d=_(()=>`/dao/proposal/${e.proposal.proposalId}`),c=async()=>{await navigator.clipboard.writeText(`${window.location.origin}/dao/proposal/${e.proposal.proposalId}`),ce({text:`Copied url for proposal ${e.proposal.proposalId}`,type:"success"})};return(s,r)=>{const p=$e,i=re("router-link"),w=z;return u(),g("div",{class:"proposal-summary",onClick:r[0]||(r[0]=S=>l("toggleExpand"))},[o("div",{class:b(["title",{"no-title":s.proposal.creatorLabel}])},[o("span",{class:"id",onClick:pe(c,["stop"])},[n(p),D(" "+f(s.proposal.proposalId),1)]),n(i,{class:"metadata",to:a(d)},{default:$(()=>[D(f(s.proposal.creatorLabel||"< No Title >"),1)]),_:1},8,["to"])],2),o("div",ks,[n(Ps,{class:"item",proposal:s.proposal},null,8,["proposal"]),n(xs,{class:"item",proposal:s.proposal},null,8,["proposal"]),n($s,{class:"item",type:"start",proposal:s.proposal},null,8,["proposal"]),o("div",{class:b(["item expander",{expanded:s.expanded}])},[n(w)],2)])])}}}),Vs=y(Ss,[["__scopeId","data-v-21defc45"]]),Is=m({__name:"Proposal",props:{proposal:{},initExpanded:{type:Boolean,default:!1}},setup(e){const t=I(e.initExpanded);return(l,d)=>{const c=K,s=ie;return u(),k(s,{compact:"",class:"proposal"},{default:$(()=>[n(Vs,{proposal:l.proposal,expanded:a(t),onToggleExpand:d[0]||(d[0]=r=>t.value=!a(t))},null,8,["proposal","expanded"]),n(c,{class:"proposal-details-collapsible",expanded:a(t)},{default:$(()=>[n(bs,{proposal:l.proposal,expanded:a(t)},null,8,["proposal","expanded"])]),_:1},8,["expanded"])]),_:1})}}}),Ts=y(Is,[["__scopeId","data-v-9a8a8fe5"]]),Ds={class:"dashboard"},As={class:"filters"},Ls={class:"proposals-content"},Ns={key:0},Es=m({__name:"Proposals.page",setup(e){const t=I(0),{page:l,onPage:d}=ve(),c=I(""),s=de(c,300),r=_(()=>{switch(t.value){case 0:return"all";case 1:return"active";case 2:return"executable";case 3:return"failed";case 4:return"executed";default:return"all"}}),p=_(()=>s.value.toLocaleLowerCase()),{isFetching:i,data:w}=Ae(_(()=>({search_string:p.value}))),S=_(()=>{var x;return((x=w.value)==null?void 0:x.length)??0}),H=_(()=>(w.value??[]).filter(x=>x.status===r.value).orderBy(x=>x.createdAt.getDate(),"desc"));return(x,T)=>{const ee=ye,V=me,se=fe,oe=ge,R=he,te=_e;return u(),g("div",Ds,[n(ee,{title:"Governance proposals",description:"View and search for governance proposals"}),n(se,{onTab:T[0]||(T[0]=P=>t.value=P.index)},{default:$(()=>[n(V,{header:"All"}),n(V,{header:"Active"}),n(V,{header:"Passed"}),n(V,{header:"Denied"}),n(V,{header:"Executed"})]),_:1}),o("div",As,[n(oe,{modelValue:a(c),"onUpdate:modelValue":T[1]||(T[1]=P=>ue(c)?c.value=P:null),search:"",style:{"flex-grow":"1"},placeholder:"Search for Curve proposals"},null,8,["modelValue"]),n(R,{class:"pagination","items-count":a(S),"items-per-page":10,page:a(l),onPage:a(d)},null,8,["items-count","page","onPage"])]),o("div",Ls,[(u(!0),g(A,null,L(a(H),P=>(u(),k(Ts,{key:P.proposalId,class:b(["loading-backdrop",{loading:a(i)}]),proposal:P},null,8,["proposal","class"]))),128)),n(R,{class:"pagination","items-count":a(S),"items-per-page":10,page:a(l),onPage:a(d)},null,8,["items-count","page","onPage"]),a(H).length===0?(u(),g("div",Ns,"No proposals could be found.")):E("",!0),n(te,{loading:a(i)},null,8,["loading"])])])}}}),Ws=y(Es,[["__scopeId","data-v-bccad0aa"]]);export{Ws as default};
