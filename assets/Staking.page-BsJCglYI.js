import{aJ as he,am as C,d as S,u as G,a as X,c as w,w as Y,b as T,o as $,e as y,f as _,g as p,h as o,_ as H,l as I,t as E,aw as B,m as R,ao as N,at as ve,av as fe,ar as ye,ai as be,j as ke,n as we}from"./index-CAAcd5HQ.js";import{_ as $e}from"./ChartBalances-CZB9I9XP.js";import{_ as Te}from"./DashboardHeader-DDQDLY3B.js";import{u as Z,c as ee,a as te,_ as se,b as Pe,J as Fe,r as Ue,d as Ce,D as Se}from"./UseLightweightChart-DfxaIZIP.js";import{o as d,s as r,n as m,_ as He,t as U,b as P,k as ae,l as F,g as D,d as W,f as q,p as O,e as J,v as De,a as A,j as oe,r as L,u as K}from"./timestamp-CP_Pnh_7.js";import{p as ne}from"./Pagination-vgbH7lYO.js";import{_ as re}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-B4Ulr9Xf.js";import{_ as qe}from"./ChartApex-D0jnfpcK.js";import{c as Ae}from"./ChartStylesApex-CGq_iNIF.js";import{_ as j}from"./Table-UUN3-BTX.js";import{_ as z}from"./AsyncValue-CuG9W6iU.js";import{u as Re,_ as le,a as Ve}from"./UsePagination-CaAAD63s.js";import{u as ie}from"./UseRelativeTime-C9SpbJdi.js";import"./Tooltip-B99sykfX.js";const xe=d({event_type:He(["stake","unstake"]),block_timestamp:m(),tx_hash:r(),block_number:m(),amount:r(),amount_usd:r(),account:ae}).transform(e=>({eventType:e.event_type,blockTime:U(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,amount:parseFloat(e.amount),amountUsd:parseFloat(e.amount_usd),account:e.account})),Ee=d({events:P(xe),count:m(),page:m(),total_pages:m()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Be=d({account:ae,amount:r(),amount_usd:r(),end_timestamp:m(),block_timestamp:m(),tx_hash:r()}).transform(e=>({account:e.account,amount:parseFloat(e.amount),amountUsd:parseFloat(e.amount_usd),end:U(e.end_timestamp),blockTime:U(e.block_timestamp),txHash:e.tx_hash})),Le=d({entries:P(Be)}).transform(e=>({entries:e.entries})),Ie=d({timestamp:m(),token_address:r(),token_symbol:r(),apr:r()}).transform(e=>({timestamp:U(e.timestamp),tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),We=d({snapshots:P(Ie),count:m(),page:m(),total_pages:m()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),Qe=d({timestamp:m(),tvl:r(),tvl_usd:r()}).transform(e=>({timestamp:U(e.timestamp),tvl:parseFloat(e.tvl),tvlUsd:parseFloat(e.tvl_usd)})),Ke=d({data:P(Qe),count:m(),page:m(),total_pages:m()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),Oe=d({address:r(),label:r().nullable(),ens:r().nullable(),position_value:r(),position_value_usd:r()}).transform(e=>({address:e.address,label:e.label,ens:e.ens,positionValue:parseFloat(e.position_value),positionValueUsd:parseFloat(e.position_value_usd)})),Je=d({total_tvl:r(),total_tvl_usd:r(),top_users_tvl:r(),top_users_tvl_usd:r(),others_tvl:r(),others_tvl_usd:r(),users:P(Oe)}).transform(e=>({totalTvl:parseFloat(e.total_tvl),totalTvlUsd:parseFloat(e.total_tvl_usd),topUsersTvl:parseFloat(e.top_users_tvl),topUsersTvlUsd:parseFloat(e.top_users_tvl_usd),othersTvl:parseFloat(e.others_tvl),othersTvlUsd:parseFloat(e.others_tvl_usd),users:e.users})),Ne=d({min_value_usd:r(),max_value_usd:r(),count:m()}).transform(e=>({minValueUsd:parseFloat(e.min_value_usd),maxValueUsd:parseFloat(e.max_value_usd),count:e.count})),je=d({bins:P(Ne),total_users:m()}).transform(e=>({bins:e.bins,totalUsers:e.total_users})),ze=d({epoch:m(),timestamp:m(),weight:r(),relative_weight:r()}).transform(e=>({epoch:e.epoch,timestamp:U(e.timestamp),weight:parseFloat(e.weight),weightRelative:parseFloat(e.relative_weight)}));d({address:r(),weights:P(ze)}).transform(e=>({adress:e.address,weights:e.weights}));const Me=d({timestamp:m(),total_staked:r(),cooldown_amount:r(),cooldown_percentage:r(),regular_staked_amount:r(),regular_staked_percentage:r(),perma_staked_amount:r(),perma_staked_percentage:r(),cooldown_percentage_excluding_perma:r(),regular_staked_percentage_excluding_perma:r()}).transform(e=>({timestamp:U(e.timestamp),totalStaked:parseFloat(e.total_staked),cooldownAmount:parseFloat(e.cooldown_amount),cooldownPercentage:parseFloat(e.cooldown_percentage),regularStakedAmount:parseFloat(e.regular_staked_amount),regularStakedPercentage:parseFloat(e.regular_staked_percentage),permaStakedAmount:parseFloat(e.perma_staked_amount),permaStakedPercentage:parseFloat(e.perma_staked_percentage),cooldownPercentageExcludingPerma:parseFloat(e.cooldown_percentage_excluding_perma),regularStakedPercentageExcludingPerma:parseFloat(e.regular_staked_percentage_excluding_perma)})),Ge=d({data:P(Me),count:m(),page:m(),total_pages:m()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),Xe=d({...F,...J,...O});async function Ye(e,s){const l=D(s),{chain:n,...t}=Xe.parse(e),i=W(t),a=await q(`${l}/v1/staking/${n}/events${i}`,void 0,s?.signal);return Ee.parse(a)}const Ze=d(F);async function et(e,s){const l=D(s),{chain:n}=Ze.parse(e),t=await q(`${l}/v1/staking/${n}/cooldown_queue`,void 0,s?.signal);return Le.parse(t)}const tt=d({...F,...J,...O});async function st(e,s){const l=D(s),{chain:n,...t}=tt.parse(e),i=W(t),a=await q(`${l}/v1/staking/${n}/apr_history${i}`,void 0,s?.signal);return We.parse(a)}const at=d({...F,...J,...O});async function ot(e,s){const l=D(s),{chain:n,...t}=at.parse(e),i=W(t),a=await q(`${l}/v1/staking/${n}/tvl_history${i}`,void 0,s?.signal);return Ke.parse(a)}const nt=d(F);async function rt(e,s){const l=D(s),{chain:n}=nt.parse(e),t=await q(`${l}/v1/staking/${n}/top_users`,void 0,s?.signal);return Je.parse(t)}const lt=d({...F,bin_count:m().int().positive().optional()});async function it(e,s){const l=D(s),{chain:n,...t}=lt.parse(e),i=W(t),a=await q(`${l}/v1/staking/${n}/position_histogram${i}`,void 0,s?.signal);return je.parse(a)}d({...F,...De});const ct=d({...F,...J,...O});async function ut(e,s){const l=D(s),{chain:n,...t}=ct.parse(e),i=W(t),a=await q(`${l}/v1/staking/${n}/distribution_history${i}`,void 0,s?.signal);return Ge.parse(a)}function pt(e){return A({queryKey:["staking-events",e],queryFn:()=>Ye(C(e)),placeholderData:he})}function mt(e){return A({queryKey:["staking-cooldown-queue",e],queryFn:()=>et(C(e))})}function dt(e){const{start:s,end:l}=oe({daysRange:90});return A({queryKey:["staking-apr-history",e],queryFn:()=>ne((t,i)=>st({...C(e),page:t,per_page:i,start:s,end:l}).then(a=>a.snapshots),1,100)})}function _t(e){const{start:s,end:l}=oe({daysRange:90});return A({queryKey:["staking-tvl-history",e],queryFn:()=>ne((t,i)=>ot({...C(e),page:t,per_page:i,start:s,end:l}).then(a=>a.data),1,100)})}function gt(e){return A({queryKey:["staking-top-users",e],queryFn:()=>rt(C(e))})}function ht(e){return A({queryKey:["staking-position-hist",e],queryFn:()=>it(C(e))})}function vt(e){return A({queryKey:["staking-distribution-hist",e],queryFn:()=>ut(C(e))})}const ft={style:{display:"flex"}},yt={ref:"chartRef",class:"chart"},bt=S({__name:"ChartApr",props:{apr:{}},setup(e){const s=G(),l=X("card"),{chart:n,series:t}=Z({createChartOptions:te(),series:ee({name:"apr",color:w(()=>s.value.colors.blue),formatter:a=>`${L(a,0,"percentage")}%`,minMove:.01})});Y(i);function i(){if(!n.value||!t.apr)return;const a=e.apr.map(u=>({time:u.timestamp.getUTCTimestamp(),value:u.apr})).uniqWith((u,g)=>u.time===g.time).orderBy(u=>u.time,"asc");a.length>0&&t.apr.setData(a),n.value.timeScale().fitContent()}return(a,u)=>{const g=re,c=se,h=H;return $(),T(h,{ref_key:"card",ref:l,title:"APR"},{actions:y(()=>[_("div",ft,[p(g,{filename:"apr",series:o(t)},null,8,["series"]),p(c,{chart:o(n),target:o(l)},null,8,["chart","target"])])]),default:y(()=>[_("div",yt,null,512)]),_:1},512)}}}),kt=S({__name:"ChartPositions",props:{bins:{}},setup(e){const s=w(()=>Ae({chart:{type:"bar",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1}},xaxis:{categories:l.value,labels:{formatter:t=>t,rotate:-60},tickPlacement:"on"},yaxis:{labels:{formatter:t=>t}},plotOptions:{bar:{columnWidth:"50%"}},dataLabels:{enabled:!1},tooltip:{followCursor:!1,enabled:!0,intersect:!0,custom:t=>{const i=t.series[0][t.dataPointIndex];return`<div><b>Range</b>: ${l.value[t.dataPointIndex]}</div><div><b>Users</b>: ${i}</div>`}}})),l=w(()=>e.bins.map(t=>{const i=t.minValueUsd?`${L(t.minValueUsd,0,"dollar")}${K(t.minValueUsd)}`:"0",a=t.maxValueUsd?`${L(t.maxValueUsd,0,"dollar")}${K(t.maxValueUsd)}`:"0";return`${i} - ${a}`})),n=w(()=>[{name:"Users",data:e.bins.map(t=>t.count)}]);return(t,i)=>{const a=qe,u=H;return $(),T(u,{title:"User positions"},{default:y(()=>[p(a,{options:o(s),series:o(n)},null,8,["options","series"])]),_:1})}}}),wt=I(kt,[["__scopeId","data-v-791d1a3d"]]),$t={style:{display:"flex"}},Tt={ref:"chartRef",class:"chart"},Pt=S({__name:"ChartTvl",props:{tvl:{}},setup(e){const s=G(),{items:l,toggles:n,disabled:t}=Pe(()=>[{id:"rsup",label:"RSUP",color:s.value.colorsArray[0],togglable:!0},{id:"dollars",label:"Dollars",color:s.value.colorsArray[1],togglable:!0}]),i=X("card"),{chart:a,series:u}=Z({createChartOptions:te(),series:[ee({name:"rsup",color:w(()=>s.value.colors.blue),formatter:c=>`${L(c,1,"dollar")}${K(c)}`}),{type:Fe,name:"dollars",options:w(()=>({priceFormat:{type:"custom",formatter:c=>`$${L(c,1,"dollar")}${K(c)}`},lineWidth:2,lineType:Ue.WithSteps,color:s.value.colors.yellow,lastValueVisible:!1,priceLineVisible:!1}))}]});Y(g);function g(){!a.value||!u.rsup||!u.dollars||(u.rsup.setData(e.tvl.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.tvl})).uniqWith((c,h)=>c.time===h.time).orderBy(c=>c.time,"asc")),u.dollars.setData(e.tvl.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.tvlUsd})).uniqWith((c,h)=>c.time===h.time).orderBy(c=>c.time,"asc")),u.rsup.applyOptions({visible:n.rsup.value}),u.dollars.applyOptions({visible:n.dollars.value}),a.value.timeScale().fitContent())}return(c,h)=>{const v=re,V=se,x=Ce,f=H;return $(),T(f,{ref_key:"card",ref:i,title:"TVL"},{actions:y(()=>[_("div",$t,[p(v,{filename:"tvl",series:o(u)},null,8,["series"]),p(V,{chart:o(a),target:o(i)},null,8,["chart","target"])])]),"actions-secondary":y(()=>[p(x,{items:o(l),disabled:o(t),onToggle:h[0]||(h[0]=Q=>o(n)[Q].value=!o(n)[Q].value)},null,8,["items","disabled"])]),default:y(()=>[_("div",Tt,null,512)]),_:1},512)}}}),Ft=["href"],Ut={class:"end"},Ct={class:"end"},St={class:"end"},Ht=["href"],M=10,Dt=S({__name:"TableCooldowns",props:{cooldowns:{}},setup(e){const{page:s,rowsPage:l,onPage:n}=Re(E(()=>e.cooldowns),M),{relativeTime:t}=ie();return(i,a)=>{const u=le,g=z,c=j,h=H;return $(),T(h,{title:"Cooldown Queue"},{actions:y(()=>[p(u,{"items-count":i.cooldowns.length,"items-per-page":M,page:o(s),onPage:o(n)},null,8,["items-count","page","onPage"])]),default:y(()=>[p(c,{rows:o(l),columns:["User",{label:"RSUP",align:"end"},{label:"Dollars",align:"end"},{label:"Time",align:"end"}]},{row:y(({item:v})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${v.account.address}`,onClick:a[0]||(a[0]=B(()=>{},["stop"]))},R(v.account.ens||("addressShort"in i?i.addressShort:o(N))(v.account.address)),9,Ft)]),_("div",Ut,[p(g,{type:"dollar",value:v.amount,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Ct,[p(g,{type:"dollar",value:v.amountUsd,precision:2},null,8,["value"])]),_("div",St,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${v.txHash}`,onClick:a[1]||(a[1]=B(()=>{},["stop"]))},R(o(t)(v.end.getUTCTimestamp())),9,Ht)])]),_:1},8,["rows"])]),_:1})}}}),qt=I(Dt,[["__scopeId","data-v-6228b228"]]),At=["href"],Rt={class:"end"},Vt={class:"end"},xt={class:"end"},Et=["href"],Bt=S({__name:"TableEvents",props:{events:{},count:{}},emits:["page"],setup(e,{emit:s}){const l=s,{page:n,onPage:t}=Ve(),i=ve(n,200);fe(i,g=>{l("page",g)});const{relativeTime:a}=ie(),u=g=>{switch(g.eventType){case"stake":return"Stake";case"unstake":return"Unstake"}};return(g,c)=>{const h=le,v=z,V=j,x=H;return $(),T(x,{title:"Events"},{actions:y(()=>[p(h,{"items-count":g.count,"items-per-page":10,page:o(n),onPage:o(t)},null,8,["items-count","page","onPage"])]),default:y(()=>[p(V,{rows:g.events,columns:["Type","Owner",{label:"RSUP",align:"end"},{label:"Dollars",align:"end"},{label:"Time",align:"end"}]},{row:y(({item:f})=>[_("div",{class:ye({green:f.eventType==="stake",red:f.eventType==="unstake"})},R(u(f)),3),_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${f.account.address}`,onClick:c[0]||(c[0]=B(()=>{},["stop"]))},R(f.account.ens||("addressShort"in g?g.addressShort:o(N))(f.account.address)),9,At)]),_("div",Rt,[p(v,{type:"dollar",value:f.amount,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Vt,[p(v,{type:"dollar",value:f.amountUsd,precision:2},null,8,["value"])]),_("div",xt,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${f.txHash}`,onClick:c[1]||(c[1]=B(()=>{},["stop"]))},R(o(a)(f.blockTime.getUTCTimestamp())),9,Et)])]),_:1},8,["rows"])]),_:1})}}}),Lt=I(Bt,[["__scopeId","data-v-a959b9d4"]]),It=["href"],Wt={class:"end"},Qt={class:"end"},Kt=S({__name:"TableTopUsers",props:{topUsers:{}},setup(e){return(s,l)=>{const n=z,t=j,i=H;return $(),T(i,{title:"Top Users"},{default:y(()=>[p(t,{rows:s.topUsers,columns:["Address",{label:"RSUP",align:"end"},{label:"Dollars",align:"end"}]},{row:y(({item:a})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${a.address}`,onClick:l[0]||(l[0]=B(()=>{},["stop"]))},R(a.ens||("addressShort"in s?s.addressShort:o(N))(a.address)),9,It)]),_("div",Wt,[p(n,{type:"dollar",value:a.positionValue,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Qt,[p(n,{type:"dollar",value:a.positionValueUsd,precision:2},null,8,["value"])])]),_:1},8,["rows"])]),_:1})}}}),Ot=I(Kt,[["__scopeId","data-v-d5d8af2d"]]),Jt={class:"dashboard"},Nt=S({__name:"Staking.page",setup(e){const{isFetching:s,data:l}=dt({chain:"ethereum"}),n=w(()=>(l.value??[]).map(b=>({timestamp:b.timestamp,apr:b.apr}))),{isFetching:t,data:i}=_t({chain:"ethereum"}),a=w(()=>(i.value??[]).map(b=>({timestamp:b.timestamp,tvl:b.tvl,tvlUsd:b.tvlUsd}))),u=be(1),{isFetching:g,data:c}=pt(w(()=>({chain:"ethereum",page:u.value,per_page:10}))),{isFetching:h,data:v}=gt(E(()=>({chain:"ethereum"}))),{isFetching:V,data:x}=mt(E(()=>({chain:"ethereum"}))),{isFetching:f,data:Q}=ht(E(()=>({chain:"ethereum"}))),{isFetching:ce,data:ue}=vt(E(()=>({chain:"ethereum"}))),pe=w(()=>{const b=ue.value?.data??[];return b.length===0?[]:[{symbol:"In cooldown",balances:b.map(k=>({timestamp:k.timestamp,balance:k.cooldownAmount,tokenPrice:1}))},{symbol:"Regular staked",balances:b.map(k=>({timestamp:k.timestamp,balance:k.regularStakedAmount-k.cooldownAmount,tokenPrice:1}))},{symbol:"Perma staked",balances:b.map(k=>({timestamp:k.timestamp,balance:k.permaStakedAmount,tokenPrice:1}))}]});return(b,k)=>{const me=Te,de=$e,_e=H;return $(),ke("div",Jt,[p(me,{style:{"grid-area":"header"},title:"Staking",description:"User governance staking metrics (RSUP)"}),p(bt,{style:{"grid-area":"apr"},apr:o(n),loading:o(s)},null,8,["apr","loading"]),p(Pt,{style:{"grid-area":"tvl"},tvl:o(a),loading:o(t)},null,8,["tvl","loading"]),p(Lt,{style:{"grid-area":"events"},events:o(c)?.events??[],count:o(c)?.count??0,loading:o(g),onPage:k[0]||(k[0]=ge=>u.value=ge)},null,8,["events","count","loading"]),p(qt,{style:{"grid-area":"cooldowns"},cooldowns:o(x)?.entries??[],loading:o(V)},null,8,["cooldowns","loading"]),o(ce)?($(),T(_e,{key:1,loading:"",title:"Staked",style:we(`grid-area: chart-staked; min-height: ${o(Se)}`)},null,8,["style"])):($(),T(de,{key:0,style:{"grid-area":"chart-staked"},title:"Staked",balances:o(pe),"show-dollars":!1},null,8,["balances"])),p(Ot,{style:{"grid-area":"top-users"},"top-users":o(v)?.users??[],loading:o(h)},null,8,["top-users","loading"]),p(wt,{style:{"grid-area":"positions"},bins:o(Q)?.bins??[],loading:o(f)},null,8,["bins","loading"])])}}}),ls=I(Nt,[["__scopeId","data-v-76bf2ec1"]]);export{ls as default};
