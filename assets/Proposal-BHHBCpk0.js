import{r as O,am as L,d as m,al as X,c as h,j as g,o as u,f as t,aC as F,aT as H,h as i,ar as b,m as f,ao as V,g as d,l as y,ai as k,y as ee,an as R,k as S,aD as z,aY as K,e as x,b as C,n as T,aZ as se,aH as oe,aw as te,E as ae,_ as ne}from"./index-CUxH3Ppq.js";import{t as D,b as W,f as q,a as A}from"./timestamp-CJsqb-wj.js";import{d as Q,o as w,s as _,n as v,a as E,p as j,i as J,g as N,_ as M}from"./AsyncValue-D546ebjD.js";import{p as Z}from"./Pagination-vgbH7lYO.js";import{_ as Y}from"./KPI-CF_cXdi_.js";/**
 * @license lucide-vue-next v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=O("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),re=Q(["all","active","failed","cancelled","executed","executable"]),pe=w({index:v(),target:_(),calldata:_(),decoded_calldata:_()}).transform(e=>({index:e.index,target:e.target,calldata:e.calldata,decodedCalldata:e.decoded_calldata})),G=w({proposal_id:v(),on_chain_id:v(),description:_(),creator:_(),creator_ens:_().nullable(),creator_label:_().nullable(),status:re,epoch:v(),created_at:v(),quorum_weight:v(),execution_tx:_().nullable(),cancellation_tx:_().nullable(),actions:E(pe),weight_yes:v(),weight_no:v(),voters_count:v(),creation_tx_hash:_()}).transform(e=>({proposalId:e.proposal_id,onChainId:e.on_chain_id,description:e.description,creator:e.creator,creatorEns:e.creator_ens,creatorLabel:e.creator_label,status:e.status,epoch:e.epoch,createdAt:D(e.created_at),end:new Date(D(e.created_at).getTime()+7*24*60*60*1e3),quorumWeight:e.quorum_weight,executionTx:e.execution_tx,cancellationTx:e.cancellation_tx,actions:e.actions,weightYes:e.weight_yes,weightNo:e.weight_no,votersCount:e.voters_count,creationTxHash:e.creation_tx_hash})),ie=w({proposals:E(G),page:v(),count:v()}).transform(e=>({proposals:e.proposals,page:e.page,count:e.count})),ce=G,de=w({voter:_(),voter_ens:_().nullable(),voter_label:_().nullable(),weight_yes:v(),weight_no:v(),tx_hash:_(),timestamp:v()}).transform(e=>({voter:e.voter,voterEns:e.voter_ens,voterLabel:e.voter_label,weightYes:e.weight_yes,weightNo:e.weight_no,txHash:e.tx_hash,time:D(e.timestamp)})),ue=w({votes:E(de),total_votes:v()}).transform(e=>({votes:e.votes,totalVotes:e.total_votes})),ve=w({search_string:_().optional(),order_by:Q(["created_at","creator","voters_count"]).optional(),...j});async function _e(e,s){const a=N(s),n=ve.parse(e),p=W(n),o=await q(`${a}/v1/dao/proposals${p}`,void 0,s==null?void 0:s.signal);return ie.parse(o)}const he=w({...J});async function ge(e,s){const a=N(s),{proposal_id:n}=he.parse(e),p=await q(`${a}/v1/dao/proposals/${n}/details`,void 0,s==null?void 0:s.signal);return ce.parse(p)}const me=w({...J,...j});async function fe(e,s){const a=N(s),{proposal_id:n,...p}=me.parse(e),o=W(p),l=await q(`${a}/v1/dao/proposals/${n}/votes${o}`,void 0,s==null?void 0:s.signal);return ue.parse(l)}function Ts(e){return A({queryKey:["dao-proposals",e],queryFn:()=>Z((a,n)=>_e({...L(e),page:a,per_page:n}).then(p=>p.proposals),1,100)})}function Is(e){return A({queryKey:["dao-proposal",e],queryFn:()=>ge(L(e))})}function ye(e){return A({queryKey:["dao-proposal-votes",e],queryFn:()=>Z((a,n)=>fe({...L(e),page:a,per_page:n}).then(p=>p.votes),1,100)})}const $e={class:"voters"},we={class:"for"},be={class:"address"},xe=["href"],Se={class:"amount"},Ce={class:"percentage"},Pe={class:"against"},ke={class:"percentage"},Te={class:"amount"},Ie={class:"address"},Ve=["href"],De=m({__name:"Voters",props:{proposal:{},votes:{}},setup(e){const{address:s}=X(),a=h(()=>e.votes?e.votes.filter(o=>o.weightYes).orderBy(o=>o.weightYes,"desc"):null),n=h(()=>e.votes?e.votes.filter(o=>o.weightNo).orderBy(o=>o.weightNo,"desc"):null),p=o=>o===s.value;return(o,l)=>{const r=M;return u(),g("div",$e,[t("div",we,[l[0]||(l[0]=t("div",{class:"title"},"For",-1)),(u(!0),g(F,null,H(i(a),c=>(u(),g("div",{key:c.voter,class:"vote font-mono"},[t("div",be,[t("a",{target:"_blank",href:`https://etherscan.io/address/${c.voter}`,class:b({you:p(c.voter)})},f(c.voterEns||("addressShort"in o?o.addressShort:i(V))(c.voter)),11,xe)]),t("div",Se,[d(r,{type:"dollar",value:c.weightYes,precision:2,"show-symbol":!1},null,8,["value"])]),t("div",Ce,[d(r,{type:"percentage",value:c.weightYes/o.proposal.weightYes*100,precision:0},null,8,["value"])])]))),128))]),t("div",Pe,[l[1]||(l[1]=t("div",{class:"title"},"Against",-1)),(u(!0),g(F,null,H(i(n),c=>(u(),g("div",{key:c.voter,class:"vote font-mono"},[t("div",ke,[d(r,{type:"percentage",value:c.weightNo/o.proposal.weightNo*100,precision:0},null,8,["value"])]),t("div",Te,[d(r,{type:"dollar",value:c.weightNo,precision:2,"show-symbol":!1},null,8,["value"])]),t("div",Ie,[t("a",{target:"_blank",href:`https://etherscan.io/address/${c.voter}`,class:b({you:p(c.voter)})},f(c.voterEns||("addressShort"in o?o.addressShort:i(V))(c.voter)),11,Ve)])]))),128))])])}}}),Le=y(De,[["__scopeId","data-v-c5d03c10"]]),qe={class:"technicals"},Ae={class:"technical"},Ee={class:"description"},Ne={class:"technical"},Me={class:"technical"},Ye=["href"],Fe={key:0,class:"technical"},He=["href"],Re={class:"technical"},Be=["innerHTML"],Ue=m({__name:"Technicals",props:{proposal:{},votes:{}},setup(e){const s=k(!0),a=k(e.proposal.votersCount>0),n=h(()=>e.votes.uniqWith((o,l)=>o.voter===l.voter).length),p=h(()=>e.proposal.actions.reduce((o,l)=>o+l.decodedCalldata,"").replace(/(?:\r\n|\r|\n)/g,"<br>").replace("/├/g","├").replace("/─/g","─").replace(/0x[a-fA-F0-9]{40}/g,o=>/[A-F]/g.test(o)&&ee(o)?`<a target='_blank' href='https://etherscan.io/address/${o}'>${o}</a>`:o));return(o,l)=>{var $;const r=z,c=K;return u(),g("div",qe,[t("div",Ae,[l[2]||(l[2]=t("div",{class:"heading"},"Description",-1)),t("div",Ee,f(o.proposal.description),1)]),t("div",Ne,[t("div",{class:"heading",onClick:l[0]||(l[0]=P=>a.value=!i(a))},[S(" Voters ("+f(i(n)??"?")+") ",1),d(r,{class:b(["expander",{expandedVoters:i(a)}])},null,8,["class"])]),d(c,{expanded:i(a)},{default:x(()=>[o.proposal?(u(),C(Le,{key:0,class:"voters",proposal:o.proposal,votes:o.votes},null,8,["proposal","votes"])):R("",!0)]),_:1},8,["expanded"])]),t("div",Me,[l[3]||(l[3]=t("div",{class:"heading"},"Creation transaction",-1)),t("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${o.proposal.creationTxHash}`},f(o.proposal.creationTxHash),9,Ye)]),($=o.proposal)!=null&&$.executionTx?(u(),g("div",Fe,[l[4]||(l[4]=t("div",{class:"heading"},"Execution transaction",-1)),t("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${o.proposal.executionTx}`},f(o.proposal.executionTx),9,He)])):R("",!0),t("div",Re,[t("div",{class:"heading",onClick:l[1]||(l[1]=P=>s.value=!i(s))},[l[5]||(l[5]=S(" Calldata ")),d(r,{class:b(["expander",{expandedCallData:i(s)}])},null,8,["class"])]),d(c,{expanded:i(s)},{default:x(()=>[t("div",{class:"calldata font-mono",innerHTML:i(p)},null,8,Be)]),_:1},8,["expanded"])])])}}}),ze=y(Ue,[["__scopeId","data-v-1c5e1409"]]),Ke={class:"quorum"},We={class:"amount"},Qe={class:"bar"},je=m({__name:"VotingQuorum",props:{proposal:{}},setup(e){const s=h(()=>e.proposal.weightYes/e.proposal.quorumWeight*100);return(a,n)=>{const p=M;return u(),g("div",Ke,[n[2]||(n[2]=t("div",{class:"heading"},"Quorum",-1)),t("div",We,[d(p,{type:"dollar",value:a.proposal.weightYes,precision:0,"show-symbol":!1},null,8,["value"]),n[0]||(n[0]=S(" / ")),d(p,{type:"dollar",value:a.proposal.quorumWeight,precision:0,"show-symbol":!1},null,8,["value"]),n[1]||(n[1]=S(" RSUP "))]),t("div",Qe,[t("div",{class:"support",style:T({width:`${i(s)}%`})},null,4),t("div",{class:"quorum",style:T({width:`${100-i(s)}%`})},null,4)]),n[3]||(n[3]=t("div",{class:"percentages"},[t("div",null,"0%"),t("div",null,"100%")],-1))])}}}),Je=y(je,[["__scopeId","data-v-877e1212"]]),Ze={class:"results"},Ge={class:"choice"},Oe={class:"amount"},Xe={class:"left"},es={class:"right"},ss={class:"choice"},os={class:"amount"},ts={class:"left"},as={class:"right"},B=4,ns=m({__name:"VotingResults",props:{votes:{}},setup(e){const s=h(()=>e.votes.reduce((l,r)=>l+r.weightYes,0)),a=h(()=>e.votes.reduce((l,r)=>l+r.weightNo,0)),n=h(()=>s.value+a.value),p=h(()=>s.value/n.value*100),o=h(()=>a.value/n.value*100);return(l,r)=>{const c=M;return u(),g("div",Ze,[r[8]||(r[8]=t("div",{class:"heading"},"Results",-1)),t("div",Ge,[r[3]||(r[3]=t("div",{class:"label"},"For",-1)),t("div",Oe,[t("div",Xe,[d(c,{"show-zero":"",type:"dollar",value:i(s),precision:0,"show-symbol":!1},null,8,["value"]),r[0]||(r[0]=t("span",null," RSUP",-1))]),t("div",es,[r[1]||(r[1]=t("span",null,"(",-1)),d(c,{"show-zero":"",type:"percentage",value:i(p),precision:2},null,8,["value"]),r[2]||(r[2]=t("span",null,")",-1))])]),t("div",{class:"bar",style:T({width:`${Math.max(B,i(p))}%`})},null,4)]),t("div",ss,[r[7]||(r[7]=t("div",{class:"label"},"Against",-1)),t("div",os,[t("div",ts,[d(c,{"show-zero":"",type:"dollar",value:i(a),precision:0,"show-symbol":!1},null,8,["value"]),r[4]||(r[4]=t("span",null," RSUP",-1))]),t("div",as,[r[5]||(r[5]=t("span",null,"(",-1)),d(c,{"show-zero":"",type:"percentage",value:i(o),precision:2},null,8,["value"]),r[6]||(r[6]=t("span",null,")",-1))])]),t("div",{class:"bar",style:T({width:`${Math.max(B,i(o))}%`})},null,4)])])}}}),ls=y(ns,[["__scopeId","data-v-4d9c269d"]]),rs={class:"voting"},ps=m({__name:"Voting",props:{proposal:{},votes:{}},setup(e){return(s,a)=>(u(),g("div",rs,[d(ls,{votes:s.votes},null,8,["votes"]),d(Je,{proposal:s.proposal},null,8,["proposal"])]))}}),is=y(ps,[["__scopeId","data-v-10fc5a28"]]),cs={class:"proposal-details"},ds={class:"proposal-details-container"},us=m({__name:"ProposalDetails",props:{proposal:{}},setup(e){const{data:s}=ye({proposal_id:e.proposal.proposalId});return(a,n)=>(u(),g("div",cs,[t("div",ds,[d(ze,{proposal:a.proposal,votes:i(s)??[]},null,8,["proposal","votes"]),d(is,{proposal:a.proposal,votes:i(s)??[]},null,8,["proposal","votes"])])]))}}),vs=y(us,[["__scopeId","data-v-c1dddb5e"]]);function _s(e){function s(I){return I<10?"0"+I.toString():I.toString()}const a=e.getTime()-new Date().getTime();if(a<=0)return"00:00:00:00";const n=1e3,p=n*60,o=p*60,l=o*24,r=Math.floor(a/l),c=Math.floor(a%l/o),$=Math.floor(a%o/p),P=Math.floor(a%p/n);return s(r)+":"+s(c)+":"+s($)+":"+s(P)}const U=m({__name:"Date",props:{proposal:{},type:{}},setup(e){let s;const a=k(""),n=h(()=>{switch(e.type){case"start":return"Start";case"end":return"End";default:return"Unk. Type"}}),p=h(()=>{switch(e.type){case"start":return e.proposal.createdAt.toLocaleDateString();case"end":return e.proposal.end>new Date?a.value:e.proposal.end.toLocaleDateString();default:return new Date(0).toLocaleDateString()}}),o=h(()=>{switch(e.type){case"start":return`
        ${e.proposal.createdAt.toLocaleDateString()} ${e.proposal.createdAt.toTimeString()}
      `;case"end":return`
        ${e.proposal.end.toLocaleDateString()} ${e.proposal.end.toTimeString()}
      `;default:return new Date(0).toLocaleDateString()}});se(()=>{l()});const l=()=>{s&&clearInterval(s),s=setInterval(()=>{a.value=_s(e.proposal.end)})};return(r,c)=>{const $=Y;return u(),C($,{"has-value":"",class:"date","tooltip-type":"underline",label:i(n),value:i(p),tooltip:i(o)},null,8,["label","value","tooltip"])}}}),hs=["href"],gs=m({__name:"Proposer",props:{proposal:{}},setup(e){return(s,a)=>{const n=Y;return u(),C(n,{"has-value":"",class:"proposer",label:"Proposer"},{default:x(()=>[t("a",{target:"_blank",href:`https://etherscan.io/address/${s.proposal.creator}`},f(s.proposal.creatorEns||("addressShort"in s?s.addressShort:i(V))(s.proposal.creator)),9,hs)]),_:1})}}}),ms=m({__name:"Status",props:{proposal:{}},setup(e){const s=h(()=>{switch(e.proposal.status){case"active":return"Active";case"failed":return"Failed";case"cancelled":return"Cancelled";case"executable":return"Executable";case"executed":return"Executed";case"all":return"All";default:return"Unk. Status"}});return(a,n)=>{const p=Y;return u(),C(p,{"has-value":"",class:"status","tooltip-type":"underline",label:"Status"},{default:x(()=>[t("span",{class:b(["status-value",a.proposal.status])},f(i(s)),3)]),_:1})}}}),fs=y(ms,[["__scopeId","data-v-39bb27db"]]),ys={class:"row"},$s=m({__name:"ProposalSummary",props:{proposal:{},expanded:{type:Boolean}},emits:["toggleExpand"],setup(e,{emit:s}){const a=s,n=h(()=>`/dao/proposal/${e.proposal.proposalId}`),p=async()=>{await navigator.clipboard.writeText(`${window.location.origin}/dao/proposal/${e.proposal.proposalId}`),ae({text:`Copied url for proposal ${e.proposal.proposalId}`,type:"success"})};return(o,l)=>{const r=le,c=oe("router-link"),$=z;return u(),g("div",{class:"proposal-summary",onClick:l[0]||(l[0]=P=>a("toggleExpand"))},[t("div",{class:b(["title",{"no-title":o.proposal.creatorLabel}])},[t("span",{class:"id",onClick:te(p,["stop"])},[d(r),S(" "+f(o.proposal.proposalId),1)]),d(c,{class:"metadata",to:i(n)},{default:x(()=>[S(f(o.proposal.description||"< No Title >"),1)]),_:1},8,["to"])],2),t("div",ys,[d(fs,{class:"item",proposal:o.proposal},null,8,["proposal"]),d(gs,{class:"item",proposal:o.proposal},null,8,["proposal"]),d(U,{class:"item",type:"start",proposal:o.proposal},null,8,["proposal"]),d(U,{class:"item",type:"end",proposal:o.proposal},null,8,["proposal"]),t("div",{class:b(["item expander",{expanded:o.expanded}])},[d($)],2)])])}}}),ws=y($s,[["__scopeId","data-v-43ae8cb3"]]),bs=m({__name:"Proposal",props:{proposal:{},initExpanded:{type:Boolean,default:!1}},setup(e){const s=k(e.initExpanded);return(a,n)=>{const p=K,o=ne;return u(),C(o,{compact:"",class:"proposal"},{default:x(()=>[d(ws,{proposal:a.proposal,expanded:i(s),onToggleExpand:n[0]||(n[0]=l=>s.value=!i(s))},null,8,["proposal","expanded"]),d(p,{class:"proposal-details-collapsible",expanded:i(s)},{default:x(()=>[d(vs,{proposal:a.proposal,expanded:i(s)},null,8,["proposal","expanded"])]),_:1},8,["expanded"])]),_:1})}}}),Vs=y(bs,[["__scopeId","data-v-9a8a8fe5"]]);export{Vs as P,Is as a,Ts as u};
