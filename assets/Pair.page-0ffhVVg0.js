import{a as me,_ as ge}from"./TabItem.vue_vue_type_script_setup_true_lang-Bx_QDcjR.js";import{al as A,aI as J,d as C,as as G,au as E,b as v,o as d,_ as N,e as h,am as w,f as _,m as k,j as F,g as i,k as I,av as S,h as s,l as T,ah as X,c as q,an as M,u as se,a as ne,w as re,t as he,aE as ve,aF as be,ax as fe,aH as L}from"./index-B_NxFp7S.js";import{a as ye}from"./protocols--lANGk0s.js";import{a as oe,p as ke}from"./util-zN_K9CJt.js";import{t as V,b as H,f as U,a as x,g as $e,r as le,u as ie}from"./Number-BHD65MO0.js";import{d as we,o as y,s as m,a as B,n as b,e as Q,p as O,t as K,c as W,g as z,_ as j}from"./AsyncValue-DhIyIA2R.js";import{p as qe}from"./Pagination-vgbH7lYO.js";import{_ as Y}from"./NoData-PUjOPJJO.js";import{_ as Z}from"./Table-CJ5VQAMe.js";import{a as ee,_ as ae}from"./UsePagination-S9IasDbG.js";import{u as te}from"./UseRelativeTime-DV61XGDw.js";import{_ as Ce}from"./KPI-FcbaH0Vu.js";import{u as ce,c as pe,a as ue,_ as de}from"./UseLightweightChart-Bbfq5fOn.js";import{_ as _e}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-Sx3n9OCS.js";import{u as Te}from"./UseTabNavigation-DTX3mpG1.js";import"./Tooltip-DxrDaZQc.js";const Pe=we(["borrow","add_collateral","remove_collateral","repay","redeem","liquidate","leveraged_position","repay_with_collateral"]),Fe=y({token_address:m(),token_symbol:m(),apr:m()}).transform(e=>({tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),Re=y({date_timestamp:b(),total_collateral:m(),total_underlying:m(),exchange_rate:m(),total_debt:m(),active_positions_count:b(),borrow_limit:m(),utilization_rate:m(),interest_rate:m(),claimable_fees:m(),claimable_other_fees:m(),borrow_cost_apr:m(),base_apr:m(),rewards:B(Fe)}).transform(e=>({time:V(e.date_timestamp),totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),exchangeRate:parseFloat(e.exchange_rate),totalDebt:parseFloat(e.total_debt),activePositionsCount:e.active_positions_count,borrowLimit:parseFloat(e.borrow_limit),utilizationRate:parseFloat(e.utilization_rate),interestRate:parseFloat(e.interest_rate),claimableFees:parseFloat(e.claimable_fees),claimableOtherFees:parseFloat(e.claimable_other_fees),aprBorrowCost:parseFloat(e.borrow_cost_apr),aprBase:parseFloat(e.base_apr),rewards:e.rewards})),De=y({snapshots:B(Re),count:b(),page:b(),total_pages:b()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),Se=y({event_type:Pe,block_timestamp:b(),tx_hash:m(),block_number:b(),collateral_change:m(),debt_change:m()}).transform(e=>({eventType:e.event_type,blockTime:V(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,collateralChange:parseFloat(e.collateral_change),debtChange:parseFloat(e.debt_change)})),Le=y({events:B(Se),count:b(),page:b(),total_pages:b()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Ie=y({block_timestamp:b(),tx_hash:m(),block_number:b(),caller:Q,amount:m(),collateral_freed:m(),protocol_fee:m(),debt_reduction:m()}).transform(e=>({blockTime:V(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,caller:e.caller,amount:parseFloat(e.amount),collateralFreed:parseFloat(e.collateral_freed),protocolFee:parseFloat(e.protocol_fee),debtReduction:parseFloat(e.debt_reduction)})),Ne=y({events:B(Ie),count:b(),page:b(),total_pages:b()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Be=y({block_timestamp:b(),tx_hash:m(),block_number:b(),borrower:Q,liquidator:Q,collateral_for_liquidator:m(),shares_liquidated:m(),amount_liquidator_to_repay:m()}).transform(e=>({blockTime:V(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,borrower:e.borrower,liquidator:e.liquidator,collateralForLiquidator:parseFloat(e.collateral_for_liquidator),sharesLiquidated:parseFloat(e.shares_liquidated),amountLiquidatorToRepay:parseFloat(e.amount_liquidator_to_repay)})),Ae=y({events:B(Be),count:b(),page:b(),total_pages:b()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Ee=y({...W,...K,...O});async function Ve(e,o){const p=z(o),{pair_id:l,...u}=Ee.parse(e),a=H(u),r=await U(`${p}/v1/pairs/${l}/snapshots${a}`,void 0,o==null?void 0:o.signal);return De.parse(r)}const He=y({...W,...K,...O});async function Ue(e,o){const p=z(o),{pair_id:l,...u}=He.parse(e),a=H(u),r=await U(`${p}/v1/pairs/${l}/collateral_events${a}`,void 0,o==null?void 0:o.signal);return Le.parse(r)}const xe=y({...W,...K,...O});async function Oe(e,o){const p=z(o),{pair_id:l,...u}=xe.parse(e),a=H(u),r=await U(`${p}/v1/pairs/${l}/redemptions${a}`,void 0,o==null?void 0:o.signal);return Ne.parse(r)}const Ke=y({...W,...K,...O});async function We(e,o){const p=z(o),{pair_id:l,...u}=Ke.parse(e),a=H(u),r=await U(`${p}/v1/pairs/${l}/liquidations${a}`,void 0,o==null?void 0:o.signal);return Ae.parse(r)}function ze(e){const{start:o,end:p}=$e({daysRange:90});return x({queryKey:["pairs-snapshots",e],queryFn:()=>qe((u,a)=>Ve({...A(e),page:u,per_page:a,start:o,end:p}).then(r=>r.snapshots),1,100)})}function je(e){return x({queryKey:["pairs-collateral-events",e],queryFn:()=>Ue(A(e)),placeholderData:J})}function Me(e){return x({queryKey:["pairs-redemptions",e],queryFn:()=>Oe(A(e)),placeholderData:J})}function Qe(e){return x({queryKey:["pairs-liquidations",e],queryFn:()=>We(A(e)),placeholderData:J})}const Je={class:"end"},Ge={key:0,style:{display:"flex",gap:"1ch"}},Xe={class:"end"},Ye={key:0,style:{display:"flex",gap:"1ch"}},Ze={class:"end"},ea=["href"],aa=C({__name:"TableCollateralEvents",props:{events:{},count:{},pair:{},loading:{type:Boolean}},emits:["page"],setup(e,{emit:o}){const p=o,{page:l,onPage:u}=ee(),a=G(l,200);E(a,n=>{p("page",n)});const{relativeTime:r}=te(),t=n=>{switch(n.eventType){case"add_collateral":return"Add collateral";case"borrow":return"Borrow";case"remove_collateral":return"Remove collateral";case"repay":return"Repay";case"redeem":return"Redeem";case"liquidate":return"Liquidate";case"leveraged_position":return"Lev. position";case"repay_with_collateral":return"Repay with col"}};return(n,c)=>{const f=ae,P=j,$=Z,R=Y,g=N;return d(),v(g,{title:"Events"},{actions:h(()=>[i(f,{"items-count":n.count,"items-per-page":10,page:s(l),onPage:s(u)},null,8,["items-count","page","onPage"])]),default:h(()=>[e.events.length>0?(d(),v($,{key:0,rows:e.events,columns:["Type",{label:"Δ Debt",align:"end"},{label:"Δ Collateral",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:D})=>[_("div",null,k(t(D)),1),_("div",Je,[D.debtChange!==0?(d(),F("div",Ge,[i(P,{type:"dollar",value:D.debtChange/10**18,precision:2,"show-symbol":!1},null,8,["value"]),I(" "+k(n.pair.tokenDebt.symbol),1)])):w("",!0)]),_("div",Xe,[D.collateralChange!==0?(d(),F("div",Ye,[i(P,{type:"dollar",value:D.collateralChange/10**18,precision:2,"show-symbol":!1},null,8,["value"]),I(" "+k(n.pair.tokenCollateral.symbol),1)])):w("",!0)]),_("div",Ze,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${D.txHash}`,onClick:c[0]||(c[0]=S(()=>{},["stop"]))},k(s(r)(D.blockTime.getUTCTimestamp())),9,ea)])]),_:1},8,["rows"])):n.loading?w("",!0):(d(),v(R,{key:1,message:"There are no events"}))]),_:1})}}}),ta=T(aa,[["__scopeId","data-v-f018f232"]]),oa={class:"dashboard-grid"},sa=C({__name:"Collateral",props:{pair:{}},setup(e){const o=X(1),{isFetching:p,data:l}=je(q(()=>({pair_id:e.pair.pairId,page:o.value,per_page:15})));return(u,a)=>{var r,t;return d(),F("div",oa,[i(ta,{events:((r=s(l))==null?void 0:r.events)??[],count:((t=s(l))==null?void 0:t.count)??0,loading:s(p),pair:u.pair,onPage:a[0]||(a[0]=n=>o.value=n)},null,8,["events","count","loading","pair"])])}}}),na=T(sa,[["__scopeId","data-v-ff086716"]]),ra={},la={class:"dashboard-grid"};function ia(e,o){return d(),F("div",la,"Health goes here")}const ca=T(ra,[["render",ia],["__scopeId","data-v-f3492742"]]),pa=["href"],ua=["href"],da={class:"end"},_a={class:"end"},ma={class:"end"},ga={class:"end"},ha=["href"],va=C({__name:"TableLiquidations",props:{liquidations:{},count:{},loading:{type:Boolean}},emits:["page"],setup(e,{emit:o}){const p=o,{page:l,onPage:u}=ee(),a=G(l,200);E(a,t=>{p("page",t)});const{relativeTime:r}=te();return(t,n)=>{const c=ae,f=j,P=Z,$=Y,R=N;return d(),v(R,{title:"Liquidations"},{actions:h(()=>[i(c,{"items-count":t.count,"items-per-page":10,page:s(l),onPage:s(u)},null,8,["items-count","page","onPage"])]),default:h(()=>[e.liquidations.length>0?(d(),v(P,{key:0,rows:e.liquidations,columns:["Borrower","Liquidator",{label:"Shares liquidated",align:"end"},{label:"Collat for liquidator",align:"end"},{label:"Amount to repay",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:g})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${g.borrower}`,onClick:n[0]||(n[0]=S(()=>{},["stop"]))},k(g.borrower.ens||("addressShort"in t?t.addressShort:s(M))(g.borrower.address)),9,pa)]),_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${g.liquidator}`,onClick:n[1]||(n[1]=S(()=>{},["stop"]))},k(g.liquidator.ens||("addressShort"in t?t.addressShort:s(M))(g.liquidator.address)),9,ua)]),_("div",da,[i(f,{type:"dollar",value:g.sharesLiquidated,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",_a,[i(f,{type:"dollar",value:g.collateralForLiquidator,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",ma,[i(f,{type:"dollar",value:g.amountLiquidatorToRepay,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",ga,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${g.txHash}`,onClick:n[2]||(n[2]=S(()=>{},["stop"]))},k(s(r)(g.blockTime.getUTCTimestamp())),9,ha)])]),_:1},8,["rows"])):t.loading?w("",!0):(d(),v($,{key:1,message:"There are no liquidations"}))]),_:1})}}}),ba=T(va,[["__scopeId","data-v-1e2df879"]]),fa={class:"dashboard-grid"},ya=C({__name:"Liquidations",props:{pair:{}},setup(e){const o=X(1),{isFetching:p,data:l}=Qe(q(()=>({pair_id:e.pair.pairId,page:o.value,per_page:15})));return(u,a)=>{var r,t;return d(),F("div",fa,[i(ba,{liquidations:((r=s(l))==null?void 0:r.events)??[],count:((t=s(l))==null?void 0:t.count)??0,loading:s(p),onPage:a[0]||(a[0]=n=>o.value=n)},null,8,["liquidations","count","loading"])])}}}),ka=T(ya,[["__scopeId","data-v-0dd6af85"]]),$a={style:{display:"flex"}},wa={ref:"chartRef",class:"chart"},qa=C({__name:"ChartApr",props:{apr:{}},setup(e){const o=se(),p=ne("card"),{chart:l,series:u}=ce({createChartOptions:ue(),series:pe({name:"apr",color:q(()=>o.value.colors.blue),formatter:r=>`$${le(r,1,"dollar")}${ie(r)}`,minMove:.01})});re(a);function a(){if(!l.value||!u.apr)return;const r=e.apr.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.apr})).uniqWith((t,n)=>t.time===n.time).orderBy(t=>t.time,"asc");r.length>0&&u.apr.setData(r),l.value.timeScale().fitContent()}return(r,t)=>{const n=_e,c=de,f=N;return d(),v(f,{ref_key:"card",ref:p,title:"APR"},{actions:h(()=>[_("div",$a,[i(n,{filename:"apr",series:s(u)},null,8,["series"]),i(c,{chart:s(l),target:s(p)},null,8,["chart","target"])])]),default:h(()=>[_("div",wa,null,512)]),_:1},512)}}}),Ca={style:{display:"flex"}},Ta={ref:"chartRef",class:"chart"},Pa=C({__name:"ChartTvl",props:{tvl:{}},setup(e){const o=se(),p=ne("card"),{chart:l,series:u}=ce({createChartOptions:ue(),series:pe({name:"tvl",color:q(()=>o.value.colors.blue),formatter:r=>`$${le(r,1,"dollar")}${ie(r)}`})});re(a);function a(){if(!l.value||!u.tvl)return;const r=e.tvl.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.tvl})).uniqWith((t,n)=>t.time===n.time).orderBy(t=>t.time,"asc");r.length>0&&u.tvl.setData(r),l.value.timeScale().fitContent()}return(r,t)=>{const n=_e,c=de,f=N;return d(),v(f,{ref_key:"card",ref:p,title:"TVL"},{actions:h(()=>[_("div",Ca,[i(n,{filename:"tvl",series:s(u)},null,8,["series"]),i(c,{chart:s(l),target:s(p)},null,8,["chart","target"])])]),default:h(()=>[_("div",Ta,null,512)]),_:1},512)}}}),Fa={class:"dashboard-grid"},Ra={class:"kpis",style:{"grid-area":"kpis"}},Da=C({__name:"Overview",props:{pair:{}},setup(e){const{isFetching:o,data:p}=ze(he(()=>({pair_id:e.pair.pairId}))),l=q(()=>(p.value??[]).map(a=>({timestamp:a.time,tvl:a.totalUnderlying}))),u=q(()=>(p.value??[]).map(a=>({timestamp:a.time,apr:a.aprBase})));return(a,r)=>{const t=j,n=Ce;return d(),F("div",Fa,[_("div",Ra,[i(n,{label:"Positions","has-value":!!a.pair},{default:h(()=>{var c;return[i(t,{precision:0,value:(c=a.pair)==null?void 0:c.activePositionsCount},null,8,["value"])]}),_:1},8,["has-value"]),i(n,{label:"TVL","has-value":!!a.pair},{default:h(()=>{var c;return[i(t,{type:"dollar",precision:2,value:(c=a.pair)==null?void 0:c.totalUnderlying,"show-symbol":!1},null,8,["value"]),I(" "+k(a.pair.tokenPairUnderyling.symbol),1)]}),_:1},8,["has-value"]),i(n,{label:"Debt","has-value":!!a.pair},{default:h(()=>{var c;return[i(t,{type:"dollar",precision:2,value:(c=a.pair)==null?void 0:c.totalDebt,"show-symbol":!1},null,8,["value"]),I(" "+k(a.pair.tokenDebt.symbol),1)]}),_:1},8,["has-value"]),i(n,{label:"Interest Rate","has-value":!!a.pair},{default:h(()=>{var c;return[i(t,{type:"percentage",precision:2,value:((c=a.pair)==null?void 0:c.interestRate)&&a.pair.interestRate/10**8},null,8,["value"])]}),_:1},8,["has-value"]),i(n,{label:"Utilization Rate","has-value":!!a.pair},{default:h(()=>{var c;return[i(t,{type:"percentage",precision:2,value:(c=a.pair)==null?void 0:c.utilizationRate},null,8,["value"])]}),_:1},8,["has-value"])]),i(Pa,{style:{"grid-area":"tvl"},tvl:s(l),loading:s(o)},null,8,["tvl","loading"]),i(qa,{style:{"grid-area":"apr"},apr:s(u),loading:s(o)},null,8,["apr","loading"])])}}}),Sa=T(Da,[["__scopeId","data-v-3151db43"]]),La=["href"],Ia={class:"end"},Na={class:"end"},Ba={class:"end",style:{display:"flex",gap:"1ch"}},Aa={class:"end"},Ea={class:"end"},Va=["href"],Ha=C({__name:"TableRedemptions",props:{redemptions:{},count:{},pair:{},loading:{type:Boolean}},emits:["page"],setup(e,{emit:o}){const p=o,{page:l,onPage:u}=ee(),a=G(l,200);E(a,t=>{p("page",t)});const{relativeTime:r}=te();return(t,n)=>{const c=ae,f=j,P=Z,$=Y,R=N;return d(),v(R,{title:"Redemptions"},{actions:h(()=>[i(c,{"items-count":t.count,"items-per-page":10,page:s(l),onPage:s(u)},null,8,["items-count","page","onPage"])]),default:h(()=>[e.redemptions.length>0?(d(),v(P,{key:0,rows:e.redemptions,columns:["Caller",{label:"reUSD",align:"end"},{label:"Debt reduction",align:"end"},{label:"Collateral freed",align:"end"},{label:"Protocol fee",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:g})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${g.caller}`,onClick:n[0]||(n[0]=S(()=>{},["stop"]))},k(g.caller.ens||("addressShort"in t?t.addressShort:s(M))(g.caller.address)),9,La)]),_("div",Ia,[i(f,{type:"dollar",value:g.amount/10**18,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Na,[i(f,{type:"dollar",value:g.debtReduction/10**18,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Ba,[i(f,{type:"dollar",value:g.collateralFreed/10**18,precision:2,"show-symbol":!1},null,8,["value"]),I(" "+k(t.pair.tokenCollateral.symbol),1)]),_("div",Aa,[i(f,{type:"dollar",value:g.protocolFee/10**18,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Ea,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${g.txHash}`,onClick:n[1]||(n[1]=S(()=>{},["stop"]))},k(s(r)(g.blockTime.getUTCTimestamp())),9,Va)])]),_:1},8,["rows"])):t.loading?w("",!0):(d(),v($,{key:1,message:"There are no redemptions"}))]),_:1})}}}),Ua=T(Ha,[["__scopeId","data-v-bbc74a72"]]),xa={class:"dashboard-grid"},Oa=C({__name:"Redemptions",props:{pair:{}},setup(e){const o=X(1),{isFetching:p,data:l}=Me(q(()=>({pair_id:e.pair.pairId,page:o.value,per_page:15})));return(u,a)=>{var r,t;return d(),F("div",xa,[i(Ua,{redemptions:((r=s(l))==null?void 0:r.events)??[],count:((t=s(l))==null?void 0:t.count)??0,loading:s(p),pair:u.pair,onPage:a[0]||(a[0]=n=>o.value=n)},null,8,["redemptions","count","loading","pair"])])}}}),Ka=T(Oa,[["__scopeId","data-v-eda307c4"]]),Wa={class:"dashboard"},za=C({__name:"Pair.page",setup(e){const o=oe("protocolName"),p=oe("pairId",void 0,{transform:Number}),{isFetching:l,data:u}=ye(q(()=>({chain:"ethereum",protocol_name:o.value})),q(()=>!!o.value)),a=q(()=>(u.value??[]).find(c=>c.pairId===p.value)),{crumbs:r}=ve(be());E(a,c=>{r.value=[{id:"protocols",label:"Protocols",pathName:"protocols",params:()=>({protocolName:o.value})},{id:"protocol",label:o.value,pathName:"protocols",params:()=>({protocolName:o.value})},{id:"pair",label:`Pair: ${c!=null&&c.name?ke(c.name):"?"}`}]},{immediate:!0});const{tabActive:t,tabActiveIndex:n}=Te(["overview","collateral","redemptions","liquidations","health"],"pair",void 0,{tabParamName:"pairTab"});return(c,f)=>{const P=fe,$=me,R=ge;return d(),F("div",Wa,[i(P,{loading:s(l)},null,8,["loading"]),!s(l)&&s(a)?(d(),v(R,{key:0,active:s(n),onTab:f[0]||(f[0]=g=>n.value=g.index)},{default:h(()=>[i($,{header:"Overview"},{default:h(()=>[(d(),v(L,null,[s(t)==="overview"?(d(),v(Sa,{key:0,pair:s(a)},null,8,["pair"])):w("",!0)],1024))]),_:1}),i($,{header:"Collateral"},{default:h(()=>[(d(),v(L,null,[s(t)==="collateral"?(d(),v(na,{key:0,pair:s(a)},null,8,["pair"])):w("",!0)],1024))]),_:1}),i($,{header:"Redemptions"},{default:h(()=>[(d(),v(L,null,[s(t)==="redemptions"?(d(),v(Ka,{key:0,pair:s(a)},null,8,["pair"])):w("",!0)],1024))]),_:1}),i($,{header:"Liquidation"},{default:h(()=>[(d(),v(L,null,[s(t)==="liquidations"?(d(),v(ka,{key:0,pair:s(a)},null,8,["pair"])):w("",!0)],1024))]),_:1}),i($,{header:"Health"},{default:h(()=>[(d(),v(L,null,[s(t)==="health"?(d(),v(ca,{key:0,pair:s(a)},null,8,["pair"])):w("",!0)],1024))]),_:1})]),_:1},8,["active"])):w("",!0)])}}}),it=T(za,[["__scopeId","data-v-9fb4fef3"]]);export{it as default};
