var E=Object.defineProperty;var V=(t,e,a)=>e in t?E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var P=(t,e,a)=>V(t,typeof e!="symbol"?e+"":e,a);import{d as v,u as q,a as K,c as b,w as L,b as y,o as _,e as f,f as m,g as l,h as n,_ as C,E as M,t as w,R as F,i as N,j as H,k as O,l as I,n as $}from"./index-C6WqhbS3.js";import{_ as S}from"./ChartBalances-BrGxQJju.js";import{u as Q,c as W,a as j,_ as z,D as k}from"./UseLightweightChart-CJ55IpRO.js";import{u as G,a as J}from"./protocols-Nb_B2dfD.js";import{u as X}from"./stablecoin-lqZVDue_.js";import{_ as Y}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-CaiSNrU4.js";import{r as Z,u as ee,f as x,a as B}from"./timestamp-ZxrFfTJg.js";import{_ as te}from"./KPI-CQqEY5Bg.js";import{g as ae,_ as se}from"./AsyncValue-CevZ32Cf.js";import"./UseLegend-Sak7y5aw.js";import"./Tooltip-QeurKRjh.js";import"./Pagination-vgbH7lYO.js";const re="/assets/hippo-ghibli-DCzfPtIQ.png",ne={style:{display:"flex"}},oe={ref:"chartRef",class:"chart"},ie=v({__name:"ChartPrice",props:{price:{}},setup(t){const e=q(),a=K("card"),{chart:r,series:u}=Q({createChartOptions:j(),series:W({name:"price",color:b(()=>e.value.colors.purple),formatter:o=>`$${Z(o,4,"dollar")}${ee(o)}`,minMove:.001,autoscaleInfoProvider:()=>({priceRange:{minValue:Math.max(Math.min(...t.price.map(o=>o.price)),.95),maxValue:Math.min(Math.max(...t.price.map(o=>o.price)),1.05)}})})});L(d);function d(){if(!r.value||!u.price)return;const o=t.price.map(i=>({time:i.timestamp.getUTCTimestamp(),value:i.price})).uniqWith((i,p)=>i.time===p.time).orderBy(i=>i.time,"asc");o.length>0&&u.price.setData(o),r.value.timeScale().fitContent()}return(o,i)=>{const p=Y,c=z,s=C;return _(),y(s,{ref_key:"card",ref:a,title:"Stablecoin Price (reUSD)"},{actions:f(()=>[m("div",ne,[l(p,{filename:"tvl",series:n(u)},null,8,["series"]),l(c,{chart:n(r),target:n(a)},null,8,["chart","target"])])]),default:f(()=>[m("div",oe,null,512)]),_:1},512)}}});class ce{async fetch(e,a,r){return x(e,a,r)}}class le extends ce{constructor(a){super();P(this,"host");this.host=a}async getHost(){return await this.host}}class pe extends le{async getPrice(e){const a=await this.getHost(),r=`ethereum:${e}`;return this.fetch(`${a}/price/${e}`).then(u=>u[r])}async getPrices(e){const a=await this.getHost(),r=e.join(",");return this.fetch(`${a}/price/${r}`)}}const ue={laf:"https://api.llama.airforce",ha:"https://api2.hippo.army",cb:void 0,cm:"https://api2.curvemonitor.com"},me=["cb","laf","ha","cm"];function de(){const t="ha";if(!me.includes(t)){const e=`Unknown app for useApp(): ${t}`;throw M({text:e,type:"error"}),new Error(e)}return t}const g={};function he(t){return ue[t]}async function T(t){const e=de(),a=e;if(g[a])return Promise.resolve(g[a]);const r=he(e);return g[a]=r,g[a]}const _e=new pe(T());function D(t){return B({queryKey:["token-price",t],queryFn:async({queryKey:[,e]})=>_e.getPrice(e),enabled:b(()=>!!t.value),initialDataUpdatedAt:0})}async function fe(t){const e=ae(t);return await x(`${e}/stats`,void 0,t==null?void 0:t.signal)}function ye(){return B({queryKey:["stats"],queryFn:async()=>{const t=await T();return fe({host:t})}})}const ge={class:"kpis"},be=v({__name:"KPIs",setup(t){const{data:e}=D(w(()=>F)),{data:a}=D(w(()=>N)),{data:r}=ye();return(u,d)=>{var p,c;const o=se,i=te;return _(),H("div",ge,[l(i,{class:"border-special",label:"RSUP Price","has-value":!!n(e)},{default:f(()=>{var s;return[l(o,{type:"dollar",value:((s=n(e))==null?void 0:s.price)??1/0,precision:3},null,8,["value"])]}),_:1},8,["has-value"]),l(i,{class:"border-special",label:"reUSD Price","has-value":!!n(a)},{default:f(()=>{var s;return[l(o,{type:"dollar",value:((s=n(a))==null?void 0:s.price)??1/0,precision:3},null,8,["value"])]}),_:1},8,["has-value"]),l(i,{class:"border-special",label:"Total reUSD borrowed","has-value":!!((p=n(r))!=null&&p.borrowed)},{default:f(()=>{var s;return[l(o,{type:"dollar",value:((s=n(r))==null?void 0:s.borrowed)??1/0,precision:0,"show-symbol":!1},null,8,["value"]),d[0]||(d[0]=O(" reUSD "))]}),_:1,__:[0]},8,["has-value"]),l(i,{class:"border-special",label:"Total collateral","has-value":!!((c=n(r))!=null&&c.collateral)},{default:f(()=>{var s;return[l(o,{type:"dollar",value:((s=n(r))==null?void 0:s.collateral)??1/0,precision:0},null,8,["value"])]}),_:1},8,["has-value"])])}}}),ve=I(be,[["__scopeId","data-v-a8311ac2"]]),Pe={class:"dashboard"},we={class:"highlights"},$e={class:"dashboard-grid charts"},Se=v({__name:"Home.page",setup(t){G();const{isFetching:e,data:a}=X(),{isFetching:r,data:u}=J({chain:"ethereum"}),d=p=>{var c;return(((c=u.value)==null?void 0:c.snapshots)??[]).map(s=>({symbol:s.name,balances:[{timestamp:s.timestamp,balance:s[p],tokenPrice:1}]})).groupBy(s=>s.symbol).entries().map(([s,U])=>({symbol:s,balances:U.flatMap(h=>h.balances).groupBy(h=>h.timestamp.getTime()).entries().map(([,h])=>({timestamp:h[0].timestamp,balance:h.reduce((A,R)=>A+R.balance,0),tokenPrice:h[0].tokenPrice}))}))},o=b(()=>d("totalUnderlying")),i=b(()=>d("totalDebt"));return(p,c)=>{const s=C;return _(),H("div",Pe,[c[0]||(c[0]=m("div",{class:"description"},[m("span",{class:"title"},"Hippo Army"),m("span",{class:"tag"},"Resupplying your portobello with hippo insights.")],-1)),c[1]||(c[1]=m("img",{class:"hippo",src:re},null,-1)),m("div",we,[l(ve)]),m("div",$e,[l(ie,{style:{"grid-area":"price"},price:n(a),loading:n(e)},null,8,["price","loading"]),n(r)?(_(),y(s,{key:1,loading:"",title:"TVL",style:$(`grid-area: underlying; min-height: ${n(k)}`)},null,8,["style"])):(_(),y(S,{key:0,style:{"grid-area":"underlying"},title:"TVL",balances:n(o),"show-dollars":!1},null,8,["balances"])),n(r)?(_(),y(s,{key:3,loading:"",title:"Debt",style:$(`grid-area: debt; min-height: ${n(k)}`)},null,8,["style"])):(_(),y(S,{key:2,style:{"grid-area":"debt"},title:"Debt",balances:n(i),"show-dollars":!1},null,8,["balances"]))])])}}}),qe=I(Se,[["__scopeId","data-v-a4a96117"]]);export{qe as default};
