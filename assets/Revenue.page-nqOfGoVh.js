import{_ as N}from"./DashboardHeader-jjU4oyqz.js";import{u as j,r as R,a as x}from"./Number-BwCHtbMI.js";import{a as z,f as Q,_ as B}from"./fetch-S3nWqVm-.js";import{o as w,s as V,f as Y,n as v,t as J,a as G,p as X,c as Z,h as tt,g as et}from"./timestamp-Ki00Lgd1.js";import{aI as st,at,d as D,ay as F,av as L,c as b,az as M,j as T,o as y,w as h,f as p,e as u,u as l,h as S,b as O,i as $,_ as P,al as nt,an as ot,ao as W,g as C,aV as it,ae as rt}from"./index-DAmMJpTU.js";import{u as q,a as I,_ as U}from"./UseLightweightChart-Cn6_rK2P.js";import{_ as H}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-DFTTHLNa.js";import{_ as lt}from"./KPI-DWk_VgbO.js";import{_ as ut}from"./Table-DQn4OZ6C.js";import{a as ct,_ as dt}from"./UsePagination-rqSrHaF6.js";import{u as mt}from"./UseRelativeTime-CKRKYyBO.js";import"./Tooltip-Yo6BbvH-.js";const _t=w({block_timestamp:v(),tx_hash:V(),block_number:v(),operator:Y,amount:V()}).transform(o=>({blockTime:J(o.block_timestamp),txHash:o.tx_hash,blockNumber:o.block_number,operator:o.operator,amount:parseFloat(o.amount)})),pt=w({distributions:G(_t),count:v(),page:v(),total_pages:v()}).transform(o=>({distributions:o.distributions,count:o.count,page:o.page,totalPages:o.total_pages})),ht=w({...tt,...Z,...X});async function ft(o,d){const i=et(),{chain:r,...m}=ht.parse(o),_=z(m),e=await Q(`${i}/v1/revenue/${r}/distributions${_}`,void 0,d==null?void 0:d.signal);return pt.parse(e)}function A(o){return j({queryKey:["revenue-distributions",o],queryFn:()=>ft(at(o)),placeholderData:st})}const gt={style:{display:"flex"}},bt={ref:"chartRef",class:"chart"},vt=D({__name:"ChartDistributions",props:{distributions:{}},setup(o){const d=F(),i=L("card"),{chart:r,series:m}=q({createChartOptions:I(),series:{type:"Histogram",name:"distributions",options:b(()=>({priceFormat:{type:"custom",formatter:e=>`$${R(e,0,"dollar")}${x(e)}`,minMove:.01},color:d.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});M(_);function _(){if(!r.value||!m.distributions)return;const e=o.distributions.map(n=>({time:n.blockTime.getUTCTimestamp(),value:n.amount})).uniqWith((n,s)=>n.time===s.time).orderBy(n=>n.time,"asc").takeRight(52);e.length>0&&(m.distributions.setData(e),r.value.timeScale().fitContent())}return(e,n)=>{const s=H,a=U,t=S;return y(),T(t,{ref_key:"card",ref:i,title:"Distributions (1y)"},{actions:h(()=>[p("div",gt,[u(s,{filename:"distributions",series:l(m)},null,8,["series"]),u(a,{chart:l(r),target:l(i)},null,8,["chart","target"])])]),default:h(()=>[p("div",bt,null,512)]),_:1},512)}}}),Dt={style:{display:"flex"}},yt={ref:"chartRef",class:"chart"},kt=D({__name:"ChartDistributionsDelta",props:{distributions:{}},setup(o){const d=F(),i=L("card"),{chart:r,series:m}=q({createChartOptions:I(),series:{type:"Histogram",name:"deltas",options:b(()=>({priceFormat:{type:"custom",formatter:e=>`$${R(e,0,"dollar")}${x(e)}`,minMove:.01},color:d.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});M(_);function _(){if(!r.value||!m.deltas)return;const{colors:e}=d.value,n=o.distributions.map(s=>({time:s.blockTime.getUTCTimestamp(),value:s.amount})).uniqWith((s,a)=>s.time===a.time).orderBy(s=>s.time,"asc").takeRight(53).reduce((s,a,t,c)=>{if(t===0)return s;const f=a.value-c[t-1].value,k=f<0?e.red:e.green;return s.push({time:a.time,value:f,color:k}),s},[]);n.length>0&&(m.deltas.setData(n),r.value.timeScale().fitContent())}return(e,n)=>{const s=H,a=U,t=S;return y(),T(t,{ref_key:"card",ref:i,title:"Distributions Change (1y)"},{actions:h(()=>[p("div",Dt,[u(s,{filename:"distributions_delta",series:l(m)},null,8,["series"]),u(a,{chart:l(r),target:l(i)},null,8,["chart","target"])])]),default:h(()=>[p("div",yt,null,512)]),_:1},512)}}}),$t={class:"kpis"},Ct=D({__name:"KPIs",setup(o){const d={chain:"ethereum"},{data:i}=A(d),r=b(()=>{var e;return(e=i.value)!=null&&e.distributions?i.value.distributions.reduce((n,s)=>n+s.amount,0):null}),m=b(()=>{var n;if(!((n=i.value)!=null&&n.distributions)||i.value.distributions.length===0)return null;const e=i.value.distributions.slice(0,52);return e.reduce((s,a)=>s+a.amount,0)/e.length}),_=b(()=>{var a;if(!((a=i.value)!=null&&a.distributions)||i.value.distributions.length===0)return null;const e=i.value.distributions.slice(0,52).map(t=>t.amount),n=e.reduce((t,c)=>t+c,0)/e.length,s=e.map(t=>Math.pow(t-n,2));return Math.sqrt(s.reduce((t,c)=>t+c,0)/(e.length-1))});return(e,n)=>{const s=B,a=lt;return y(),O("div",$t,[u(a,{label:"Total","has-value":!!l(r)},{default:h(()=>[u(s,{type:"dollar",value:l(r),precision:2,"show-symbol":!1},null,8,["value"]),n[0]||(n[0]=$(" reUSD "))]),_:1},8,["has-value"]),u(a,{label:"Average (1y)","has-value":!!l(m)},{default:h(()=>[u(s,{type:"dollar",value:l(m),precision:2,"show-symbol":!1},null,8,["value"]),n[1]||(n[1]=$(" reUSD "))]),_:1},8,["has-value"]),u(a,{label:"Standard Deviation (1y)","has-value":!!l(_)},{default:h(()=>[u(s,{type:"dollar",value:l(_),precision:2,"show-symbol":!1},null,8,["value"]),n[2]||(n[2]=$(" reUSD "))]),_:1},8,["has-value"])])}}}),wt=P(Ct,[["__scopeId","data-v-8461099e"]]),Tt=["href"],St={class:"period"},Pt={class:"end"},Vt={class:"end"},Wt=["href"],Rt=D({__name:"TableDistributions",props:{distributions:{},count:{}},emits:["page"],setup(o,{emit:d}){const i=d,{page:r,onPage:m}=ct(),_=nt(r,200);ot(_,a=>{i("page",a)});const{relativeTime:e}=mt();function n(a){const t=new Date(a);t.setDate(a.getDate()+4);const c=new Date(t);return c.setDate(t.getDate()-t.getDay()),`${c.toLocaleString("default",{month:"short"})} ${c.getDate()}`}function s(a){const t=new Date(a);t.setDate(a.getDate()+4);const c=new Date(t);c.setDate(t.getDate()-t.getDay());const f=new Date(c);return f.setDate(c.getDate()+4),`${f.toLocaleString("default",{month:"short"})} ${f.getDate()}`}return(a,t)=>{const c=dt,f=it,k=B,E=ut,K=S;return y(),T(K,{title:"Distributions"},{actions:h(()=>[u(c,{"items-count":a.count,"items-per-page":10,page:l(r),onPage:l(m)},null,8,["items-count","page","onPage"])]),default:h(()=>[u(E,{rows:a.distributions,columns:["Period",{label:"Amount (reUSD)",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:g})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${g.operator.address}`,onClick:t[0]||(t[0]=W(()=>{},["stop"]))},[p("div",St,[p("span",null,C(n(g.blockTime)),1),u(f,{class:"chevron"}),p("span",null,C(s(g.blockTime)),1)])],8,Tt)]),p("div",Pt,[u(k,{"show-zero":"",type:"dollar",value:g.amount,"show-symbol":!1,precision:2},null,8,["value"])]),p("div",Vt,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${g.txHash}`,onClick:t[1]||(t[1]=W(()=>{},["stop"]))},C(l(e)(g.blockTime.getUTCTimestamp())),9,Wt)])]),_:1},8,["rows"])]),_:1})}}}),xt=P(Rt,[["__scopeId","data-v-e0a42fd0"]]),Bt={class:"dashboard"},Ft=D({__name:"Revenue.page",setup(o){const d=rt(1),{isFetching:i,data:r}=A(b(()=>({chain:"ethereum",page:d.value,per_page:15})));return(m,_)=>{var n,s,a,t;const e=N;return y(),O("div",Bt,[u(e,{style:{"grid-area":"header"},title:"Revenue",description:"Token revenue distribution metrics"}),u(wt,{style:{"grid-area":"kpis"}}),u(vt,{style:{"grid-area":"chart"},distributions:((n=l(r))==null?void 0:n.distributions)??[]},null,8,["distributions"]),u(kt,{style:{"grid-area":"delta"},distributions:((s=l(r))==null?void 0:s.distributions)??[]},null,8,["distributions"]),u(xt,{style:{"grid-area":"table"},distributions:((a=l(r))==null?void 0:a.distributions)??[],count:((t=l(r))==null?void 0:t.count)??0,loading:l(i),onPage:_[0]||(_[0]=c=>d.value=c)},null,8,["distributions","count","loading"])])}}}),zt=P(Ft,[["__scopeId","data-v-f3bd6d88"]]);export{zt as default};
