import{_ as oe}from"./DashboardHeader-CBTrQLFq.js";import{c as f,d as V,at as P,au as Q,aM as Y,av as R,j as B,o as D,h as A,w as g,f as k,e as v,u as r,aN as se,i as E,g as x,_ as M,ae as ne,aO as le,aP as re,t as L,a as ie,b as ee,aQ as ce,aR as F}from"./index--6aQy66t.js";import{u as N,r as U,a as q}from"./Number-JCDnKITR.js";import{u as ue,_ as me}from"./UseLegend-BqSHP-IN.js";import{u as I,a as G,c as H,_ as Z,D as de}from"./UseLightweightChart-CBj2c-74.js";import{_ as pe}from"./Tooltip-ZsHLl0Z0.js";import{_ as te}from"./ButtonToggle-CkpdMSaO.js";import{_ as ae}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-Kqoh4nS8.js";const K=e=>"https://prices.curve.fi";class _e extends Error{constructor(t,s){super(s),this.status=t}}async function j(e,t,s){const o=await fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t),signal:s});if(!o.ok)throw new _e(o.status,`Fetch error ${o.status} for URL: ${e}`);return o.json()}const ve=/[+-]\d{2}:?\d{2}$/;function z(e){if(typeof e=="number")return new Date(e*1e3);const t=Number(e);if(!Number.isNaN(t))return new Date(t*1e3);const o=e.endsWith("Z")||ve.test(e)?e:`${e}Z`;return new Date(o)}const he=24*60*60;function J({end:e,start:t,daysRange:s=10}={}){return e??(e=Math.floor(Date.now()/1e3)),t??(t=e-s*he),{end:e,start:t}}const fe=e=>({time:z(e.time),open:e.open,high:e.high,low:e.low,close:e.close});async function ge(e,t,s,o,m){const p=K(),{start:n,end:d}=J({daysRange:90}),_=`${p}/v1/ohlc/${e}/${t}?main_token=${s}&reference_token=${o}&agg_number=1&agg_units=day&start=${n}&end=${d}`;return(await j(_)).data.map(fe)}const ye=e=>{var t,s;return{name:e.name,address:e.address,numCoins:e.n_coins,tvlUsd:e.tvl_usd,tradingVolume24h:e.trading_volume_24h,tradingFee24h:e.trading_fee_24h,liquidityVolume24h:e.liquidity_volume_24h,liquidityFee24h:e.liquidity_fee_24h,coins:((t=e.coins)==null?void 0:t.map(o=>({poolIndex:o.pool_index,symbol:o.symbol,address:o.address})))??[],baseDailyApr:e.base_daily_apr,baseWeeklyApr:e.base_weekly_apr,virtualPrice:e.virtual_price,poolMethods:((s=e.pool_methods)==null?void 0:s.map(o=>o))??[]}},be=e=>({timestamp:z(e.timestamp),volume:e.volume,fees:e.fees}),$e=e=>({timestamp:z(e.timestamp),tvlUSD:e.tvl_usd??0,balances:[...e.balances],tokenPrices:[...e.token_prices]});async function Ce(e,t,s){const o=K(),m=await j(`${o}/v1/pools/${e}/${t}`);return ye(m)}async function we(e,t,s){const o=K(),{start:m,end:p}=J({daysRange:90});return(await j(`${o}/v1/volume/usd/${e}/${t}?interval=day&start=${m}&end=${p}`)).data.map(be)}async function Se(e,t,s){const o=K(),{start:m,end:p}=J({daysRange:90});return(await j(`${o}/v1/snapshots/${e}/${t}/tvl?interval=day&start=${m}&end=${p}`)).data.map($e)}function ke(e,t,s,o){return N({queryKey:["curve-token-price",t,s,o],queryFn:({queryKey:[,m,p,n]})=>ge(e.value,m,p,n),enabled:f(()=>!!e.value&&!!t.value&&!!s.value&&!!o.value),initialData:[],initialDataUpdatedAt:0})}function Te(e,t){return N({queryKey:["curve-pool",t],queryFn:async({queryKey:[,s]})=>Ce(e.value,s),enabled:f(()=>!!e.value)})}function De(e,t){return N({queryKey:["curve-pool-volume",t],queryFn:async({queryKey:[,s]})=>we(e.value,s),enabled:f(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}function Fe(e,t){return N({queryKey:["curve-pool-tvl",t],queryFn:async({queryKey:[,s]})=>Se(e.value,s),enabled:f(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}const Be={style:{display:"flex"}},Ve={ref:"chartRef",class:"chart"},Le="chart_pool_balances_dollars",Ue="chart_pool_balances_type",qe=V({__name:"ChartBalances",props:{balances:{}},setup(e){const t=P(),{items:s,toggles:o,disabled:m}=ue(()=>e.balances.map(({symbol:a},c)=>({id:a,label:a,color:t.value.colorsArray[c],togglable:!0}))),p=Q("card"),n=Y(Le,!1),d=["unstacked","stacked","100%"],_=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],l=Y(Ue,d[0]),{chart:u,series:i}=I({createChartOptions:H(),series:[...e.balances.map(({symbol:a},c)=>({type:"Line",name:a,options:f(()=>({priceFormat:{type:"custom",formatter:y=>`${U(y,1,"dollar")}${q(y)}`},lineWidth:2,lineType:G.WithSteps,color:t.value.colorsArray[c],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stacked",options:f(()=>({priceFormat:{type:"custom",formatter:a=>`${U(a,1,"dollar")}${q(a)}`},colors:s.value.map((a,c)=>({item:a,i:c})).filter(({item:a})=>!m.value.includes(a.id)).map(({i:a})=>a).map(a=>t.value.colorsArray[a]).map(a=>({line:a,area:a+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});R(S);function S(){if(!(!u.value||Object.values(i).length<0)){for(const a of Object.values(i))a==null||a.setData([]);l.value==="unstacked"?O():W(l.value==="100%"),u.value.timeScale().fitContent()}}function O(){var a,c;for(const{symbol:y,balances:h}of e.balances.values()){if(!o[y].value){(a=i[y])==null||a.setData([]);continue}const b=n.value,C=h.map($=>({time:$.timestamp.getUTCTimestamp(),value:b?$.balance*$.tokenPrice:$.balance})).uniqWith(($,T)=>$.time===T.time).orderBy($=>$.time,"asc");C.length>0&&((c=i[y])==null||c.setData(C))}}function W(a){if(!i.stacked)return;const c=n.value,y=[...e.balances.values()].filter(({symbol:h,balances:b})=>o[h].value&&b.length>0).flatMap(({symbol:h,balances:b})=>b.map(C=>({symbol:h,timestamp:C.timestamp,balance:c?C.balance*C.tokenPrice:C.balance}))).groupBy(h=>h.timestamp.getTime()).entries().map(([h,b])=>{const C=a?b.reduce((T,w)=>T+w.balance,0):1,$=b.map(T=>a?T.balance/C*100:T.balance);return{time:Number(h)/1e3,values:$}}).uniqWith((h,b)=>h.time===b.time).orderBy(h=>h.time,"asc");y.length>0&&i.stacked.setData(y)}return(a,c)=>{const y=se,h=te,b=pe,C=Z,$=me,T=A;return D(),B(T,{ref_key:"card",ref:p,class:"stack-actions",title:"Balances"},{actions:g(()=>[k("div",Be,[v(y,{options:_,selected:_.find(w=>w.id===r(l))??_[0],onSelect:c[0]||(c[0]=w=>l.value=w.id)},{option:g(({option:w})=>[E(x(w.label),1)]),_:1},8,["selected"]),v(b,null,{trigger:g(()=>[v(h,{style:{"margin-right":"1rem"},"model-value":r(n),onClick:c[1]||(c[1]=w=>n.value=!r(n))},{default:g(()=>c[3]||(c[3]=[E(" $ ")])),_:1},8,["model-value"])]),default:g(()=>[c[4]||(c[4]=E(" Show token balances in USD. "))]),_:1}),v(C,{chart:r(u),target:r(p)},null,8,["chart","target"])])]),"actions-secondary":g(()=>[v($,{items:r(s),disabled:r(m),onToggle:c[2]||(c[2]=w=>r(o)[w].value=!r(o)[w].value)},null,8,["items","disabled"])]),default:g(()=>[k("div",Ve,null,512)]),_:1},512)}}}),Ae=M(qe,[["__scopeId","data-v-e9381c7d"]]),Oe={class:"controls"},We={ref:"chartRef",class:"chart"},Ee=V({__name:"ChartPrice",props:{ohlc:{}},setup(e){const t=P(),s=ne(!1);let o=1,m=0;const{chart:p,series:n}=I({createChartOptions:H(),series:{type:"Candlestick",name:"ohlc",options:f(()=>{const{colors:l}=t.value;return{priceFormat:{type:"custom",formatter:_},upColor:l.green,borderUpColor:l.green,wickUpColor:l.green,downColor:l.red,borderDownColor:l.red,wickDownColor:l.red}})}});R(d);function d(){if(!p.value||!n.ohlc)return;const l=s.value?-1:1,u=e.ohlc.map(i=>({time:i.time.getUTCTimestamp(),open:Math.pow(i.open,l),high:Math.pow(i.high,l),low:Math.pow(i.low,l),close:Math.pow(i.close,l)})).uniqWith((i,S)=>i.time===S.time).orderBy(i=>i.time,"asc");u.length>0&&(n.ohlc.setData(u),m=Math.min(...u.map(i=>i.low)),o=Math.max(...u.map(i=>i.high))),p.value.timeScale().fitContent()}function _(l){const u=o-m,i=u>1?u-Math.floor(u):u,S=-Math.floor(Math.log10(i)+1)+2;return`${U(l,S,"dollar")}${q(l)}`}return(l,u)=>{const i=te,S=A;return D(),B(S,{title:"Price"},{actions:g(()=>[k("div",Oe,[v(i,{"model-value":r(s),onClick:u[0]||(u[0]=O=>s.value=!r(s))},{default:g(()=>u[1]||(u[1]=[E(" Invert ")])),_:1},8,["model-value"])])]),default:g(()=>[k("div",We,null,512)]),_:1})}}}),Pe=M(Ee,[["__scopeId","data-v-762b8110"]]),Re={style:{display:"flex"}},Me={ref:"chartRef",class:"chart"},Ne=V({__name:"ChartTvl",props:{tvl:{}},setup(e){const t=P(),s=Q("card"),{chart:o,series:m}=I({createChartOptions:H(),series:{type:"Area",name:"tvl",options:f(()=>({priceFormat:{type:"custom",formatter:n=>`$${U(n,1,"dollar")}${q(n)}`},lineWidth:2,lineType:G.WithSteps,lineColor:t.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});R(p);function p(){if(!o.value||!m.tvl)return;const n=e.tvl.map(d=>({time:d.timestamp.getUTCTimestamp(),value:d.tvl})).uniqWith((d,_)=>d.time===_.time).orderBy(d=>d.time,"asc");n.length>0&&m.tvl.setData(n),o.value.timeScale().fitContent()}return(n,d)=>{const _=ae,l=Z,u=A;return D(),B(u,{ref_key:"card",ref:s,title:"TVL"},{actions:g(()=>[k("div",Re,[v(_,{filename:"tvl",series:r(m)},null,8,["series"]),v(l,{chart:r(o),target:r(s)},null,8,["chart","target"])])]),default:g(()=>[k("div",Me,null,512)]),_:1},512)}}}),Ie={style:{display:"flex"}},He={ref:"chartRef",class:"chart"},Ke=V({__name:"ChartVolume",props:{volume:{}},setup(e){const t=P(),s=Q("card"),{chart:o,series:m}=I({createChartOptions:H(),series:{type:"Area",name:"volume",options:f(()=>({priceFormat:{type:"custom",formatter:n=>`$${U(n,1,"dollar")}${q(n)}`},lineWidth:2,lineType:G.WithSteps,lineColor:t.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});R(p);function p(){if(!o.value||!m.volume)return;const n=e.volume.map(d=>({time:d.timestamp.getUTCTimestamp(),value:d.volume})).uniqWith((d,_)=>d.time===_.time).orderBy(d=>d.time,"asc");n.length>0&&m.volume.setData(n),o.value.timeScale().fitContent()}return(n,d)=>{const _=ae,l=Z,u=A;return D(),B(u,{ref_key:"card",ref:s,title:"Volume"},{actions:g(()=>[k("div",Ie,[v(_,{filename:"volume",series:r(m)},null,8,["series"]),v(l,{chart:r(o),target:r(s)},null,8,["chart","target"])])]),default:g(()=>[k("div",He,null,512)]),_:1},512)}}}),je=V({__name:"Pool",props:{pool:{}},setup(e){const t=f(()=>{switch(e.pool){case"scrvusd":return"0xc522A6606BBA746d7960404F22a3DB936B6F4F50";case"sfrxusd":return"0xed785Af60bEd688baa8990cD5c4166221599A441";default:throw new Error(`Unknown pool: ${e.pool}`)}}),s=f(()=>{switch(e.pool){case"scrvusd":return re;case"sfrxusd":return le;default:throw new Error(`Unknown pool: ${e.pool}`)}}),{isFetching:o,data:m}=ke(L(()=>"ethereum"),t,s,L(()=>ie)),{isFetching:p,data:n}=De(L(()=>"ethereum"),t),{isFetching:d,data:_}=Fe(L(()=>"ethereum"),t),{isFetching:l,data:u}=Te(L(()=>"ethereum"),t.value),i=f(()=>n.value.map(a=>({timestamp:a.timestamp,volume:a.volume}))),S=f(()=>_.value.map(a=>({timestamp:a.timestamp,tvl:a.tvlUSD}))),O=f(()=>!u.value||_.value.length===0?[]:u.value.coins.map(a=>({symbol:a.symbol,balances:_.value.map(c=>({timestamp:c.timestamp,balance:c.balances[a.poolIndex],tokenPrice:c.tokenPrices[a.poolIndex]}))}))),W=f(()=>l.value||d.value);return(a,c)=>{const y=A;return D(),ee(ce,null,[k("div",{class:"title",style:F(`grid-area: title-${a.pool}`)}," Pool: "+x(a.pool),5),v(Pe,{style:F(`grid-area: price-${a.pool}`),ohlc:r(m),loading:r(o)},null,8,["style","ohlc","loading"]),v(Ke,{style:F(`grid-area: volume-${a.pool}`),volume:r(i),loading:r(p)},null,8,["style","volume","loading"]),v(Ne,{style:F(`grid-area: tvl-${a.pool}`),tvl:r(S),loading:r(d)},null,8,["style","tvl","loading"]),r(W)?(D(),B(y,{key:1,loading:"",title:"Balances",style:F(`grid-area: balances-${a.pool}; min-height: ${r(de)}`)},null,8,["style"])):(D(),B(Ae,{key:0,style:F(`grid-area: balances-${a.pool}`),balances:r(O),loading:r(W)},null,8,["style","balances","loading"]))],64)}}}),X=M(je,[["__scopeId","data-v-f65fb2bd"]]),Qe={class:"dashboard"},Ge=V({__name:"Stablecoin.page",setup(e){return(t,s)=>{const o=oe;return D(),ee("div",Qe,[v(o,{style:{"grid-area":"header"},title:"Stablecoin",description:"reUSD stablecoin metrics and liquidity pool analytics"}),v(X,{pool:"scrvusd"}),v(X,{pool:"sfrxusd"})])}}}),at=M(Ge,[["__scopeId","data-v-70317081"]]);export{at as default};
