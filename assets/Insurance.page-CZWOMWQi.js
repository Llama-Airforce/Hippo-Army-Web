import{aJ as ve,am as C,d as U,c as $,b as w,o as b,e as y,g as p,h as n,_ as x,l as I,u as ye,a as fe,w as be,f as _,t as V,aw as R,m as q,ao as j,at as we,av as ke,ar as $e,ai as Te,j as Pe,n as ae}from"./index-eREEKl5L.js";import{_ as Ce}from"./ChartBalances-DdGhx-Md.js";import{_ as Se}from"./DashboardHeader-Byn85ddD.js";import{u as Fe,c as He,a as De,_ as Ae,D as ne}from"./UseLightweightChart-D2pZoVZ3.js";import{t as E,b as B,f as S,a as F,g as re,r as O,u as z}from"./timestamp-DcP9Bt_c.js";import{o as u,e as Q,s as l,n as c,d as qe,a as H,h as Ee,p as K,t as L,f as D,g as A,_ as J}from"./AsyncValue-IM55AzVv.js";import{p as ie}from"./Pagination-vgbH7lYO.js";import{_ as Ue}from"./ChartApex-XJwIL3HG.js";import{c as xe}from"./ChartStylesApex-DbitbQGf.js";import{_ as Ve}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-kfvPP31c.js";import{_ as M}from"./Table-Dbh33w8a.js";import{u as Re,_ as le,a as Ie}from"./UsePagination-DIWvwju_.js";import{u as ce}from"./UseRelativeTime-BUBU5iwX.js";import"./Tooltip-BC3yTzdv.js";const ue=u({event_type:qe(["deposit","withdraw"]),block_timestamp:c(),tx_hash:l(),block_number:c(),assets:l(),shares:l(),sender:Q,owner:Q}),pe=e=>({eventType:e.event_type,blockTime:E(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,assets:parseFloat(e.assets),shares:parseFloat(e.shares),sender:e.sender,owner:e.owner}),Be=ue.refine(e=>e.event_type==="deposit",{message:"Expected deposit event type"}).transform(pe),Qe=ue.extend({receiver:Q}).refine(e=>e.event_type==="withdraw",{message:"Expected withdraw event type"}).transform(e=>({...pe(e),receiver:e.receiver})),Ke=u({events:H(Ee([Be,Qe])),count:c(),page:c(),total_pages:c()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Le=u({account:Q,amount:l(),end_timestamp:c(),block_timestamp:c(),tx_hash:l()}).transform(e=>({account:e.account,amount:parseFloat(e.amount),end:E(e.end_timestamp),blockTime:E(e.block_timestamp),txHash:e.tx_hash})),We=u({entries:H(Le)}).transform(e=>({entries:e.entries})),Ne=u({timestamp:c(),token_address:l(),token_symbol:l(),apr:l()}).transform(e=>({timestamp:E(e.timestamp),tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),Oe=u({snapshots:H(Ne),count:c(),page:c(),total_pages:c()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),ze=u({timestamp:c(),tvl:l()}).transform(e=>({timestamp:E(e.timestamp),tvl:parseFloat(e.tvl)})),je=u({data:H(ze),count:c(),page:c(),total_pages:c()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),Je=u({address:l(),label:l().nullable(),ens:l().nullable(),position_value:l()}).transform(e=>({address:e.address,label:e.label,ens:e.ens,positionValue:parseFloat(e.position_value)})),Me=u({total_tvl:l(),top_users_tvl:l(),others_tvl:l(),users:H(Je)}).transform(e=>({totalTvl:parseFloat(e.total_tvl),topUsersTvl:parseFloat(e.top_users_tvl),othersTvl:parseFloat(e.others_tvl),users:e.users})),Ge=u({min_value:l(),max_value:l(),count:c()}).transform(e=>({minValue:parseFloat(e.min_value),maxValue:parseFloat(e.max_value),count:e.count})),Xe=u({bins:H(Ge),total_users:c()}).transform(e=>({bins:e.bins,totalUsers:e.total_users})),Ye=u({timestamp:c(),total_staked:l(),cooldown_amount:l(),cooldown_percentage:l(),active_staked_amount:l(),active_staked_percentage:l()}).transform(e=>({timestamp:E(e.timestamp),totalStaked:parseFloat(e.total_staked),cooldownAmount:parseFloat(e.cooldown_amount),cooldownPercentage:parseFloat(e.cooldown_percentage),activeStakedAmount:parseFloat(e.active_staked_amount),activeStakedPercentage:parseFloat(e.active_staked_percentage)})),Ze=u({data:H(Ye),count:c(),page:c(),total_pages:c()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),et=u({...D,...L,...K});async function tt(e,t){const o=A(t),{chain:r,...s}=et.parse(e),i=B(s),a=await S(`${o}/v1/insurance/${r}/events${i}`,void 0,t==null?void 0:t.signal);return Ke.parse(a)}const st=u(D);async function at(e,t){const o=A(t),{chain:r}=st.parse(e),s=await S(`${o}/v1/insurance/${r}/cooldown_queue`,void 0,t==null?void 0:t.signal);return We.parse(s)}const nt=u({...D,...L,...K});async function ot(e,t){const o=A(t),{chain:r,...s}=nt.parse(e),i=B(s),a=await S(`${o}/v1/insurance/${r}/apr_history${i}`,void 0,t==null?void 0:t.signal);return Oe.parse(a)}const rt=u({...D,...L,...K});async function it(e,t){const o=A(t),{chain:r,...s}=rt.parse(e),i=B(s),a=await S(`${o}/v1/insurance/${r}/tvl_history${i}`,void 0,t==null?void 0:t.signal);return je.parse(a)}const lt=u(D);async function ct(e,t){const o=A(t),{chain:r}=lt.parse(e),s=await S(`${o}/v1/insurance/${r}/top_users`,void 0,t==null?void 0:t.signal);return Me.parse(s)}const ut=u({...D,bin_count:c().int().positive().optional()});async function pt(e,t){const o=A(t),{chain:r,...s}=ut.parse(e),i=B(s),a=await S(`${o}/v1/insurance/${r}/position_histogram${i}`,void 0,t==null?void 0:t.signal);return Xe.parse(a)}const mt=u({...D,...L,...K});async function dt(e,t){const o=A(t),{chain:r,...s}=mt.parse(e),i=B(s),a=await S(`${o}/v1/insurance/${r}/insurance_pool_distribution_history${i}`,void 0,t==null?void 0:t.signal);return Ze.parse(a)}function _t(e){return F({queryKey:["insurance-events",e],queryFn:()=>tt(C(e)),placeholderData:ve})}function gt(e){return F({queryKey:["insurance-cooldown-queue",e],queryFn:()=>at(C(e))})}function ht(e){const{start:t,end:o}=re({daysRange:90});return F({queryKey:["insurance-apr-history",e],queryFn:()=>ie((s,i)=>ot({...C(e),page:s,per_page:i,start:t,end:o}).then(a=>a.snapshots),1,100)})}function vt(e){const{start:t,end:o}=re({daysRange:90});return F({queryKey:["insurance-tvl-history",e],queryFn:()=>ie((s,i)=>it({...C(e),page:s,per_page:i,start:t,end:o}).then(a=>a.data),1,100)})}function yt(e){return F({queryKey:["insurance-top-users",e],queryFn:()=>ct(C(e))})}function ft(e){return F({queryKey:["insurance-position-hist",e],queryFn:()=>pt(C(e))})}function bt(e){return F({queryKey:["insurance-distribution-hist",e],queryFn:()=>dt(C(e))})}const wt=U({__name:"ChartPositions",props:{bins:{}},setup(e){const t=$(()=>xe({chart:{type:"bar",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1}},xaxis:{categories:o.value,labels:{formatter:s=>s,rotate:-60},tickPlacement:"on"},yaxis:{labels:{formatter:s=>s}},plotOptions:{bar:{columnWidth:"50%"}},dataLabels:{enabled:!1},tooltip:{followCursor:!1,enabled:!0,intersect:!0,custom:s=>{const i=s.series[0][s.dataPointIndex];return`<div><b>Range</b>: ${o.value[s.dataPointIndex]}</div><div><b>Users</b>: ${i}</div>`}}})),o=$(()=>e.bins.map(s=>{const i=s.minValue?`${O(s.minValue,0,"dollar")}${z(s.minValue)}`:"0",a=s.maxValue?`${O(s.maxValue,0,"dollar")}${z(s.maxValue)}`:"0";return`${i} - ${a}`})),r=$(()=>[{name:"Users",data:e.bins.map(s=>s.count)}]);return(s,i)=>{const a=Ue,m=x;return b(),w(m,{title:"User positions"},{default:y(()=>[p(a,{options:n(t),series:n(r)},null,8,["options","series"])]),_:1})}}}),kt=I(wt,[["__scopeId","data-v-525b8a17"]]),$t={style:{display:"flex"}},Tt={ref:"chartRef",class:"chart"},Pt=U({__name:"ChartTvl",props:{tvl:{}},setup(e){const t=ye(),o=fe("card"),{chart:r,series:s}=Fe({createChartOptions:De(),series:He({name:"tvl",color:$(()=>t.value.colors.blue),formatter:a=>`${O(a,1,"dollar")}${z(a)}`})});be(i);function i(){if(!r.value||!s.tvl)return;const a=e.tvl.map(m=>({time:m.timestamp.getUTCTimestamp(),value:m.tvl})).uniqWith((m,d)=>m.time===d.time).orderBy(m=>m.time,"asc");a.length>0&&s.tvl.setData(a),r.value.timeScale().fitContent()}return(a,m)=>{const d=Ve,h=Ae,T=x;return b(),w(T,{ref_key:"card",ref:o,title:"TVL (reUSD)"},{actions:y(()=>[_("div",$t,[p(d,{filename:"tvl",series:n(s)},null,8,["series"]),p(h,{chart:n(r),target:n(o)},null,8,["chart","target"])])]),default:y(()=>[_("div",Tt,null,512)]),_:1},512)}}}),Ct=["href"],St={class:"end"},Ft={class:"end"},Ht=["href"],oe=10,Dt=U({__name:"TableCooldowns",props:{cooldowns:{}},setup(e){const{page:t,rowsPage:o,onPage:r}=Re(V(()=>e.cooldowns),oe),{relativeTime:s}=ce();return(i,a)=>{const m=le,d=J,h=M,T=x;return b(),w(T,{title:"Cooldown Queue"},{actions:y(()=>[p(m,{"items-count":i.cooldowns.length,"items-per-page":oe,page:n(t),onPage:n(r)},null,8,["items-count","page","onPage"])]),default:y(()=>[p(h,{rows:n(o),columns:["User",{label:"Staked reUSD",align:"end"},{label:"Time",align:"end"}]},{row:y(({item:f})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${f.account.address}`,onClick:a[0]||(a[0]=R(()=>{},["stop"]))},q(f.account.ens||("addressShort"in i?i.addressShort:n(j))(f.account.address)),9,Ct)]),_("div",St,[p(d,{type:"dollar",value:f.amount,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Ft,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${f.txHash}`,onClick:a[1]||(a[1]=R(()=>{},["stop"]))},q(n(s)(f.end.getUTCTimestamp())),9,Ht)])]),_:1},8,["rows"])]),_:1})}}}),At=I(Dt,[["__scopeId","data-v-b4fa2168"]]),qt=["href"],Et={class:"end"},Ut={class:"end"},xt=["href"],Vt=U({__name:"TableEvents",props:{events:{},count:{}},emits:["page"],setup(e,{emit:t}){const o=t,{page:r,onPage:s}=Ie(),i=we(r,200);ke(i,d=>{o("page",d)});const{relativeTime:a}=ce(),m=d=>{switch(d.eventType){case"deposit":return"Deposit";case"withdraw":return"Withdraw"}};return(d,h)=>{const T=le,f=J,W=M,N=x;return b(),w(N,{title:"Events"},{actions:y(()=>[p(T,{"items-count":d.count,"items-per-page":10,page:n(r),onPage:n(s)},null,8,["items-count","page","onPage"])]),default:y(()=>[p(W,{rows:d.events,columns:["Type","Owner",{label:"reUSD",align:"end"},{label:"Time",align:"end"}]},{row:y(({item:v})=>[_("div",{class:$e({green:v.eventType==="deposit",red:v.eventType==="withdraw"})},q(m(v)),3),_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${v.owner.address}`,onClick:h[0]||(h[0]=R(()=>{},["stop"]))},q(v.owner.ens||("addressShort"in d?d.addressShort:n(j))(v.owner.address)),9,qt)]),_("div",Et,[p(f,{type:"dollar",value:v.assets,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Ut,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${v.txHash}`,onClick:h[1]||(h[1]=R(()=>{},["stop"]))},q(n(a)(v.blockTime.getUTCTimestamp())),9,xt)])]),_:1},8,["rows"])]),_:1})}}}),Rt=I(Vt,[["__scopeId","data-v-3718948b"]]),It=["href"],Bt={class:"end"},Qt=U({__name:"TableTopUsers",props:{topUsers:{}},setup(e){return(t,o)=>{const r=J,s=M,i=x;return b(),w(i,{title:"Top Users"},{default:y(()=>[p(s,{rows:t.topUsers,columns:["Address",{label:"Staked reUSD",align:"end"}]},{row:y(({item:a})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${a.address}`,onClick:o[0]||(o[0]=R(()=>{},["stop"]))},q(a.ens||("addressShort"in t?t.addressShort:n(j))(a.address)),9,It)]),_("div",Bt,[p(r,{type:"dollar",value:a.positionValue,precision:2,"show-symbol":!1},null,8,["value"])])]),_:1},8,["rows"])]),_:1})}}}),Kt=I(Qt,[["__scopeId","data-v-d27f5415"]]),Lt={class:"dashboard"},Wt=U({__name:"Insurance.page",setup(e){const{isFetching:t,data:o}=ht({chain:"ethereum"}),r=$(()=>(o.value??[]).groupBy(g=>g.tokenAddress).entries().orderBy(([,g])=>g[0].tokenSymbol,"desc").map(([,g])=>({symbol:g[0].tokenSymbol,balances:g.map(k=>({timestamp:k.timestamp,balance:k.apr,tokenPrice:1}))}))),{isFetching:s,data:i}=vt({chain:"ethereum"}),a=$(()=>(i.value??[]).map(g=>({timestamp:g.timestamp,tvl:g.tvl}))),m=Te(1),{isFetching:d,data:h}=_t($(()=>({chain:"ethereum",page:m.value,per_page:10}))),{isFetching:T,data:f}=yt(V(()=>({chain:"ethereum"}))),{isFetching:W,data:N}=gt(V(()=>({chain:"ethereum"}))),{isFetching:v,data:me}=ft(V(()=>({chain:"ethereum"}))),{isFetching:de,data:_e}=bt(V(()=>({chain:"ethereum"}))),ge=$(()=>{var k;const g=((k=_e.value)==null?void 0:k.data)??[];return g.length===0?[]:[{symbol:"In cooldown",balances:g.map(P=>({timestamp:P.timestamp,balance:P.cooldownAmount,tokenPrice:1}))},{symbol:"Active staked",balances:g.map(P=>({timestamp:P.timestamp,balance:P.activeStakedAmount,tokenPrice:1}))}]});return(g,k)=>{var Y,Z,ee,te,se;const P=Se,G=Ce,X=x;return b(),Pe("div",Lt,[p(P,{style:{"grid-area":"header"},title:"Insurance",description:"Insurance pool metrics for Resupply including APR, TVL and positions"}),n(t)?(b(),w(X,{key:1,loading:"",title:"APR",style:ae(`grid-area: apr; min-height: ${n(ne)}`)},null,8,["style"])):(b(),w(G,{key:0,style:{"grid-area":"apr"},title:"APR",balances:n(r),loading:n(t),"show-dollars":!1},null,8,["balances","loading"])),p(Pt,{style:{"grid-area":"tvl"},tvl:n(a),loading:n(s)},null,8,["tvl","loading"]),p(Rt,{style:{"grid-area":"events"},events:((Y=n(h))==null?void 0:Y.events)??[],count:((Z=n(h))==null?void 0:Z.count)??0,loading:n(d),onPage:k[0]||(k[0]=he=>m.value=he)},null,8,["events","count","loading"]),p(At,{style:{"grid-area":"cooldowns"},cooldowns:((ee=n(N))==null?void 0:ee.entries)??[],loading:n(W)},null,8,["cooldowns","loading"]),n(de)?(b(),w(X,{key:3,loading:"",title:"Staked",style:ae(`grid-area: chart-staked; min-height: ${n(ne)}`)},null,8,["style"])):(b(),w(G,{key:2,style:{"grid-area":"chart-staked"},title:"Staked",balances:n(ge),"show-dollars":!1},null,8,["balances"])),p(Kt,{style:{"grid-area":"top-users"},"top-users":((te=n(f))==null?void 0:te.users)??[],loading:n(T)},null,8,["top-users","loading"]),p(kt,{style:{"grid-area":"positions"},bins:((se=n(me))==null?void 0:se.bins)??[],loading:n(v)},null,8,["bins","loading"])])}}}),ns=I(Wt,[["__scopeId","data-v-e4006c67"]]);export{ns as default};
