import{d as O,ap as M,aq as U,b as D,o as T,az as q,ar as P,e as m,as as W,l as N,u as j,a as z,b0 as C,c as B,w as A,_ as F,f as w,g as y,h as u,an as I,a$ as Y,k as V,m as H}from"./index-eREEKl5L.js";import{b as J,u as K,G as Q,r as X,a as Z,d as x,_ as ee}from"./UseLightweightChart-D2pZoVZ3.js";import{_ as ae}from"./Tooltip-BC3yTzdv.js";import{r as L,u as te}from"./timestamp-DcP9Bt_c.js";const se=O({__name:"ButtonToggle",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:M(["change"],["update:modelValue"]),setup(c,{emit:_}){const f=U(c,"modelValue"),g=_;return(b,v)=>{const p=q;return T(),D(p,{class:P({toggled:f.value}),onClick:v[0]||(v[0]=$=>g("change",!f.value))},{default:m(()=>[W(b.$slots,"default",{},void 0,!0)]),_:3},8,["class"])}}}),le=N(se,[["__scopeId","data-v-1a55ee48"]]),ne={class:"actions"},oe={ref:"chartRef",class:"chart"},ce="chart_pool_balances_dollars",ie="chart_pool_balances_type",re=O({__name:"ChartBalances",props:{balances:{},title:{},showDollars:{type:Boolean,default:!0},chartType:{default:"area"}},setup(c){const _=j(),{items:f,toggles:g,disabled:b}=J(()=>c.balances.map(({symbol:e},a)=>({id:e,label:e,color:_.value.colorsArray[a],togglable:!0}))),v=z("card"),p=C(ce,!1),$=["unstacked","stacked","100%"],S=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],k=C(ie,$[0]),{chart:h,series:o}=K({createChartOptions:Z(),series:[...c.balances.map(({symbol:e},a)=>({type:Q,name:e,options:B(()=>({lineWidth:2,lineType:X.WithSteps,color:_.value.colorsArray[a],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stackedArea",options:B(()=>({colors:f.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!b.value.includes(e.id)).map(({i:e})=>e).map(e=>_.value.colorsArray[e]).map(e=>({line:e,area:e+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))},{type:"StackedBars",name:"stackedBars",options:B(()=>({colors:f.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!b.value.includes(e.id)).map(({i:e})=>e).map(e=>_.value.colorsArray[e]),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});A(()=>{h.value&&h.value.applyOptions({localization:{priceFormatter:k.value==="100%"?e=>`${L(e,0,"percentage")}%`:e=>`${L(e,1,"dollar")}${te(e)}`}})}),A(R);function R(){if(!(!h.value||Object.values(o).length<0)){for(const e of Object.values(o))e==null||e.setData([]);k.value==="unstacked"?E():G(k.value==="100%"),h.value.timeScale().fitContent()}}function E(){var e,a;for(const{symbol:i,balances:t}of c.balances.values()){if(!g[i].value){(e=o[i])==null||e.setData([]);continue}const s=c.showDollars&&p.value,n=t.map(l=>({time:l.timestamp.getUTCTimestamp(),value:s?l.balance*l.tokenPrice:l.balance})).uniqWith((l,d)=>l.time===d.time).orderBy(l=>l.time,"asc");n.length>0&&((a=o[i])==null||a.setData(n))}}function G(e){if(!o.stackedArea||!o.stackedBars)return;const a=c.showDollars&&p.value,i=[...c.balances.values()].filter(({symbol:t,balances:s})=>g[t].value&&s.length>0).flatMap(({symbol:t,balances:s})=>s.map(n=>({symbol:t,timestamp:n.timestamp,balance:a?n.balance*n.tokenPrice:n.balance}))).groupBy(t=>t.timestamp.getTime()).entries().map(([t,s])=>{const n=e&&s.sumBy(d=>d.balance)||1,l=s.map(d=>e?d.balance/n*100:d.balance);return{time:Number(t)/1e3,values:l}}).uniqWith((t,s)=>t.time===s.time).orderBy(t=>t.time,"asc");i.length>0&&(c.chartType==="area"?(o.stackedArea.setData(i),o.stackedBars.setData([])):(o.stackedArea.setData([]),o.stackedBars.setData(i)))}return(e,a)=>{const i=Y,t=le,s=ae,n=ee,l=x,d=F;return T(),D(d,{ref_key:"card",ref:v,class:"stack-actions",title:e.title??"Balances"},{actions:m(()=>[w("div",ne,[W(e.$slots,"actions",{},void 0,!0),y(i,{options:S,selected:S.find(r=>r.id===u(k))??S[0],onSelect:a[0]||(a[0]=r=>k.value=r.id)},{option:m(({option:r})=>[V(H(r.label),1)]),_:1},8,["selected"]),e.showDollars?(T(),D(s,{key:0},{trigger:m(()=>[y(t,{"model-value":u(p),onClick:a[1]||(a[1]=r=>p.value=!u(p))},{default:m(()=>a[3]||(a[3]=[V(" $ ")])),_:1,__:[3]},8,["model-value"])]),default:m(()=>[a[4]||(a[4]=V(" Show token balances in USD. "))]),_:1,__:[4]})):I("",!0),y(n,{chart:u(h),target:u(v)},null,8,["chart","target"])])]),"actions-secondary":m(()=>[y(l,{items:u(f),disabled:u(b),onToggle:a[2]||(a[2]=r=>u(g)[r].value=!u(g)[r].value)},null,8,["items","disabled"])]),default:m(()=>[w("div",oe,null,512)]),_:3},8,["title"])}}}),_e=N(re,[["__scopeId","data-v-ca373428"]]);export{_e as _,le as a};
