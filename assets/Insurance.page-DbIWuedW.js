import{_ as fe}from"./DashboardHeader-BZxATxlq.js";import{t as D,b as I,f as P,a as k,g as te,r as A,u as W}from"./Number-D-_ywgC3.js";import{o as _,e as B,s as m,n as d,d as ye,a as S,h as be,p as K,t as O,f as F,g as x,_ as N}from"./AsyncValue-Brd_Goit.js";import{p as se}from"./Pagination-vgbH7lYO.js";import{aJ as we,aw as U,d as w,u as ae,a as ne,c as b,w as oe,b as q,o as $,e as g,f as p,g as u,h as r,_ as E,l as V,t as R,ar as H,m as C,at as j,ao as $e,aq as Te,am as Ce,ah as Pe,j as ke}from"./index-C4bxLmri.js";import{u as re,c as ie,a as ce,_ as le}from"./UseLightweightChart-C12vCX9v.js";import{_ as ue}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-CH9iGe7u.js";import{_ as Se}from"./ChartApex-DyJKELTz.js";import{c as Fe}from"./ChartStylesApex-DE9w9qVh.js";import{_ as z}from"./Table-CDZZfuyN.js";import{u as xe,_ as pe,a as Ue}from"./UsePagination-C4qACSg2.js";import{u as me}from"./UseRelativeTime-BFrqfvoq.js";const de=_({event_type:ye(["deposit","withdraw"]),block_timestamp:d(),tx_hash:m(),block_number:d(),assets:m(),shares:m(),sender:B,owner:B}),_e=e=>({eventType:e.event_type,blockTime:D(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,assets:parseFloat(e.assets),shares:parseFloat(e.shares),sender:e.sender,owner:e.owner}),qe=de.refine(e=>e.event_type==="deposit",{message:"Expected deposit event type"}).transform(_e),Ee=de.extend({receiver:B}).refine(e=>e.event_type==="withdraw",{message:"Expected withdraw event type"}).transform(e=>({..._e(e),receiver:e.receiver})),De=_({events:S(be([qe,Ee])),count:d(),page:d(),total_pages:d()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),He=_({account:B,amount:m(),end_timestamp:d(),block_timestamp:d(),tx_hash:m()}).transform(e=>({account:e.account,amount:parseFloat(e.amount),end:D(e.end_timestamp),blockTime:D(e.block_timestamp),txHash:e.tx_hash})),Ve=_({entries:S(He)}).transform(e=>({entries:e.entries})),Re=_({timestamp:d(),token_address:m(),token_symbol:m(),apr:m()}).transform(e=>({timestamp:D(e.timestamp),tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),Ae=_({snapshots:S(Re),count:d(),page:d(),total_pages:d()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),Be=_({timestamp:d(),tvl:m()}).transform(e=>({timestamp:D(e.timestamp),tvl:parseFloat(e.tvl)})),Ie=_({data:S(Be),count:d(),page:d(),total_pages:d()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),Qe=_({address:m(),label:m().nullable(),ens:m().nullable(),position_value:m()}).transform(e=>({address:e.address,label:e.label,ens:e.ens,positionValue:parseFloat(e.position_value)})),Le=_({total_tvl:m(),top_users_tvl:m(),others_tvl:m(),users:S(Qe)}).transform(e=>({totalTvl:parseFloat(e.total_tvl),topUsersTvl:parseFloat(e.top_users_tvl),othersTvl:parseFloat(e.others_tvl),users:e.users})),We=_({min_value:m(),max_value:m(),count:d()}).transform(e=>({minValue:parseFloat(e.min_value),maxValue:parseFloat(e.max_value),count:e.count})),Ke=_({bins:S(We),total_users:d()}).transform(e=>({bins:e.bins,totalUsers:e.total_users})),Oe=_({...F,...O,...K});async function Ne(e,t){const n=x(t),{chain:o,...s}=Oe.parse(e),i=I(s),a=await P(`${n}/v1/insurance/${o}/events${i}`,void 0,t==null?void 0:t.signal);return De.parse(a)}const je=_(F);async function ze(e,t){const n=x(t),{chain:o}=je.parse(e),s=await P(`${n}/v1/insurance/${o}/cooldown_queue`,void 0,t==null?void 0:t.signal);return Ve.parse(s)}const Je=_({...F,...O,...K});async function Me(e,t){const n=x(t),{chain:o,...s}=Je.parse(e),i=I(s),a=await P(`${n}/v1/insurance/${o}/apr_history${i}`,void 0,t==null?void 0:t.signal);return Ae.parse(a)}const Ge=_({...F,...O,...K});async function Xe(e,t){const n=x(t),{chain:o,...s}=Ge.parse(e),i=I(s),a=await P(`${n}/v1/insurance/${o}/tvl_history${i}`,void 0,t==null?void 0:t.signal);return Ie.parse(a)}const Ye=_(F);async function Ze(e,t){const n=x(t),{chain:o}=Ye.parse(e),s=await P(`${n}/v1/insurance/${o}/top_users`,void 0,t==null?void 0:t.signal);return Le.parse(s)}const et=_({...F,bin_count:d().int().positive().optional()});async function tt(e,t){const n=x(t),{chain:o,...s}=et.parse(e),i=I(s),a=await P(`${n}/v1/insurance/${o}/position_histogram${i}`,void 0,t==null?void 0:t.signal);return Ke.parse(a)}function st(e){return k({queryKey:["insurance-events",e],queryFn:()=>Ne(U(e)),placeholderData:we})}function at(e){return k({queryKey:["insurance-cooldown-queue",e],queryFn:()=>ze(U(e))})}function nt(e){const{start:t,end:n}=te({daysRange:90});return k({queryKey:["insurance-apr-history",e],queryFn:()=>se((s,i)=>Me({...U(e),page:s,per_page:i,start:t,end:n}).then(a=>a.snapshots),1,100)})}function ot(e){const{start:t,end:n}=te({daysRange:90});return k({queryKey:["insurance-tvl-history",e],queryFn:()=>se((s,i)=>Xe({...U(e),page:s,per_page:i,start:t,end:n}).then(a=>a.data),1,100)})}function rt(e){return k({queryKey:["insurance-top-users",e],queryFn:()=>Ze(U(e))})}function it(e){return k({queryKey:["insurance-position-hist",e],queryFn:()=>tt(U(e))})}const ct={style:{display:"flex"}},lt={ref:"chartRef",class:"chart"},ut=w({__name:"ChartApr",props:{apr:{}},setup(e){const t=ae(),n=ne("card"),{chart:o,series:s}=re({createChartOptions:ce(),series:ie({name:"apr",color:b(()=>t.value.colors.blue),formatter:a=>`${A(a,0,"percentage")}%`,minMove:.01})});oe(i);function i(){if(!o.value||!s.apr)return;const a=e.apr.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.apr})).uniqWith((c,l)=>c.time===l.time).orderBy(c=>c.time,"asc");a.length>0&&s.apr.setData(a),o.value.timeScale().fitContent()}return(a,c)=>{const l=ue,h=le,y=E;return $(),q(y,{ref_key:"card",ref:n,title:"APR"},{actions:g(()=>[p("div",ct,[u(l,{filename:"apr",series:r(s)},null,8,["series"]),u(h,{chart:r(o),target:r(n)},null,8,["chart","target"])])]),default:g(()=>[p("div",lt,null,512)]),_:1},512)}}}),pt=w({__name:"ChartPositions",props:{bins:{}},setup(e){const t=b(()=>Fe({chart:{type:"bar",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1}},xaxis:{categories:n.value,labels:{formatter:s=>s,rotate:-60},tickPlacement:"on"},yaxis:{labels:{formatter:s=>s}},plotOptions:{bar:{columnWidth:"50%"}},dataLabels:{enabled:!1},tooltip:{followCursor:!1,enabled:!0,intersect:!0,custom:s=>{const i=s.series[0][s.dataPointIndex];return`<div><b>Range</b>: ${n.value[s.dataPointIndex]}</div><div><b>Users</b>: ${i}</div>`}}})),n=b(()=>e.bins.map(s=>{const i=s.minValue?`${A(s.minValue,0,"dollar")}${W(s.minValue)}`:"0",a=s.maxValue?`${A(s.maxValue,0,"dollar")}${W(s.maxValue)}`:"0";return`${i} - ${a}`})),o=b(()=>[{name:"Users",data:e.bins.map(s=>s.count)}]);return(s,i)=>{const a=Se,c=E;return $(),q(c,{title:"User positions"},{default:g(()=>[u(a,{options:r(t),series:r(o)},null,8,["options","series"])]),_:1})}}}),mt=V(pt,[["__scopeId","data-v-525b8a17"]]),dt={style:{display:"flex"}},_t={ref:"chartRef",class:"chart"},ht=w({__name:"ChartTvl",props:{tvl:{}},setup(e){const t=ae(),n=ne("card"),{chart:o,series:s}=re({createChartOptions:ce(),series:ie({name:"tvl",color:b(()=>t.value.colors.blue),formatter:a=>`${A(a,1,"dollar")}${W(a)}`})});oe(i);function i(){if(!o.value||!s.tvl)return;const a=e.tvl.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.tvl})).uniqWith((c,l)=>c.time===l.time).orderBy(c=>c.time,"asc");a.length>0&&s.tvl.setData(a),o.value.timeScale().fitContent()}return(a,c)=>{const l=ue,h=le,y=E;return $(),q(y,{ref_key:"card",ref:n,title:"TVL (reUSD)"},{actions:g(()=>[p("div",dt,[u(l,{filename:"tvl",series:r(s)},null,8,["series"]),u(h,{chart:r(o),target:r(n)},null,8,["chart","target"])])]),default:g(()=>[p("div",_t,null,512)]),_:1},512)}}}),gt=["href"],vt={class:"end"},ft={class:"end"},yt=["href"],ee=10,bt=w({__name:"TableCooldowns",props:{cooldowns:{}},setup(e){const{page:t,rowsPage:n,onPage:o}=xe(R(()=>e.cooldowns),ee),{relativeTime:s}=me();return(i,a)=>{const c=pe,l=N,h=z,y=E;return $(),q(y,{title:"Cooldown Queue"},{actions:g(()=>[u(c,{"items-count":i.cooldowns.length,"items-per-page":ee,page:r(t),onPage:r(o)},null,8,["items-count","page","onPage"])]),default:g(()=>[u(h,{rows:r(n),columns:["User",{label:"Staked reUSD",align:"end"},{label:"Time",align:"end"}]},{row:g(({item:f})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${f.account.address}`,onClick:a[0]||(a[0]=H(()=>{},["stop"]))},C(f.account.ens||("addressShort"in i?i.addressShort:r(j))(f.account.address)),9,gt)]),p("div",vt,[u(l,{type:"dollar",value:f.amount,precision:2,"show-symbol":!1},null,8,["value"])]),p("div",ft,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${f.txHash}`,onClick:a[1]||(a[1]=H(()=>{},["stop"]))},C(r(s)(f.end.getUTCTimestamp())),9,yt)])]),_:1},8,["rows"])]),_:1})}}}),wt=V(bt,[["__scopeId","data-v-b4fa2168"]]),$t=["href"],Tt={class:"end"},Ct={class:"end"},Pt=["href"],kt=w({__name:"TableEvents",props:{events:{},count:{}},emits:["page"],setup(e,{emit:t}){const n=t,{page:o,onPage:s}=Ue(),i=$e(o,200);Te(i,l=>{n("page",l)});const{relativeTime:a}=me(),c=l=>{switch(l.eventType){case"deposit":return"Deposit";case"withdraw":return"Withdraw"}};return(l,h)=>{const y=pe,f=N,Q=z,L=E;return $(),q(L,{title:"Events"},{actions:g(()=>[u(y,{"items-count":l.count,"items-per-page":10,page:r(o),onPage:r(s)},null,8,["items-count","page","onPage"])]),default:g(()=>[u(Q,{rows:l.events,columns:["Type","Owner",{label:"reUSD",align:"end"},{label:"Time",align:"end"}]},{row:g(({item:v})=>[p("div",{class:Ce({green:v.eventType==="deposit",red:v.eventType==="withdraw"})},C(c(v)),3),p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${v.owner.address}`,onClick:h[0]||(h[0]=H(()=>{},["stop"]))},C(v.owner.ens||("addressShort"in l?l.addressShort:r(j))(v.owner.address)),9,$t)]),p("div",Tt,[u(f,{type:"dollar",value:v.assets,precision:2,"show-symbol":!1},null,8,["value"])]),p("div",Ct,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${v.txHash}`,onClick:h[1]||(h[1]=H(()=>{},["stop"]))},C(r(a)(v.blockTime.getUTCTimestamp())),9,Pt)])]),_:1},8,["rows"])]),_:1})}}}),St=V(kt,[["__scopeId","data-v-3718948b"]]),Ft=["href"],xt={class:"end"},Ut=w({__name:"TableTopUsers",props:{topUsers:{}},setup(e){return(t,n)=>{const o=N,s=z,i=E;return $(),q(i,{title:"Top Users"},{default:g(()=>[u(s,{rows:t.topUsers,columns:["Address",{label:"Staked reUSD",align:"end"}]},{row:g(({item:a})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${a.address}`,onClick:n[0]||(n[0]=H(()=>{},["stop"]))},C(a.ens||("addressShort"in t?t.addressShort:r(j))(a.address)),9,Ft)]),p("div",xt,[u(o,{type:"dollar",value:a.positionValue,precision:2,"show-symbol":!1},null,8,["value"])])]),_:1},8,["rows"])]),_:1})}}}),qt=V(Ut,[["__scopeId","data-v-d27f5415"]]),Et={class:"dashboard"},Dt=w({__name:"Insurance.page",setup(e){const{isFetching:t,data:n}=nt({chain:"ethereum"}),o=b(()=>(n.value??[]).map(T=>({timestamp:T.timestamp,apr:T.apr}))),{isFetching:s,data:i}=ot({chain:"ethereum"}),a=b(()=>(i.value??[]).map(T=>({timestamp:T.timestamp,tvl:T.tvl}))),c=Pe(1),{isFetching:l,data:h}=st(b(()=>({chain:"ethereum",page:c.value,per_page:10}))),{isFetching:y,data:f}=rt(R(()=>({chain:"ethereum"}))),{isFetching:Q,data:L}=at(R(()=>({chain:"ethereum"}))),{isFetching:v,data:he}=it(R(()=>({chain:"ethereum"})));return(T,J)=>{var M,G,X,Y,Z;const ge=fe;return $(),ke("div",Et,[u(ge,{style:{"grid-area":"header"},title:"Insurance",description:"Insurance pool metrics for Resupply including APR, TVL and positions"}),u(ut,{style:{"grid-area":"apr"},apr:r(o),loading:r(t)},null,8,["apr","loading"]),u(ht,{style:{"grid-area":"tvl"},tvl:r(a),loading:r(s)},null,8,["tvl","loading"]),u(St,{style:{"grid-area":"events"},events:((M=r(h))==null?void 0:M.events)??[],count:((G=r(h))==null?void 0:G.count)??0,loading:r(l),onPage:J[0]||(J[0]=ve=>c.value=ve)},null,8,["events","count","loading"]),u(qt,{style:{"grid-area":"top-users"},"top-users":((X=r(f))==null?void 0:X.users)??[],loading:r(y)},null,8,["top-users","loading"]),u(wt,{style:{"grid-area":"cooldowns"},cooldowns:((Y=r(L))==null?void 0:Y.entries)??[],loading:r(Q)},null,8,["cooldowns","loading"]),u(mt,{style:{"grid-area":"positions"},bins:((Z=r(he))==null?void 0:Z.bins)??[],loading:r(v)},null,8,["bins","loading"])])}}}),jt=V(Dt,[["__scopeId","data-v-978a25a4"]]);export{jt as default};
