import{_ as Q}from"./DashboardHeader-BUjwVYE-.js";import{d as U,u as E,a as x,aU as N,c as $,w as R,b as A,o as B,_ as M,e as h,f as w,g as d,h as t,aV as Z,k as W,m as Y,l as I,ah as ee,aW as te,aX as ae,t as L,i as oe,j as X,aA as se,aY as D}from"./index-B7fEYGi1.js";import{a as le,b as ne,c as re,d as ce}from"./stablecoin-DJuc6tMG.js";import{u as ie,_ as me}from"./UseLegend-CaQFPKdK.js";import{u as q,G as ue,r as de,a as H,_ as G,S as pe,c as z,D as _e}from"./UseLightweightChart-3f-X_BLf.js";import{_ as fe}from"./Tooltip-DU9iSTSn.js";import{_ as J}from"./ButtonToggle-l7ThU_mq.js";import{r as F,u as V}from"./Number-2LMhF5NG.js";import{_ as K}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-D0Te1FAL.js";const he={style:{display:"flex"}},ve={ref:"chartRef",class:"chart"},ge="chart_pool_balances_dollars",be="chart_pool_balances_type",ye=U({__name:"ChartBalances",props:{balances:{}},setup(i){const p=E(),{items:u,toggles:c,disabled:_}=ie(()=>i.balances.map(({symbol:e},s)=>({id:e,label:e,color:p.value.colorsArray[s],togglable:!0}))),y=x("card"),n=N(ge,!1),r=["unstacked","stacked","100%"],m=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],a=N(be,r[0]),{chart:l,series:o}=q({createChartOptions:H(),series:[...i.balances.map(({symbol:e},s)=>({type:ue,name:e,options:$(()=>({priceFormat:{type:"custom",formatter:v=>`${F(v,1,"dollar")}${V(v)}`},lineWidth:2,lineType:de.WithSteps,color:p.value.colorsArray[s],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stacked",options:$(()=>({priceFormat:{type:"custom",formatter:e=>`${F(e,1,"dollar")}${V(e)}`},colors:u.value.map((e,s)=>({item:e,i:s})).filter(({item:e})=>!_.value.includes(e.id)).map(({i:e})=>e).map(e=>p.value.colorsArray[e]).map(e=>({line:e,area:e+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});R(k);function k(){if(!(!l.value||Object.values(o).length<0)){for(const e of Object.values(o))e==null||e.setData([]);a.value==="unstacked"?P():O(a.value==="100%"),l.value.timeScale().fitContent()}}function P(){var e,s;for(const{symbol:v,balances:f}of i.balances.values()){if(!c[v].value){(e=o[v])==null||e.setData([]);continue}const g=n.value,C=f.map(b=>({time:b.timestamp.getUTCTimestamp(),value:g?b.balance*b.tokenPrice:b.balance})).uniqWith((b,T)=>b.time===T.time).orderBy(b=>b.time,"asc");C.length>0&&((s=o[v])==null||s.setData(C))}}function O(e){if(!o.stacked)return;const s=n.value,v=[...i.balances.values()].filter(({symbol:f,balances:g})=>c[f].value&&g.length>0).flatMap(({symbol:f,balances:g})=>g.map(C=>({symbol:f,timestamp:C.timestamp,balance:s?C.balance*C.tokenPrice:C.balance}))).groupBy(f=>f.timestamp.getTime()).entries().map(([f,g])=>{const C=e?g.reduce((T,S)=>T+S.balance,0):1,b=g.map(T=>e?T.balance/C*100:T.balance);return{time:Number(f)/1e3,values:b}}).uniqWith((f,g)=>f.time===g.time).orderBy(f=>f.time,"asc");v.length>0&&o.stacked.setData(v)}return(e,s)=>{const v=Z,f=J,g=fe,C=G,b=me,T=M;return B(),A(T,{ref_key:"card",ref:y,class:"stack-actions",title:"Balances"},{actions:h(()=>[w("div",he,[d(v,{options:m,selected:m.find(S=>S.id===t(a))??m[0],onSelect:s[0]||(s[0]=S=>a.value=S.id)},{option:h(({option:S})=>[W(Y(S.label),1)]),_:1},8,["selected"]),d(g,null,{trigger:h(()=>[d(f,{style:{"margin-right":"1rem"},"model-value":t(n),onClick:s[1]||(s[1]=S=>n.value=!t(n))},{default:h(()=>s[3]||(s[3]=[W(" $ ")])),_:1},8,["model-value"])]),default:h(()=>[s[4]||(s[4]=W(" Show token balances in USD. "))]),_:1}),d(C,{chart:t(l),target:t(y)},null,8,["chart","target"])])]),"actions-secondary":h(()=>[d(b,{items:t(u),disabled:t(_),onToggle:s[2]||(s[2]=S=>t(c)[S].value=!t(c)[S].value)},null,8,["items","disabled"])]),default:h(()=>[w("div",ve,null,512)]),_:1},512)}}}),Ce=I(ye,[["__scopeId","data-v-43570596"]]),Se={class:"controls"},$e={ref:"chartRef",class:"chart"},ke=U({__name:"ChartPrice",props:{ohlc:{},minMove:{default:()=>{}}},setup(i){const p=E(),u=ee(!1);let c=1,_=0;const{chart:y,series:n}=q({createChartOptions:H(),series:{type:pe,name:"ohlc",options:$(()=>{const{colors:a}=p.value;return{priceFormat:{type:"custom",formatter:m,minMove:i.minMove},upColor:a.green,borderUpColor:a.green,wickUpColor:a.green,downColor:a.red,borderDownColor:a.red,wickDownColor:a.red}})}});R(r);function r(){if(!y.value||!n.ohlc)return;const a=u.value?-1:1,l=i.ohlc.map(o=>({time:o.time.getUTCTimestamp(),open:Math.pow(o.open,a),high:Math.pow(o.high,a),low:Math.pow(o.low,a),close:Math.pow(o.close,a)})).uniqWith((o,k)=>o.time===k.time).orderBy(o=>o.time,"asc");l.length>0&&(n.ohlc.setData(l),_=Math.min(...l.map(o=>o.low)),c=Math.max(...l.map(o=>o.high))),y.value.timeScale().fitContent()}function m(a){const l=c-_,o=l>1?l-Math.floor(l):l,k=-Math.floor(Math.log10(o)+1)+2;return`${F(a,k,"dollar")}${V(a)}`}return(a,l)=>{const o=J,k=M;return B(),A(k,{title:"Price"},{actions:h(()=>[w("div",Se,[d(o,{"model-value":t(u),onClick:l[0]||(l[0]=P=>u.value=!t(u))},{default:h(()=>l[1]||(l[1]=[W(" Invert ")])),_:1},8,["model-value"])])]),default:h(()=>[w("div",$e,null,512)]),_:1})}}}),we=I(ke,[["__scopeId","data-v-251bffbb"]]),Te={style:{display:"flex"}},Be={ref:"chartRef",class:"chart"},De=U({__name:"ChartTvl",props:{tvl:{}},setup(i){const p=E(),u=x("card"),{chart:c,series:_}=q({createChartOptions:H(),series:z({name:"tvl",color:$(()=>p.value.colors.blue),formatter:n=>`$${F(n,1,"dollar")}${V(n)}`})});R(y);function y(){if(!c.value||!_.tvl)return;const n=i.tvl.map(r=>({time:r.timestamp.getUTCTimestamp(),value:r.tvl})).uniqWith((r,m)=>r.time===m.time).orderBy(r=>r.time,"asc");n.length>0&&_.tvl.setData(n),c.value.timeScale().fitContent()}return(n,r)=>{const m=K,a=G,l=M;return B(),A(l,{ref_key:"card",ref:u,title:"TVL"},{actions:h(()=>[w("div",Te,[d(m,{filename:"tvl",series:t(_)},null,8,["series"]),d(a,{chart:t(c),target:t(u)},null,8,["chart","target"])])]),default:h(()=>[w("div",Be,null,512)]),_:1},512)}}}),Ae={style:{display:"flex"}},Ue={ref:"chartRef",class:"chart"},Le=U({__name:"ChartVolume",props:{volume:{}},setup(i){const p=E(),u=x("card"),{chart:c,series:_}=q({createChartOptions:H(),series:z({name:"volume",color:$(()=>p.value.colors.blue),formatter:n=>`$${F(n,1,"dollar")}${V(n)}`})});R(y);function y(){if(!c.value||!_.volume)return;const n=i.volume.map(r=>({time:r.timestamp.getUTCTimestamp(),value:r.volume})).uniqWith((r,m)=>r.time===m.time).orderBy(r=>r.time,"asc");n.length>0&&_.volume.setData(n),c.value.timeScale().fitContent()}return(n,r)=>{const m=K,a=G,l=M;return B(),A(l,{ref_key:"card",ref:u,title:"Volume"},{actions:h(()=>[w("div",Ae,[d(m,{filename:"volume",series:t(_)},null,8,["series"]),d(a,{chart:t(c),target:t(u)},null,8,["chart","target"])])]),default:h(()=>[w("div",Ue,null,512)]),_:1},512)}}}),Fe=U({__name:"Pool",props:{pool:{}},setup(i){const p=$(()=>{switch(i.pool){case"scrvusd":return"0xc522A6606BBA746d7960404F22a3DB936B6F4F50";case"sfrxusd":return"0xed785Af60bEd688baa8990cD5c4166221599A441";default:throw new Error(`Unknown pool: ${i.pool}`)}}),u=$(()=>{switch(i.pool){case"scrvusd":return ae;case"sfrxusd":return te;default:throw new Error(`Unknown pool: ${i.pool}`)}}),{isFetching:c,data:_}=le(L(()=>"ethereum"),p,u,L(()=>oe)),{isFetching:y,data:n}=ne(L(()=>"ethereum"),p),{isFetching:r,data:m}=re(L(()=>"ethereum"),p),{isFetching:a,data:l}=ce(L(()=>"ethereum"),p.value),o=$(()=>n.value.map(e=>({timestamp:e.timestamp,volume:e.volume}))),k=$(()=>m.value.map(e=>({timestamp:e.timestamp,tvl:e.tvlUSD}))),P=$(()=>!l.value||m.value.length===0?[]:l.value.coins.map(e=>({symbol:e.symbol,balances:m.value.map(s=>({timestamp:s.timestamp,balance:s.balances[e.poolIndex],tokenPrice:s.tokenPrices[e.poolIndex]}))}))),O=$(()=>a.value||r.value);return(e,s)=>{const v=M;return B(),X(se,null,[w("div",{class:"title",style:D(`grid-area: title-${e.pool}`)}," Pool: "+Y(e.pool),5),d(we,{style:D(`grid-area: price-${e.pool}`),ohlc:t(_),loading:t(c),"min-move":.001},null,8,["style","ohlc","loading"]),d(Le,{style:D(`grid-area: volume-${e.pool}`),volume:t(o),loading:t(y)},null,8,["style","volume","loading"]),d(De,{style:D(`grid-area: tvl-${e.pool}`),tvl:t(k),loading:t(r)},null,8,["style","tvl","loading"]),t(O)?(B(),A(v,{key:1,loading:"",title:"Balances",style:D(`grid-area: balances-${e.pool}; min-height: ${t(_e)}`)},null,8,["style"])):(B(),A(Ce,{key:0,style:D(`grid-area: balances-${e.pool}`),balances:t(P),loading:t(O)},null,8,["style","balances","loading"]))],64)}}}),j=I(Fe,[["__scopeId","data-v-b59a0214"]]),Ve={class:"dashboard"},Me=U({__name:"Stablecoin.page",setup(i){return(p,u)=>{const c=Q;return B(),X("div",Ve,[d(c,{style:{"grid-area":"header"},title:"Stablecoin",description:"reUSD stablecoin metrics and liquidity pool analytics"}),d(j,{pool:"scrvusd"}),d(j,{pool:"sfrxusd"})])}}}),Ge=I(Me,[["__scopeId","data-v-70317081"]]);export{Ge as default};
