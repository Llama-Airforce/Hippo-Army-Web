import{_ as oe}from"./DashboardHeader-B9DjZVb_.js";import{c as f,d as U,az as R,av as G,aM as Q,aA as W,j as F,o as T,h as O,w as g,f as k,e as v,u as r,aN as se,i as E,g as X,_ as M,ae as ne,aO as le,aP as re,t as q,a as ce,b as x,aQ as ie,aR as B}from"./index-Ci__0x6w.js";import{u as N,r as A,a as L}from"./Number-BVeBD89l.js";import{u as ue,_ as de}from"./UseLegend-BWAKSbnJ.js";import{u as I,b as me,a as H,_ as z,c as ee,D as pe}from"./UseLightweightChart-CtaEGqrD.js";import{_ as _e}from"./Tooltip-CMs6kQZ9.js";import{_ as te}from"./ButtonToggle-CbsSXreG.js";import{_ as ae}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-Dt42c5sN.js";const K=e=>"https://prices.curve.fi";class ve extends Error{constructor(t,s){super(s),this.status=t}}async function j(e,t,s){const o=await fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t),signal:s});if(!o.ok)throw new ve(o.status,`Fetch error ${o.status} for URL: ${e}`);return o.json()}const he=/[+-]\d{2}:?\d{2}$/;function Z(e){if(typeof e=="number")return new Date(e*1e3);const t=Number(e);if(!Number.isNaN(t))return new Date(t*1e3);const o=e.endsWith("Z")||he.test(e)?e:`${e}Z`;return new Date(o)}const fe=24*60*60;function J({end:e,start:t,daysRange:s=10}={}){return e??(e=Math.floor(Date.now()/1e3)),t??(t=e-s*fe),{end:e,start:t}}const ge=e=>({time:Z(e.time),open:e.open,high:e.high,low:e.low,close:e.close});async function ye(e,t,s,o,d){const p=K(),{start:n,end:m}=J({daysRange:90}),_=`${p}/v1/ohlc/${e}/${t}?main_token=${s}&reference_token=${o}&agg_number=1&agg_units=day&start=${n}&end=${m}`;return(await j(_)).data.map(ge)}const be=e=>{var t,s;return{name:e.name,address:e.address,numCoins:e.n_coins,tvlUsd:e.tvl_usd,tradingVolume24h:e.trading_volume_24h,tradingFee24h:e.trading_fee_24h,liquidityVolume24h:e.liquidity_volume_24h,liquidityFee24h:e.liquidity_fee_24h,coins:((t=e.coins)==null?void 0:t.map(o=>({poolIndex:o.pool_index,symbol:o.symbol,address:o.address})))??[],baseDailyApr:e.base_daily_apr,baseWeeklyApr:e.base_weekly_apr,virtualPrice:e.virtual_price,poolMethods:((s=e.pool_methods)==null?void 0:s.map(o=>o))??[]}},$e=e=>({timestamp:Z(e.timestamp),volume:e.volume,fees:e.fees}),Ce=e=>({timestamp:Z(e.timestamp),tvlUSD:e.tvl_usd??0,balances:[...e.balances],tokenPrices:[...e.token_prices]});async function we(e,t,s){const o=K(),d=await j(`${o}/v1/pools/${e}/${t}`);return be(d)}async function Se(e,t,s){const o=K(),{start:d,end:p}=J({daysRange:90});return(await j(`${o}/v1/volume/usd/${e}/${t}?interval=day&start=${d}&end=${p}`)).data.map($e)}async function ke(e,t,s){const o=K(),{start:d,end:p}=J({daysRange:90});return(await j(`${o}/v1/snapshots/${e}/${t}/tvl?interval=day&start=${d}&end=${p}`)).data.map(Ce)}function De(e,t,s,o){return N({queryKey:["curve-token-price",t,s,o],queryFn:({queryKey:[,d,p,n]})=>ye(e.value,d,p,n),enabled:f(()=>!!e.value&&!!t.value&&!!s.value&&!!o.value),initialData:[],initialDataUpdatedAt:0})}function Te(e,t){return N({queryKey:["curve-pool",t],queryFn:async({queryKey:[,s]})=>we(e.value,s),enabled:f(()=>!!e.value)})}function Be(e,t){return N({queryKey:["curve-pool-volume",t],queryFn:async({queryKey:[,s]})=>Se(e.value,s),enabled:f(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}function Fe(e,t){return N({queryKey:["curve-pool-tvl",t],queryFn:async({queryKey:[,s]})=>ke(e.value,s),enabled:f(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}const Ue={style:{display:"flex"}},qe={ref:"chartRef",class:"chart"},Ae="chart_pool_balances_dollars",Le="chart_pool_balances_type",Oe=U({__name:"ChartBalances",props:{balances:{}},setup(e){const t=R(),{items:s,toggles:o,disabled:d}=ue(()=>e.balances.map(({symbol:a},i)=>({id:a,label:a,color:t.value.colorsArray[i],togglable:!0}))),p=G("card"),n=Q(Ae,!1),m=["unstacked","stacked","100%"],_=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],l=Q(Le,m[0]),{chart:u,series:c}=I({createChartOptions:H(),series:[...e.balances.map(({symbol:a},i)=>({type:"Line",name:a,options:f(()=>({priceFormat:{type:"custom",formatter:y=>`${A(y,1,"dollar")}${L(y)}`},lineWidth:2,lineType:me.WithSteps,color:t.value.colorsArray[i],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stacked",options:f(()=>({priceFormat:{type:"custom",formatter:a=>`${A(a,1,"dollar")}${L(a)}`},colors:s.value.map((a,i)=>({item:a,i})).filter(({item:a})=>!d.value.includes(a.id)).map(({i:a})=>a).map(a=>t.value.colorsArray[a]).map(a=>({line:a,area:a+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});W(S);function S(){if(!(!u.value||Object.values(c).length<0)){for(const a of Object.values(c))a==null||a.setData([]);l.value==="unstacked"?P():V(l.value==="100%"),u.value.timeScale().fitContent()}}function P(){var a,i;for(const{symbol:y,balances:h}of e.balances.values()){if(!o[y].value){(a=c[y])==null||a.setData([]);continue}const b=n.value,C=h.map($=>({time:$.timestamp.getUTCTimestamp(),value:b?$.balance*$.tokenPrice:$.balance})).uniqWith(($,D)=>$.time===D.time).orderBy($=>$.time,"asc");C.length>0&&((i=c[y])==null||i.setData(C))}}function V(a){if(!c.stacked)return;const i=n.value,y=[...e.balances.values()].filter(({symbol:h,balances:b})=>o[h].value&&b.length>0).flatMap(({symbol:h,balances:b})=>b.map(C=>({symbol:h,timestamp:C.timestamp,balance:i?C.balance*C.tokenPrice:C.balance}))).groupBy(h=>h.timestamp.getTime()).entries().map(([h,b])=>{const C=a?b.reduce((D,w)=>D+w.balance,0):1,$=b.map(D=>a?D.balance/C*100:D.balance);return{time:Number(h)/1e3,values:$}}).uniqWith((h,b)=>h.time===b.time).orderBy(h=>h.time,"asc");y.length>0&&c.stacked.setData(y)}return(a,i)=>{const y=se,h=te,b=_e,C=z,$=de,D=O;return T(),F(D,{ref_key:"card",ref:p,class:"stack-actions",title:"Balances"},{actions:g(()=>[k("div",Ue,[v(y,{options:_,selected:_.find(w=>w.id===r(l))??_[0],onSelect:i[0]||(i[0]=w=>l.value=w.id)},{option:g(({option:w})=>[E(X(w.label),1)]),_:1},8,["selected"]),v(b,null,{trigger:g(()=>[v(h,{style:{"margin-right":"1rem"},"model-value":r(n),onClick:i[1]||(i[1]=w=>n.value=!r(n))},{default:g(()=>i[3]||(i[3]=[E(" $ ")])),_:1},8,["model-value"])]),default:g(()=>[i[4]||(i[4]=E(" Show token balances in USD. "))]),_:1}),v(C,{chart:r(u),target:r(p)},null,8,["chart","target"])])]),"actions-secondary":g(()=>[v($,{items:r(s),disabled:r(d),onToggle:i[2]||(i[2]=w=>r(o)[w].value=!r(o)[w].value)},null,8,["items","disabled"])]),default:g(()=>[k("div",qe,null,512)]),_:1},512)}}}),Pe=M(Oe,[["__scopeId","data-v-e9381c7d"]]),Ve={class:"controls"},Ee={ref:"chartRef",class:"chart"},Re=U({__name:"ChartPrice",props:{ohlc:{}},setup(e){const t=R(),s=ne(!1);let o=1,d=0;const{chart:p,series:n}=I({createChartOptions:H(),series:{type:"Candlestick",name:"ohlc",options:f(()=>{const{colors:l}=t.value;return{priceFormat:{type:"custom",formatter:_},upColor:l.green,borderUpColor:l.green,wickUpColor:l.green,downColor:l.red,borderDownColor:l.red,wickDownColor:l.red}})}});W(m);function m(){if(!p.value||!n.ohlc)return;const l=s.value?-1:1,u=e.ohlc.map(c=>({time:c.time.getUTCTimestamp(),open:Math.pow(c.open,l),high:Math.pow(c.high,l),low:Math.pow(c.low,l),close:Math.pow(c.close,l)})).uniqWith((c,S)=>c.time===S.time).orderBy(c=>c.time,"asc");u.length>0&&(n.ohlc.setData(u),d=Math.min(...u.map(c=>c.low)),o=Math.max(...u.map(c=>c.high))),p.value.timeScale().fitContent()}function _(l){const u=o-d,c=u>1?u-Math.floor(u):u,S=-Math.floor(Math.log10(c)+1)+2;return`${A(l,S,"dollar")}${L(l)}`}return(l,u)=>{const c=te,S=O;return T(),F(S,{title:"Price"},{actions:g(()=>[k("div",Ve,[v(c,{"model-value":r(s),onClick:u[0]||(u[0]=P=>s.value=!r(s))},{default:g(()=>u[1]||(u[1]=[E(" Invert ")])),_:1},8,["model-value"])])]),default:g(()=>[k("div",Ee,null,512)]),_:1})}}}),We=M(Re,[["__scopeId","data-v-762b8110"]]),Me={style:{display:"flex"}},Ne={ref:"chartRef",class:"chart"},Ie=U({__name:"ChartTvl",props:{tvl:{}},setup(e){const t=R(),s=G("card"),{chart:o,series:d}=I({createChartOptions:H(),series:ee({name:"tvl",color:f(()=>t.value.colors.blue),formatter:n=>`$${A(n,1,"dollar")}${L(n)}`})});W(p);function p(){if(!o.value||!d.tvl)return;const n=e.tvl.map(m=>({time:m.timestamp.getUTCTimestamp(),value:m.tvl})).uniqWith((m,_)=>m.time===_.time).orderBy(m=>m.time,"asc");n.length>0&&d.tvl.setData(n),o.value.timeScale().fitContent()}return(n,m)=>{const _=ae,l=z,u=O;return T(),F(u,{ref_key:"card",ref:s,title:"TVL"},{actions:g(()=>[k("div",Me,[v(_,{filename:"tvl",series:r(d)},null,8,["series"]),v(l,{chart:r(o),target:r(s)},null,8,["chart","target"])])]),default:g(()=>[k("div",Ne,null,512)]),_:1},512)}}}),He={style:{display:"flex"}},Ke={ref:"chartRef",class:"chart"},je=U({__name:"ChartVolume",props:{volume:{}},setup(e){const t=R(),s=G("card"),{chart:o,series:d}=I({createChartOptions:H(),series:ee({name:"volume",color:f(()=>t.value.colors.blue),formatter:n=>`$${A(n,1,"dollar")}${L(n)}`})});W(p);function p(){if(!o.value||!d.volume)return;const n=e.volume.map(m=>({time:m.timestamp.getUTCTimestamp(),value:m.volume})).uniqWith((m,_)=>m.time===_.time).orderBy(m=>m.time,"asc");n.length>0&&d.volume.setData(n),o.value.timeScale().fitContent()}return(n,m)=>{const _=ae,l=z,u=O;return T(),F(u,{ref_key:"card",ref:s,title:"Volume"},{actions:g(()=>[k("div",He,[v(_,{filename:"volume",series:r(d)},null,8,["series"]),v(l,{chart:r(o),target:r(s)},null,8,["chart","target"])])]),default:g(()=>[k("div",Ke,null,512)]),_:1},512)}}}),Ge=U({__name:"Pool",props:{pool:{}},setup(e){const t=f(()=>{switch(e.pool){case"scrvusd":return"0xc522A6606BBA746d7960404F22a3DB936B6F4F50";case"sfrxusd":return"0xed785Af60bEd688baa8990cD5c4166221599A441";default:throw new Error(`Unknown pool: ${e.pool}`)}}),s=f(()=>{switch(e.pool){case"scrvusd":return re;case"sfrxusd":return le;default:throw new Error(`Unknown pool: ${e.pool}`)}}),{isFetching:o,data:d}=De(q(()=>"ethereum"),t,s,q(()=>ce)),{isFetching:p,data:n}=Be(q(()=>"ethereum"),t),{isFetching:m,data:_}=Fe(q(()=>"ethereum"),t),{isFetching:l,data:u}=Te(q(()=>"ethereum"),t.value),c=f(()=>n.value.map(a=>({timestamp:a.timestamp,volume:a.volume}))),S=f(()=>_.value.map(a=>({timestamp:a.timestamp,tvl:a.tvlUSD}))),P=f(()=>!u.value||_.value.length===0?[]:u.value.coins.map(a=>({symbol:a.symbol,balances:_.value.map(i=>({timestamp:i.timestamp,balance:i.balances[a.poolIndex],tokenPrice:i.tokenPrices[a.poolIndex]}))}))),V=f(()=>l.value||m.value);return(a,i)=>{const y=O;return T(),x(ie,null,[k("div",{class:"title",style:B(`grid-area: title-${a.pool}`)}," Pool: "+X(a.pool),5),v(We,{style:B(`grid-area: price-${a.pool}`),ohlc:r(d),loading:r(o)},null,8,["style","ohlc","loading"]),v(je,{style:B(`grid-area: volume-${a.pool}`),volume:r(c),loading:r(p)},null,8,["style","volume","loading"]),v(Ie,{style:B(`grid-area: tvl-${a.pool}`),tvl:r(S),loading:r(m)},null,8,["style","tvl","loading"]),r(V)?(T(),F(y,{key:1,loading:"",title:"Balances",style:B(`grid-area: balances-${a.pool}; min-height: ${r(pe)}`)},null,8,["style"])):(T(),F(Pe,{key:0,style:B(`grid-area: balances-${a.pool}`),balances:r(P),loading:r(V)},null,8,["style","balances","loading"]))],64)}}}),Y=M(Ge,[["__scopeId","data-v-0c85c11a"]]),ze={class:"dashboard"},Ze=U({__name:"Stablecoin.page",setup(e){return(t,s)=>{const o=oe;return T(),x("div",ze,[v(o,{style:{"grid-area":"header"},title:"Stablecoin",description:"reUSD stablecoin metrics and liquidity pool analytics"}),v(Y,{pool:"scrvusd"}),v(Y,{pool:"sfrxusd"})])}}}),ot=M(Ze,[["__scopeId","data-v-70317081"]]);export{ot as default};
