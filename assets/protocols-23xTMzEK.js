var J=e=>{throw TypeError(e)};var I=(e,t,s)=>t.has(e)||J("Cannot "+s);var l=(e,t,s)=>(I(e,t,"read from private field"),s?s.call(e):t.get(e)),g=(e,t,s)=>t.has(e)?J("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),h=(e,t,s,r)=>(I(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),d=(e,t,s)=>(I(e,t,"access private method"),s);import{Q as se,o as m,s as n,n as c,b as D,t as E,l as S,p as B,d as Y,f as U,g as M,i as T,a as H}from"./timestamp-BJgOM8hi.js";import{aL as re,aM as V,aN as oe,aO as ae,c as k,h as ne,aP as ie,aQ as le,av as G,aj as ce,aR as ue,ak as pe,am as z}from"./index-B0gvS3y9.js";import{p as he}from"./Pagination-vgbH7lYO.js";function W(e,t){return e.filter(s=>!t.includes(s))}function me(e,t,s){const r=e.slice(0);return r[t]=s,r}var w,_,O,R,b,v,Q,q,C,p,K,L,N,j,A,X,_e=(X=class extends re{constructor(t,s,r){super();g(this,p);g(this,w);g(this,_);g(this,O);g(this,R);g(this,b);g(this,v);g(this,Q);g(this,q);g(this,C,[]);h(this,w,t),h(this,R,r),h(this,O,[]),h(this,b,[]),h(this,_,[]),this.setQueries(s)}onSubscribe(){this.listeners.size===1&&l(this,b).forEach(t=>{t.subscribe(s=>{d(this,p,j).call(this,t,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,l(this,b).forEach(t=>{t.destroy()})}setQueries(t,s){h(this,O,t),h(this,R,s),V.batch(()=>{const r=l(this,b),a=d(this,p,N).call(this,l(this,O));h(this,C,a),a.forEach(u=>u.observer.setOptions(u.defaultedQueryOptions));const o=a.map(u=>u.observer),i=o.map(u=>u.getCurrentResult()),f=o.some((u,y)=>u!==r[y]);r.length===o.length&&!f||(h(this,b,o),h(this,_,i),this.hasListeners()&&(W(r,o).forEach(u=>{u.destroy()}),W(o,r).forEach(u=>{u.subscribe(y=>{d(this,p,j).call(this,u,y)})}),d(this,p,A).call(this)))})}getCurrentResult(){return l(this,_)}getQueries(){return l(this,b).map(t=>t.getCurrentQuery())}getObservers(){return l(this,b)}getOptimisticResult(t,s){const r=d(this,p,N).call(this,t),a=r.map(o=>o.observer.getOptimisticResult(o.defaultedQueryOptions));return[a,o=>d(this,p,L).call(this,o??a,s),()=>d(this,p,K).call(this,a,r)]}},w=new WeakMap,_=new WeakMap,O=new WeakMap,R=new WeakMap,b=new WeakMap,v=new WeakMap,Q=new WeakMap,q=new WeakMap,C=new WeakMap,p=new WeakSet,K=function(t,s){return s.map((r,a)=>{const o=t[a];return r.defaultedQueryOptions.notifyOnChangeProps?o:r.observer.trackResult(o,i=>{s.forEach(f=>{f.observer.trackProp(i)})})})},L=function(t,s){return s?((!l(this,v)||l(this,_)!==l(this,q)||s!==l(this,Q))&&(h(this,Q,s),h(this,q,l(this,_)),h(this,v,oe(l(this,v),s(t)))),l(this,v)):t},N=function(t){const s=new Map(l(this,b).map(a=>[a.options.queryHash,a])),r=[];return t.forEach(a=>{const o=l(this,w).defaultQueryOptions(a),i=s.get(o.queryHash);i?r.push({defaultedQueryOptions:o,observer:i}):r.push({defaultedQueryOptions:o,observer:new se(l(this,w),o)})}),r},j=function(t,s){const r=l(this,b).indexOf(t);r!==-1&&(h(this,_,me(l(this,_),r,s)),d(this,p,A).call(this))},A=function(){var t;if(this.hasListeners()){const s=l(this,v),r=d(this,p,K).call(this,l(this,_),l(this,C)),a=d(this,p,L).call(this,r,(t=l(this,R))==null?void 0:t.combine);s!==a&&V.batch(()=>{this.listeners.forEach(o=>{o(l(this,_))})})}},X);function be({queries:e,...t},s){const r=ae(),a=k(()=>ne(e).map($=>{const F=ie($);typeof F.enabled=="function"&&(F.enabled=$.enabled());const x=r.defaultQueryOptions(F);return x._optimisticResults=r.isRestoring.value?"isRestoring":"optimistic",x})),o=new _e(r,a.value,t),i=()=>{const[y,$]=o.getOptimisticResult(a.value,t.combine);return $(y.map((F,x)=>({...F,refetch:async(...ee)=>{const[{[x]:te}]=o.getOptimisticResult(a.value,t.combine);return te.refetch(...ee)}})))},f=le(i());let u=()=>{};return G(r.isRestoring,y=>{y||(u(),u=o.subscribe(()=>{f.value=i()}),f.value=i())},{immediate:!0}),G(a,y=>{o.setQueries(y,t),f.value=i()}),ce(()=>{u()}),t.shallow?ue(f):pe(f)}const fe=m({name:n(),protocol_id:c(),pairs_count:c(),active_positions_count:c(),total_collateral:n(),total_underlying:n(),total_debt:n()}).transform(e=>({name:e.name,protocolId:e.protocol_id,pairsCount:e.pairs_count,activePositionsCount:e.active_positions_count,totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),totalDebt:parseFloat(e.total_debt)})),ge=m({protocols:D(fe),count:c()}).transform(e=>({protocols:e.protocols,count:e.count})),P=m({symbol:n(),name:n(),address:n(),precision:c()}).transform(e=>({symbol:e.symbol,name:e.name,address:e.address,precision:e.precision})),de=m({token_address:n(),token_symbol:n(),apr:n()}).transform(e=>({tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),ye=m({pair_id:c(),name:n(),address:n(),total_collateral:n(),total_underlying:n(),exchange_rate:n(),total_debt:n(),active_positions_count:c(),borrow_limit:n(),utilization_rate:n(),interest_rate:n(),claimable_fees:n(),claimable_other_fees:n(),block_timestamp:c(),last_redemption:c().nullable(),redemption_fee_10k:n(),borrow_cost_apr:n(),base_apr:n(),rewards:D(de),collateral_token:P,debt_token:P,underlying_token:P,pair_collateral_token:P,pair_underlying_token:P}).transform(e=>({pairId:e.pair_id,name:e.name,address:e.address,totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),exchangeRate:parseFloat(e.exchange_rate),totalDebt:parseFloat(e.total_debt),activePositionsCount:e.active_positions_count,borrowLimit:parseFloat(e.borrow_limit),utilizationRate:parseFloat(e.utilization_rate),interestRate:parseFloat(e.interest_rate),claimableFees:parseFloat(e.claimable_fees),claimableOtherFees:parseFloat(e.claimable_other_fees),blockTime:E(e.block_timestamp),lastRedemption:e.last_redemption?E(e.last_redemption):null,redemptionFee10k:parseFloat(e.redemption_fee_10k),aprBorrowCost:parseFloat(e.borrow_cost_apr),aprBase:parseFloat(e.base_apr),rewards:e.rewards,tokenCollateral:e.collateral_token,tokenDebt:e.debt_token,tokenUnderlying:e.underlying_token,tokenPairCollateral:e.pair_collateral_token,tokenPairUnderyling:e.pair_underlying_token})),ve=m({pairs:D(ye),count:c(),page:c(),total_pages:c()}).transform(e=>({pairs:e.pairs,count:e.count,page:e.page,totalPages:e.total_pages})),ke=m({crvusd_price:n(),frxusd_price:n(),block_number:c(),block_timestamp:c()}).transform(e=>({crvusd:parseFloat(e.crvusd_price),frxusd:parseFloat(e.frxusd_price),blockNumber:e.block_number,timestamp:E(e.block_timestamp)})),we=m({prices:D(ke),count:c(),page:c(),total_pages:c()}).transform(e=>({prices:e.prices,count:e.count,page:e.page,totalPages:e.total_pages})),Oe=m({name:n(),protocol_id:c(),pairs_count:c(),active_positions_count:c(),total_collateral:n(),total_underlying:n(),total_debt:n(),timestamp:c()}).transform(e=>({timestamp:E(e.timestamp),name:e.name,protocolId:e.protocol_id,pairsCount:e.pairs_count,totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),totalDebt:parseFloat(e.total_debt)})),Re=m({snapshots:D(Oe),count:c(),page:c(),total_pages:c()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),Fe=m(S);async function Pe(e,t){const s=M(t),{chain:r}=Fe.parse(e),a=await U(`${s}/v1/protocols/overview/${r}`,void 0,t==null?void 0:t.signal);return ge.parse(a)}const Qe=m({...S,...B,protocol_name:n()});async function qe(e,t){const s=M(t),{chain:r,protocol_name:a,...o}=Qe.parse(e),i=T(o),f=await U(`${s}/v1/protocols/${r}/${a}/pairs${i}`,void 0,t==null?void 0:t.signal);return ve.parse(f)}const Ce=m({...S,...Y,...B});async function De(e,t){const s=M(t),{chain:r,...a}=Ce.parse(e),o=T(a),i=await U(`${s}/v1/protocols/${r}/oracle_prices${o}`,void 0,t==null?void 0:t.signal);return we.parse(i)}const $e=m({...S,...Y,...B});async function xe(e,t){const s=M(t),{chain:r,...a}=$e.parse(e),o=T(a),i=await U(`${s}/v1/protocols/history/${r}${o}`,void 0,t==null?void 0:t.signal);return Re.parse(i)}function Ee(e){return H({queryKey:["protocols-overview",e],queryFn:()=>Pe(z(e))})}function Z(e){return{queryKey:["protocols-pairs",e],queryFn:()=>he((s,r)=>qe({...z(e),page:s,per_page:r}).then(a=>a.pairs),1,100)}}function ze(e,t){return H({...Z(e),enabled:t})}function Ie(){const{data:e}=Ee({chain:"ethereum"}),t=k(()=>{var o;return(((o=e.value)==null?void 0:o.protocols)??[]).map(i=>i.name)}),s=k(()=>{var o;return(((o=e.value)==null?void 0:o.count)??0)>0}),r=k(()=>t.value.map(o=>({...Z({chain:"ethereum",protocol_name:o}),enabled:s}))),a=be({queries:r,combine:o=>({data:o.map(i=>i.data).filter(i=>i!==void 0).flat(),pending:o.some(i=>i.isPending)})});return{data:k(()=>a.value.data),pending:k(()=>a.value.pending)}}function Ke(e){return H({queryKey:["protocols-oracle-prices",e],queryFn:()=>De(z(e))})}function Le(e){return H({queryKey:["protocols-history",e],queryFn:()=>xe(z(e))})}export{Le as a,ze as b,Ee as c,Ke as d,Ie as u};
