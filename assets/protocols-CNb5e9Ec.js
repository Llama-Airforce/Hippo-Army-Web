var I=e=>{throw TypeError(e)};var x=(e,t,s)=>t.has(e)||I("Cannot "+s);var a=(e,t,s)=>(x(e,t,"read from private field"),s?s.call(e):t.get(e)),_=(e,t,s)=>t.has(e)?I("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),p=(e,t,s,r)=>(x(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),d=(e,t,s)=>(x(e,t,"access private method"),s);import{Q as Z,t as L,f as K,b as ee,a as N}from"./Number-2LMhF5NG.js";import{aN as te,aO as T,aP as se,aQ as re,c as w,h as oe,aR as ne,aS as ae,ar as j,ai as ie,aT as le,aj as ce,ax as J}from"./index-B7fEYGi1.js";import{o as y,s as i,n as b,a as H,f as V,p as ue,g as G}from"./AsyncValue-CcfLQ0pX.js";import{p as pe}from"./Pagination-vgbH7lYO.js";function A(e,t){return e.filter(s=>!t.includes(s))}function he(e,t,s){const r=e.slice(0);return r[t]=s,r}var k,h,R,O,m,v,C,P,q,u,S,U,M,$,z,B,me=(B=class extends te{constructor(t,s,r){super();_(this,u);_(this,k);_(this,h);_(this,R);_(this,O);_(this,m);_(this,v);_(this,C);_(this,P);_(this,q,[]);p(this,k,t),p(this,O,r),p(this,R,[]),p(this,m,[]),p(this,h,[]),this.setQueries(s)}onSubscribe(){this.listeners.size===1&&a(this,m).forEach(t=>{t.subscribe(s=>{d(this,u,$).call(this,t,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,a(this,m).forEach(t=>{t.destroy()})}setQueries(t,s){p(this,R,t),p(this,O,s),T.batch(()=>{const r=a(this,m),n=d(this,u,M).call(this,a(this,R));p(this,q,n),n.forEach(c=>c.observer.setOptions(c.defaultedQueryOptions));const o=n.map(c=>c.observer),l=o.map(c=>c.getCurrentResult()),f=o.some((c,g)=>c!==r[g]);r.length===o.length&&!f||(p(this,m,o),p(this,h,l),this.hasListeners()&&(A(r,o).forEach(c=>{c.destroy()}),A(o,r).forEach(c=>{c.subscribe(g=>{d(this,u,$).call(this,c,g)})}),d(this,u,z).call(this)))})}getCurrentResult(){return a(this,h)}getQueries(){return a(this,m).map(t=>t.getCurrentQuery())}getObservers(){return a(this,m)}getOptimisticResult(t,s){const r=d(this,u,M).call(this,t),n=r.map(o=>o.observer.getOptimisticResult(o.defaultedQueryOptions));return[n,o=>d(this,u,U).call(this,o??n,s),()=>d(this,u,S).call(this,n,r)]}},k=new WeakMap,h=new WeakMap,R=new WeakMap,O=new WeakMap,m=new WeakMap,v=new WeakMap,C=new WeakMap,P=new WeakMap,q=new WeakMap,u=new WeakSet,S=function(t,s){return s.map((r,n)=>{const o=t[n];return r.defaultedQueryOptions.notifyOnChangeProps?o:r.observer.trackResult(o,l=>{s.forEach(f=>{f.observer.trackProp(l)})})})},U=function(t,s){return s?((!a(this,v)||a(this,h)!==a(this,P)||s!==a(this,C))&&(p(this,C,s),p(this,P,a(this,h)),p(this,v,se(a(this,v),s(t)))),a(this,v)):t},M=function(t){const s=new Map(a(this,m).map(n=>[n.options.queryHash,n])),r=[];return t.forEach(n=>{const o=a(this,k).defaultQueryOptions(n),l=s.get(o.queryHash);l?r.push({defaultedQueryOptions:o,observer:l}):r.push({defaultedQueryOptions:o,observer:new Z(a(this,k),o)})}),r},$=function(t,s){const r=a(this,m).indexOf(t);r!==-1&&(p(this,h,he(a(this,h),r,s)),d(this,u,z).call(this))},z=function(){var t;if(this.hasListeners()){const s=a(this,v),r=d(this,u,S).call(this,a(this,h),a(this,q)),n=d(this,u,U).call(this,r,(t=a(this,O))==null?void 0:t.combine);s!==n&&T.batch(()=>{this.listeners.forEach(o=>{o(a(this,h))})})}},B);function be({queries:e,...t},s){const r=re(),n=w(()=>oe(e).map(D=>{const Q=ne(D);typeof Q.enabled=="function"&&(Q.enabled=D.enabled());const E=r.defaultQueryOptions(Q);return E._optimisticResults=r.isRestoring.value?"isRestoring":"optimistic",E})),o=new me(r,n.value,t),l=()=>{const[g,D]=o.getOptimisticResult(n.value,t.combine);return D(g.map((Q,E)=>({...Q,refetch:async(...X)=>{const[{[E]:Y}]=o.getOptimisticResult(n.value,t.combine);return Y.refetch(...X)}})))},f=ae(l());let c=()=>{};return j(r.isRestoring,g=>{g||(c(),c=o.subscribe(()=>{f.value=l()}),f.value=l())},{immediate:!0}),j(n,g=>{o.setQueries(g,t),f.value=l()}),ie(()=>{c()}),t.shallow?le(f):ce(f)}const fe=y({name:i(),protocol_id:b(),pairs_count:b(),active_positions_count:b(),total_collateral:i(),total_underlying:i(),total_debt:i()}).transform(e=>({name:e.name,protocolId:e.protocol_id,pairsCount:e.pairs_count,activePositionsCount:e.active_positions_count,totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),totalDebt:parseFloat(e.total_debt)})),_e=y({protocols:H(fe),count:b()}).transform(e=>({protocols:e.protocols,count:e.count})),F=y({symbol:i(),name:i(),address:i(),precision:b()}).transform(e=>({symbol:e.symbol,name:e.name,address:e.address,precision:e.precision})),de=y({token_address:i(),token_symbol:i(),apr:i()}).transform(e=>({tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),ge=y({pair_id:b(),name:i(),address:i(),total_collateral:i(),total_underlying:i(),exchange_rate:i(),total_debt:i(),active_positions_count:b(),borrow_limit:i(),utilization_rate:i(),interest_rate:i(),claimable_fees:i(),claimable_other_fees:i(),block_timestamp:b(),last_redemption:b().nullable(),redemption_fee_10k:i(),borrow_cost_apr:i(),base_apr:i(),rewards:H(de),collateral_token:F,debt_token:F,underlying_token:F,pair_collateral_token:F,pair_underlying_token:F}).transform(e=>({pairId:e.pair_id,name:e.name,address:e.address,totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),exchangeRate:parseFloat(e.exchange_rate),totalDebt:parseFloat(e.total_debt),activePositionsCount:e.active_positions_count,borrowLimit:parseFloat(e.borrow_limit),utilizationRate:parseFloat(e.utilization_rate),interestRate:parseFloat(e.interest_rate),claimableFees:parseFloat(e.claimable_fees),claimableOtherFees:parseFloat(e.claimable_other_fees),blockTime:L(e.block_timestamp),lastRedemption:e.last_redemption?L(e.last_redemption):null,redemptionFee10k:parseFloat(e.redemption_fee_10k),aprBorrowCost:parseFloat(e.borrow_cost_apr),aprBase:parseFloat(e.base_apr),rewards:e.rewards,tokenCollateral:e.collateral_token,tokenDebt:e.debt_token,tokenUnderlying:e.underlying_token,tokenPairCollateral:e.pair_collateral_token,tokenPairUnderyling:e.pair_underlying_token})),ve=y({pairs:H(ge),count:b(),page:b(),total_pages:b()}).transform(e=>({pairs:e.pairs,count:e.count,page:e.page,totalPages:e.total_pages})),ye=y(V);async function we(e,t){const s=G(t),{chain:r}=ye.parse(e),n=await K(`${s}/v1/protocols/overview/${r}`,void 0,t==null?void 0:t.signal);return _e.parse(n)}const ke=y({...V,...ue,protocol_name:i()});async function Re(e,t){const s=G(t),{chain:r,protocol_name:n,...o}=ke.parse(e),l=ee(o),f=await K(`${s}/v1/protocols/${r}/${n}/pairs${l}`,void 0,t==null?void 0:t.signal);return ve.parse(f)}function Oe(e){return N({queryKey:["protocols-overview",e],queryFn:()=>we(J(e))})}function W(e){return{queryKey:["protocols-pairs",e],queryFn:()=>pe((s,r)=>Re({...J(e),page:s,per_page:r}).then(n=>n.pairs),1,100)}}function De(e,t){return N({...W(e),enabled:t})}function Ee(){const{data:e}=Oe({chain:"ethereum"}),t=w(()=>{var o;return(((o=e.value)==null?void 0:o.protocols)??[]).map(l=>l.name)}),s=w(()=>{var o;return(((o=e.value)==null?void 0:o.count)??0)>0}),r=w(()=>t.value.map(o=>({...W({chain:"ethereum",protocol_name:o}),enabled:s}))),n=be({queries:r,combine:o=>({data:o.map(l=>l.data).filter(l=>l!==void 0).flat(),pending:o.some(l=>l.isPending)})});return{data:w(()=>n.value.data),pending:w(()=>n.value.pending)}}export{De as a,Oe as b,Ee as u};
