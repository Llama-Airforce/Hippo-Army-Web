import{_ as A}from"./DashboardHeader-CBTrQLFq.js";import{u as E,r as V,a as W}from"./Number-JCDnKITR.js";import{z as h,d as K,t as N,p as Q,a as z,e as Y,g as J}from"./timestamp-D1DOFXxn.js";import{a as G,f as X,_ as R}from"./fetch-CzIKldv6.js";import{aI as Z,ar as tt,d as D,at as x,au as B,c as v,av as F,j as w,o as y,w as b,f as p,e as l,u,h as T,b as L,i as $,_ as S,aj as et,al as st,am as P,g as C,aV as at,ae as nt}from"./index--6aQy66t.js";import{u as M,c as O,_ as q}from"./UseLightweightChart-CBj2c-74.js";import{_ as I}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-Kqoh4nS8.js";import{_ as ot}from"./KPI-Do90NnUD.js";import{_ as it}from"./Table-B1fGGnP3.js";import{a as rt,_ as ut}from"./UsePagination-BUVeOBbV.js";import{u as lt}from"./UseRelativeTime-B1_it9GW.js";import"./Tooltip-ZsHLl0Z0.js";const ct=h.object({block_timestamp:h.number(),tx_hash:h.string(),block_number:h.number(),operator:K,amount:h.string()}).transform(o=>({blockTime:N(o.block_timestamp),txHash:o.tx_hash,blockNumber:o.block_number,operator:o.operator,amount:parseFloat(o.amount)})),mt=h.object({distributions:h.array(ct),count:h.number(),page:h.number(),total_pages:h.number()}).transform(o=>({distributions:o.distributions,count:o.count,page:o.page,totalPages:o.total_pages})),dt=h.object({...Y,...z,...Q});async function _t(o,m){const i=J(),{chain:r,...d}=dt.parse(o),_=G(d),e=await X(`${i}/v1/revenue/${r}/distributions${_}`,void 0,m==null?void 0:m.signal);return mt.parse(e)}function U(o){return E({queryKey:["revenue-distributions",o],queryFn:()=>_t(tt(o)),placeholderData:Z})}const pt={style:{display:"flex"}},ht={ref:"chartRef",class:"chart"},bt=D({__name:"ChartDistributions",props:{distributions:{}},setup(o){const m=x(),i=B("card"),{chart:r,series:d}=M({createChartOptions:O(),series:{type:"Histogram",name:"distributions",options:v(()=>({priceFormat:{type:"custom",formatter:e=>`$${V(e,0,"dollar")}${W(e)}`,minMove:.01},color:m.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});F(_);function _(){if(!r.value||!d.distributions)return;const e=o.distributions.map(n=>({time:n.blockTime.getUTCTimestamp(),value:n.amount})).uniqWith((n,s)=>n.time===s.time).orderBy(n=>n.time,"asc").takeRight(52);e.length>0&&(d.distributions.setData(e),r.value.timeScale().fitContent())}return(e,n)=>{const s=I,a=q,t=T;return y(),w(t,{ref_key:"card",ref:i,title:"Distributions (1y)"},{actions:b(()=>[p("div",pt,[l(s,{filename:"distributions",series:u(d)},null,8,["series"]),l(a,{chart:u(r),target:u(i)},null,8,["chart","target"])])]),default:b(()=>[p("div",ht,null,512)]),_:1},512)}}}),ft={style:{display:"flex"}},gt={ref:"chartRef",class:"chart"},vt=D({__name:"ChartDistributionsDelta",props:{distributions:{}},setup(o){const m=x(),i=B("card"),{chart:r,series:d}=M({createChartOptions:O(),series:{type:"Histogram",name:"deltas",options:v(()=>({priceFormat:{type:"custom",formatter:e=>`$${V(e,0,"dollar")}${W(e)}`,minMove:.01},color:m.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});F(_);function _(){if(!r.value||!d.deltas)return;const{colors:e}=m.value,n=o.distributions.map(s=>({time:s.blockTime.getUTCTimestamp(),value:s.amount})).uniqWith((s,a)=>s.time===a.time).orderBy(s=>s.time,"asc").takeRight(53).reduce((s,a,t,c)=>{if(t===0)return s;const f=a.value-c[t-1].value,k=f<0?e.red:e.green;return s.push({time:a.time,value:f,color:k}),s},[]);n.length>0&&(d.deltas.setData(n),r.value.timeScale().fitContent())}return(e,n)=>{const s=I,a=q,t=T;return y(),w(t,{ref_key:"card",ref:i,title:"Distributions Change (1y)"},{actions:b(()=>[p("div",ft,[l(s,{filename:"distributions_delta",series:u(d)},null,8,["series"]),l(a,{chart:u(r),target:u(i)},null,8,["chart","target"])])]),default:b(()=>[p("div",gt,null,512)]),_:1},512)}}}),Dt={class:"kpis"},yt=D({__name:"KPIs",setup(o){const m={chain:"ethereum"},{data:i}=U(m),r=v(()=>{var e;return(e=i.value)!=null&&e.distributions?i.value.distributions.reduce((n,s)=>n+s.amount,0):null}),d=v(()=>{var n;if(!((n=i.value)!=null&&n.distributions)||i.value.distributions.length===0)return null;const e=i.value.distributions.slice(0,52);return e.reduce((s,a)=>s+a.amount,0)/e.length}),_=v(()=>{var a;if(!((a=i.value)!=null&&a.distributions)||i.value.distributions.length===0)return null;const e=i.value.distributions.slice(0,52).map(t=>t.amount),n=e.reduce((t,c)=>t+c,0)/e.length,s=e.map(t=>Math.pow(t-n,2));return Math.sqrt(s.reduce((t,c)=>t+c,0)/(e.length-1))});return(e,n)=>{const s=R,a=ot;return y(),L("div",Dt,[l(a,{label:"Total","has-value":!!u(r)},{default:b(()=>[l(s,{type:"dollar",value:u(r),precision:2,"show-symbol":!1},null,8,["value"]),n[0]||(n[0]=$(" reUSD "))]),_:1},8,["has-value"]),l(a,{label:"Average (1y)","has-value":!!u(d)},{default:b(()=>[l(s,{type:"dollar",value:u(d),precision:2,"show-symbol":!1},null,8,["value"]),n[1]||(n[1]=$(" reUSD "))]),_:1},8,["has-value"]),l(a,{label:"Standard Deviation (1y)","has-value":!!u(_)},{default:b(()=>[l(s,{type:"dollar",value:u(_),precision:2,"show-symbol":!1},null,8,["value"]),n[2]||(n[2]=$(" reUSD "))]),_:1},8,["has-value"])])}}}),kt=S(yt,[["__scopeId","data-v-bfc974c7"]]),$t=["href"],Ct={class:"period"},wt={class:"end"},Tt={class:"end"},St=["href"],Pt=D({__name:"TableDistributions",props:{distributions:{},count:{}},emits:["page"],setup(o,{emit:m}){const i=m,{page:r,onPage:d}=rt(),_=et(r,200);st(_,a=>{i("page",a)});const{relativeTime:e}=lt();function n(a){const t=new Date(a);t.setDate(a.getDate()+4);const c=new Date(t);return c.setDate(t.getDate()-t.getDay()),`${c.toLocaleString("default",{month:"short"})} ${c.getDate()}`}function s(a){const t=new Date(a);t.setDate(a.getDate()+4);const c=new Date(t);c.setDate(t.getDate()-t.getDay());const f=new Date(c);return f.setDate(c.getDate()+4),`${f.toLocaleString("default",{month:"short"})} ${f.getDate()}`}return(a,t)=>{const c=ut,f=at,k=R,H=it,j=T;return y(),w(j,{title:"Distributions"},{actions:b(()=>[l(c,{"items-count":a.count,"items-per-page":10,page:u(r),onPage:u(d)},null,8,["items-count","page","onPage"])]),default:b(()=>[l(H,{rows:a.distributions,columns:["Period",{label:"Amount (reUSD)",align:"end"},{label:"Time",align:"end"}]},{row:b(({item:g})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${g.operator.address}`,onClick:t[0]||(t[0]=P(()=>{},["stop"]))},[p("div",Ct,[p("span",null,C(n(g.blockTime)),1),l(f,{class:"chevron"}),p("span",null,C(s(g.blockTime)),1)])],8,$t)]),p("div",wt,[l(k,{"show-zero":"",type:"dollar",value:g.amount,"show-symbol":!1,precision:2},null,8,["value"])]),p("div",Tt,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${g.txHash}`,onClick:t[1]||(t[1]=P(()=>{},["stop"]))},C(u(e)(g.blockTime.getUTCTimestamp())),9,St)])]),_:1},8,["rows"])]),_:1})}}}),Vt=S(Pt,[["__scopeId","data-v-e0a42fd0"]]),Wt={class:"dashboard"},Rt=D({__name:"Revenue.page",setup(o){const m=nt(1),{isFetching:i,data:r}=U(v(()=>({chain:"ethereum",page:m.value,per_page:15})));return(d,_)=>{var n,s,a,t;const e=A;return y(),L("div",Wt,[l(e,{style:{"grid-area":"header"},title:"Revenue",description:"Token revenue distribution metrics"}),l(kt,{style:{"grid-area":"kpis"}}),l(bt,{style:{"grid-area":"chart"},distributions:((n=u(r))==null?void 0:n.distributions)??[]},null,8,["distributions"]),l(vt,{style:{"grid-area":"delta"},distributions:((s=u(r))==null?void 0:s.distributions)??[]},null,8,["distributions"]),l(Vt,{style:{"grid-area":"table"},distributions:((a=u(r))==null?void 0:a.distributions)??[],count:((t=u(r))==null?void 0:t.count)??0,loading:u(i),onPage:_[0]||(_[0]=c=>m.value=c)},null,8,["distributions","count","loading"])])}}}),Et=S(Rt,[["__scopeId","data-v-1c2abc2e"]]);export{Et as default};
