import{_ as fe}from"./DashboardHeader-BUjwVYE-.js";import{t as F,b as I,f as S,a as x,g as te,r as A,u as O}from"./Number-2LMhF5NG.js";import{o as p,e as B,s as l,n as u,d as ye,a as w,h as be,p as Q,t as L,f as $,g as U,_ as N}from"./AsyncValue-CcfLQ0pX.js";import{p as se}from"./Pagination-vgbH7lYO.js";import{aJ as we,ax as D,d as T,u as ae,a as ne,c as b,w as oe,b as E,o as k,e as h,f as _,g as d,h as r,_ as H,l as V,t as R,as as q,m as P,au as j,ap as $e,ar as Te,an as ke,ah as Ce,j as Pe}from"./index-B7fEYGi1.js";import{u as re,c as ie,a as ce,_ as le}from"./UseLightweightChart-3f-X_BLf.js";import{_ as ue}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-D0Te1FAL.js";import{_ as Fe}from"./ChartApex-DZxckm3J.js";import{c as Se}from"./ChartStylesApex-BMI2O3c4.js";import{_ as z}from"./Table-C5dgkW7x.js";import{u as xe,_ as pe,a as Ue}from"./UsePagination-B_CWYAdH.js";import{u as me}from"./UseRelativeTime-BcQ4VfeI.js";const de=p({event_type:ye(["deposit","withdraw"]),block_timestamp:u(),tx_hash:l(),block_number:u(),assets:l(),shares:l(),sender:B,owner:B}),_e=e=>({eventType:e.event_type,blockTime:F(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,assets:parseFloat(e.assets),shares:parseFloat(e.shares),sender:e.sender,owner:e.owner}),De=de.refine(e=>e.event_type==="deposit",{message:"Expected deposit event type"}).transform(_e),Ee=de.extend({receiver:B}).refine(e=>e.event_type==="withdraw",{message:"Expected withdraw event type"}).transform(e=>({..._e(e),receiver:e.receiver})),He=p({events:w(be([De,Ee])),count:u(),page:u(),total_pages:u()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),qe=p({account:B,amount:l(),end_timestamp:u(),block_timestamp:u(),tx_hash:l()}).transform(e=>({account:e.account,amount:parseFloat(e.amount),end:F(e.end_timestamp),blockTime:F(e.block_timestamp),txHash:e.tx_hash})),Ve=p({entries:w(qe)}).transform(e=>({entries:e.entries})),Re=p({timestamp:u(),token_address:l(),token_symbol:l(),apr:l()}).transform(e=>({timestamp:F(e.timestamp),tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),Ae=p({snapshots:w(Re),count:u(),page:u(),total_pages:u()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),Be=p({timestamp:u(),tvl:l()}).transform(e=>({timestamp:F(e.timestamp),tvl:parseFloat(e.tvl)})),Ie=p({data:w(Be),count:u(),page:u(),total_pages:u()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),Qe=p({address:l(),label:l().nullable(),ens:l().nullable(),position_value:l()}).transform(e=>({address:e.address,label:e.label,ens:e.ens,positionValue:parseFloat(e.position_value)})),Le=p({total_tvl:l(),top_users_tvl:l(),others_tvl:l(),users:w(Qe)}).transform(e=>({totalTvl:parseFloat(e.total_tvl),topUsersTvl:parseFloat(e.top_users_tvl),othersTvl:parseFloat(e.others_tvl),users:e.users})),We=p({min_value:l(),max_value:l(),count:u()}).transform(e=>({minValue:parseFloat(e.min_value),maxValue:parseFloat(e.max_value),count:e.count})),Ke=p({bins:w(We),total_users:u()}).transform(e=>({bins:e.bins,totalUsers:e.total_users})),Oe=p({timestamp:u(),total_staked:l(),cooldown_amount:l(),cooldown_percentage:l(),active_staked_amount:l(),active_staked_percentage:l()}).transform(e=>({timestamp:F(e.timestamp),totalStaked:parseFloat(e.total_staked),cooldownAmount:parseFloat(e.cooldown_amount),cooldownPercentage:parseFloat(e.cooldown_percentage),activeStakedAmount:parseFloat(e.active_staked_amount),activeStakedPercentage:parseFloat(e.active_staked_percentage)}));p({data:w(Oe),count:u(),page:u(),total_pages:u()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages}));const Ne=p({...$,...L,...Q});async function je(e,t){const n=U(t),{chain:o,...s}=Ne.parse(e),i=I(s),a=await S(`${n}/v1/insurance/${o}/events${i}`,void 0,t==null?void 0:t.signal);return He.parse(a)}const ze=p($);async function Je(e,t){const n=U(t),{chain:o}=ze.parse(e),s=await S(`${n}/v1/insurance/${o}/cooldown_queue`,void 0,t==null?void 0:t.signal);return Ve.parse(s)}const Me=p({...$,...L,...Q});async function Ge(e,t){const n=U(t),{chain:o,...s}=Me.parse(e),i=I(s),a=await S(`${n}/v1/insurance/${o}/apr_history${i}`,void 0,t==null?void 0:t.signal);return Ae.parse(a)}const Xe=p({...$,...L,...Q});async function Ye(e,t){const n=U(t),{chain:o,...s}=Xe.parse(e),i=I(s),a=await S(`${n}/v1/insurance/${o}/tvl_history${i}`,void 0,t==null?void 0:t.signal);return Ie.parse(a)}const Ze=p($);async function et(e,t){const n=U(t),{chain:o}=Ze.parse(e),s=await S(`${n}/v1/insurance/${o}/top_users`,void 0,t==null?void 0:t.signal);return Le.parse(s)}const tt=p({...$,bin_count:u().int().positive().optional()});async function st(e,t){const n=U(t),{chain:o,...s}=tt.parse(e),i=I(s),a=await S(`${n}/v1/insurance/${o}/position_histogram${i}`,void 0,t==null?void 0:t.signal);return Ke.parse(a)}p({...$,...L,...Q});function at(e){return x({queryKey:["insurance-events",e],queryFn:()=>je(D(e)),placeholderData:we})}function nt(e){return x({queryKey:["insurance-cooldown-queue",e],queryFn:()=>Je(D(e))})}function ot(e){const{start:t,end:n}=te({daysRange:90});return x({queryKey:["insurance-apr-history",e],queryFn:()=>se((s,i)=>Ge({...D(e),page:s,per_page:i,start:t,end:n}).then(a=>a.snapshots),1,100)})}function rt(e){const{start:t,end:n}=te({daysRange:90});return x({queryKey:["insurance-tvl-history",e],queryFn:()=>se((s,i)=>Ye({...D(e),page:s,per_page:i,start:t,end:n}).then(a=>a.data),1,100)})}function it(e){return x({queryKey:["insurance-top-users",e],queryFn:()=>et(D(e))})}function ct(e){return x({queryKey:["insurance-position-hist",e],queryFn:()=>st(D(e))})}const lt={style:{display:"flex"}},ut={ref:"chartRef",class:"chart"},pt=T({__name:"ChartApr",props:{apr:{}},setup(e){const t=ae(),n=ne("card"),{chart:o,series:s}=re({createChartOptions:ce(),series:ie({name:"apr",color:b(()=>t.value.colors.blue),formatter:a=>`${A(a,0,"percentage")}%`,minMove:.01})});oe(i);function i(){if(!o.value||!s.apr)return;const a=e.apr.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.apr})).uniqWith((c,m)=>c.time===m.time).orderBy(c=>c.time,"asc");a.length>0&&s.apr.setData(a),o.value.timeScale().fitContent()}return(a,c)=>{const m=ue,g=le,y=H;return k(),E(y,{ref_key:"card",ref:n,title:"APR"},{actions:h(()=>[_("div",lt,[d(m,{filename:"apr",series:r(s)},null,8,["series"]),d(g,{chart:r(o),target:r(n)},null,8,["chart","target"])])]),default:h(()=>[_("div",ut,null,512)]),_:1},512)}}}),mt=T({__name:"ChartPositions",props:{bins:{}},setup(e){const t=b(()=>Se({chart:{type:"bar",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1}},xaxis:{categories:n.value,labels:{formatter:s=>s,rotate:-60},tickPlacement:"on"},yaxis:{labels:{formatter:s=>s}},plotOptions:{bar:{columnWidth:"50%"}},dataLabels:{enabled:!1},tooltip:{followCursor:!1,enabled:!0,intersect:!0,custom:s=>{const i=s.series[0][s.dataPointIndex];return`<div><b>Range</b>: ${n.value[s.dataPointIndex]}</div><div><b>Users</b>: ${i}</div>`}}})),n=b(()=>e.bins.map(s=>{const i=s.minValue?`${A(s.minValue,0,"dollar")}${O(s.minValue)}`:"0",a=s.maxValue?`${A(s.maxValue,0,"dollar")}${O(s.maxValue)}`:"0";return`${i} - ${a}`})),o=b(()=>[{name:"Users",data:e.bins.map(s=>s.count)}]);return(s,i)=>{const a=Fe,c=H;return k(),E(c,{title:"User positions"},{default:h(()=>[d(a,{options:r(t),series:r(o)},null,8,["options","series"])]),_:1})}}}),dt=V(mt,[["__scopeId","data-v-525b8a17"]]),_t={style:{display:"flex"}},gt={ref:"chartRef",class:"chart"},ht=T({__name:"ChartTvl",props:{tvl:{}},setup(e){const t=ae(),n=ne("card"),{chart:o,series:s}=re({createChartOptions:ce(),series:ie({name:"tvl",color:b(()=>t.value.colors.blue),formatter:a=>`${A(a,1,"dollar")}${O(a)}`})});oe(i);function i(){if(!o.value||!s.tvl)return;const a=e.tvl.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.tvl})).uniqWith((c,m)=>c.time===m.time).orderBy(c=>c.time,"asc");a.length>0&&s.tvl.setData(a),o.value.timeScale().fitContent()}return(a,c)=>{const m=ue,g=le,y=H;return k(),E(y,{ref_key:"card",ref:n,title:"TVL (reUSD)"},{actions:h(()=>[_("div",_t,[d(m,{filename:"tvl",series:r(s)},null,8,["series"]),d(g,{chart:r(o),target:r(n)},null,8,["chart","target"])])]),default:h(()=>[_("div",gt,null,512)]),_:1},512)}}}),vt=["href"],ft={class:"end"},yt={class:"end"},bt=["href"],ee=10,wt=T({__name:"TableCooldowns",props:{cooldowns:{}},setup(e){const{page:t,rowsPage:n,onPage:o}=xe(R(()=>e.cooldowns),ee),{relativeTime:s}=me();return(i,a)=>{const c=pe,m=N,g=z,y=H;return k(),E(y,{title:"Cooldown Queue"},{actions:h(()=>[d(c,{"items-count":i.cooldowns.length,"items-per-page":ee,page:r(t),onPage:r(o)},null,8,["items-count","page","onPage"])]),default:h(()=>[d(g,{rows:r(n),columns:["User",{label:"Staked reUSD",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:f})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${f.account.address}`,onClick:a[0]||(a[0]=q(()=>{},["stop"]))},P(f.account.ens||("addressShort"in i?i.addressShort:r(j))(f.account.address)),9,vt)]),_("div",ft,[d(m,{type:"dollar",value:f.amount,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",yt,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${f.txHash}`,onClick:a[1]||(a[1]=q(()=>{},["stop"]))},P(r(s)(f.end.getUTCTimestamp())),9,bt)])]),_:1},8,["rows"])]),_:1})}}}),$t=V(wt,[["__scopeId","data-v-b4fa2168"]]),Tt=["href"],kt={class:"end"},Ct={class:"end"},Pt=["href"],Ft=T({__name:"TableEvents",props:{events:{},count:{}},emits:["page"],setup(e,{emit:t}){const n=t,{page:o,onPage:s}=Ue(),i=$e(o,200);Te(i,m=>{n("page",m)});const{relativeTime:a}=me(),c=m=>{switch(m.eventType){case"deposit":return"Deposit";case"withdraw":return"Withdraw"}};return(m,g)=>{const y=pe,f=N,W=z,K=H;return k(),E(K,{title:"Events"},{actions:h(()=>[d(y,{"items-count":m.count,"items-per-page":10,page:r(o),onPage:r(s)},null,8,["items-count","page","onPage"])]),default:h(()=>[d(W,{rows:m.events,columns:["Type","Owner",{label:"reUSD",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:v})=>[_("div",{class:ke({green:v.eventType==="deposit",red:v.eventType==="withdraw"})},P(c(v)),3),_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${v.owner.address}`,onClick:g[0]||(g[0]=q(()=>{},["stop"]))},P(v.owner.ens||("addressShort"in m?m.addressShort:r(j))(v.owner.address)),9,Tt)]),_("div",kt,[d(f,{type:"dollar",value:v.assets,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Ct,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${v.txHash}`,onClick:g[1]||(g[1]=q(()=>{},["stop"]))},P(r(a)(v.blockTime.getUTCTimestamp())),9,Pt)])]),_:1},8,["rows"])]),_:1})}}}),St=V(Ft,[["__scopeId","data-v-3718948b"]]),xt=["href"],Ut={class:"end"},Dt=T({__name:"TableTopUsers",props:{topUsers:{}},setup(e){return(t,n)=>{const o=N,s=z,i=H;return k(),E(i,{title:"Top Users"},{default:h(()=>[d(s,{rows:t.topUsers,columns:["Address",{label:"Staked reUSD",align:"end"}]},{row:h(({item:a})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${a.address}`,onClick:n[0]||(n[0]=q(()=>{},["stop"]))},P(a.ens||("addressShort"in t?t.addressShort:r(j))(a.address)),9,xt)]),_("div",Ut,[d(o,{type:"dollar",value:a.positionValue,precision:2,"show-symbol":!1},null,8,["value"])])]),_:1},8,["rows"])]),_:1})}}}),Et=V(Dt,[["__scopeId","data-v-d27f5415"]]),Ht={class:"dashboard"},qt=T({__name:"Insurance.page",setup(e){const{isFetching:t,data:n}=ot({chain:"ethereum"}),o=b(()=>(n.value??[]).map(C=>({timestamp:C.timestamp,apr:C.apr}))),{isFetching:s,data:i}=rt({chain:"ethereum"}),a=b(()=>(i.value??[]).map(C=>({timestamp:C.timestamp,tvl:C.tvl}))),c=Ce(1),{isFetching:m,data:g}=at(b(()=>({chain:"ethereum",page:c.value,per_page:10}))),{isFetching:y,data:f}=it(R(()=>({chain:"ethereum"}))),{isFetching:W,data:K}=nt(R(()=>({chain:"ethereum"}))),{isFetching:v,data:ge}=ct(R(()=>({chain:"ethereum"})));return(C,J)=>{var M,G,X,Y,Z;const he=fe;return k(),Pe("div",Ht,[d(he,{style:{"grid-area":"header"},title:"Insurance",description:"Insurance pool metrics for Resupply including APR, TVL and positions"}),d(pt,{style:{"grid-area":"apr"},apr:r(o),loading:r(t)},null,8,["apr","loading"]),d(ht,{style:{"grid-area":"tvl"},tvl:r(a),loading:r(s)},null,8,["tvl","loading"]),d(St,{style:{"grid-area":"events"},events:((M=r(g))==null?void 0:M.events)??[],count:((G=r(g))==null?void 0:G.count)??0,loading:r(m),onPage:J[0]||(J[0]=ve=>c.value=ve)},null,8,["events","count","loading"]),d(Et,{style:{"grid-area":"top-users"},"top-users":((X=r(f))==null?void 0:X.users)??[],loading:r(y)},null,8,["top-users","loading"]),d($t,{style:{"grid-area":"cooldowns"},cooldowns:((Y=r(K))==null?void 0:Y.entries)??[],loading:r(W)},null,8,["cooldowns","loading"]),d(dt,{style:{"grid-area":"positions"},bins:((Z=r(ge))==null?void 0:Z.bins)??[],loading:r(v)},null,8,["bins","loading"])])}}}),zt=V(qt,[["__scopeId","data-v-978a25a4"]]);export{zt as default};
