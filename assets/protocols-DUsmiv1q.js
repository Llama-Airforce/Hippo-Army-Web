import{Q as E,o as u,s as n,n as i,b as f,t as y,l as v,p as F,d as D,f as k,g as w,i as P,a as R}from"./timestamp-DOR7_23P.js";import{aL as U,aM as Q,aN as M,aO as H,c as m,h as z,aP as I,aQ as K,av as q,aj as L,aR as N,ak as j,am as O}from"./index-BbdM5O_n.js";import{p as A}from"./Pagination-vgbH7lYO.js";function C(e,t){const r=new Set(t);return e.filter(s=>!r.has(s))}function B(e,t,r){const s=e.slice(0);return s[t]=r,s}var T=class extends U{#r;#e;#o;#n;#t;#s;#a;#i;#l=[];constructor(e,t,r){super(),this.#r=e,this.#n=r,this.#o=[],this.#t=[],this.#e=[],this.setQueries(t)}onSubscribe(){this.listeners.size===1&&this.#t.forEach(e=>{e.subscribe(t=>{this.#h(e,t)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.#t.forEach(e=>{e.destroy()})}setQueries(e,t){this.#o=e,this.#n=t,Q.batch(()=>{const r=this.#t,s=this.#p(this.#o);this.#l=s,s.forEach(l=>l.observer.setOptions(l.defaultedQueryOptions));const o=s.map(l=>l.observer),a=o.map(l=>l.getCurrentResult()),c=o.some((l,p)=>l!==r[p]);r.length===o.length&&!c||(this.#t=o,this.#e=a,this.hasListeners()&&(C(r,o).forEach(l=>{l.destroy()}),C(o,r).forEach(l=>{l.subscribe(p=>{this.#h(l,p)})}),this.#m()))})}getCurrentResult(){return this.#e}getQueries(){return this.#t.map(e=>e.getCurrentQuery())}getObservers(){return this.#t}getOptimisticResult(e,t){const r=this.#p(e),s=r.map(o=>o.observer.getOptimisticResult(o.defaultedQueryOptions));return[s,o=>this.#u(o??s,t),()=>this.#c(s,r)]}#c(e,t){return t.map((r,s)=>{const o=e[s];return r.defaultedQueryOptions.notifyOnChangeProps?o:r.observer.trackResult(o,a=>{t.forEach(c=>{c.observer.trackProp(a)})})})}#u(e,t){return t?((!this.#s||this.#e!==this.#i||t!==this.#a)&&(this.#a=t,this.#i=this.#e,this.#s=M(this.#s,t(e))),this.#s):e}#p(e){const t=new Map(this.#t.map(s=>[s.options.queryHash,s])),r=[];return e.forEach(s=>{const o=this.#r.defaultQueryOptions(s),a=t.get(o.queryHash);a?r.push({defaultedQueryOptions:o,observer:a}):r.push({defaultedQueryOptions:o,observer:new E(this.#r,o)})}),r}#h(e,t){const r=this.#t.indexOf(e);r!==-1&&(this.#e=B(this.#e,r,t),this.#m())}#m(){if(this.hasListeners()){const e=this.#s,t=this.#c(this.#e,this.#l),r=this.#u(t,this.#n?.combine);e!==r&&Q.batch(()=>{this.listeners.forEach(s=>{s(this.#e)})})}}};function J({queries:e,...t},r){const s=H(),o=m(()=>z(e).map(g=>{const _=I(g);typeof _.enabled=="function"&&(_.enabled=g.enabled());const d=s.defaultQueryOptions(_);return d._optimisticResults=s.isRestoring?.value?"isRestoring":"optimistic",d})),a=new T(s,o.value,t),c=()=>{const[h,g]=a.getOptimisticResult(o.value,t.combine);return g(h.map((_,d)=>({..._,refetch:async(...$)=>{const[{[d]:S}]=a.getOptimisticResult(o.value,t.combine);return S.refetch(...$)}})))},l=K(c());let p=()=>{};return s.isRestoring&&q(s.isRestoring,h=>{h||(p(),p=a.subscribe(()=>{l.value=c()}),l.value=c())},{immediate:!0}),q(o,h=>{a.setQueries(h,t),l.value=c()}),L(()=>{p()}),t.shallow?N(l):j(l)}const V=u({name:n(),protocol_id:i(),pairs_count:i(),active_positions_count:i(),total_collateral:n(),total_underlying:n(),total_debt:n()}).transform(e=>({name:e.name,protocolId:e.protocol_id,pairsCount:e.pairs_count,activePositionsCount:e.active_positions_count,totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),totalDebt:parseFloat(e.total_debt)})),G=u({protocols:f(V),count:i()}).transform(e=>({protocols:e.protocols,count:e.count})),b=u({symbol:n(),name:n(),address:n(),precision:i()}).transform(e=>({symbol:e.symbol,name:e.name,address:e.address,precision:e.precision})),W=u({token_address:n(),token_symbol:n(),apr:n()}).transform(e=>({tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),X=u({pair_id:i(),name:n(),address:n(),total_collateral:n(),total_underlying:n(),exchange_rate:n(),total_debt:n(),active_positions_count:i(),borrow_limit:n(),utilization_rate:n(),interest_rate:n(),claimable_fees:n(),claimable_other_fees:n(),block_timestamp:i(),last_redemption:i().nullable(),redemption_fee_10k:n(),borrow_cost_apr:n(),base_apr:n(),rewards:f(W),collateral_token:b,debt_token:b,underlying_token:b,pair_collateral_token:b,pair_underlying_token:b}).transform(e=>({pairId:e.pair_id,name:e.name,address:e.address,totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),exchangeRate:parseFloat(e.exchange_rate),totalDebt:parseFloat(e.total_debt),activePositionsCount:e.active_positions_count,borrowLimit:parseFloat(e.borrow_limit),utilizationRate:parseFloat(e.utilization_rate),interestRate:parseFloat(e.interest_rate),claimableFees:parseFloat(e.claimable_fees),claimableOtherFees:parseFloat(e.claimable_other_fees),blockTime:y(e.block_timestamp),lastRedemption:e.last_redemption?y(e.last_redemption):null,redemptionFee10k:parseFloat(e.redemption_fee_10k),aprBorrowCost:parseFloat(e.borrow_cost_apr),aprBase:parseFloat(e.base_apr),rewards:e.rewards,tokenCollateral:e.collateral_token,tokenDebt:e.debt_token,tokenUnderlying:e.underlying_token,tokenPairCollateral:e.pair_collateral_token,tokenPairUnderyling:e.pair_underlying_token})),Y=u({pairs:f(X),count:i(),page:i(),total_pages:i()}).transform(e=>({pairs:e.pairs,count:e.count,page:e.page,totalPages:e.total_pages})),Z=u({crvusd_price:n(),frxusd_price:n(),block_number:i(),block_timestamp:i()}).transform(e=>({crvusd:parseFloat(e.crvusd_price),frxusd:parseFloat(e.frxusd_price),blockNumber:e.block_number,timestamp:y(e.block_timestamp)})),ee=u({prices:f(Z),count:i(),page:i(),total_pages:i()}).transform(e=>({prices:e.prices,count:e.count,page:e.page,totalPages:e.total_pages})),te=u({name:n(),protocol_id:i(),pairs_count:i(),active_positions_count:i(),total_collateral:n(),total_underlying:n(),total_debt:n(),timestamp:i()}).transform(e=>({timestamp:y(e.timestamp),name:e.name,protocolId:e.protocol_id,pairsCount:e.pairs_count,totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),totalDebt:parseFloat(e.total_debt)})),se=u({snapshots:f(te),count:i(),page:i(),total_pages:i()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),re=u(v);async function oe(e,t){const r=w(t),{chain:s}=re.parse(e),o=await k(`${r}/v1/protocols/overview/${s}`,void 0,t?.signal);return G.parse(o)}const ne=u({...v,...F,protocol_name:n()});async function ae(e,t){const r=w(t),{chain:s,protocol_name:o,...a}=ne.parse(e),c=P(a),l=await k(`${r}/v1/protocols/${s}/${o}/pairs${c}`,void 0,t?.signal);return Y.parse(l)}const ie=u({...v,...D,...F});async function le(e,t){const r=w(t),{chain:s,...o}=ie.parse(e),a=P(o),c=await k(`${r}/v1/protocols/${s}/oracle_prices${a}`,void 0,t?.signal);return ee.parse(c)}const ce=u({...v,...D,...F});async function ue(e,t){const r=w(t),{chain:s,...o}=ce.parse(e),a=P(o),c=await k(`${r}/v1/protocols/history/${s}${a}`,void 0,t?.signal);return se.parse(c)}function pe(e){return R({queryKey:["protocols-overview",e],queryFn:()=>oe(O(e))})}function x(e){return{queryKey:["protocols-pairs",e],queryFn:()=>A((r,s)=>ae({...O(e),page:r,per_page:s}).then(o=>o.pairs),1,100)}}function be(e,t){return R({...x(e),enabled:t})}function fe(){const{data:e}=pe({chain:"ethereum"}),t=m(()=>(e.value?.protocols??[]).map(a=>a.name)),r=m(()=>(e.value?.count??0)>0),s=m(()=>t.value.map(a=>({...x({chain:"ethereum",protocol_name:a}),enabled:r}))),o=J({queries:s,combine:a=>({data:a.map(c=>c.data).filter(c=>c!==void 0).flat(),pending:a.some(c=>c.isPending)})});return{data:m(()=>o.value.data),pending:m(()=>o.value.pending)}}function ge(e){return R({queryKey:["protocols-oracle-prices",e],queryFn:()=>le(O(e))})}function de(e){return R({queryKey:["protocols-history",e],queryFn:()=>ue(O(e))})}export{de as a,be as b,pe as c,ge as d,fe as u};
