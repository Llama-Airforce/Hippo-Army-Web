import{_ as N}from"./DashboardHeader-BZxATxlq.js";import{t as j,b as J,f as Q,a as Y,r as V,u as x}from"./Number-D-_ywgC3.js";import{o as w,s as W,e as z,n as v,a as G,p as X,t as Z,f as tt,g as et,_ as B}from"./AsyncValue-Brd_Goit.js";import{aJ as st,aw as at,d as D,u as F,a as L,c as g,w as M,b as T,o as y,e as h,f as p,g as u,h as l,_ as S,j as q,k as $,l as P,ao as nt,aq as ot,ar as R,m as C,a$ as it,ah as rt}from"./index-C4bxLmri.js";import{u as O,a as U,_ as H}from"./UseLightweightChart-C12vCX9v.js";import{_ as I}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-CH9iGe7u.js";import{_ as lt}from"./KPI-BvSL3471.js";import{_ as ut}from"./Table-CDZZfuyN.js";import{a as ct,_ as dt}from"./UsePagination-C4qACSg2.js";import{u as mt}from"./UseRelativeTime-BFrqfvoq.js";import"./Tooltip-DPMfqQ_8.js";const _t=w({block_timestamp:v(),tx_hash:W(),block_number:v(),operator:z,amount:W()}).transform(o=>({blockTime:j(o.block_timestamp),txHash:o.tx_hash,blockNumber:o.block_number,operator:o.operator,amount:parseFloat(o.amount)})),pt=w({distributions:G(_t),count:v(),page:v(),total_pages:v()}).transform(o=>({distributions:o.distributions,count:o.count,page:o.page,totalPages:o.total_pages})),ht=w({...tt,...Z,...X});async function ft(o,d){const i=et(d),{chain:r,...m}=ht.parse(o),_=J(m),e=await Q(`${i}/v1/revenue/${r}/distributions${_}`,void 0,d==null?void 0:d.signal);return pt.parse(e)}function A(o){return Y({queryKey:["revenue-distributions",o],queryFn:()=>ft(at(o)),placeholderData:st})}const bt={style:{display:"flex"}},gt={ref:"chartRef",class:"chart"},vt=D({__name:"ChartDistributions",props:{distributions:{}},setup(o){const d=F(),i=L("card"),{chart:r,series:m}=O({createChartOptions:U(),series:{type:"Histogram",name:"distributions",options:g(()=>({priceFormat:{type:"custom",formatter:e=>`$${V(e,0,"dollar")}${x(e)}`,minMove:.01},color:d.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});M(_);function _(){if(!r.value||!m.distributions)return;const e=o.distributions.map(n=>({time:n.blockTime.getUTCTimestamp(),value:n.amount})).uniqWith((n,s)=>n.time===s.time).orderBy(n=>n.time,"asc").takeRight(52);e.length>0&&(m.distributions.setData(e),r.value.timeScale().fitContent())}return(e,n)=>{const s=I,a=H,t=S;return y(),T(t,{ref_key:"card",ref:i,title:"Distributions (1y)"},{actions:h(()=>[p("div",bt,[u(s,{filename:"distributions",series:l(m)},null,8,["series"]),u(a,{chart:l(r),target:l(i)},null,8,["chart","target"])])]),default:h(()=>[p("div",gt,null,512)]),_:1},512)}}}),Dt={style:{display:"flex"}},yt={ref:"chartRef",class:"chart"},kt=D({__name:"ChartDistributionsDelta",props:{distributions:{}},setup(o){const d=F(),i=L("card"),{chart:r,series:m}=O({createChartOptions:U(),series:{type:"Histogram",name:"deltas",options:g(()=>({priceFormat:{type:"custom",formatter:e=>`$${V(e,0,"dollar")}${x(e)}`,minMove:.01},color:d.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});M(_);function _(){if(!r.value||!m.deltas)return;const{colors:e}=d.value,n=o.distributions.map(s=>({time:s.blockTime.getUTCTimestamp(),value:s.amount})).uniqWith((s,a)=>s.time===a.time).orderBy(s=>s.time,"asc").takeRight(53).reduce((s,a,t,c)=>{if(t===0)return s;const f=a.value-c[t-1].value,k=f<0?e.red:e.green;return s.push({time:a.time,value:f,color:k}),s},[]);n.length>0&&(m.deltas.setData(n),r.value.timeScale().fitContent())}return(e,n)=>{const s=I,a=H,t=S;return y(),T(t,{ref_key:"card",ref:i,title:"Distributions Change (1y)"},{actions:h(()=>[p("div",Dt,[u(s,{filename:"distributions_delta",series:l(m)},null,8,["series"]),u(a,{chart:l(r),target:l(i)},null,8,["chart","target"])])]),default:h(()=>[p("div",yt,null,512)]),_:1},512)}}}),$t={class:"kpis"},Ct=D({__name:"KPIs",setup(o){const d={chain:"ethereum"},{data:i}=A(d),r=g(()=>{var e;return(e=i.value)!=null&&e.distributions?i.value.distributions.reduce((n,s)=>n+s.amount,0):null}),m=g(()=>{var n;if(!((n=i.value)!=null&&n.distributions)||i.value.distributions.length===0)return null;const e=i.value.distributions.slice(0,52);return e.reduce((s,a)=>s+a.amount,0)/e.length}),_=g(()=>{var a;if(!((a=i.value)!=null&&a.distributions)||i.value.distributions.length===0)return null;const e=i.value.distributions.slice(0,52).map(t=>t.amount),n=e.reduce((t,c)=>t+c,0)/e.length,s=e.map(t=>Math.pow(t-n,2));return Math.sqrt(s.reduce((t,c)=>t+c,0)/(e.length-1))});return(e,n)=>{const s=B,a=lt;return y(),q("div",$t,[u(a,{label:"Total","has-value":!!l(r)},{default:h(()=>[u(s,{type:"dollar",value:l(r),precision:2,"show-symbol":!1},null,8,["value"]),n[0]||(n[0]=$(" reUSD "))]),_:1},8,["has-value"]),u(a,{label:"Average (1y)","has-value":!!l(m)},{default:h(()=>[u(s,{type:"dollar",value:l(m),precision:2,"show-symbol":!1},null,8,["value"]),n[1]||(n[1]=$(" reUSD "))]),_:1},8,["has-value"]),u(a,{label:"Standard Deviation (1y)","has-value":!!l(_)},{default:h(()=>[u(s,{type:"dollar",value:l(_),precision:2,"show-symbol":!1},null,8,["value"]),n[2]||(n[2]=$(" reUSD "))]),_:1},8,["has-value"])])}}}),wt=P(Ct,[["__scopeId","data-v-8461099e"]]),Tt=["href"],St={class:"period"},Pt={class:"end"},Wt={class:"end"},Rt=["href"],Vt=D({__name:"TableDistributions",props:{distributions:{},count:{}},emits:["page"],setup(o,{emit:d}){const i=d,{page:r,onPage:m}=ct(),_=nt(r,200);ot(_,a=>{i("page",a)});const{relativeTime:e}=mt();function n(a){const t=new Date(a);t.setDate(a.getDate()+4);const c=new Date(t);return c.setDate(t.getDate()-t.getDay()),`${c.toLocaleString("default",{month:"short"})} ${c.getDate()}`}function s(a){const t=new Date(a);t.setDate(a.getDate()+4);const c=new Date(t);c.setDate(t.getDate()-t.getDay());const f=new Date(c);return f.setDate(c.getDate()+4),`${f.toLocaleString("default",{month:"short"})} ${f.getDate()}`}return(a,t)=>{const c=dt,f=it,k=B,E=ut,K=S;return y(),T(K,{title:"Distributions"},{actions:h(()=>[u(c,{"items-count":a.count,"items-per-page":10,page:l(r),onPage:l(m)},null,8,["items-count","page","onPage"])]),default:h(()=>[u(E,{rows:a.distributions,columns:["Period",{label:"Amount (reUSD)",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:b})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${b.operator.address}`,onClick:t[0]||(t[0]=R(()=>{},["stop"]))},[p("div",St,[p("span",null,C(n(b.blockTime)),1),u(f,{class:"chevron"}),p("span",null,C(s(b.blockTime)),1)])],8,Tt)]),p("div",Pt,[u(k,{"show-zero":"",type:"dollar",value:b.amount,"show-symbol":!1,precision:2},null,8,["value"])]),p("div",Wt,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${b.txHash}`,onClick:t[1]||(t[1]=R(()=>{},["stop"]))},C(l(e)(b.blockTime.getUTCTimestamp())),9,Rt)])]),_:1},8,["rows"])]),_:1})}}}),xt=P(Vt,[["__scopeId","data-v-daf29cb9"]]),Bt={class:"dashboard"},Ft=D({__name:"Revenue.page",setup(o){const d=rt(1),{isFetching:i,data:r}=A(g(()=>({chain:"ethereum",page:d.value,per_page:15})));return(m,_)=>{var n,s,a,t;const e=N;return y(),q("div",Bt,[u(e,{style:{"grid-area":"header"},title:"Revenue",description:"Token revenue distribution metrics"}),u(wt,{style:{"grid-area":"kpis"}}),u(vt,{style:{"grid-area":"chart"},distributions:((n=l(r))==null?void 0:n.distributions)??[]},null,8,["distributions"]),u(kt,{style:{"grid-area":"delta"},distributions:((s=l(r))==null?void 0:s.distributions)??[]},null,8,["distributions"]),u(xt,{style:{"grid-area":"table"},distributions:((a=l(r))==null?void 0:a.distributions)??[],count:((t=l(r))==null?void 0:t.count)??0,loading:l(i),onPage:_[0]||(_[0]=c=>d.value=c)},null,8,["distributions","count","loading"])])}}}),jt=P(Ft,[["__scopeId","data-v-f3bd6d88"]]);export{jt as default};
