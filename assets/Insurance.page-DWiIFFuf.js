import{_ as he}from"./DashboardHeader-CBTrQLFq.js";import{u as $,r as A,a as B}from"./Number-JCDnKITR.js";import{z as t,d as E,t as V,p as Q,a as I,e as C,g as k,c as Z}from"./timestamp-D1DOFXxn.js";import{a as q,f as P,_ as W}from"./fetch-CzIKldv6.js";import{p as ee}from"./Pagination-vgbH7lYO.js";import{aI as ve,ar as x,d as b,at as L,au as te,c as f,av as se,j as S,o as y,w as _,f as m,e as p,u as i,h as F,_ as U,t as j,am as D,g as T,ao as M,aj as fe,al as be,aD as ye,ae as we,b as Te}from"./index--6aQy66t.js";import{u as ne,a as ae,c as oe,_ as re}from"./UseLightweightChart-CBj2c-74.js";import{_ as ie}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-Kqoh4nS8.js";import{_ as $e}from"./ChartApex-CN81F-ET.js";import{_ as K}from"./Table-B1fGGnP3.js";import{u as Ce,_ as le,a as ke}from"./UsePagination-BUVeOBbV.js";import{u as ce}from"./UseRelativeTime-B1_it9GW.js";function ue(e,s){const r={...e};for(const a in s)Array.isArray(s[a])?r[a]=[...s[a]]:typeof s[a]=="object"&&s[a]!==null?r[a]=ue(r[a],s[a]):r[a]=s[a];return r}const pe=t.object({event_type:t.enum(["deposit","withdraw"]),block_timestamp:t.number(),tx_hash:t.string(),block_number:t.number(),assets:t.string(),shares:t.string(),sender:E,owner:E}),me=e=>({eventType:e.event_type,blockTime:V(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,assets:parseFloat(e.assets),shares:parseFloat(e.shares),sender:e.sender,owner:e.owner}),Pe=pe.refine(e=>e.event_type==="deposit",{message:"Expected deposit event type"}).transform(me),xe=pe.extend({receiver:E}).refine(e=>e.event_type==="withdraw",{message:"Expected withdraw event type"}).transform(e=>({...me(e),receiver:e.receiver})),Se=t.object({events:t.array(t.union([Pe,xe])),count:t.number(),page:t.number(),total_pages:t.number()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Fe=t.object({account:E,amount:t.string(),end_timestamp:t.number(),block_timestamp:t.number(),tx_hash:t.string()}).transform(e=>({account:e.account,amount:parseFloat(e.amount),end:V(e.end_timestamp),blockTime:V(e.block_timestamp),txHash:e.tx_hash})),Ve=t.object({entries:t.array(Fe)}).transform(e=>({entries:e.entries})),De=t.object({timestamp:t.number(),token_address:t.string(),token_symbol:t.string(),apr:t.string()}).transform(e=>({timestamp:V(e.timestamp),tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),Ue=t.object({snapshots:t.array(De),count:t.number(),page:t.number(),total_pages:t.number()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),je=t.object({timestamp:t.number(),tvl:t.string()}).transform(e=>({timestamp:V(e.timestamp),tvl:parseFloat(e.tvl)})),Ae=t.object({data:t.array(je),count:t.number(),page:t.number(),total_pages:t.number()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),Ee=t.object({address:t.string(),label:t.string().nullable(),ens:t.string().nullable(),position_value:t.string()}).transform(e=>({address:e.address,label:e.label,ens:e.ens,positionValue:parseFloat(e.position_value)})),qe=t.object({total_tvl:t.string(),top_users_tvl:t.string(),others_tvl:t.string(),users:t.array(Ee)}).transform(e=>({totalTvl:parseFloat(e.total_tvl),topUsersTvl:parseFloat(e.top_users_tvl),othersTvl:parseFloat(e.others_tvl),users:e.users})),He=t.object({min_value:t.string(),max_value:t.string(),count:t.number()}).transform(e=>({minValue:parseFloat(e.min_value),maxValue:parseFloat(e.max_value),count:e.count})),Re=t.object({bins:t.array(He),total_users:t.number()}).transform(e=>({bins:e.bins,totalUsers:e.total_users})),Be=t.object({...C,...I,...Q});async function Qe(e,s){const r=k(),{chain:a,...n}=Be.parse(e),l=q(n),o=await P(`${r}/v1/insurance/${a}/events${l}`,void 0,s==null?void 0:s.signal);return Se.parse(o)}const Ie=t.object(C);async function We(e,s){const r=k(),{chain:a}=Ie.parse(e),n=await P(`${r}/v1/insurance/${a}/cooldown_queue`,void 0,s==null?void 0:s.signal);return Ve.parse(n)}const Le=t.object({...C,...I,...Q});async function Me(e,s){const r=k(),{chain:a,...n}=Le.parse(e),l=q(n),o=await P(`${r}/v1/insurance/${a}/apr_history${l}`,void 0,s==null?void 0:s.signal);return Ue.parse(o)}const Ke=t.object({...C,...I,...Q});async function ze(e,s){const r=k(),{chain:a,...n}=Ke.parse(e),l=q(n),o=await P(`${r}/v1/insurance/${a}/tvl_history${l}`,void 0,s==null?void 0:s.signal);return Ae.parse(o)}const Oe=t.object(C);async function Ne(e,s){const r=k(),{chain:a}=Oe.parse(e),n=await P(`${r}/v1/insurance/${a}/top_users`,void 0,s==null?void 0:s.signal);return qe.parse(n)}const Je=t.object({...C,bin_count:t.number().int().positive().optional()});async function Ye(e,s){const r=k(),{chain:a,...n}=Je.parse(e),l=q(n),o=await P(`${r}/v1/insurance/${a}/position_histogram${l}`,void 0,s==null?void 0:s.signal);return Re.parse(o)}function Ge(e){return $({queryKey:["insurance-events",e],queryFn:()=>Qe(x(e)),placeholderData:ve})}function Xe(e){return $({queryKey:["insurance-cooldown-queue",e],queryFn:()=>We(x(e))})}function Ze(e){const{start:s,end:r}=Z({daysRange:90});return $({queryKey:["insurance-apr-history",e],queryFn:()=>ee((n,l)=>Me({...x(e),page:n,per_page:l,start:s,end:r}).then(o=>o.snapshots),1,100)})}function et(e){const{start:s,end:r}=Z({daysRange:90});return $({queryKey:["insurance-tvl-history",e],queryFn:()=>ee((n,l)=>ze({...x(e),page:n,per_page:l,start:s,end:r}).then(o=>o.data),1,100)})}function tt(e){return $({queryKey:["insurance-top-users",e],queryFn:()=>Ne(x(e))})}function st(e){return $({queryKey:["insurance-position-hist",e],queryFn:()=>Ye(x(e))})}const nt={style:{display:"flex"}},at={ref:"chartRef",class:"chart"},ot=b({__name:"ChartApr",props:{apr:{}},setup(e){const s=L(),r=te("card"),{chart:a,series:n}=ne({createChartOptions:oe(),series:{type:"Area",name:"apr",options:f(()=>({priceFormat:{type:"custom",formatter:o=>`${A(o,0,"percentage")}%`,minMove:.01},lineWidth:2,lineType:ae.WithSteps,lineColor:s.value.colors.blue,topColor:"rgba(3, 114, 255, 0.2)",bottomColor:"rgba(3, 114, 255, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});se(l);function l(){if(!a.value||!n.apr)return;const o=e.apr.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.apr})).uniqWith((c,u)=>c.time===u.time).orderBy(c=>c.time,"asc");o.length>0&&n.apr.setData(o),a.value.timeScale().fitContent()}return(o,c)=>{const u=ie,d=re,v=F;return y(),S(v,{ref_key:"card",ref:r,title:"APR"},{actions:_(()=>[m("div",nt,[p(u,{filename:"apr",series:i(n)},null,8,["series"]),p(d,{chart:i(a),target:i(r)},null,8,["chart","target"])])]),default:_(()=>[m("div",at,null,512)]),_:1},512)}}}),rt=e=>({chart:{id:"chart",background:"transparant",foreColor:e.colors.level5,fontFamily:"ui-monospace, SFMono-Regular, SF Mono, Menlo, Monaco, Consolas, monospace",toolbar:{autoSelected:"zoom",tools:{download:!1,pan:!1}},zoom:{autoScaleYaxis:!0}},colors:e.colorsArray,grid:{borderColor:e.colors.level5,strokeDashArray:4,xaxis:{lines:{show:!1}}},fill:{type:"solid",opacity:1},stroke:{curve:"smooth",width:2},theme:{mode:"dark"},xaxis:{type:"category",axisBorder:{color:e.colors.level5,height:1},axisTicks:{color:e.colors.level5},title:{color:e.colors.level5}},yaxis:{tickAmount:4,axisBorder:{color:e.colors.level5},axisTicks:{color:e.colors.level5},title:{color:e.colors.level5}}});function it(e,s){s??(s=L());const r=rt(s.value);return e?ue(r,e):r}const lt=b({__name:"ChartPositions",props:{bins:{}},setup(e){const s=f(()=>it({chart:{type:"bar",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1}},xaxis:{categories:r.value,labels:{formatter:n=>n,rotate:-60},tickPlacement:"on"},yaxis:{labels:{formatter:n=>n}},plotOptions:{bar:{columnWidth:"50%"}},dataLabels:{enabled:!1},tooltip:{followCursor:!1,enabled:!0,intersect:!0,custom:n=>{const l=n.series[0][n.dataPointIndex];return`<div><b>Range</b>: ${r.value[n.dataPointIndex]}</div><div><b>Users</b>: ${l}</div>`}}})),r=f(()=>e.bins.map(n=>{const l=n.minValue?`${A(n.minValue,0,"dollar")}${B(n.minValue)}`:"0",o=n.maxValue?`${A(n.maxValue,0,"dollar")}${B(n.maxValue)}`:"0";return`${l} - ${o}`})),a=f(()=>[{name:"Users",data:e.bins.map(n=>n.count)}]);return(n,l)=>{const o=$e,c=F;return y(),S(c,{title:"User positions"},{default:_(()=>[p(o,{options:i(s),series:i(a)},null,8,["options","series"])]),_:1})}}}),ct=U(lt,[["__scopeId","data-v-525b8a17"]]),ut={style:{display:"flex"}},pt={ref:"chartRef",class:"chart"},mt=b({__name:"ChartTvl",props:{tvl:{}},setup(e){const s=L(),r=te("card"),{chart:a,series:n}=ne({createChartOptions:oe(),series:{type:"Area",name:"tvl",options:f(()=>({priceFormat:{type:"custom",formatter:o=>`${A(o,1,"dollar")}${B(o)}`},lineWidth:2,lineType:ae.WithSteps,lineColor:s.value.colors.blue,topColor:"rgba(3, 114, 255, 0.2)",bottomColor:"rgba(3, 114, 255, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});se(l);function l(){if(!a.value||!n.tvl)return;const o=e.tvl.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.tvl})).uniqWith((c,u)=>c.time===u.time).orderBy(c=>c.time,"asc");o.length>0&&n.tvl.setData(o),a.value.timeScale().fitContent()}return(o,c)=>{const u=ie,d=re,v=F;return y(),S(v,{ref_key:"card",ref:r,title:"TVL (reUSD)"},{actions:_(()=>[m("div",ut,[p(u,{filename:"tvl",series:i(n)},null,8,["series"]),p(d,{chart:i(a),target:i(r)},null,8,["chart","target"])])]),default:_(()=>[m("div",pt,null,512)]),_:1},512)}}}),dt=["href"],_t={class:"end"},gt={class:"end"},ht=["href"],X=10,vt=b({__name:"TableCooldowns",props:{cooldowns:{}},setup(e){const{page:s,rowsPage:r,onPage:a}=Ce(j(()=>e.cooldowns),X),{relativeTime:n}=ce();return(l,o)=>{const c=le,u=W,d=K,v=F;return y(),S(v,{title:"Cooldown Queue"},{actions:_(()=>[p(c,{"items-count":l.cooldowns.length,"items-per-page":X,page:i(s),onPage:i(a)},null,8,["items-count","page","onPage"])]),default:_(()=>[p(d,{rows:i(r),columns:["User",{label:"Staked reUSD",align:"end"},{label:"Time",align:"end"}]},{row:_(({item:h})=>[m("div",null,[m("a",{target:"_blank",href:`https://etherscan.io/address/${h.account.address}`,onClick:o[0]||(o[0]=D(()=>{},["stop"]))},T(h.account.ens||("addressShort"in l?l.addressShort:i(M))(h.account.address)),9,dt)]),m("div",_t,[p(u,{type:"dollar",value:h.amount,precision:2,"show-symbol":!1},null,8,["value"])]),m("div",gt,[m("a",{target:"_blank",href:`https://etherscan.io/tx/${h.txHash}`,onClick:o[1]||(o[1]=D(()=>{},["stop"]))},T(i(n)(h.end.getUTCTimestamp())),9,ht)])]),_:1},8,["rows"])]),_:1})}}}),ft=U(vt,[["__scopeId","data-v-68d34664"]]),bt=["href"],yt={class:"end"},wt={class:"end"},Tt=["href"],$t=b({__name:"TableEvents",props:{events:{},count:{}},emits:["page"],setup(e,{emit:s}){const r=s,{page:a,onPage:n}=ke(),l=fe(a,200);be(l,u=>{r("page",u)});const{relativeTime:o}=ce(),c=u=>{switch(u.eventType){case"deposit":return"Deposit";case"withdraw":return"Withdraw"}};return(u,d)=>{const v=le,h=W,H=K,R=F;return y(),S(R,{title:"Events"},{actions:_(()=>[p(v,{"items-count":u.count,"items-per-page":10,page:i(a),onPage:i(n)},null,8,["items-count","page","onPage"])]),default:_(()=>[p(H,{rows:u.events,columns:["Type","Owner",{label:"reUSD",align:"end"},{label:"Time",align:"end"}]},{row:_(({item:g})=>[m("div",{class:ye({green:g.eventType==="deposit",red:g.eventType==="withdraw"})},T(c(g)),3),m("div",null,[m("a",{target:"_blank",href:`https://etherscan.io/address/${g.owner.address}`,onClick:d[0]||(d[0]=D(()=>{},["stop"]))},T(g.owner.ens||("addressShort"in u?u.addressShort:i(M))(g.owner.address)),9,bt)]),m("div",yt,[p(h,{type:"dollar",value:g.assets,precision:2,"show-symbol":!1},null,8,["value"])]),m("div",wt,[m("a",{target:"_blank",href:`https://etherscan.io/tx/${g.txHash}`,onClick:d[1]||(d[1]=D(()=>{},["stop"]))},T(i(o)(g.blockTime.getUTCTimestamp())),9,Tt)])]),_:1},8,["rows"])]),_:1})}}}),Ct=U($t,[["__scopeId","data-v-3f720b56"]]),kt=["href"],Pt={class:"end"},xt=b({__name:"TableTopUsers",props:{topUsers:{}},setup(e){return(s,r)=>{const a=W,n=K,l=F;return y(),S(l,{title:"Top Users"},{default:_(()=>[p(n,{rows:s.topUsers,columns:["Address",{label:"Staked reUSD",align:"end"}]},{row:_(({item:o})=>[m("div",null,[m("a",{target:"_blank",href:`https://etherscan.io/address/${o.address}`,onClick:r[0]||(r[0]=D(()=>{},["stop"]))},T(o.ens||("addressShort"in s?s.addressShort:i(M))(o.address)),9,kt)]),m("div",Pt,[p(a,{type:"dollar",value:o.positionValue,precision:2,"show-symbol":!1},null,8,["value"])])]),_:1},8,["rows"])]),_:1})}}}),St=U(xt,[["__scopeId","data-v-4cc4818c"]]),Ft={class:"dashboard"},Vt=b({__name:"Insurance.page",setup(e){const{isFetching:s,data:r}=Ze({chain:"ethereum"}),a=f(()=>(r.value??[]).map(w=>({timestamp:w.timestamp,apr:w.apr}))),{isFetching:n,data:l}=et({chain:"ethereum"}),o=f(()=>(l.value??[]).map(w=>({timestamp:w.timestamp,tvl:w.tvl}))),c=we(1),{isFetching:u,data:d}=Ge(f(()=>({chain:"ethereum",page:c.value,per_page:10}))),{isFetching:v,data:h}=tt(j(()=>({chain:"ethereum"}))),{isFetching:H,data:R}=Xe(j(()=>({chain:"ethereum"}))),{isFetching:g,data:de}=st(j(()=>({chain:"ethereum"})));return(w,z)=>{var O,N,J,Y,G;const _e=he;return y(),Te("div",Ft,[p(_e,{style:{"grid-area":"header"},title:"Insurance",description:"Insurance pool metrics for Resupply including APR, TVL and positions"}),p(ot,{style:{"grid-area":"apr"},apr:i(a),loading:i(s)},null,8,["apr","loading"]),p(mt,{style:{"grid-area":"tvl"},tvl:i(o),loading:i(n)},null,8,["tvl","loading"]),p(Ct,{style:{"grid-area":"events"},events:((O=i(d))==null?void 0:O.events)??[],count:((N=i(d))==null?void 0:N.count)??0,loading:i(u),onPage:z[0]||(z[0]=ge=>c.value=ge)},null,8,["events","count","loading"]),p(St,{style:{"grid-area":"top-users"},"top-users":((J=i(h))==null?void 0:J.users)??[],loading:i(v)},null,8,["top-users","loading"]),p(ft,{style:{"grid-area":"cooldowns"},cooldowns:((Y=i(R))==null?void 0:Y.entries)??[],loading:i(H)},null,8,["cooldowns","loading"]),p(ct,{style:{"grid-area":"positions"},bins:((G=i(de))==null?void 0:G.bins)??[],loading:i(g)},null,8,["bins","loading"])])}}}),Lt=U(Vt,[["__scopeId","data-v-2715e81f"]]);export{Lt as default};
