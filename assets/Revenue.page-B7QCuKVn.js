import{aJ as H,am as W,d as P,u as x,a as K,c as y,w as j,b as D,o as v,e as h,f as b,g as c,h as r,_ as N,j as M,k as C,l as R,at as z,av as J,aw as L,m as S,a_ as O,ai as A,an as Q,a$ as Y,n as G}from"./index-eREEKl5L.js";import{_ as X}from"./ChartBalances-DdGhx-Md.js";import{_ as Z}from"./DashboardHeader-Byn85ddD.js";import{u as ee,a as te,_ as se,k as ae,D as oe}from"./UseLightweightChart-D2pZoVZ3.js";import{t as ne,b as re,f as ie,a as le,r as ue,u as ce}from"./timestamp-DcP9Bt_c.js";import{o as B,s as f,n as k,a as U,e as me,p as pe,t as _e,f as de,g as be,_ as q}from"./AsyncValue-IM55AzVv.js";import{_ as he}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-kfvPP31c.js";import{_ as ge}from"./KPI-CgyzPJO4.js";import{_ as fe}from"./Table-Dbh33w8a.js";import{a as ve,_ as ye}from"./UsePagination-DIWvwju_.js";import{u as ke}from"./UseRelativeTime-BUBU5iwX.js";import"./Tooltip-BC3yTzdv.js";const De=B({pair_id:k(),pair_name:f(),protocol_name:f(),interest:f(),fees:f()}).transform(s=>({pairId:s.pair_id,pairName:s.pair_name,protocolName:s.protocol_name,interest:parseFloat(s.interest),fees:parseFloat(s.fees)})),we=B({block_timestamp:k(),tx_hash:f(),block_number:k(),operator:me,amount:f(),interest_total:f(),fees_total:f(),breakdown:U(De)}).transform(s=>({blockTime:ne(s.block_timestamp),txHash:s.tx_hash,blockNumber:s.block_number,operator:s.operator,amount:parseFloat(s.amount),interestTotal:parseFloat(s.interest_total),feesTotal:parseFloat(s.fees_total),breakdown:s.breakdown})),Te=B({distributions:U(we),count:k(),page:k(),total_pages:k()}).transform(s=>({distributions:s.distributions,count:s.count,page:s.page,totalPages:s.total_pages})),$e=B({...de,..._e,...pe});async function Ce(s,p){const l=be(p),{chain:u,...m}=$e.parse(s),_=re(m),o=await ie(`${l}/v1/revenue/${u}/distributions${_}`,void 0,p==null?void 0:p.signal);return Te.parse(o)}function E(s){return le({queryKey:["revenue-distributions",s],queryFn:()=>Ce(W(s)),placeholderData:H})}const Se={style:{display:"flex"}},Pe={ref:"chartRef",class:"chart"},Be=P({__name:"ChartDistributionsDelta",props:{distributions:{}},setup(s){const p=x(),l=K("card"),{chart:u,series:m}=ee({createChartOptions:te(),series:{type:ae,name:"deltas",options:y(()=>({priceFormat:{type:"custom",formatter:o=>`$${ue(o,0,"dollar")}${ce(o)}`,minMove:.01},color:p.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});j(_);function _(){if(!u.value||!m.deltas)return;const{colors:o}=p.value;m.deltas.setData(s.distributions.map(t=>({time:t.blockTime.getUTCTimestamp(),value:t.amount})).uniqWith((t,a)=>t.time===a.time).orderBy(t=>t.time,"asc").takeRight(53).reduce((t,a,n,e)=>{if(n===0)return t;const i=a.value-e[n-1].value,g=i<0?o.red:o.green;return t.push({time:a.time,value:i,color:g}),t},[])),u.value.timeScale().fitContent()}return(o,t)=>{const a=he,n=se,e=N;return v(),D(e,{ref_key:"card",ref:l,title:"Distributions Change (1y)"},{actions:h(()=>[b("div",Se,[c(a,{filename:"distributions_delta",series:r(m)},null,8,["series"]),c(n,{chart:r(u),target:r(l)},null,8,["chart","target"])])]),default:h(()=>[b("div",Pe,null,512)]),_:1},512)}}}),Fe={class:"kpis"},Ie=P({__name:"KPIs",setup(s){const p={chain:"ethereum"},{data:l}=E(p),u=y(()=>{var o;return(o=l.value)!=null&&o.distributions?l.value.distributions.sumBy(t=>t.amount):null}),m=y(()=>{var t;if(!((t=l.value)!=null&&t.distributions)||l.value.distributions.length===0)return null;const o=l.value.distributions.slice(0,52);return o.sumBy(a=>a.amount)/o.length}),_=y(()=>{var n;if(!((n=l.value)!=null&&n.distributions)||l.value.distributions.length===0)return null;const o=l.value.distributions.slice(0,52).map(e=>e.amount),t=o.sumBy(e=>e)/o.length,a=o.map(e=>Math.pow(e-t,2));return Math.sqrt(a.sumBy(e=>e)/(o.length-1))});return(o,t)=>{const a=q,n=ge;return v(),M("div",Fe,[c(n,{label:"Total","has-value":!!r(u)},{default:h(()=>[c(a,{type:"dollar",value:r(u),precision:2,"show-symbol":!1},null,8,["value"]),t[0]||(t[0]=C(" reUSD "))]),_:1,__:[0]},8,["has-value"]),c(n,{label:"Average (1y)","has-value":!!r(m)},{default:h(()=>[c(a,{type:"dollar",value:r(m),precision:2,"show-symbol":!1},null,8,["value"]),t[1]||(t[1]=C(" reUSD "))]),_:1,__:[1]},8,["has-value"]),c(n,{label:"Standard Deviation (1y)","has-value":!!r(_)},{default:h(()=>[c(a,{type:"dollar",value:r(_),precision:2,"show-symbol":!1},null,8,["value"]),t[2]||(t[2]=C(" reUSD "))]),_:1,__:[2]},8,["has-value"])])}}}),Ne=R(Ie,[["__scopeId","data-v-e12c7e95"]]),Re=["href"],Ve={class:"period"},Le={class:"end"},Ae={class:"end"},Me=["href"],Ue=7*24*60*60*1e3,qe=P({__name:"TableDistributions",props:{distributions:{},count:{}},emits:["page"],setup(s,{emit:p}){const l=p,{page:u,onPage:m}=ve(),_=z(u,200);J(_,e=>{l("page",e)});const{relativeTime:o}=ke();function t(e){const i=new Date(Date.UTC(2025,2,20));return new Date(i.getTime()+e*Ue)}function a(e){const i=t(e),g=new Date(i);return g.setDate(i.getDate()+7),g}function n(e){return`${e.toLocaleString("default",{month:"short"})} ${e.getDate()}`}return(e,i)=>{const g=ye,F=O,w=q,T=fe,$=N;return v(),D($,{title:"Distributions"},{actions:h(()=>[c(g,{"items-count":e.count,"items-per-page":10,page:r(u),onPage:r(m)},null,8,["items-count","page","onPage"])]),default:h(()=>[c(T,{rows:e.distributions,columns:["Period",{label:"Amount (reUSD)",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:d,idx:V})=>[b("div",null,[b("a",{target:"_blank",href:`https://etherscan.io/address/${d.operator.address}`,onClick:i[0]||(i[0]=L(()=>{},["stop"]))},[b("div",Ve,[b("span",null,S(n(t(e.distributions.length-V-1))),1),c(F,{class:"chevron"}),b("span",null,S(n(a(e.distributions.length-V-1))),1)])],8,Re)]),b("div",Le,[c(w,{"show-zero":"",type:"dollar",value:d.amount,"show-symbol":!1,precision:2},null,8,["value"])]),b("div",Ae,[b("a",{target:"_blank",href:`https://etherscan.io/tx/${d.txHash}`,onClick:i[1]||(i[1]=L(()=>{},["stop"]))},S(r(o)(d.blockTime.getUTCTimestamp())),9,Me)])]),_:1},8,["rows"])]),_:1})}}}),Ee=R(qe,[["__scopeId","data-v-11a72d6d"]]),He={class:"dashboard"},I="All",We=P({__name:"Revenue.page",setup(s){const p=A(1),{isFetching:l,data:u}=E(y(()=>({chain:"ethereum",page:p.value,per_page:15}))),m=y(()=>{var a;return[I,...(((a=u.value)==null?void 0:a.distributions)??[]).flatMap(n=>n.breakdown.map(e=>e.protocolName)).uniq()]}),_=A(I),o=a=>_.value===I||a.protocolName===_.value,t=y(()=>{var n;const a=(((n=u.value)==null?void 0:n.distributions)??[]).map(e=>({timestamp:e.blockTime,fees:e.breakdown.filter(o).sumBy(i=>i.fees),interest:e.breakdown.filter(o).sumBy(i=>i.interest)}));return a.length===0?[]:[{symbol:"Fees",balances:a.map(e=>({timestamp:e.timestamp,balance:e.fees,tokenPrice:1}))},{symbol:"Interest",balances:a.map(e=>({timestamp:e.timestamp,balance:e.interest,tokenPrice:1}))}]});return(a,n)=>{var w,T,$;const e=Z,i=Y,g=X,F=N;return v(),M("div",He,[c(e,{style:{"grid-area":"header"},title:"Revenue",description:"Token revenue distribution metrics"}),c(Ne,{style:{"grid-area":"kpis"}}),r(l)?(v(),D(F,{key:1,loading:"",title:"Breakdown",style:G(`grid-area: chart; min-height: ${r(oe)}`)},null,8,["style"])):(v(),D(g,{key:0,style:{"grid-area":"chart"},title:"Breakdown","chart-type":"bars",balances:r(t),"show-dollars":!1},{actions:h(()=>[r(m).length>0?(v(),D(i,{key:0,options:r(m),selected:r(m).find(d=>d===r(_))??r(m)[0],onSelect:n[0]||(n[0]=d=>_.value=d)},{option:h(({option:d})=>[C(S(d),1)]),_:1},8,["options","selected"])):Q("",!0)]),_:1},8,["balances"])),c(Be,{style:{"grid-area":"delta"},distributions:((w=r(u))==null?void 0:w.distributions)??[]},null,8,["distributions"]),c(Ee,{style:{"grid-area":"table"},distributions:((T=r(u))==null?void 0:T.distributions)??[],count:(($=r(u))==null?void 0:$.count)??0,loading:r(l),onPage:n[1]||(n[1]=d=>p.value=d)},null,8,["distributions","count","loading"])])}}}),tt=R(We,[["__scopeId","data-v-c9e30e33"]]);export{tt as default};
