import{aJ as ke,am as P,d as C,u as se,a as ae,c as w,w as ne,b as k,o as $,e as h,f as _,g as d,h as r,_ as S,l as B,t as V,aw as R,m as U,ao as M,at as Te,av as Pe,ar as Ce,ai as Se,j as Fe,n as He}from"./index-ubWCN88q.js";import{_ as De}from"./ChartBalances-CtR_LCzw.js";import{_ as qe}from"./DashboardHeader-Dq35Htxz.js";import{u as oe,c as re,a as ie,_ as ce,D as Ee}from"./UseLightweightChart-vEBfyHR1.js";import{t as x,b as I,f as F,a as H,g as le,r as Q,u as z}from"./timestamp-DJ1YwJUy.js";import{o as p,e as L,s as l,n as u,d as Ue,a as D,h as xe,p as W,t as K,f as q,g as E,_ as j}from"./AsyncValue-Befmow8u.js";import{p as ue}from"./Pagination-vgbH7lYO.js";import{_ as pe}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-CUJSKRE5.js";import{_ as Ae}from"./ChartApex-BqEvrln1.js";import{c as Ve}from"./ChartStylesApex-CaEp61sy.js";import{_ as J}from"./Table-EXH8bS0J.js";import{u as Re,_ as me,a as Be}from"./UsePagination-C155jocX.js";import{u as de}from"./UseRelativeTime-BQcSW5ST.js";import"./UseLegend-DVYHHnok.js";import"./Tooltip-CsZ4ys_a.js";const _e=p({event_type:Ue(["deposit","withdraw"]),block_timestamp:u(),tx_hash:l(),block_number:u(),assets:l(),shares:l(),sender:L,owner:L}),ge=e=>({eventType:e.event_type,blockTime:x(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,assets:parseFloat(e.assets),shares:parseFloat(e.shares),sender:e.sender,owner:e.owner}),Ie=_e.refine(e=>e.event_type==="deposit",{message:"Expected deposit event type"}).transform(ge),Qe=_e.extend({receiver:L}).refine(e=>e.event_type==="withdraw",{message:"Expected withdraw event type"}).transform(e=>({...ge(e),receiver:e.receiver})),Le=p({events:D(xe([Ie,Qe])),count:u(),page:u(),total_pages:u()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),We=p({account:L,amount:l(),end_timestamp:u(),block_timestamp:u(),tx_hash:l()}).transform(e=>({account:e.account,amount:parseFloat(e.amount),end:x(e.end_timestamp),blockTime:x(e.block_timestamp),txHash:e.tx_hash})),Ke=p({entries:D(We)}).transform(e=>({entries:e.entries})),Oe=p({timestamp:u(),token_address:l(),token_symbol:l(),apr:l()}).transform(e=>({timestamp:x(e.timestamp),tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),Ne=p({snapshots:D(Oe),count:u(),page:u(),total_pages:u()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),ze=p({timestamp:u(),tvl:l()}).transform(e=>({timestamp:x(e.timestamp),tvl:parseFloat(e.tvl)})),Me=p({data:D(ze),count:u(),page:u(),total_pages:u()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),je=p({address:l(),label:l().nullable(),ens:l().nullable(),position_value:l()}).transform(e=>({address:e.address,label:e.label,ens:e.ens,positionValue:parseFloat(e.position_value)})),Je=p({total_tvl:l(),top_users_tvl:l(),others_tvl:l(),users:D(je)}).transform(e=>({totalTvl:parseFloat(e.total_tvl),topUsersTvl:parseFloat(e.top_users_tvl),othersTvl:parseFloat(e.others_tvl),users:e.users})),Ge=p({min_value:l(),max_value:l(),count:u()}).transform(e=>({minValue:parseFloat(e.min_value),maxValue:parseFloat(e.max_value),count:e.count})),Xe=p({bins:D(Ge),total_users:u()}).transform(e=>({bins:e.bins,totalUsers:e.total_users})),Ye=p({timestamp:u(),total_staked:l(),cooldown_amount:l(),cooldown_percentage:l(),active_staked_amount:l(),active_staked_percentage:l()}).transform(e=>({timestamp:x(e.timestamp),totalStaked:parseFloat(e.total_staked),cooldownAmount:parseFloat(e.cooldown_amount),cooldownPercentage:parseFloat(e.cooldown_percentage),activeStakedAmount:parseFloat(e.active_staked_amount),activeStakedPercentage:parseFloat(e.active_staked_percentage)})),Ze=p({data:D(Ye),count:u(),page:u(),total_pages:u()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),et=p({...q,...K,...W});async function tt(e,t){const n=E(t),{chain:o,...s}=et.parse(e),i=I(s),a=await F(`${n}/v1/insurance/${o}/events${i}`,void 0,t==null?void 0:t.signal);return Le.parse(a)}const st=p(q);async function at(e,t){const n=E(t),{chain:o}=st.parse(e),s=await F(`${n}/v1/insurance/${o}/cooldown_queue`,void 0,t==null?void 0:t.signal);return Ke.parse(s)}const nt=p({...q,...K,...W});async function ot(e,t){const n=E(t),{chain:o,...s}=nt.parse(e),i=I(s),a=await F(`${n}/v1/insurance/${o}/apr_history${i}`,void 0,t==null?void 0:t.signal);return Ne.parse(a)}const rt=p({...q,...K,...W});async function it(e,t){const n=E(t),{chain:o,...s}=rt.parse(e),i=I(s),a=await F(`${n}/v1/insurance/${o}/tvl_history${i}`,void 0,t==null?void 0:t.signal);return Me.parse(a)}const ct=p(q);async function lt(e,t){const n=E(t),{chain:o}=ct.parse(e),s=await F(`${n}/v1/insurance/${o}/top_users`,void 0,t==null?void 0:t.signal);return Je.parse(s)}const ut=p({...q,bin_count:u().int().positive().optional()});async function pt(e,t){const n=E(t),{chain:o,...s}=ut.parse(e),i=I(s),a=await F(`${n}/v1/insurance/${o}/position_histogram${i}`,void 0,t==null?void 0:t.signal);return Xe.parse(a)}const mt=p({...q,...K,...W});async function dt(e,t){const n=E(t),{chain:o,...s}=mt.parse(e),i=I(s),a=await F(`${n}/v1/insurance/${o}/insurance_pool_distribution_history${i}`,void 0,t==null?void 0:t.signal);return Ze.parse(a)}function _t(e){return H({queryKey:["insurance-events",e],queryFn:()=>tt(P(e)),placeholderData:ke})}function gt(e){return H({queryKey:["insurance-cooldown-queue",e],queryFn:()=>at(P(e))})}function ht(e){const{start:t,end:n}=le({daysRange:90});return H({queryKey:["insurance-apr-history",e],queryFn:()=>ue((s,i)=>ot({...P(e),page:s,per_page:i,start:t,end:n}).then(a=>a.snapshots),1,100)})}function vt(e){const{start:t,end:n}=le({daysRange:90});return H({queryKey:["insurance-tvl-history",e],queryFn:()=>ue((s,i)=>it({...P(e),page:s,per_page:i,start:t,end:n}).then(a=>a.data),1,100)})}function ft(e){return H({queryKey:["insurance-top-users",e],queryFn:()=>lt(P(e))})}function yt(e){return H({queryKey:["insurance-position-hist",e],queryFn:()=>pt(P(e))})}function bt(e){return H({queryKey:["insurance-distribution-hist",e],queryFn:()=>dt(P(e))})}const wt={style:{display:"flex"}},$t={ref:"chartRef",class:"chart"},kt=C({__name:"ChartApr",props:{apr:{}},setup(e){const t=se(),n=ae("card"),{chart:o,series:s}=oe({createChartOptions:ie(),series:re({name:"apr",color:w(()=>t.value.colors.blue),formatter:a=>`${Q(a,0,"percentage")}%`,minMove:.01})});ne(i);function i(){if(!o.value||!s.apr)return;const a=e.apr.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.apr})).uniqWith((c,m)=>c.time===m.time).orderBy(c=>c.time,"asc");a.length>0&&s.apr.setData(a),o.value.timeScale().fitContent()}return(a,c)=>{const m=pe,g=ce,b=S;return $(),k(b,{ref_key:"card",ref:n,title:"APR"},{actions:h(()=>[_("div",wt,[d(m,{filename:"apr",series:r(s)},null,8,["series"]),d(g,{chart:r(o),target:r(n)},null,8,["chart","target"])])]),default:h(()=>[_("div",$t,null,512)]),_:1},512)}}}),Tt=C({__name:"ChartPositions",props:{bins:{}},setup(e){const t=w(()=>Ve({chart:{type:"bar",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1}},xaxis:{categories:n.value,labels:{formatter:s=>s,rotate:-60},tickPlacement:"on"},yaxis:{labels:{formatter:s=>s}},plotOptions:{bar:{columnWidth:"50%"}},dataLabels:{enabled:!1},tooltip:{followCursor:!1,enabled:!0,intersect:!0,custom:s=>{const i=s.series[0][s.dataPointIndex];return`<div><b>Range</b>: ${n.value[s.dataPointIndex]}</div><div><b>Users</b>: ${i}</div>`}}})),n=w(()=>e.bins.map(s=>{const i=s.minValue?`${Q(s.minValue,0,"dollar")}${z(s.minValue)}`:"0",a=s.maxValue?`${Q(s.maxValue,0,"dollar")}${z(s.maxValue)}`:"0";return`${i} - ${a}`})),o=w(()=>[{name:"Users",data:e.bins.map(s=>s.count)}]);return(s,i)=>{const a=Ae,c=S;return $(),k(c,{title:"User positions"},{default:h(()=>[d(a,{options:r(t),series:r(o)},null,8,["options","series"])]),_:1})}}}),Pt=B(Tt,[["__scopeId","data-v-525b8a17"]]),Ct={style:{display:"flex"}},St={ref:"chartRef",class:"chart"},Ft=C({__name:"ChartTvl",props:{tvl:{}},setup(e){const t=se(),n=ae("card"),{chart:o,series:s}=oe({createChartOptions:ie(),series:re({name:"tvl",color:w(()=>t.value.colors.blue),formatter:a=>`${Q(a,1,"dollar")}${z(a)}`})});ne(i);function i(){if(!o.value||!s.tvl)return;const a=e.tvl.map(c=>({time:c.timestamp.getUTCTimestamp(),value:c.tvl})).uniqWith((c,m)=>c.time===m.time).orderBy(c=>c.time,"asc");a.length>0&&s.tvl.setData(a),o.value.timeScale().fitContent()}return(a,c)=>{const m=pe,g=ce,b=S;return $(),k(b,{ref_key:"card",ref:n,title:"TVL (reUSD)"},{actions:h(()=>[_("div",Ct,[d(m,{filename:"tvl",series:r(s)},null,8,["series"]),d(g,{chart:r(o),target:r(n)},null,8,["chart","target"])])]),default:h(()=>[_("div",St,null,512)]),_:1},512)}}}),Ht=["href"],Dt={class:"end"},qt={class:"end"},Et=["href"],te=10,Ut=C({__name:"TableCooldowns",props:{cooldowns:{}},setup(e){const{page:t,rowsPage:n,onPage:o}=Re(V(()=>e.cooldowns),te),{relativeTime:s}=de();return(i,a)=>{const c=me,m=j,g=J,b=S;return $(),k(b,{title:"Cooldown Queue"},{actions:h(()=>[d(c,{"items-count":i.cooldowns.length,"items-per-page":te,page:r(t),onPage:r(o)},null,8,["items-count","page","onPage"])]),default:h(()=>[d(g,{rows:r(n),columns:["User",{label:"Staked reUSD",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:f})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${f.account.address}`,onClick:a[0]||(a[0]=R(()=>{},["stop"]))},U(f.account.ens||("addressShort"in i?i.addressShort:r(M))(f.account.address)),9,Ht)]),_("div",Dt,[d(m,{type:"dollar",value:f.amount,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",qt,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${f.txHash}`,onClick:a[1]||(a[1]=R(()=>{},["stop"]))},U(r(s)(f.end.getUTCTimestamp())),9,Et)])]),_:1},8,["rows"])]),_:1})}}}),xt=B(Ut,[["__scopeId","data-v-b4fa2168"]]),At=["href"],Vt={class:"end"},Rt={class:"end"},Bt=["href"],It=C({__name:"TableEvents",props:{events:{},count:{}},emits:["page"],setup(e,{emit:t}){const n=t,{page:o,onPage:s}=Be(),i=Te(o,200);Pe(i,m=>{n("page",m)});const{relativeTime:a}=de(),c=m=>{switch(m.eventType){case"deposit":return"Deposit";case"withdraw":return"Withdraw"}};return(m,g)=>{const b=me,f=j,O=J,N=S;return $(),k(N,{title:"Events"},{actions:h(()=>[d(b,{"items-count":m.count,"items-per-page":10,page:r(o),onPage:r(s)},null,8,["items-count","page","onPage"])]),default:h(()=>[d(O,{rows:m.events,columns:["Type","Owner",{label:"reUSD",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:v})=>[_("div",{class:Ce({green:v.eventType==="deposit",red:v.eventType==="withdraw"})},U(c(v)),3),_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${v.owner.address}`,onClick:g[0]||(g[0]=R(()=>{},["stop"]))},U(v.owner.ens||("addressShort"in m?m.addressShort:r(M))(v.owner.address)),9,At)]),_("div",Vt,[d(f,{type:"dollar",value:v.assets,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Rt,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${v.txHash}`,onClick:g[1]||(g[1]=R(()=>{},["stop"]))},U(r(a)(v.blockTime.getUTCTimestamp())),9,Bt)])]),_:1},8,["rows"])]),_:1})}}}),Qt=B(It,[["__scopeId","data-v-3718948b"]]),Lt=["href"],Wt={class:"end"},Kt=C({__name:"TableTopUsers",props:{topUsers:{}},setup(e){return(t,n)=>{const o=j,s=J,i=S;return $(),k(i,{title:"Top Users"},{default:h(()=>[d(s,{rows:t.topUsers,columns:["Address",{label:"Staked reUSD",align:"end"}]},{row:h(({item:a})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${a.address}`,onClick:n[0]||(n[0]=R(()=>{},["stop"]))},U(a.ens||("addressShort"in t?t.addressShort:r(M))(a.address)),9,Lt)]),_("div",Wt,[d(o,{type:"dollar",value:a.positionValue,precision:2,"show-symbol":!1},null,8,["value"])])]),_:1},8,["rows"])]),_:1})}}}),Ot=B(Kt,[["__scopeId","data-v-d27f5415"]]),Nt={class:"dashboard"},zt=C({__name:"Insurance.page",setup(e){const{isFetching:t,data:n}=ht({chain:"ethereum"}),o=w(()=>(n.value??[]).map(y=>({timestamp:y.timestamp,apr:y.apr}))),{isFetching:s,data:i}=vt({chain:"ethereum"}),a=w(()=>(i.value??[]).map(y=>({timestamp:y.timestamp,tvl:y.tvl}))),c=Se(1),{isFetching:m,data:g}=_t(w(()=>({chain:"ethereum",page:c.value,per_page:10}))),{isFetching:b,data:f}=ft(V(()=>({chain:"ethereum"}))),{isFetching:O,data:N}=gt(V(()=>({chain:"ethereum"}))),{isFetching:v,data:he}=yt(V(()=>({chain:"ethereum"}))),{isFetching:ve,data:fe}=bt(V(()=>({chain:"ethereum"}))),ye=w(()=>{var A;const y=((A=fe.value)==null?void 0:A.data)??[];return y.length===0?[]:[{symbol:"In cooldown",balances:y.map(T=>({timestamp:T.timestamp,balance:T.cooldownAmount,tokenPrice:1}))},{symbol:"Active staked",balances:y.map(T=>({timestamp:T.timestamp,balance:T.activeStakedAmount,tokenPrice:1}))}]});return(y,A)=>{var G,X,Y,Z,ee;const T=qe,be=De,we=S;return $(),Fe("div",Nt,[d(T,{style:{"grid-area":"header"},title:"Insurance",description:"Insurance pool metrics for Resupply including APR, TVL and positions"}),d(kt,{style:{"grid-area":"apr"},apr:r(o),loading:r(t)},null,8,["apr","loading"]),d(Ft,{style:{"grid-area":"tvl"},tvl:r(a),loading:r(s)},null,8,["tvl","loading"]),d(Qt,{style:{"grid-area":"events"},events:((G=r(g))==null?void 0:G.events)??[],count:((X=r(g))==null?void 0:X.count)??0,loading:r(m),onPage:A[0]||(A[0]=$e=>c.value=$e)},null,8,["events","count","loading"]),d(xt,{style:{"grid-area":"cooldowns"},cooldowns:((Y=r(N))==null?void 0:Y.entries)??[],loading:r(O)},null,8,["cooldowns","loading"]),r(ve)?($(),k(we,{key:1,loading:"",title:"Staked",style:He(`grid-area: chart-staked; min-height: ${r(Ee)}`)},null,8,["style"])):($(),k(be,{key:0,style:{"grid-area":"chart-staked"},title:"Staked",balances:r(ye),"show-dollars":!1},null,8,["balances"])),d(Ot,{style:{"grid-area":"top-users"},"top-users":((Z=r(f))==null?void 0:Z.users)??[],loading:r(b)},null,8,["top-users","loading"]),d(Pt,{style:{"grid-area":"positions"},bins:((ee=r(he))==null?void 0:ee.bins)??[],loading:r(v)},null,8,["bins","loading"])])}}}),cs=B(zt,[["__scopeId","data-v-d35785be"]]);export{cs as default};
