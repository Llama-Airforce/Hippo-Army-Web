import{_ as ye}from"./DashboardHeader-B9DjZVb_.js";import{u as k,r as R,a as W}from"./Number-BVeBD89l.js";import{a as I,f as P,_ as M}from"./fetch-DRLrqTU_.js";import{o as _,f as B,s as d,n as m,_ as be,t as A,a as x,i as we,p as K,c as z,h as S,g as F,e as se}from"./timestamp-D2Yelcgj.js";import{p as ae}from"./Pagination-vgbH7lYO.js";import{aI as $e,at as D,d as w,az as O,av as ne,c as b,aA as oe,j as U,o as $,w as g,f as p,e as u,u as r,h as q,_ as H,t as V,ao as E,g as C,aq as j,al as Te,an as Ce,ak as ke,ae as Pe,b as xe}from"./index-Ci__0x6w.js";import{u as re,c as ie,a as le,_ as ce}from"./UseLightweightChart-CtaEGqrD.js";import{_ as ue}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-Dt42c5sN.js";import{_ as Se}from"./ChartApex-CC9fKWpe.js";import{_ as N}from"./Table-DgB77jpL.js";import{u as Fe,_ as pe,a as De}from"./UsePagination-DPOOP3UB.js";import{u as de}from"./UseRelativeTime-Bp8GrysG.js";function me(e,t){const o={...e};for(const a in t)Array.isArray(t[a])?o[a]=[...t[a]]:typeof t[a]=="object"&&t[a]!==null?o[a]=me(o[a],t[a]):o[a]=t[a];return o}const _e=_({event_type:be(["deposit","withdraw"]),block_timestamp:m(),tx_hash:d(),block_number:m(),assets:d(),shares:d(),sender:B,owner:B}),he=e=>({eventType:e.event_type,blockTime:A(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,assets:parseFloat(e.assets),shares:parseFloat(e.shares),sender:e.sender,owner:e.owner}),Ue=_e.refine(e=>e.event_type==="deposit",{message:"Expected deposit event type"}).transform(he),qe=_e.extend({receiver:B}).refine(e=>e.event_type==="withdraw",{message:"Expected withdraw event type"}).transform(e=>({...he(e),receiver:e.receiver})),Ae=_({events:x(we([Ue,qe])),count:m(),page:m(),total_pages:m()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Ee=_({account:B,amount:d(),end_timestamp:m(),block_timestamp:m(),tx_hash:d()}).transform(e=>({account:e.account,amount:parseFloat(e.amount),end:A(e.end_timestamp),blockTime:A(e.block_timestamp),txHash:e.tx_hash})),He=_({entries:x(Ee)}).transform(e=>({entries:e.entries})),Ve=_({timestamp:m(),token_address:d(),token_symbol:d(),apr:d()}).transform(e=>({timestamp:A(e.timestamp),tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),Re=_({snapshots:x(Ve),count:m(),page:m(),total_pages:m()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),Be=_({timestamp:m(),tvl:d()}).transform(e=>({timestamp:A(e.timestamp),tvl:parseFloat(e.tvl)})),Ie=_({data:x(Be),count:m(),page:m(),total_pages:m()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),Qe=_({address:d(),label:d().nullable(),ens:d().nullable(),position_value:d()}).transform(e=>({address:e.address,label:e.label,ens:e.ens,positionValue:parseFloat(e.position_value)})),Le=_({total_tvl:d(),top_users_tvl:d(),others_tvl:d(),users:x(Qe)}).transform(e=>({totalTvl:parseFloat(e.total_tvl),topUsersTvl:parseFloat(e.top_users_tvl),othersTvl:parseFloat(e.others_tvl),users:e.users})),We=_({min_value:d(),max_value:d(),count:m()}).transform(e=>({minValue:parseFloat(e.min_value),maxValue:parseFloat(e.max_value),count:e.count})),Me=_({bins:x(We),total_users:m()}).transform(e=>({bins:e.bins,totalUsers:e.total_users})),Ke=_({...S,...z,...K});async function ze(e,t){const o=F(),{chain:a,...s}=Ke.parse(e),i=I(s),n=await P(`${o}/v1/insurance/${a}/events${i}`,void 0,t==null?void 0:t.signal);return Ae.parse(n)}const Oe=_(S);async function je(e,t){const o=F(),{chain:a}=Oe.parse(e),s=await P(`${o}/v1/insurance/${a}/cooldown_queue`,void 0,t==null?void 0:t.signal);return He.parse(s)}const Ne=_({...S,...z,...K});async function Je(e,t){const o=F(),{chain:a,...s}=Ne.parse(e),i=I(s),n=await P(`${o}/v1/insurance/${a}/apr_history${i}`,void 0,t==null?void 0:t.signal);return Re.parse(n)}const Ye=_({...S,...z,...K});async function Ge(e,t){const o=F(),{chain:a,...s}=Ye.parse(e),i=I(s),n=await P(`${o}/v1/insurance/${a}/tvl_history${i}`,void 0,t==null?void 0:t.signal);return Ie.parse(n)}const Xe=_(S);async function Ze(e,t){const o=F(),{chain:a}=Xe.parse(e),s=await P(`${o}/v1/insurance/${a}/top_users`,void 0,t==null?void 0:t.signal);return Le.parse(s)}const et=_({...S,bin_count:m().int().positive().optional()});async function tt(e,t){const o=F(),{chain:a,...s}=et.parse(e),i=I(s),n=await P(`${o}/v1/insurance/${a}/position_histogram${i}`,void 0,t==null?void 0:t.signal);return Me.parse(n)}function st(e){return k({queryKey:["insurance-events",e],queryFn:()=>ze(D(e)),placeholderData:$e})}function at(e){return k({queryKey:["insurance-cooldown-queue",e],queryFn:()=>je(D(e))})}function nt(e){const{start:t,end:o}=se({daysRange:90});return k({queryKey:["insurance-apr-history",e],queryFn:()=>ae((s,i)=>Je({...D(e),page:s,per_page:i,start:t,end:o}).then(n=>n.snapshots),1,100)})}function ot(e){const{start:t,end:o}=se({daysRange:90});return k({queryKey:["insurance-tvl-history",e],queryFn:()=>ae((s,i)=>Ge({...D(e),page:s,per_page:i,start:t,end:o}).then(n=>n.data),1,100)})}function rt(e){return k({queryKey:["insurance-top-users",e],queryFn:()=>Ze(D(e))})}function it(e){return k({queryKey:["insurance-position-hist",e],queryFn:()=>tt(D(e))})}const lt={style:{display:"flex"}},ct={ref:"chartRef",class:"chart"},ut=w({__name:"ChartApr",props:{apr:{}},setup(e){const t=O(),o=ne("card"),{chart:a,series:s}=re({createChartOptions:le(),series:ie({name:"apr",color:b(()=>t.value.colors.blue),formatter:n=>`${R(n,0,"percentage")}%`,minMove:.01})});oe(i);function i(){if(!a.value||!s.apr)return;const n=e.apr.map(l=>({time:l.timestamp.getUTCTimestamp(),value:l.apr})).uniqWith((l,c)=>l.time===c.time).orderBy(l=>l.time,"asc");n.length>0&&s.apr.setData(n),a.value.timeScale().fitContent()}return(n,l)=>{const c=ue,h=ce,y=q;return $(),U(y,{ref_key:"card",ref:o,title:"APR"},{actions:g(()=>[p("div",lt,[u(c,{filename:"apr",series:r(s)},null,8,["series"]),u(h,{chart:r(a),target:r(o)},null,8,["chart","target"])])]),default:g(()=>[p("div",ct,null,512)]),_:1},512)}}}),pt=e=>({chart:{id:"chart",background:"transparant",foreColor:e.colors.level5,fontFamily:"ui-monospace, SFMono-Regular, SF Mono, Menlo, Monaco, Consolas, monospace",toolbar:{autoSelected:"zoom",tools:{download:!1,pan:!1}},zoom:{autoScaleYaxis:!0}},colors:e.colorsArray,grid:{borderColor:e.colors.level5,strokeDashArray:4,xaxis:{lines:{show:!1}}},fill:{type:"solid",opacity:1},stroke:{curve:"smooth",width:2},theme:{mode:"dark"},xaxis:{type:"category",axisBorder:{color:e.colors.level5,height:1},axisTicks:{color:e.colors.level5},title:{color:e.colors.level5}},yaxis:{tickAmount:4,axisBorder:{color:e.colors.level5},axisTicks:{color:e.colors.level5},title:{color:e.colors.level5}}});function dt(e,t){t??(t=O());const o=pt(t.value);return e?me(o,e):o}const mt=w({__name:"ChartPositions",props:{bins:{}},setup(e){const t=b(()=>dt({chart:{type:"bar",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1}},xaxis:{categories:o.value,labels:{formatter:s=>s,rotate:-60},tickPlacement:"on"},yaxis:{labels:{formatter:s=>s}},plotOptions:{bar:{columnWidth:"50%"}},dataLabels:{enabled:!1},tooltip:{followCursor:!1,enabled:!0,intersect:!0,custom:s=>{const i=s.series[0][s.dataPointIndex];return`<div><b>Range</b>: ${o.value[s.dataPointIndex]}</div><div><b>Users</b>: ${i}</div>`}}})),o=b(()=>e.bins.map(s=>{const i=s.minValue?`${R(s.minValue,0,"dollar")}${W(s.minValue)}`:"0",n=s.maxValue?`${R(s.maxValue,0,"dollar")}${W(s.maxValue)}`:"0";return`${i} - ${n}`})),a=b(()=>[{name:"Users",data:e.bins.map(s=>s.count)}]);return(s,i)=>{const n=Se,l=q;return $(),U(l,{title:"User positions"},{default:g(()=>[u(n,{options:r(t),series:r(a)},null,8,["options","series"])]),_:1})}}}),_t=H(mt,[["__scopeId","data-v-525b8a17"]]),ht={style:{display:"flex"}},gt={ref:"chartRef",class:"chart"},vt=w({__name:"ChartTvl",props:{tvl:{}},setup(e){const t=O(),o=ne("card"),{chart:a,series:s}=re({createChartOptions:le(),series:ie({name:"tvl",color:b(()=>t.value.colors.blue),formatter:n=>`${R(n,1,"dollar")}${W(n)}`})});oe(i);function i(){if(!a.value||!s.tvl)return;const n=e.tvl.map(l=>({time:l.timestamp.getUTCTimestamp(),value:l.tvl})).uniqWith((l,c)=>l.time===c.time).orderBy(l=>l.time,"asc");n.length>0&&s.tvl.setData(n),a.value.timeScale().fitContent()}return(n,l)=>{const c=ue,h=ce,y=q;return $(),U(y,{ref_key:"card",ref:o,title:"TVL (reUSD)"},{actions:g(()=>[p("div",ht,[u(c,{filename:"tvl",series:r(s)},null,8,["series"]),u(h,{chart:r(a),target:r(o)},null,8,["chart","target"])])]),default:g(()=>[p("div",gt,null,512)]),_:1},512)}}}),ft=["href"],yt={class:"end"},bt={class:"end"},wt=["href"],te=10,$t=w({__name:"TableCooldowns",props:{cooldowns:{}},setup(e){const{page:t,rowsPage:o,onPage:a}=Fe(V(()=>e.cooldowns),te),{relativeTime:s}=de();return(i,n)=>{const l=pe,c=M,h=N,y=q;return $(),U(y,{title:"Cooldown Queue"},{actions:g(()=>[u(l,{"items-count":i.cooldowns.length,"items-per-page":te,page:r(t),onPage:r(a)},null,8,["items-count","page","onPage"])]),default:g(()=>[u(h,{rows:r(o),columns:["User",{label:"Staked reUSD",align:"end"},{label:"Time",align:"end"}]},{row:g(({item:f})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${f.account.address}`,onClick:n[0]||(n[0]=E(()=>{},["stop"]))},C(f.account.ens||("addressShort"in i?i.addressShort:r(j))(f.account.address)),9,ft)]),p("div",yt,[u(c,{type:"dollar",value:f.amount,precision:2,"show-symbol":!1},null,8,["value"])]),p("div",bt,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${f.txHash}`,onClick:n[1]||(n[1]=E(()=>{},["stop"]))},C(r(s)(f.end.getUTCTimestamp())),9,wt)])]),_:1},8,["rows"])]),_:1})}}}),Tt=H($t,[["__scopeId","data-v-68d34664"]]),Ct=["href"],kt={class:"end"},Pt={class:"end"},xt=["href"],St=w({__name:"TableEvents",props:{events:{},count:{}},emits:["page"],setup(e,{emit:t}){const o=t,{page:a,onPage:s}=De(),i=Te(a,200);Ce(i,c=>{o("page",c)});const{relativeTime:n}=de(),l=c=>{switch(c.eventType){case"deposit":return"Deposit";case"withdraw":return"Withdraw"}};return(c,h)=>{const y=pe,f=M,Q=N,L=q;return $(),U(L,{title:"Events"},{actions:g(()=>[u(y,{"items-count":c.count,"items-per-page":10,page:r(a),onPage:r(s)},null,8,["items-count","page","onPage"])]),default:g(()=>[u(Q,{rows:c.events,columns:["Type","Owner",{label:"reUSD",align:"end"},{label:"Time",align:"end"}]},{row:g(({item:v})=>[p("div",{class:ke({green:v.eventType==="deposit",red:v.eventType==="withdraw"})},C(l(v)),3),p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${v.owner.address}`,onClick:h[0]||(h[0]=E(()=>{},["stop"]))},C(v.owner.ens||("addressShort"in c?c.addressShort:r(j))(v.owner.address)),9,Ct)]),p("div",kt,[u(f,{type:"dollar",value:v.assets,precision:2,"show-symbol":!1},null,8,["value"])]),p("div",Pt,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${v.txHash}`,onClick:h[1]||(h[1]=E(()=>{},["stop"]))},C(r(n)(v.blockTime.getUTCTimestamp())),9,xt)])]),_:1},8,["rows"])]),_:1})}}}),Ft=H(St,[["__scopeId","data-v-3f720b56"]]),Dt=["href"],Ut={class:"end"},qt=w({__name:"TableTopUsers",props:{topUsers:{}},setup(e){return(t,o)=>{const a=M,s=N,i=q;return $(),U(i,{title:"Top Users"},{default:g(()=>[u(s,{rows:t.topUsers,columns:["Address",{label:"Staked reUSD",align:"end"}]},{row:g(({item:n})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${n.address}`,onClick:o[0]||(o[0]=E(()=>{},["stop"]))},C(n.ens||("addressShort"in t?t.addressShort:r(j))(n.address)),9,Dt)]),p("div",Ut,[u(a,{type:"dollar",value:n.positionValue,precision:2,"show-symbol":!1},null,8,["value"])])]),_:1},8,["rows"])]),_:1})}}}),At=H(qt,[["__scopeId","data-v-4cc4818c"]]),Et={class:"dashboard"},Ht=w({__name:"Insurance.page",setup(e){const{isFetching:t,data:o}=nt({chain:"ethereum"}),a=b(()=>(o.value??[]).map(T=>({timestamp:T.timestamp,apr:T.apr}))),{isFetching:s,data:i}=ot({chain:"ethereum"}),n=b(()=>(i.value??[]).map(T=>({timestamp:T.timestamp,tvl:T.tvl}))),l=Pe(1),{isFetching:c,data:h}=st(b(()=>({chain:"ethereum",page:l.value,per_page:10}))),{isFetching:y,data:f}=rt(V(()=>({chain:"ethereum"}))),{isFetching:Q,data:L}=at(V(()=>({chain:"ethereum"}))),{isFetching:v,data:ge}=it(V(()=>({chain:"ethereum"})));return(T,J)=>{var Y,G,X,Z,ee;const ve=ye;return $(),xe("div",Et,[u(ve,{style:{"grid-area":"header"},title:"Insurance",description:"Insurance pool metrics for Resupply including APR, TVL and positions"}),u(ut,{style:{"grid-area":"apr"},apr:r(a),loading:r(t)},null,8,["apr","loading"]),u(vt,{style:{"grid-area":"tvl"},tvl:r(n),loading:r(s)},null,8,["tvl","loading"]),u(Ft,{style:{"grid-area":"events"},events:((Y=r(h))==null?void 0:Y.events)??[],count:((G=r(h))==null?void 0:G.count)??0,loading:r(c),onPage:J[0]||(J[0]=fe=>l.value=fe)},null,8,["events","count","loading"]),u(At,{style:{"grid-area":"top-users"},"top-users":((X=r(f))==null?void 0:X.users)??[],loading:r(y)},null,8,["top-users","loading"]),u(Tt,{style:{"grid-area":"cooldowns"},cooldowns:((Z=r(L))==null?void 0:Z.entries)??[],loading:r(Q)},null,8,["cooldowns","loading"]),u(_t,{style:{"grid-area":"positions"},bins:((ee=r(ge))==null?void 0:ee.bins)??[],loading:r(v)},null,8,["bins","loading"])])}}}),Nt=H(Ht,[["__scopeId","data-v-978a25a4"]]);export{Nt as default};
