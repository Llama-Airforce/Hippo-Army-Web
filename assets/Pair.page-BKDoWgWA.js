import{_ as ce,a as pe}from"./TabItem.vue_vue_type_script_setup_true_lang-By3qrmS3.js";import{ar as D,aI as Q,d as $,aj as z,al as I,j as v,o as g,h as S,w as h,e as c,f as _,g as y,b as F,aw as T,i as L,am as P,u as r,_ as k,ae as K,c as C,ao as U,at as Z,au as ee,av as ae,t as ue,aE as de,aF as _e,ap as me,aB as R}from"./index--6aQy66t.js";import{u as ge,p as he}from"./util-ecCbvgwE.js";import{u as V,r as te,a as oe}from"./Number-JCDnKITR.js";import{z as a,t as B,d as O,p as N,a as j,b as A,g as E,c as be}from"./timestamp-D1DOFXxn.js";import{a as x,f as H,_ as W}from"./fetch-CzIKldv6.js";import{p as ve}from"./Pagination-vgbH7lYO.js";import{_ as M}from"./Table-B1fGGnP3.js";import{a as J,_ as G}from"./UsePagination-BUVeOBbV.js";import{u as X}from"./UseRelativeTime-B1_it9GW.js";import{_ as fe}from"./KPI-Do90NnUD.js";import{u as se,a as re,c as ne,_ as le}from"./UseLightweightChart-CBj2c-74.js";import{_ as ie}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-Kqoh4nS8.js";import{b as Y,a as ye}from"./UseTabNavigation-EsgH_Q1K.js";import"./Tooltip-ZsHLl0Z0.js";const Ce=a.enum(["borrow","add_collateral","remove_collateral","repay","redeem","liquidate","leveraged_position","repay_with_collateral"]),$e=a.object({token_address:a.string(),token_symbol:a.string(),apr:a.string()}).transform(e=>({tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),we=a.object({date_timestamp:a.number(),total_collateral:a.string(),total_underlying:a.string(),exchange_rate:a.string(),total_debt:a.string(),active_positions_count:a.number(),borrow_limit:a.string(),utilization_rate:a.string(),interest_rate:a.string(),claimable_fees:a.string(),claimable_other_fees:a.string(),borrow_cost_apr:a.string(),base_apr:a.string(),rewards:a.array($e)}).transform(e=>({time:B(e.date_timestamp),totalCollateral:parseFloat(e.total_collateral),totalUnderlying:parseFloat(e.total_underlying),exchangeRate:parseFloat(e.exchange_rate),totalDebt:parseFloat(e.total_debt),activePositionsCount:e.active_positions_count,borrowLimit:parseFloat(e.borrow_limit),utilizationRate:parseFloat(e.utilization_rate),interestRate:parseFloat(e.interest_rate),claimableFees:parseFloat(e.claimable_fees),claimableOtherFees:parseFloat(e.claimable_other_fees),aprBorrowCost:parseFloat(e.borrow_cost_apr),aprBase:parseFloat(e.base_apr),rewards:e.rewards})),ke=a.object({snapshots:a.array(we),count:a.number(),page:a.number(),total_pages:a.number()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),qe=a.object({event_type:Ce,block_timestamp:a.number(),tx_hash:a.string(),block_number:a.number(),collateral_change:a.string(),debt_change:a.string()}).transform(e=>({eventType:e.event_type,blockTime:B(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,collateralChange:parseFloat(e.collateral_change),debtChange:parseFloat(e.debt_change)})),Te=a.object({events:a.array(qe),count:a.number(),page:a.number(),total_pages:a.number()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Fe=a.object({block_timestamp:a.number(),tx_hash:a.string(),block_number:a.number(),caller:O,amount:a.string(),collateral_freed:a.string(),protocol_fee:a.string(),debt_reduction:a.string()}).transform(e=>({blockTime:B(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,caller:e.caller,amount:parseFloat(e.amount),collateralFreed:parseFloat(e.collateral_freed),protocolFee:parseFloat(e.protocol_fee),debtReduction:parseFloat(e.debt_reduction)})),Pe=a.object({events:a.array(Fe),count:a.number(),page:a.number(),total_pages:a.number()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Re=a.object({block_timestamp:a.number(),tx_hash:a.string(),block_number:a.number(),borrower:O,liquidator:O,collateral_for_liquidator:a.string(),shares_liquidated:a.string(),amount_liquidator_to_repay:a.string()}).transform(e=>({blockTime:B(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,borrower:e.borrower,liquidator:e.liquidator,collateralForLiquidator:parseFloat(e.collateral_for_liquidator),sharesLiquidated:parseFloat(e.shares_liquidated),amountLiquidatorToRepay:parseFloat(e.amount_liquidator_to_repay)})),Se=a.object({events:a.array(Re),count:a.number(),page:a.number(),total_pages:a.number()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Le=a.object({...A,...j,...N});async function De(e,s){const p=E(),{pair_id:i,...u}=Le.parse(e),t=x(u),l=await H(`${p}/v1/pairs/${i}/snapshots${t}`,void 0,s==null?void 0:s.signal);return ke.parse(l)}const Ie=a.object({...A,...j,...N});async function Ve(e,s){const p=E(),{pair_id:i,...u}=Ie.parse(e),t=x(u),l=await H(`${p}/v1/pairs/${i}/collateral_events${t}`,void 0,s==null?void 0:s.signal);return Te.parse(l)}const Be=a.object({...A,...j,...N});async function Ne(e,s){const p=E(),{pair_id:i,...u}=Be.parse(e),t=x(u),l=await H(`${p}/v1/pairs/${i}/redemptions${t}`,void 0,s==null?void 0:s.signal);return Pe.parse(l)}const je=a.object({...A,...j,...N});async function Ae(e,s){const p=E(),{pair_id:i,...u}=je.parse(e),t=x(u),l=await H(`${p}/v1/pairs/${i}/liquidations${t}`,void 0,s==null?void 0:s.signal);return Se.parse(l)}function Ee(e){const{start:s,end:p}=be({daysRange:90});return V({queryKey:["pairs-snapshots",e],queryFn:()=>ve((u,t)=>De({...D(e),page:u,per_page:t,start:s,end:p}).then(l=>l.snapshots),1,100)})}function xe(e){return V({queryKey:["pairs-collateral-events",e],queryFn:()=>Ve(D(e)),placeholderData:Q})}function He(e){return V({queryKey:["pairs-redemption",e],queryFn:()=>Ne(D(e)),placeholderData:Q})}function We(e){return V({queryKey:["pairs-liquidations",e],queryFn:()=>Ae(D(e)),placeholderData:Q})}const Ue={class:"end"},Oe={key:0,style:{display:"flex",gap:"1ch"}},Qe={class:"end"},ze={key:0,style:{display:"flex",gap:"1ch"}},Ke={class:"end"},Me=["href"],Je=$({__name:"TableCollateralEvents",props:{events:{},count:{},pair:{}},emits:["page"],setup(e,{emit:s}){const p=s,{page:i,onPage:u}=J(),t=z(i,200);I(t,n=>{p("page",n)});const{relativeTime:l}=X(),o=n=>{switch(n.eventType){case"add_collateral":return"Add collateral";case"borrow":return"Borrow";case"remove_collateral":return"Remove collateral";case"repay":return"Repay";case"redeem":return"Redeem";case"liquidate":return"Liquidate";case"leveraged_position":return"Lev. position";case"repay_with_collateral":return"Repay with col"}};return(n,d)=>{const b=G,q=W,f=M,m=S;return g(),v(m,{title:"Events"},{actions:h(()=>[c(b,{"items-count":n.count,"items-per-page":10,page:r(i),onPage:r(u)},null,8,["items-count","page","onPage"])]),default:h(()=>[c(f,{rows:n.events,columns:["Type",{label:"Î” Debt",align:"end"},{label:"Î” Collateral",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:w})=>[_("div",null,y(o(w)),1),_("div",Ue,[w.debtChange!==0?(g(),F("div",Oe,[c(q,{type:"dollar",value:w.debtChange/10**18,precision:4,"show-symbol":!1},null,8,["value"]),L(" "+y(n.pair.tokenDebt.symbol),1)])):T("",!0)]),_("div",Qe,[w.collateralChange!==0?(g(),F("div",ze,[c(q,{type:"dollar",value:w.collateralChange/10**18,precision:4,"show-symbol":!1},null,8,["value"]),L(" "+y(n.pair.tokenCollateral.symbol),1)])):T("",!0)]),_("div",Ke,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${w.txHash}`,onClick:d[0]||(d[0]=P(()=>{},["stop"]))},y(r(l)(w.blockTime.getUTCTimestamp())),9,Me)])]),_:1},8,["rows"])]),_:1})}}}),Ge=k(Je,[["__scopeId","data-v-a900c8c4"]]),Xe={class:"dashboard-grid"},Ye=$({__name:"Collateral",props:{pair:{}},setup(e){const s=K(1),{isFetching:p,data:i}=xe(C(()=>({pair_id:e.pair.pairId,page:s.value,per_page:15})));return(u,t)=>{var l,o;return g(),F("div",Xe,[c(Ge,{events:((l=r(i))==null?void 0:l.events)??[],count:((o=r(i))==null?void 0:o.count)??0,loading:r(p),pair:u.pair,onPage:t[0]||(t[0]=n=>s.value=n)},null,8,["events","count","loading","pair"])])}}}),Ze=k(Ye,[["__scopeId","data-v-223a6ffe"]]),ea={},aa={class:"dashboard-grid"};function ta(e,s){return g(),F("div",aa,"Health goes here")}const oa=k(ea,[["render",ta],["__scopeId","data-v-f3492742"]]),sa={class:"end"},ra=["href"],na={class:"end"},la=["href"],ia={class:"end"},ca={class:"end"},pa={class:"end"},ua={class:"end"},da=["href"],_a=$({__name:"TableLiquidations",props:{liquidations:{},count:{}},emits:["page"],setup(e,{emit:s}){const p=s,{page:i,onPage:u}=J(),t=z(i,200);I(t,o=>{p("page",o)});const{relativeTime:l}=X();return(o,n)=>{const d=G,b=W,q=M,f=S;return g(),v(f,{title:"Liquidations"},{actions:h(()=>[c(d,{"items-count":o.count,"items-per-page":10,page:r(i),onPage:r(u)},null,8,["items-count","page","onPage"])]),default:h(()=>[c(q,{rows:o.liquidations,columns:["Borrower","Liquidator",{label:"Shares liquidated",align:"end"},{label:"Collat for liquidator",align:"end"},{label:"Amount to repay",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:m})=>[_("div",sa,[_("a",{target:"_blank",href:`https://etherscan.io/address/${m.borrower}`,onClick:n[0]||(n[0]=P(()=>{},["stop"]))},y(m.borrower.ens||("addressShort"in o?o.addressShort:r(U))(m.borrower.address)),9,ra)]),_("div",na,[_("a",{target:"_blank",href:`https://etherscan.io/address/${m.liquidator}`,onClick:n[1]||(n[1]=P(()=>{},["stop"]))},y(m.liquidator.ens||("addressShort"in o?o.addressShort:r(U))(m.liquidator.address)),9,la)]),_("div",ia,[c(b,{type:"dollar",value:m.sharesLiquidated,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",ca,[c(b,{type:"dollar",value:m.collateralForLiquidator,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",pa,[c(b,{type:"dollar",value:m.amountLiquidatorToRepay,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",ua,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${m.txHash}`,onClick:n[2]||(n[2]=P(()=>{},["stop"]))},y(r(l)(m.blockTime.getUTCTimestamp())),9,da)])]),_:1},8,["rows"])]),_:1})}}}),ma=k(_a,[["__scopeId","data-v-e5fce9da"]]),ga={class:"dashboard-grid"},ha=$({__name:"Liquidations",props:{pair:{}},setup(e){const s=K(1),{isFetching:p,data:i}=We(C(()=>({pair_id:e.pair.pairId,page:s.value,per_page:15})));return(u,t)=>{var l,o;return g(),F("div",ga,[c(ma,{liquidations:((l=r(i))==null?void 0:l.events)??[],count:((o=r(i))==null?void 0:o.count)??0,loading:r(p),onPage:t[0]||(t[0]=n=>s.value=n)},null,8,["liquidations","count","loading"])])}}}),ba=k(ha,[["__scopeId","data-v-8c64c258"]]),va={style:{display:"flex"}},fa={ref:"chartRef",class:"chart"},ya=$({__name:"ChartApr",props:{apr:{}},setup(e){const s=Z(),p=ee("card"),{chart:i,series:u}=se({createChartOptions:ne(),series:{type:"Area",name:"apr",options:C(()=>({priceFormat:{type:"custom",formatter:l=>`$${te(l,1,"dollar")}${oe(l)}`,minMove:.01},lineWidth:2,lineType:re.WithSteps,lineColor:s.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});ae(t);function t(){if(!i.value||!u.apr)return;const l=e.apr.map(o=>({time:o.timestamp.getUTCTimestamp(),value:o.apr})).uniqWith((o,n)=>o.time===n.time).orderBy(o=>o.time,"asc");l.length>0&&u.apr.setData(l),i.value.timeScale().fitContent()}return(l,o)=>{const n=ie,d=le,b=S;return g(),v(b,{ref_key:"card",ref:p,title:"APR"},{actions:h(()=>[_("div",va,[c(n,{filename:"apr",series:r(u)},null,8,["series"]),c(d,{chart:r(i),target:r(p)},null,8,["chart","target"])])]),default:h(()=>[_("div",fa,null,512)]),_:1},512)}}}),Ca={style:{display:"flex"}},$a={ref:"chartRef",class:"chart"},wa=$({__name:"ChartTvl",props:{tvl:{}},setup(e){const s=Z(),p=ee("card"),{chart:i,series:u}=se({createChartOptions:ne(),series:{type:"Area",name:"tvl",options:C(()=>({priceFormat:{type:"custom",formatter:l=>`$${te(l,1,"dollar")}${oe(l)}`},lineWidth:2,lineType:re.WithSteps,lineColor:s.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});ae(t);function t(){if(!i.value||!u.tvl)return;const l=e.tvl.map(o=>({time:o.timestamp.getUTCTimestamp(),value:o.tvl})).uniqWith((o,n)=>o.time===n.time).orderBy(o=>o.time,"asc");l.length>0&&u.tvl.setData(l),i.value.timeScale().fitContent()}return(l,o)=>{const n=ie,d=le,b=S;return g(),v(b,{ref_key:"card",ref:p,title:"TVL"},{actions:h(()=>[_("div",Ca,[c(n,{filename:"tvl",series:r(u)},null,8,["series"]),c(d,{chart:r(i),target:r(p)},null,8,["chart","target"])])]),default:h(()=>[_("div",$a,null,512)]),_:1},512)}}}),ka={class:"dashboard-grid"},qa=$({__name:"Overview",props:{pair:{}},setup(e){const{isFetching:s,data:p}=Ee(ue(()=>({pair_id:e.pair.pairId}))),i=C(()=>(p.value??[]).map(t=>({timestamp:t.time,tvl:t.totalCollateral/10**21}))),u=C(()=>(p.value??[]).map(t=>({timestamp:t.time,apr:t.aprBase})));return(t,l)=>{const o=W,n=fe;return g(),F("div",ka,[c(n,{style:{"grid-area":"kpi1"},label:"Positions","has-value":!!t.pair},{default:h(()=>{var d;return[c(o,{precision:0,value:(d=t.pair)==null?void 0:d.activePositionsCount},null,8,["value"])]}),_:1},8,["has-value"]),c(n,{style:{"grid-area":"kpi2"},label:"TVL","has-value":!!t.pair},{default:h(()=>{var d;return[c(o,{type:"dollar",precision:2,value:((d=t.pair)==null?void 0:d.totalCollateral)&&t.pair.totalCollateral/10**21,"show-symbol":!1},null,8,["value"]),L(" "+y(t.pair.tokenUnderlying.symbol),1)]}),_:1},8,["has-value"]),c(n,{style:{"grid-area":"kpi3"},label:"Interest Rate","has-value":!!t.pair},{default:h(()=>{var d;return[c(o,{type:"percentage",precision:2,value:((d=t.pair)==null?void 0:d.interestRate)&&t.pair.interestRate/10**8},null,8,["value"])]}),_:1},8,["has-value"]),c(n,{style:{"grid-area":"kpi4"},label:"Utilization Rate","has-value":!!t.pair},{default:h(()=>{var d;return[c(o,{type:"percentage",precision:2,value:(d=t.pair)==null?void 0:d.utilizationRate},null,8,["value"])]}),_:1},8,["has-value"]),c(wa,{style:{"grid-area":"tvl"},tvl:r(i),loading:r(s)},null,8,["tvl","loading"]),c(ya,{style:{"grid-area":"apr"},apr:r(u),loading:r(s)},null,8,["apr","loading"])])}}}),Ta=k(qa,[["__scopeId","data-v-da783683"]]),Fa={class:"end"},Pa=["href"],Ra={class:"end"},Sa={class:"end"},La={class:"end",style:{display:"flex",gap:"1ch"}},Da={class:"end"},Ia={class:"end"},Va=["href"],Ba=$({__name:"TableRedemptions",props:{redemptions:{},count:{},pair:{}},emits:["page"],setup(e,{emit:s}){const p=s,{page:i,onPage:u}=J(),t=z(i,200);I(t,o=>{p("page",o)});const{relativeTime:l}=X();return(o,n)=>{const d=G,b=W,q=M,f=S;return g(),v(f,{title:"Redemptions"},{actions:h(()=>[c(d,{"items-count":o.count,"items-per-page":10,page:r(i),onPage:r(u)},null,8,["items-count","page","onPage"])]),default:h(()=>[c(q,{rows:o.redemptions,columns:["Caller",{label:"reUSD",align:"end"},{label:"Debt reduction",align:"end"},{label:"Collateral freed",align:"end"},{label:"Protocol fee",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:m})=>[_("div",Fa,[_("a",{target:"_blank",href:`https://etherscan.io/address/${m.caller}`,onClick:n[0]||(n[0]=P(()=>{},["stop"]))},y(m.caller.ens||("addressShort"in o?o.addressShort:r(U))(m.caller.address)),9,Pa)]),_("div",Ra,[c(b,{type:"dollar",value:m.amount/10**18,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Sa,[c(b,{type:"dollar",value:m.debtReduction/10**18,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",La,[c(b,{type:"dollar",value:m.collateralFreed/10**18,precision:2,"show-symbol":!1},null,8,["value"]),L(" "+y(o.pair.tokenCollateral.symbol),1)]),_("div",Da,[c(b,{type:"dollar",value:m.protocolFee/10**18,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Ia,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${m.txHash}`,onClick:n[1]||(n[1]=P(()=>{},["stop"]))},y(r(l)(m.blockTime.getUTCTimestamp())),9,Va)])]),_:1},8,["rows"])]),_:1})}}}),Na=k(Ba,[["__scopeId","data-v-bb85efe6"]]),ja={class:"dashboard-grid"},Aa=$({__name:"Redemptions",props:{pair:{}},setup(e){const s=K(1),{isFetching:p,data:i}=He(C(()=>({pair_id:e.pair.pairId,page:s.value,per_page:15})));return(u,t)=>{var l,o;return g(),F("div",ja,[c(Na,{redemptions:((l=r(i))==null?void 0:l.events)??[],count:((o=r(i))==null?void 0:o.count)??0,loading:r(p),pair:u.pair,onPage:t[0]||(t[0]=n=>s.value=n)},null,8,["redemptions","count","loading","pair"])])}}}),Ea=k(Aa,[["__scopeId","data-v-89fe86c2"]]),xa={class:"dashboard"},Ha=$({__name:"Pair.page",setup(e){const s=Y("protocolName"),p=Y("pairId",void 0,{transform:Number}),{isFetching:i,data:u}=ge(C(()=>({chain:"ethereum",protocol_name:s.value})),C(()=>!!s.value)),t=C(()=>(u.value??[]).find(d=>d.pairId===p.value)),{crumbs:l}=de(_e());I(t,d=>{l.value=[{id:"protocols",label:"Protocols",pathName:"protocols",params:()=>({protocolName:s.value})},{id:"protocol",label:s.value,pathName:"protocols",params:()=>({protocolName:s.value})},{id:"pair",label:`Pair: ${d!=null&&d.name?he(d.name):"?"}`}]},{immediate:!0});const{tabActive:o,tabActiveIndex:n}=ye(["overview","collateral","redemptions","liquidations","health"],"pair",void 0,{tabParamName:"pairTab"});return(d,b)=>{const q=me,f=ce,m=pe;return g(),F("div",xa,[c(q,{loading:r(i)},null,8,["loading"]),!r(i)&&r(t)?(g(),v(m,{key:0,active:r(n),onTab:b[0]||(b[0]=w=>n.value=w.index)},{default:h(()=>[c(f,{header:"Overview"},{default:h(()=>[(g(),v(R,null,[r(o)==="overview"?(g(),v(Ta,{key:0,pair:r(t)},null,8,["pair"])):T("",!0)],1024))]),_:1}),c(f,{header:"Collateral"},{default:h(()=>[(g(),v(R,null,[r(o)==="collateral"?(g(),v(Ze,{key:0,pair:r(t)},null,8,["pair"])):T("",!0)],1024))]),_:1}),c(f,{header:"Redemptions"},{default:h(()=>[(g(),v(R,null,[r(o)==="redemptions"?(g(),v(Ea,{key:0,pair:r(t)},null,8,["pair"])):T("",!0)],1024))]),_:1}),c(f,{header:"Liquidation"},{default:h(()=>[(g(),v(R,null,[r(o)==="liquidations"?(g(),v(ba,{key:0,pair:r(t)},null,8,["pair"])):T("",!0)],1024))]),_:1}),c(f,{header:"Health"},{default:h(()=>[(g(),v(R,null,[r(o)==="health"?(g(),v(oa,{key:0,pair:r(t)},null,8,["pair"])):T("",!0)],1024))]),_:1})]),_:1},8,["active"])):T("",!0)])}}}),ot=k(Ha,[["__scopeId","data-v-67e23288"]]);export{ot as default};
