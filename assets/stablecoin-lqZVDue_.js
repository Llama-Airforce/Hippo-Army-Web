import{a as i,f as m,g as h,t as f}from"./timestamp-ZxrFfTJg.js";import{c as u,i as $}from"./index-C6WqhbS3.js";const c=e=>"https://prices.curve.finance";class _ extends Error{constructor(t,a){super(a),this.status=t}}async function l(e,t,a){const s=await fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t),signal:a});if(!s.ok)throw new _(s.status,`Fetch error ${s.status} for URL: ${e}`);return await s.json()}const g=/[+-]\d{2}:?\d{2}$/;function p(e){if(typeof e=="number")return new Date(e*1e3);const t=Number(e);if(!Number.isNaN(t))return new Date(t*1e3);const s=e.endsWith("Z")||g.test(e)?e:`${e}Z`;return new Date(s)}const b=24*60*60;function d({end:e,start:t,daysRange:a=10}={}){return e??(e=Math.floor(Date.now()/1e3)),t??(t=e-a*b),{end:e,start:t}}const q=e=>({time:p(e.time),open:e.open,high:e.high,low:e.low,close:e.close});async function D(e,t,a,s,n){const o=c(),{start:r,end:y}=d({daysRange:90}),v=`${o}/v1/ohlc/${e}/${t}?main_token=${a}&reference_token=${s}&agg_number=1&agg_units=day&start=${r}&end=${y}`;return(await l(v)).data.map(q)}const w=e=>{var t,a;return{name:e.name,address:e.address,numCoins:e.n_coins,tvlUsd:e.tvl_usd,tradingVolume24h:e.trading_volume_24h,tradingFee24h:e.trading_fee_24h,liquidityVolume24h:e.liquidity_volume_24h,liquidityFee24h:e.liquidity_fee_24h,coins:((t=e.coins)==null?void 0:t.map(s=>({poolIndex:s.pool_index,symbol:s.symbol,address:s.address})))??[],baseDailyApr:e.base_daily_apr,baseWeeklyApr:e.base_weekly_apr,virtualPrice:e.virtual_price,poolMethods:((a=e.pool_methods)==null?void 0:a.map(s=>s))??[]}},T=e=>({timestamp:p(e.timestamp),volume:e.volume,fees:e.fees}),F=e=>({timestamp:p(e.timestamp),tvlUSD:e.tvl_usd??0,balances:[...e.balances],tokenPrices:[...e.token_prices]});async function K(e,t,a){const s=c(),n=await l(`${s}/v1/pools/${e}/${t}`);return w(n)}async function N(e,t,a){const s=c(),{start:n,end:o}=d({daysRange:90});return(await l(`${s}/v1/volume/usd/${e}/${t}?interval=day&start=${n}&end=${o}`)).data.map(T)}async function O(e,t,a){const s=c(),{start:n,end:o}=d({daysRange:90});return(await l(`${s}/v1/snapshots/${e}/${t}/tvl?interval=day&start=${n}&end=${o}`)).data.map(F)}function R(){return i({queryKey:["reusd-price-history"],queryFn:async()=>{const{start:e,end:t}=h({daysRange:90}),a=`https://prices.curve.finance/v1/usd_price/ethereum/${$}/history?interval=day&start=${e}&end=${t}`;return(await m(a)).data.map(n=>({price:n.price,timestamp:f(n.timestamp)}))},initialData:[],initialDataUpdatedAt:0})}function k(e,t,a,s){return i({queryKey:["curve-token-price",t,a,s],queryFn:({queryKey:[,n,o,r]})=>D(e.value,n,o,r),enabled:u(()=>!!e.value&&!!t.value&&!!a.value&&!!s.value),initialData:[],initialDataUpdatedAt:0})}function A(e,t){return i({queryKey:["curve-pool",t],queryFn:async({queryKey:[,a]})=>K(e.value,a),enabled:u(()=>!!e.value)})}function E(e,t){return i({queryKey:["curve-pool-volume",t],queryFn:async({queryKey:[,a]})=>N(e.value,a),enabled:u(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}function S(e,t){return i({queryKey:["curve-pool-tvl",t],queryFn:async({queryKey:[,a]})=>O(e.value,a),enabled:u(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}export{k as a,E as b,S as c,A as d,R as u};
