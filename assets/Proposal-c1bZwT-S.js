import{r as O,am as D,d as m,al as Z,c as h,j as g,o as u,f as o,aC as F,aK as B,h as p,ar as b,m as f,ao as I,g as d,l as y,ai as P,y as ee,an as H,k as S,aD as K,aW as W,e as x,b as C,n as k,aX as se,aH as oe,aw as te,E as ae,_ as ne}from"./index-V38PSwR-.js";import{_ as z,o as $,s as _,n as v,b as L,t as V,p as Q,q as j,g as q,i as J,f as A,a as E}from"./timestamp-CFR8-yJ3.js";import{p as X}from"./Pagination-vgbH7lYO.js";import{_ as N}from"./AsyncValue-Drfpo5Bi.js";import{_ as M}from"./KPI-P5Tjq05N.js";/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=O("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),re=z(["all","active","failed","cancelled","executed","executable"]),pe=$({index:v(),target:_(),calldata:_(),decoded_calldata:_()}).transform(e=>({index:e.index,target:e.target,calldata:e.calldata,decodedCalldata:e.decoded_calldata})),G=$({proposal_id:v(),on_chain_id:v(),description:_(),creator:_(),creator_ens:_().nullable(),creator_label:_().nullable(),status:re,epoch:v(),created_at:v(),quorum_weight:v(),execution_tx:_().nullable(),cancellation_tx:_().nullable(),actions:L(pe),weight_yes:v(),weight_no:v(),voters_count:v(),creation_tx_hash:_(),voting_period:v()}).transform(e=>({proposalId:e.proposal_id,onChainId:e.on_chain_id,description:e.description,creator:e.creator,creatorEns:e.creator_ens,creatorLabel:e.creator_label,status:e.status,epoch:e.epoch,createdAt:V(e.created_at),end:new Date(V(e.created_at).getTime()+e.voting_period*1e3),quorumWeight:e.quorum_weight,executionTx:e.execution_tx,cancellationTx:e.cancellation_tx,actions:e.actions,weightYes:e.weight_yes,weightNo:e.weight_no,votersCount:e.voters_count,creationTxHash:e.creation_tx_hash})),ie=$({proposals:L(G),page:v(),count:v()}).transform(e=>({proposals:e.proposals,page:e.page,count:e.count})),ce=G,de=$({voter:_(),voter_ens:_().nullable(),voter_label:_().nullable(),weight_yes:v(),weight_no:v(),tx_hash:_(),timestamp:v()}).transform(e=>({voter:e.voter,voterEns:e.voter_ens,voterLabel:e.voter_label,weightYes:e.weight_yes,weightNo:e.weight_no,txHash:e.tx_hash,time:V(e.timestamp)})),ue=$({votes:L(de),total_votes:v()}).transform(e=>({votes:e.votes,totalVotes:e.total_votes})),ve=$({search_string:_().optional(),order_by:z(["created_at","creator","voters_count"]).optional(),...Q});async function _e(e,t){const a=q(t),n=ve.parse(e),r=J(n),s=await A(`${a}/v1/dao/proposals${r}`,void 0,t?.signal);return ie.parse(s)}const he=$({...j});async function ge(e,t){const a=q(t),{proposal_id:n}=he.parse(e),r=await A(`${a}/v1/dao/proposals/${n}/details`,void 0,t?.signal);return ce.parse(r)}const me=$({...j,...Q});async function fe(e,t){const a=q(t),{proposal_id:n,...r}=me.parse(e),s=J(r),l=await A(`${a}/v1/dao/proposals/${n}/votes${s}`,void 0,t?.signal);return ue.parse(l)}function Ts(e){return E({queryKey:["dao-proposals",e],queryFn:()=>X((a,n)=>_e({...D(e),page:a,per_page:n}).then(r=>r.proposals),1,100)})}function Is(e){return E({queryKey:["dao-proposal",e],queryFn:()=>ge(D(e))})}function ye(e){return E({queryKey:["dao-proposal-votes",e],queryFn:()=>X((a,n)=>fe({...D(e),page:a,per_page:n}).then(r=>r.votes),1,100)})}const $e={class:"voters"},we={class:"for"},be={class:"address"},xe=["href"],Se={class:"amount"},Ce={class:"percentage"},Pe={class:"against"},ke={class:"percentage"},Te={class:"amount"},Ie={class:"address"},Ve=["href"],De=m({__name:"Voters",props:{proposal:{},votes:{}},setup(e){const{address:t}=Z(),a=h(()=>e.votes?e.votes.filter(s=>s.weightYes).orderBy(s=>s.weightYes,"desc"):null),n=h(()=>e.votes?e.votes.filter(s=>s.weightNo).orderBy(s=>s.weightNo,"desc"):null),r=s=>s===t.value;return(s,l)=>{const i=N;return u(),g("div",$e,[o("div",we,[l[0]||(l[0]=o("div",{class:"title"},"For",-1)),(u(!0),g(F,null,B(p(a),c=>(u(),g("div",{key:c.voter,class:"vote font-mono"},[o("div",be,[o("a",{target:"_blank",href:`https://etherscan.io/address/${c.voter}`,class:b({you:r(c.voter)})},f(c.voterEns||("addressShort"in s?s.addressShort:p(I))(c.voter)),11,xe)]),o("div",Se,[d(i,{type:"dollar",value:c.weightYes,precision:2,"show-symbol":!1},null,8,["value"])]),o("div",Ce,[d(i,{type:"percentage",value:c.weightYes/s.proposal.weightYes*100,precision:0},null,8,["value"])])]))),128))]),o("div",Pe,[l[1]||(l[1]=o("div",{class:"title"},"Against",-1)),(u(!0),g(F,null,B(p(n),c=>(u(),g("div",{key:c.voter,class:"vote font-mono"},[o("div",ke,[d(i,{type:"percentage",value:c.weightNo/s.proposal.weightNo*100,precision:0},null,8,["value"])]),o("div",Te,[d(i,{type:"dollar",value:c.weightNo,precision:2,"show-symbol":!1},null,8,["value"])]),o("div",Ie,[o("a",{target:"_blank",href:`https://etherscan.io/address/${c.voter}`,class:b({you:r(c.voter)})},f(c.voterEns||("addressShort"in s?s.addressShort:p(I))(c.voter)),11,Ve)])]))),128))])])}}}),Le=y(De,[["__scopeId","data-v-be60e1b4"]]),qe={class:"technicals"},Ae={class:"technical"},Ee={class:"description"},Ne={class:"technical"},Me={class:"technical"},Ye=["href"],Fe={key:0,class:"technical"},Be=["href"],He={class:"technical"},Re=["innerHTML"],Ue=m({__name:"Technicals",props:{proposal:{},votes:{}},setup(e){const t=P(!0),a=P(e.proposal.votersCount>0),n=h(()=>e.votes.uniqWith((s,l)=>s.voter===l.voter).length),r=h(()=>e.proposal.actions.reduce((s,l)=>s+l.decodedCalldata,"").replace(/(?:\r\n|\r|\n)/g,"<br>").replace("/├/g","├").replace("/─/g","─").replace(/0x[a-fA-F0-9]{40}/g,s=>/[A-F]/g.test(s)&&ee(s)?`<a target='_blank' href='https://etherscan.io/address/${s}'>${s}</a>`:s));return(s,l)=>{const i=K,c=W;return u(),g("div",qe,[o("div",Ae,[l[2]||(l[2]=o("div",{class:"heading"},"Description",-1)),o("div",Ee,f(s.proposal.description),1)]),o("div",Ne,[o("div",{class:"heading",onClick:l[0]||(l[0]=w=>a.value=!p(a))},[S(" Voters ("+f(p(n)??"?")+") ",1),d(i,{class:b(["expander",{expandedVoters:p(a)}])},null,8,["class"])]),d(c,{expanded:p(a)},{default:x(()=>[s.proposal?(u(),C(Le,{key:0,class:"voters",proposal:s.proposal,votes:s.votes},null,8,["proposal","votes"])):H("",!0)]),_:1},8,["expanded"])]),o("div",Me,[l[3]||(l[3]=o("div",{class:"heading"},"Creation transaction",-1)),o("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.creationTxHash}`},f(s.proposal.creationTxHash),9,Ye)]),s.proposal?.executionTx?(u(),g("div",Fe,[l[4]||(l[4]=o("div",{class:"heading"},"Execution transaction",-1)),o("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.executionTx}`},f(s.proposal.executionTx),9,Be)])):H("",!0),o("div",He,[o("div",{class:"heading",onClick:l[1]||(l[1]=w=>t.value=!p(t))},[l[5]||(l[5]=S(" Calldata ")),d(i,{class:b(["expander",{expandedCallData:p(t)}])},null,8,["class"])]),d(c,{expanded:p(t)},{default:x(()=>[o("div",{class:"calldata font-mono",innerHTML:p(r)},null,8,Re)]),_:1},8,["expanded"])])])}}}),Ke=y(Ue,[["__scopeId","data-v-1c5e1409"]]),We={class:"quorum"},ze={class:"amount"},Qe={class:"bar"},je=m({__name:"VotingQuorum",props:{proposal:{}},setup(e){const t=h(()=>e.proposal.weightYes/e.proposal.quorumWeight*100);return(a,n)=>{const r=N;return u(),g("div",We,[n[2]||(n[2]=o("div",{class:"heading"},"Quorum",-1)),o("div",ze,[d(r,{type:"dollar",value:a.proposal.weightYes,precision:0,"show-symbol":!1},null,8,["value"]),n[0]||(n[0]=S(" / ")),d(r,{type:"dollar",value:a.proposal.quorumWeight,precision:0,"show-symbol":!1},null,8,["value"]),n[1]||(n[1]=S(" RSUP "))]),o("div",Qe,[o("div",{class:"support",style:k({width:`${p(t)}%`})},null,4),o("div",{class:"quorum",style:k({width:`${100-p(t)}%`})},null,4)]),n[3]||(n[3]=o("div",{class:"percentages"},[o("div",null,"0%"),o("div",null,"100%")],-1))])}}}),Je=y(je,[["__scopeId","data-v-877e1212"]]),Xe={class:"results"},Ge={class:"choice"},Oe={class:"amount"},Ze={class:"left"},es={class:"right"},ss={class:"choice"},os={class:"amount"},ts={class:"left"},as={class:"right"},R=4,ns=m({__name:"VotingResults",props:{votes:{}},setup(e){const t=h(()=>e.votes.sumBy(l=>l.weightYes)),a=h(()=>e.votes.sumBy(l=>l.weightNo)),n=h(()=>t.value+a.value),r=h(()=>t.value/n.value*100),s=h(()=>a.value/n.value*100);return(l,i)=>{const c=N;return u(),g("div",Xe,[i[8]||(i[8]=o("div",{class:"heading"},"Results",-1)),o("div",Ge,[i[3]||(i[3]=o("div",{class:"label"},"For",-1)),o("div",Oe,[o("div",Ze,[d(c,{"show-zero":"",type:"dollar",value:p(t),precision:0,"show-symbol":!1},null,8,["value"]),i[0]||(i[0]=o("span",null," RSUP",-1))]),o("div",es,[i[1]||(i[1]=o("span",null,"(",-1)),d(c,{"show-zero":"",type:"percentage",value:p(r),precision:2},null,8,["value"]),i[2]||(i[2]=o("span",null,")",-1))])]),o("div",{class:"bar",style:k({width:`${Math.max(R,p(r))}%`})},null,4)]),o("div",ss,[i[7]||(i[7]=o("div",{class:"label"},"Against",-1)),o("div",os,[o("div",ts,[d(c,{"show-zero":"",type:"dollar",value:p(a),precision:0,"show-symbol":!1},null,8,["value"]),i[4]||(i[4]=o("span",null," RSUP",-1))]),o("div",as,[i[5]||(i[5]=o("span",null,"(",-1)),d(c,{"show-zero":"",type:"percentage",value:p(s),precision:2},null,8,["value"]),i[6]||(i[6]=o("span",null,")",-1))])]),o("div",{class:"bar",style:k({width:`${Math.max(R,p(s))}%`})},null,4)])])}}}),ls=y(ns,[["__scopeId","data-v-03202824"]]),rs={class:"voting"},ps=m({__name:"Voting",props:{proposal:{},votes:{}},setup(e){return(t,a)=>(u(),g("div",rs,[d(ls,{votes:t.votes},null,8,["votes"]),d(Je,{proposal:t.proposal},null,8,["proposal"])]))}}),is=y(ps,[["__scopeId","data-v-10fc5a28"]]),cs={class:"proposal-details"},ds={class:"proposal-details-container"},us=m({__name:"ProposalDetails",props:{proposal:{}},setup(e){const{data:t}=ye({proposal_id:e.proposal.proposalId});return(a,n)=>(u(),g("div",cs,[o("div",ds,[d(Ke,{proposal:a.proposal,votes:p(t)??[]},null,8,["proposal","votes"]),d(is,{proposal:a.proposal,votes:p(t)??[]},null,8,["proposal","votes"])])]))}}),vs=y(us,[["__scopeId","data-v-c1dddb5e"]]);function _s(e){function t(T){return T<10?"0"+T.toString():T.toString()}const a=e.getTime()-new Date().getTime();if(a<=0)return"00:00:00:00";const n=1e3,r=n*60,s=r*60,l=s*24,i=Math.floor(a/l),c=Math.floor(a%l/s),w=Math.floor(a%s/r),Y=Math.floor(a%r/n);return t(i)+":"+t(c)+":"+t(w)+":"+t(Y)}const U=m({__name:"Date",props:{proposal:{},type:{}},setup(e){let t;const a=P(""),n=h(()=>{switch(e.type){case"start":return"Start";case"end":return"End";default:return"Unk. Type"}}),r=h(()=>{switch(e.type){case"start":return e.proposal.createdAt.toLocaleDateString();case"end":return e.proposal.end>new Date?a.value:e.proposal.end.toLocaleDateString();default:return new Date(0).toLocaleDateString()}}),s=h(()=>{switch(e.type){case"start":return`
        ${e.proposal.createdAt.toLocaleDateString()} ${e.proposal.createdAt.toTimeString()}
      `;case"end":return`
        ${e.proposal.end.toLocaleDateString()} ${e.proposal.end.toTimeString()}
      `;default:return new Date(0).toLocaleDateString()}});se(()=>{l()});const l=()=>{t&&clearInterval(t),t=setInterval(()=>{a.value=_s(e.proposal.end)})};return(i,c)=>{const w=M;return u(),C(w,{"has-value":"",class:"date","tooltip-type":"underline",label:p(n),value:p(r),tooltip:p(s)},null,8,["label","value","tooltip"])}}}),hs=["href"],gs=m({__name:"Proposer",props:{proposal:{}},setup(e){return(t,a)=>{const n=M;return u(),C(n,{"has-value":"",class:"proposer",label:"Proposer"},{default:x(()=>[o("a",{target:"_blank",href:`https://etherscan.io/address/${t.proposal.creator}`},f(t.proposal.creatorEns||("addressShort"in t?t.addressShort:p(I))(t.proposal.creator)),9,hs)]),_:1})}}}),ms=m({__name:"Status",props:{proposal:{}},setup(e){const t=h(()=>{switch(e.proposal.status){case"active":return"Active";case"failed":return"Failed";case"cancelled":return"Cancelled";case"executable":return"Executable";case"executed":return"Executed";case"all":return"All";default:return"Unk. Status"}});return(a,n)=>{const r=M;return u(),C(r,{"has-value":"",class:"status","tooltip-type":"underline",label:"Status"},{default:x(()=>[o("span",{class:b(["status-value",a.proposal.status])},f(p(t)),3)]),_:1})}}}),fs=y(ms,[["__scopeId","data-v-39bb27db"]]),ys={class:"row"},$s=m({__name:"ProposalSummary",props:{proposal:{},expanded:{type:Boolean}},emits:["toggleExpand"],setup(e,{emit:t}){const a=t,n=h(()=>`/dao/proposal/${e.proposal.proposalId}`),r=async()=>{await navigator.clipboard.writeText(`${window.location.origin}/dao/proposal/${e.proposal.proposalId}`),ae({text:`Copied url for proposal ${e.proposal.proposalId}`,type:"success"})};return(s,l)=>{const i=le,c=oe("router-link"),w=K;return u(),g("div",{class:"proposal-summary",onClick:l[0]||(l[0]=Y=>a("toggleExpand"))},[o("div",{class:b(["title",{"no-title":s.proposal.creatorLabel}])},[o("span",{class:"id",onClick:te(r,["stop"])},[d(i),S(" "+f(s.proposal.onChainId),1)]),d(c,{class:"metadata",to:p(n)},{default:x(()=>[S(f(s.proposal.description||"< No Title >"),1)]),_:1},8,["to"])],2),o("div",ys,[d(fs,{class:"item",proposal:s.proposal},null,8,["proposal"]),d(gs,{class:"item",proposal:s.proposal},null,8,["proposal"]),d(U,{class:"item",type:"start",proposal:s.proposal},null,8,["proposal"]),d(U,{class:"item",type:"end",proposal:s.proposal},null,8,["proposal"]),o("div",{class:b(["item expander",{expanded:s.expanded}])},[d(w)],2)])])}}}),ws=y($s,[["__scopeId","data-v-ceb9cfbf"]]),bs=m({__name:"Proposal",props:{proposal:{},initExpanded:{type:Boolean,default:!1}},setup(e){const t=P(e.initExpanded);return(a,n)=>{const r=W,s=ne;return u(),C(s,{compact:"",class:"proposal"},{default:x(()=>[d(ws,{proposal:a.proposal,expanded:p(t),onToggleExpand:n[0]||(n[0]=l=>t.value=!p(t))},null,8,["proposal","expanded"]),d(r,{class:"proposal-details-collapsible",expanded:p(t)},{default:x(()=>[d(vs,{proposal:a.proposal,expanded:p(t)},null,8,["proposal","expanded"])]),_:1},8,["expanded"])]),_:1})}}}),Vs=y(bs,[["__scopeId","data-v-9a8a8fe5"]]);export{Vs as P,Is as a,Ts as u};
