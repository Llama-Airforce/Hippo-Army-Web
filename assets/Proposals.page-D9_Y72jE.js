import{q as ae,ax as M,d as m,ak as ne,c as _,j as g,o as u,f as o,aA as D,aZ as L,h as a,an as b,m as f,au as E,g as n,l as y,ah as V,x as le,aB as N,k as A,aE as z,a_ as K,e as $,b as k,aY as R,aI as re,as as pe,E as ce,_ as ie,ap as de,ad as ue,av as _e}from"./index-B7fEYGi1.js";import{a as ve,_ as he}from"./UsePagination-B_CWYAdH.js";import{_ as ge}from"./InputText-DaXmkkMM.js";import{a as me,_ as fe}from"./TabItem.vue_vue_type_script_setup_true_lang-D_S_xjak.js";import{_ as ye}from"./DashboardHeader-BUjwVYE-.js";import{t as U,b as W,f as j,a as O}from"./Number-2LMhF5NG.js";import{d as Q,o as C,s as h,n as v,a as q,p as G,i as be,g as J,_ as Z}from"./AsyncValue-CcfLQ0pX.js";import{p as X}from"./Pagination-vgbH7lYO.js";import{_ as F}from"./KPI-omsalhVo.js";import"./Tooltip-DU9iSTSn.js";/**
 * @license lucide-vue-next v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=ae("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),xe=Q(["all","active","failed","cancelled","executed","executable"]),we=C({index:v(),target:h(),calldata:h(),decoded_calldata:h()}).transform(e=>({index:e.index,target:e.target,calldata:e.calldata,decodedCalldata:e.decoded_calldata})),Ce=C({proposal_id:v(),on_chain_id:v(),creator:h(),creator_ens:h().nullable(),creator_label:h().nullable(),status:xe,epoch:v(),created_at:v(),quorum_weight:v(),execution_tx:h().nullable(),cancellation_tx:h().nullable(),actions:q(we),weight_yes:v(),weight_no:v(),voters_count:v(),creation_tx_hash:h()}).transform(e=>({proposalId:e.proposal_id,onChainId:e.on_chain_id,creator:e.creator,creatorEns:e.creator_ens,creatorLabel:e.creator_label,status:e.status,epoch:e.epoch,createdAt:U(e.created_at),quorumWeight:e.quorum_weight,executionTx:e.execution_tx,cancellationTx:e.cancellation_tx,actions:e.actions,weightYes:e.weight_yes,weightNo:e.weight_no,votersCount:e.voters_count,creationTxHash:e.creation_tx_hash})),Pe=C({proposals:q(Ce),page:v(),count:v()}).transform(e=>({proposals:e.proposals,page:e.page,count:e.count})),ke=C({voter:h(),voter_ens:h().nullable(),voter_label:h().nullable(),weight_yes:v(),weight_no:v(),tx_hash:h(),timestamp:v()}).transform(e=>({voter:e.voter,voterEns:e.voter_ens,voterLabel:e.voter_label,weightYes:e.weight_yes,weightNo:e.weight_no,txHash:e.tx_hash,time:U(e.timestamp)})),Ie=C({votes:q(ke),total_votes:v()}).transform(e=>({votes:e.votes,totalVotes:e.total_votes})),Se=C({search_string:h().optional(),order_by:Q(["created_at","creator","voters_count"]).optional(),...G});async function Ve(e,t){const l=J(t),d=Se.parse(e),c=W(d),s=await j(`${l}/v1/dao/proposals${c}`,void 0,t==null?void 0:t.signal);return Pe.parse(s)}const Te=C({...be,...G});async function Ae(e,t){const l=J(t),{proposal_id:d,...c}=Te.parse(e),s=W(c),r=await j(`${l}/v1/dao/proposals/${d}/votes${s}`,void 0,t==null?void 0:t.signal);return Ie.parse(r)}function De(e){return O({queryKey:["dao-proposals",e],queryFn:()=>X((l,d)=>Ve({...M(e),page:l,per_page:d}).then(c=>c.proposals),1,100)})}function Le(e){return O({queryKey:["dao-proposal-votes",e],queryFn:()=>X((l,d)=>Ae({...M(e),page:l,per_page:d}).then(c=>c.votes),1,100)})}const Ee={class:"voters"},Ne={class:"for"},qe={class:"address"},Fe=["href"],Ye={class:"amount"},Be={class:"percentage"},Re={class:"against"},He={class:"percentage"},Me={class:"amount"},ze={class:"address"},Ke=["href"],Ue=m({__name:"Voters",props:{proposal:{},votes:{}},setup(e){const{address:t}=ne(),l=_(()=>e.votes?e.votes.filter(s=>s.weightYes).orderBy(s=>s.weightYes,"desc"):null),d=_(()=>e.votes?e.votes.filter(s=>s.weightNo).orderBy(s=>s.weightNo,"desc"):null),c=s=>s===t.value;return(s,r)=>{const p=Z;return u(),g("div",Ee,[o("div",Ne,[r[0]||(r[0]=o("div",{class:"title"},"For",-1)),(u(!0),g(D,null,L(a(l),i=>(u(),g("div",{key:i.voter,class:"vote font-mono"},[o("div",qe,[o("a",{target:"_blank",href:`https://etherscan.io/address/${i.voter}`,class:b({you:c(i.voter)})},f(i.voterEns||("addressShort"in s?s.addressShort:a(E))(i.voter)),11,Fe)]),o("div",Ye,[n(p,{type:"dollar",value:i.weightYes,precision:2,"show-symbol":!1},null,8,["value"])]),o("div",Be,[n(p,{type:"percentage",value:i.weightYes/s.proposal.weightYes*100,precision:0},null,8,["value"])])]))),128))]),o("div",Re,[r[1]||(r[1]=o("div",{class:"title"},"Against",-1)),(u(!0),g(D,null,L(a(d),i=>(u(),g("div",{key:i.voter,class:"vote font-mono"},[o("div",He,[n(p,{type:"percentage",value:i.weightNo/s.proposal.weightNo*100,precision:0},null,8,["value"])]),o("div",Me,[n(p,{type:"dollar",value:i.weightNo,precision:2,"show-symbol":!1},null,8,["value"])]),o("div",ze,[o("a",{target:"_blank",href:`https://etherscan.io/address/${i.voter}`,class:b({you:c(i.voter)})},f(i.voterEns||("addressShort"in s?s.addressShort:a(E))(i.voter)),11,Ke)])]))),128))])])}}}),We=y(Ue,[["__scopeId","data-v-c5d03c10"]]),je={class:"technicals"},Oe={class:"technical"},Qe={class:"technical"},Ge=["href"],Je={key:0,class:"technical"},Ze=["href"],Xe={class:"technical"},es=["innerHTML"],ss=m({__name:"Technicals",props:{proposal:{},votes:{}},setup(e){const t=V(!0),l=V(e.proposal.votersCount>0),d=_(()=>e.votes.uniqWith((s,r)=>s.voter===r.voter).length),c=_(()=>e.proposal.actions.reduce((s,r)=>s+r.decodedCalldata,"").replace(/(?:\r\n|\r|\n)/g,"<br>").replace("/├/g","├").replace("/─/g","─").replace(/0x[a-fA-F0-9]{40}/g,s=>/[A-F]/g.test(s)&&le(s)?`<a target='_blank' href='https://etherscan.io/address/${s}'>${s}</a>`:s));return(s,r)=>{var x;const p=z,i=K;return u(),g("div",je,[r[5]||(r[5]=o("div",{class:"technical"},[o("div",{class:"heading"},"Description"),o("div",{class:"description"},"DESCRIPTION TODO")],-1)),o("div",Oe,[o("div",{class:"heading",onClick:r[0]||(r[0]=I=>l.value=!a(l))},[A(" Voters ("+f(a(d)??"?")+") ",1),n(p,{class:b(["expander",{expandedVoters:a(l)}])},null,8,["class"])]),n(i,{expanded:a(l)},{default:$(()=>[s.proposal?(u(),k(We,{key:0,class:"voters",proposal:s.proposal,votes:s.votes},null,8,["proposal","votes"])):N("",!0)]),_:1},8,["expanded"])]),o("div",Qe,[r[2]||(r[2]=o("div",{class:"heading"},"Creation transaction",-1)),o("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.creationTxHash}`},f(s.proposal.creationTxHash),9,Ge)]),(x=s.proposal)!=null&&x.executionTx?(u(),g("div",Je,[r[3]||(r[3]=o("div",{class:"heading"},"Execution transaction",-1)),o("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${s.proposal.executionTx}`},f(s.proposal.executionTx),9,Ze)])):N("",!0),o("div",Xe,[o("div",{class:"heading",onClick:r[1]||(r[1]=I=>t.value=!a(t))},[r[4]||(r[4]=A(" Calldata ")),n(p,{class:b(["expander",{expandedCallData:a(t)}])},null,8,["class"])]),n(i,{expanded:a(t)},{default:$(()=>[o("div",{class:"calldata font-mono",innerHTML:a(c)},null,8,es)]),_:1},8,["expanded"])])])}}}),os=y(ss,[["__scopeId","data-v-e295b27a"]]),ts={class:"results"},as={class:"choice"},ns={class:"amount"},ls={class:"left"},rs={class:"right"},ps={class:"choice"},cs={class:"amount"},is={class:"left"},ds={class:"right"},H=4,us=m({__name:"VotingResults",props:{votes:{}},setup(e){const t=_(()=>e.votes.reduce((r,p)=>r+p.weightYes,0)),l=_(()=>e.votes.reduce((r,p)=>r+p.weightNo,0)),d=_(()=>t.value+l.value),c=_(()=>t.value/d.value*100),s=_(()=>l.value/d.value*100);return(r,p)=>{const i=Z;return u(),g("div",ts,[p[8]||(p[8]=o("div",{class:"heading"},"Results",-1)),o("div",as,[p[3]||(p[3]=o("div",{class:"label"},"For",-1)),o("div",ns,[o("div",ls,[n(i,{"show-zero":"",type:"dollar",value:a(t),precision:0,"show-symbol":!1},null,8,["value"]),p[0]||(p[0]=o("span",null," veCRV",-1))]),o("div",rs,[p[1]||(p[1]=o("span",null,"(",-1)),n(i,{"show-zero":"",type:"percentage",value:a(c),precision:2},null,8,["value"]),p[2]||(p[2]=o("span",null,")",-1))])]),o("div",{class:"bar",style:R({width:`${Math.max(H,a(c))}%`})},null,4)]),o("div",ps,[p[7]||(p[7]=o("div",{class:"label"},"Against",-1)),o("div",cs,[o("div",is,[n(i,{"show-zero":"",type:"dollar",value:a(l),precision:0,"show-symbol":!1},null,8,["value"]),p[4]||(p[4]=o("span",null," veCRV",-1))]),o("div",ds,[p[5]||(p[5]=o("span",null,"(",-1)),n(i,{"show-zero":"",type:"percentage",value:a(s),precision:2},null,8,["value"]),p[6]||(p[6]=o("span",null,")",-1))])]),o("div",{class:"bar",style:R({width:`${Math.max(H,a(s))}%`})},null,4)])])}}}),_s=y(us,[["__scopeId","data-v-f01664c7"]]),vs={class:"voting"},hs=m({__name:"Voting",props:{votes:{}},setup(e){return(t,l)=>(u(),g("div",vs,[n(_s,{votes:t.votes},null,8,["votes"])]))}}),gs=y(hs,[["__scopeId","data-v-214162ab"]]),ms={class:"proposal-details"},fs={class:"proposal-details-container"},ys=m({__name:"ProposalDetails",props:{proposal:{}},setup(e){const{data:t}=Le({proposal_id:e.proposal.proposalId});return(l,d)=>(u(),g("div",ms,[o("div",fs,[n(os,{proposal:l.proposal,votes:a(t)??[]},null,8,["proposal","votes"]),n(gs,{votes:a(t)??[]},null,8,["votes"])])]))}}),bs=y(ys,[["__scopeId","data-v-413585ab"]]),$s=m({__name:"Date",props:{proposal:{}},setup(e){const t=_(()=>e.proposal.createdAt.toLocaleDateString()+e.proposal.createdAt.toTimeString());return(l,d)=>{const c=F;return u(),k(c,{"has-value":"",class:"date","tooltip-type":"underline",label:"Start",value:l.proposal.createdAt.toLocaleDateString(),tooltip:a(t)},null,8,["value","tooltip"])}}}),xs=["href"],ws=m({__name:"Proposer",props:{proposal:{}},setup(e){return(t,l)=>{const d=F;return u(),k(d,{"has-value":"",class:"proposer",label:"Proposer"},{default:$(()=>[o("a",{target:"_blank",href:`https://etherscan.io/address/${t.proposal.creator}`},f(t.proposal.creatorEns||("addressShort"in t?t.addressShort:a(E))(t.proposal.creator)),9,xs)]),_:1})}}}),Cs=m({__name:"Status",props:{proposal:{}},setup(e){const t=_(()=>{switch(e.proposal.status){case"active":return"Active";case"failed":return"Failed";case"cancelled":return"Cancelled";case"executable":return"Executable";case"executed":return"Executed";case"all":return"All";default:return"Unk. Status"}});return(l,d)=>{const c=F;return u(),k(c,{"has-value":"",class:"status","tooltip-type":"underline",label:"Status"},{default:$(()=>[o("span",{class:b(["status-value",l.proposal.status])},f(a(t)),3)]),_:1})}}}),Ps=y(Cs,[["__scopeId","data-v-39bb27db"]]),ks={class:"row"},Is=m({__name:"ProposalSummary",props:{proposal:{},expanded:{type:Boolean}},emits:["toggleExpand"],setup(e,{emit:t}){const l=t,d=_(()=>`/dao/proposal/${e.proposal.proposalId}`),c=async()=>{await navigator.clipboard.writeText(`${window.location.origin}/dao/proposal/${e.proposal.proposalId}`),ce({text:`Copied url for proposal ${e.proposal.proposalId}`,type:"success"})};return(s,r)=>{const p=$e,i=re("router-link"),x=z;return u(),g("div",{class:"proposal-summary",onClick:r[0]||(r[0]=I=>l("toggleExpand"))},[o("div",{class:b(["title",{"no-title":s.proposal.creatorLabel}])},[o("span",{class:"id",onClick:pe(c,["stop"])},[n(p),A(" "+f(s.proposal.proposalId),1)]),n(i,{class:"metadata",to:a(d)},{default:$(()=>[A(f(s.proposal.creatorLabel||"< No Title >"),1)]),_:1},8,["to"])],2),o("div",ks,[n(Ps,{class:"item",proposal:s.proposal},null,8,["proposal"]),n(ws,{class:"item",proposal:s.proposal},null,8,["proposal"]),n($s,{class:"item",type:"start",proposal:s.proposal},null,8,["proposal"]),o("div",{class:b(["item expander",{expanded:s.expanded}])},[n(x)],2)])])}}}),Ss=y(Is,[["__scopeId","data-v-21defc45"]]),Vs=m({__name:"Proposal",props:{proposal:{},initExpanded:{type:Boolean,default:!1}},setup(e){const t=V(e.initExpanded);return(l,d)=>{const c=K,s=ie;return u(),k(s,{compact:"",class:"proposal"},{default:$(()=>[n(Ss,{proposal:l.proposal,expanded:a(t),onToggleExpand:d[0]||(d[0]=r=>t.value=!a(t))},null,8,["proposal","expanded"]),n(c,{class:"proposal-details-collapsible",expanded:a(t)},{default:$(()=>[n(bs,{proposal:l.proposal,expanded:a(t)},null,8,["proposal","expanded"])]),_:1},8,["expanded"])]),_:1})}}}),Ts=y(Vs,[["__scopeId","data-v-9a8a8fe5"]]),As={class:"dashboard"},Ds={class:"filters"},Ls={class:"proposals-content"},Es={key:0},Ns=m({__name:"Proposals.page",setup(e){const t=V(0),{page:l,onPage:d}=ve(),c=V(""),s=de(c,300),r=_(()=>{switch(t.value){case 0:return"all";case 1:return"active";case 2:return"executable";case 3:return"failed";case 4:return"executed";default:return"all"}}),p=_(()=>s.value.toLocaleLowerCase()),{isFetching:i,data:x}=De(_(()=>({search_string:p.value}))),I=_(()=>{var w;return((w=x.value)==null?void 0:w.length)??0}),Y=_(()=>(x.value??[]).filter(w=>w.status===r.value).orderBy(w=>w.createdAt.getDate(),"desc"));return(w,T)=>{const ee=ye,S=me,se=fe,oe=ge,B=he,te=_e;return u(),g("div",As,[n(ee,{title:"Governance proposals",description:"View and search for governance proposals"}),n(se,{onTab:T[0]||(T[0]=P=>t.value=P.index)},{default:$(()=>[n(S,{header:"All"}),n(S,{header:"Active"}),n(S,{header:"Passed"}),n(S,{header:"Denied"}),n(S,{header:"Executed"})]),_:1}),o("div",Ds,[n(oe,{modelValue:a(c),"onUpdate:modelValue":T[1]||(T[1]=P=>ue(c)?c.value=P:null),search:"",style:{"flex-grow":"1"},placeholder:"Search for Resupply proposals"},null,8,["modelValue"]),n(B,{class:"pagination","items-count":a(I),"items-per-page":10,page:a(l),onPage:a(d)},null,8,["items-count","page","onPage"])]),o("div",Ls,[(u(!0),g(D,null,L(a(Y),P=>(u(),k(Ts,{key:P.proposalId,class:b(["loading-backdrop",{loading:a(i)}]),proposal:P},null,8,["proposal","class"]))),128)),n(B,{class:"pagination","items-count":a(I),"items-per-page":10,page:a(l),onPage:a(d)},null,8,["items-count","page","onPage"]),a(Y).length===0?(u(),g("div",Es,"No proposals could be found.")):N("",!0),n(te,{loading:a(i)},null,8,["loading"])])])}}}),Ws=y(Ns,[["__scopeId","data-v-5782a2f4"]]);export{Ws as default};
