import{_ as j}from"./DashboardHeader-DIUaj5yv.js";import{t as Q,b as Y,f as z,a as J,r as V,u as x}from"./Number-DpAK-pXX.js";import{o as w,s as W,e as G,n as v,a as X,p as Z,t as tt,f as et,g as st,_ as B}from"./AsyncValue-iTYOvWr4.js";import{aI as at,al as nt,d as D,u as F,a as L,c as g,w as M,b as T,o as y,e as h,f as p,g as u,h as l,_ as P,j as O,k as $,l as S,as as ot,au as it,av as R,m as C,b0 as rt,ah as lt}from"./index-BgPU8Sw7.js";import{u as q,a as I,_ as U,P as A}from"./UseLightweightChart-Bx3pg8jN.js";import{_ as E}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-BmD2VBda.js";import{_ as ut}from"./KPI-CngUDtHK.js";import{_ as ct}from"./Table-CvXFjjfl.js";import{a as dt,_ as mt}from"./UsePagination-CVTD_cJr.js";import{u as _t}from"./UseRelativeTime-nGpi85-e.js";import"./Tooltip-DzxxnI9b.js";const pt=w({block_timestamp:v(),tx_hash:W(),block_number:v(),operator:G,amount:W()}).transform(o=>({blockTime:Q(o.block_timestamp),txHash:o.tx_hash,blockNumber:o.block_number,operator:o.operator,amount:parseFloat(o.amount)})),ht=w({distributions:X(pt),count:v(),page:v(),total_pages:v()}).transform(o=>({distributions:o.distributions,count:o.count,page:o.page,totalPages:o.total_pages})),ft=w({...et,...tt,...Z});async function bt(o,d){const i=st(d),{chain:r,...m}=ft.parse(o),_=Y(m),e=await z(`${i}/v1/revenue/${r}/distributions${_}`,void 0,d==null?void 0:d.signal);return ht.parse(e)}function H(o){return J({queryKey:["revenue-distributions",o],queryFn:()=>bt(nt(o)),placeholderData:at})}const gt={style:{display:"flex"}},vt={ref:"chartRef",class:"chart"},Dt=D({__name:"ChartDistributions",props:{distributions:{}},setup(o){const d=F(),i=L("card"),{chart:r,series:m}=q({createChartOptions:I(),series:{type:A,name:"distributions",options:g(()=>({priceFormat:{type:"custom",formatter:e=>`$${V(e,0,"dollar")}${x(e)}`,minMove:.01},color:d.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});M(_);function _(){if(!r.value||!m.distributions)return;const e=o.distributions.map(n=>({time:n.blockTime.getUTCTimestamp(),value:n.amount})).uniqWith((n,s)=>n.time===s.time).orderBy(n=>n.time,"asc").takeRight(52);e.length>0&&(m.distributions.setData(e),r.value.timeScale().fitContent())}return(e,n)=>{const s=E,a=U,t=P;return y(),T(t,{ref_key:"card",ref:i,title:"Distributions (1y)"},{actions:h(()=>[p("div",gt,[u(s,{filename:"distributions",series:l(m)},null,8,["series"]),u(a,{chart:l(r),target:l(i)},null,8,["chart","target"])])]),default:h(()=>[p("div",vt,null,512)]),_:1},512)}}}),yt={style:{display:"flex"}},kt={ref:"chartRef",class:"chart"},$t=D({__name:"ChartDistributionsDelta",props:{distributions:{}},setup(o){const d=F(),i=L("card"),{chart:r,series:m}=q({createChartOptions:I(),series:{type:A,name:"deltas",options:g(()=>({priceFormat:{type:"custom",formatter:e=>`$${V(e,0,"dollar")}${x(e)}`,minMove:.01},color:d.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))}});M(_);function _(){if(!r.value||!m.deltas)return;const{colors:e}=d.value,n=o.distributions.map(s=>({time:s.blockTime.getUTCTimestamp(),value:s.amount})).uniqWith((s,a)=>s.time===a.time).orderBy(s=>s.time,"asc").takeRight(53).reduce((s,a,t,c)=>{if(t===0)return s;const f=a.value-c[t-1].value,k=f<0?e.red:e.green;return s.push({time:a.time,value:f,color:k}),s},[]);n.length>0&&(m.deltas.setData(n),r.value.timeScale().fitContent())}return(e,n)=>{const s=E,a=U,t=P;return y(),T(t,{ref_key:"card",ref:i,title:"Distributions Change (1y)"},{actions:h(()=>[p("div",yt,[u(s,{filename:"distributions_delta",series:l(m)},null,8,["series"]),u(a,{chart:l(r),target:l(i)},null,8,["chart","target"])])]),default:h(()=>[p("div",kt,null,512)]),_:1},512)}}}),Ct={class:"kpis"},wt=D({__name:"KPIs",setup(o){const d={chain:"ethereum"},{data:i}=H(d),r=g(()=>{var e;return(e=i.value)!=null&&e.distributions?i.value.distributions.reduce((n,s)=>n+s.amount,0):null}),m=g(()=>{var n;if(!((n=i.value)!=null&&n.distributions)||i.value.distributions.length===0)return null;const e=i.value.distributions.slice(0,52);return e.reduce((s,a)=>s+a.amount,0)/e.length}),_=g(()=>{var a;if(!((a=i.value)!=null&&a.distributions)||i.value.distributions.length===0)return null;const e=i.value.distributions.slice(0,52).map(t=>t.amount),n=e.reduce((t,c)=>t+c,0)/e.length,s=e.map(t=>Math.pow(t-n,2));return Math.sqrt(s.reduce((t,c)=>t+c,0)/(e.length-1))});return(e,n)=>{const s=B,a=ut;return y(),O("div",Ct,[u(a,{label:"Total","has-value":!!l(r)},{default:h(()=>[u(s,{type:"dollar",value:l(r),precision:2,"show-symbol":!1},null,8,["value"]),n[0]||(n[0]=$(" reUSD "))]),_:1},8,["has-value"]),u(a,{label:"Average (1y)","has-value":!!l(m)},{default:h(()=>[u(s,{type:"dollar",value:l(m),precision:2,"show-symbol":!1},null,8,["value"]),n[1]||(n[1]=$(" reUSD "))]),_:1},8,["has-value"]),u(a,{label:"Standard Deviation (1y)","has-value":!!l(_)},{default:h(()=>[u(s,{type:"dollar",value:l(_),precision:2,"show-symbol":!1},null,8,["value"]),n[2]||(n[2]=$(" reUSD "))]),_:1},8,["has-value"])])}}}),Tt=S(wt,[["__scopeId","data-v-8461099e"]]),Pt=["href"],St={class:"period"},Wt={class:"end"},Rt={class:"end"},Vt=["href"],xt=D({__name:"TableDistributions",props:{distributions:{},count:{}},emits:["page"],setup(o,{emit:d}){const i=d,{page:r,onPage:m}=dt(),_=ot(r,200);it(_,a=>{i("page",a)});const{relativeTime:e}=_t();function n(a){const t=new Date(a);t.setDate(a.getDate()+4);const c=new Date(t);return c.setDate(t.getDate()-t.getDay()),`${c.toLocaleString("default",{month:"short"})} ${c.getDate()}`}function s(a){const t=new Date(a);t.setDate(a.getDate()+4);const c=new Date(t);c.setDate(t.getDate()-t.getDay());const f=new Date(c);return f.setDate(c.getDate()+4),`${f.toLocaleString("default",{month:"short"})} ${f.getDate()}`}return(a,t)=>{const c=mt,f=rt,k=B,K=ct,N=P;return y(),T(N,{title:"Distributions"},{actions:h(()=>[u(c,{"items-count":a.count,"items-per-page":10,page:l(r),onPage:l(m)},null,8,["items-count","page","onPage"])]),default:h(()=>[u(K,{rows:a.distributions,columns:["Period",{label:"Amount (reUSD)",align:"end"},{label:"Time",align:"end"}]},{row:h(({item:b})=>[p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${b.operator.address}`,onClick:t[0]||(t[0]=R(()=>{},["stop"]))},[p("div",St,[p("span",null,C(n(b.blockTime)),1),u(f,{class:"chevron"}),p("span",null,C(s(b.blockTime)),1)])],8,Pt)]),p("div",Wt,[u(k,{"show-zero":"",type:"dollar",value:b.amount,"show-symbol":!1,precision:2},null,8,["value"])]),p("div",Rt,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${b.txHash}`,onClick:t[1]||(t[1]=R(()=>{},["stop"]))},C(l(e)(b.blockTime.getUTCTimestamp())),9,Vt)])]),_:1},8,["rows"])]),_:1})}}}),Bt=S(xt,[["__scopeId","data-v-daf29cb9"]]),Ft={class:"dashboard"},Lt=D({__name:"Revenue.page",setup(o){const d=lt(1),{isFetching:i,data:r}=H(g(()=>({chain:"ethereum",page:d.value,per_page:15})));return(m,_)=>{var n,s,a,t;const e=j;return y(),O("div",Ft,[u(e,{style:{"grid-area":"header"},title:"Revenue",description:"Token revenue distribution metrics"}),u(Tt,{style:{"grid-area":"kpis"}}),u(Dt,{style:{"grid-area":"chart"},distributions:((n=l(r))==null?void 0:n.distributions)??[]},null,8,["distributions"]),u($t,{style:{"grid-area":"delta"},distributions:((s=l(r))==null?void 0:s.distributions)??[]},null,8,["distributions"]),u(Bt,{style:{"grid-area":"table"},distributions:((a=l(r))==null?void 0:a.distributions)??[],count:((t=l(r))==null?void 0:t.count)??0,loading:l(i),onPage:_[0]||(_[0]=c=>d.value=c)},null,8,["distributions","count","loading"])])}}}),Qt=S(Lt,[["__scopeId","data-v-f3bd6d88"]]);export{Qt as default};
