import{d as A,ap as G,aq as M,b as B,o as C,az as U,ar as q,e as m,as as P,l as W,u as j,a as z,a$ as $,c as D,w,_ as F,f as O,g as y,h as c,an as I,b0 as Y,k as V,m as H}from"./index-BYo41Xup.js";import{u as J,_ as K}from"./UseLegend-DtEHLPBI.js";import{u as Q,G as X,r as Z,a as x,_ as ee}from"./UseLightweightChart-CFtEm1oP.js";import{_ as ae}from"./Tooltip-DWyUKFfl.js";import{r as L,u as te}from"./timestamp-DbzQYZiw.js";const se=A({__name:"ButtonToggle",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:G(["change"],["update:modelValue"]),setup(i,{emit:f}){const g=M(i,"modelValue"),p=f;return(k,b)=>{const d=U;return C(),B(d,{class:q({toggled:g.value}),onClick:b[0]||(b[0]=T=>p("change",!g.value))},{default:m(()=>[P(k.$slots,"default",{},void 0,!0)]),_:3},8,["class"])}}}),le=W(se,[["__scopeId","data-v-1a55ee48"]]),ne={style:{display:"flex"}},oe={ref:"chartRef",class:"chart"},ce="chart_pool_balances_dollars",ie="chart_pool_balances_type",re=A({__name:"ChartBalances",props:{balances:{},title:{},showDollars:{type:Boolean,default:!0}},setup(i){const f=j(),{items:g,toggles:p,disabled:k}=J(()=>i.balances.map(({symbol:e},a)=>({id:e,label:e,color:f.value.colorsArray[a],togglable:!0}))),b=z("card"),d=$(ce,!1),T=["unstacked","stacked","100%"],S=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],v=$(ie,T[0]),{chart:h,series:_}=Q({createChartOptions:x(),series:[...i.balances.map(({symbol:e},a)=>({type:X,name:e,options:D(()=>({lineWidth:2,lineType:Z.WithSteps,color:f.value.colorsArray[a],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stacked",options:D(()=>({colors:g.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!k.value.includes(e.id)).map(({i:e})=>e).map(e=>f.value.colorsArray[e]).map(e=>({line:e,area:e+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});w(()=>{h.value&&h.value.applyOptions({localization:{priceFormatter:v.value==="100%"?e=>`${L(e,0,"percentage")}%`:e=>`${L(e,1,"dollar")}${te(e)}`}})}),w(N);function N(){if(!(!h.value||Object.values(_).length<0)){for(const e of Object.values(_))e==null||e.setData([]);v.value==="unstacked"?R():E(v.value==="100%"),h.value.timeScale().fitContent()}}function R(){var e,a;for(const{symbol:r,balances:t}of i.balances.values()){if(!p[r].value){(e=_[r])==null||e.setData([]);continue}const s=i.showDollars&&d.value,n=t.map(l=>({time:l.timestamp.getUTCTimestamp(),value:s?l.balance*l.tokenPrice:l.balance})).uniqWith((l,u)=>l.time===u.time).orderBy(l=>l.time,"asc");n.length>0&&((a=_[r])==null||a.setData(n))}}function E(e){if(!_.stacked)return;const a=i.showDollars&&d.value,r=[...i.balances.values()].filter(({symbol:t,balances:s})=>p[t].value&&s.length>0).flatMap(({symbol:t,balances:s})=>s.map(n=>({symbol:t,timestamp:n.timestamp,balance:a?n.balance*n.tokenPrice:n.balance}))).groupBy(t=>t.timestamp.getTime()).entries().map(([t,s])=>{const n=e&&s.reduce((u,o)=>u+o.balance,0)||1,l=s.map(u=>e?u.balance/n*100:u.balance);return{time:Number(t)/1e3,values:l}}).uniqWith((t,s)=>t.time===s.time).orderBy(t=>t.time,"asc");r.length>0&&_.stacked.setData(r)}return(e,a)=>{const r=Y,t=le,s=ae,n=ee,l=K,u=F;return C(),B(u,{ref_key:"card",ref:b,class:"stack-actions",title:e.title??"Balances"},{actions:m(()=>[O("div",ne,[y(r,{options:S,selected:S.find(o=>o.id===c(v))??S[0],onSelect:a[0]||(a[0]=o=>v.value=o.id)},{option:m(({option:o})=>[V(H(o.label),1)]),_:1},8,["selected"]),e.showDollars?(C(),B(s,{key:0},{trigger:m(()=>[y(t,{style:{"margin-right":"1rem"},"model-value":c(d),onClick:a[1]||(a[1]=o=>d.value=!c(d))},{default:m(()=>a[3]||(a[3]=[V(" $ ")])),_:1,__:[3]},8,["model-value"])]),default:m(()=>[a[4]||(a[4]=V(" Show token balances in USD. "))]),_:1,__:[4]})):I("",!0),y(n,{chart:c(h),target:c(b)},null,8,["chart","target"])])]),"actions-secondary":m(()=>[y(l,{items:c(g),disabled:c(k),onToggle:a[2]||(a[2]=o=>c(p)[o].value=!c(p)[o].value)},null,8,["items","disabled"])]),default:m(()=>[O("div",oe,null,512)]),_:1},8,["title"])}}}),fe=W(re,[["__scopeId","data-v-86372f0b"]]);export{fe as _,le as a};
