import{r as O,am as L,d as m,al as Z,c as h,j as g,o as u,f as t,aC as F,aK as B,h as p,ar as b,m as f,ao as V,g as d,l as y,ai as k,y as ee,an as H,k as S,aD as K,aW as W,e as x,b as C,n as T,aX as se,aH as oe,aw as te,E as ae,_ as ne}from"./index-B0gvS3y9.js";import{_ as z,o as w,s as _,n as v,b as q,t as D,p as Q,q as j,g as A,i as J,f as E,a as N}from"./timestamp-BJgOM8hi.js";import{p as X}from"./Pagination-vgbH7lYO.js";import{_ as M}from"./AsyncValue-a7yWNq_Y.js";import{_ as Y}from"./KPI-BmhHraLT.js";/**
 * @license lucide-vue-next v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=O("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),re=z(["all","active","failed","cancelled","executed","executable"]),pe=w({index:v(),target:_(),calldata:_(),decoded_calldata:_()}).transform(e=>({index:e.index,target:e.target,calldata:e.calldata,decodedCalldata:e.decoded_calldata})),G=w({proposal_id:v(),on_chain_id:v(),description:_(),creator:_(),creator_ens:_().nullable(),creator_label:_().nullable(),status:re,epoch:v(),created_at:v(),quorum_weight:v(),execution_tx:_().nullable(),cancellation_tx:_().nullable(),actions:q(pe),weight_yes:v(),weight_no:v(),voters_count:v(),creation_tx_hash:_()}).transform(e=>({proposalId:e.proposal_id,onChainId:e.on_chain_id,description:e.description,creator:e.creator,creatorEns:e.creator_ens,creatorLabel:e.creator_label,status:e.status,epoch:e.epoch,createdAt:D(e.created_at),end:new Date(D(e.created_at).getTime()+7*24*60*60*1e3),quorumWeight:e.quorum_weight,executionTx:e.execution_tx,cancellationTx:e.cancellation_tx,actions:e.actions,weightYes:e.weight_yes,weightNo:e.weight_no,votersCount:e.voters_count,creationTxHash:e.creation_tx_hash})),ie=w({proposals:q(G),page:v(),count:v()}).transform(e=>({proposals:e.proposals,page:e.page,count:e.count})),ce=G,de=w({voter:_(),voter_ens:_().nullable(),voter_label:_().nullable(),weight_yes:v(),weight_no:v(),tx_hash:_(),timestamp:v()}).transform(e=>({voter:e.voter,voterEns:e.voter_ens,voterLabel:e.voter_label,weightYes:e.weight_yes,weightNo:e.weight_no,txHash:e.tx_hash,time:D(e.timestamp)})),ue=w({votes:q(de),total_votes:v()}).transform(e=>({votes:e.votes,totalVotes:e.total_votes})),ve=w({search_string:_().optional(),order_by:z(["created_at","creator","voters_count"]).optional(),...Q});async function _e(e,s){const a=A(s),n=ve.parse(e),r=J(n),o=await E(`${a}/v1/dao/proposals${r}`,void 0,s==null?void 0:s.signal);return ie.parse(o)}const he=w({...j});async function ge(e,s){const a=A(s),{proposal_id:n}=he.parse(e),r=await E(`${a}/v1/dao/proposals/${n}/details`,void 0,s==null?void 0:s.signal);return ce.parse(r)}const me=w({...j,...Q});async function fe(e,s){const a=A(s),{proposal_id:n,...r}=me.parse(e),o=J(r),l=await E(`${a}/v1/dao/proposals/${n}/votes${o}`,void 0,s==null?void 0:s.signal);return ue.parse(l)}function Ts(e){return N({queryKey:["dao-proposals",e],queryFn:()=>X((a,n)=>_e({...L(e),page:a,per_page:n}).then(r=>r.proposals),1,100)})}function Is(e){return N({queryKey:["dao-proposal",e],queryFn:()=>ge(L(e))})}function ye(e){return N({queryKey:["dao-proposal-votes",e],queryFn:()=>X((a,n)=>fe({...L(e),page:a,per_page:n}).then(r=>r.votes),1,100)})}const $e={class:"voters"},we={class:"for"},be={class:"address"},xe=["href"],Se={class:"amount"},Ce={class:"percentage"},Pe={class:"against"},ke={class:"percentage"},Te={class:"amount"},Ie={class:"address"},Ve=["href"],De=m({__name:"Voters",props:{proposal:{},votes:{}},setup(e){const{address:s}=Z(),a=h(()=>e.votes?e.votes.filter(o=>o.weightYes).orderBy(o=>o.weightYes,"desc"):null),n=h(()=>e.votes?e.votes.filter(o=>o.weightNo).orderBy(o=>o.weightNo,"desc"):null),r=o=>o===s.value;return(o,l)=>{const i=M;return u(),g("div",$e,[t("div",we,[l[0]||(l[0]=t("div",{class:"title"},"For",-1)),(u(!0),g(F,null,B(p(a),c=>(u(),g("div",{key:c.voter,class:"vote font-mono"},[t("div",be,[t("a",{target:"_blank",href:`https://etherscan.io/address/${c.voter}`,class:b({you:r(c.voter)})},f(c.voterEns||("addressShort"in o?o.addressShort:p(V))(c.voter)),11,xe)]),t("div",Se,[d(i,{type:"dollar",value:c.weightYes,precision:2,"show-symbol":!1},null,8,["value"])]),t("div",Ce,[d(i,{type:"percentage",value:c.weightYes/o.proposal.weightYes*100,precision:0},null,8,["value"])])]))),128))]),t("div",Pe,[l[1]||(l[1]=t("div",{class:"title"},"Against",-1)),(u(!0),g(F,null,B(p(n),c=>(u(),g("div",{key:c.voter,class:"vote font-mono"},[t("div",ke,[d(i,{type:"percentage",value:c.weightNo/o.proposal.weightNo*100,precision:0},null,8,["value"])]),t("div",Te,[d(i,{type:"dollar",value:c.weightNo,precision:2,"show-symbol":!1},null,8,["value"])]),t("div",Ie,[t("a",{target:"_blank",href:`https://etherscan.io/address/${c.voter}`,class:b({you:r(c.voter)})},f(c.voterEns||("addressShort"in o?o.addressShort:p(V))(c.voter)),11,Ve)])]))),128))])])}}}),Le=y(De,[["__scopeId","data-v-be60e1b4"]]),qe={class:"technicals"},Ae={class:"technical"},Ee={class:"description"},Ne={class:"technical"},Me={class:"technical"},Ye=["href"],Fe={key:0,class:"technical"},Be=["href"],He={class:"technical"},Re=["innerHTML"],Ue=m({__name:"Technicals",props:{proposal:{},votes:{}},setup(e){const s=k(!0),a=k(e.proposal.votersCount>0),n=h(()=>e.votes.uniqWith((o,l)=>o.voter===l.voter).length),r=h(()=>e.proposal.actions.reduce((o,l)=>o+l.decodedCalldata,"").replace(/(?:\r\n|\r|\n)/g,"<br>").replace("/├/g","├").replace("/─/g","─").replace(/0x[a-fA-F0-9]{40}/g,o=>/[A-F]/g.test(o)&&ee(o)?`<a target='_blank' href='https://etherscan.io/address/${o}'>${o}</a>`:o));return(o,l)=>{var $;const i=K,c=W;return u(),g("div",qe,[t("div",Ae,[l[2]||(l[2]=t("div",{class:"heading"},"Description",-1)),t("div",Ee,f(o.proposal.description),1)]),t("div",Ne,[t("div",{class:"heading",onClick:l[0]||(l[0]=P=>a.value=!p(a))},[S(" Voters ("+f(p(n)??"?")+") ",1),d(i,{class:b(["expander",{expandedVoters:p(a)}])},null,8,["class"])]),d(c,{expanded:p(a)},{default:x(()=>[o.proposal?(u(),C(Le,{key:0,class:"voters",proposal:o.proposal,votes:o.votes},null,8,["proposal","votes"])):H("",!0)]),_:1},8,["expanded"])]),t("div",Me,[l[3]||(l[3]=t("div",{class:"heading"},"Creation transaction",-1)),t("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${o.proposal.creationTxHash}`},f(o.proposal.creationTxHash),9,Ye)]),($=o.proposal)!=null&&$.executionTx?(u(),g("div",Fe,[l[4]||(l[4]=t("div",{class:"heading"},"Execution transaction",-1)),t("a",{style:{"align-self":"start"},target:"_blank",href:`https://etherscan.io/tx/${o.proposal.executionTx}`},f(o.proposal.executionTx),9,Be)])):H("",!0),t("div",He,[t("div",{class:"heading",onClick:l[1]||(l[1]=P=>s.value=!p(s))},[l[5]||(l[5]=S(" Calldata ")),d(i,{class:b(["expander",{expandedCallData:p(s)}])},null,8,["class"])]),d(c,{expanded:p(s)},{default:x(()=>[t("div",{class:"calldata font-mono",innerHTML:p(r)},null,8,Re)]),_:1},8,["expanded"])])])}}}),Ke=y(Ue,[["__scopeId","data-v-1c5e1409"]]),We={class:"quorum"},ze={class:"amount"},Qe={class:"bar"},je=m({__name:"VotingQuorum",props:{proposal:{}},setup(e){const s=h(()=>e.proposal.weightYes/e.proposal.quorumWeight*100);return(a,n)=>{const r=M;return u(),g("div",We,[n[2]||(n[2]=t("div",{class:"heading"},"Quorum",-1)),t("div",ze,[d(r,{type:"dollar",value:a.proposal.weightYes,precision:0,"show-symbol":!1},null,8,["value"]),n[0]||(n[0]=S(" / ")),d(r,{type:"dollar",value:a.proposal.quorumWeight,precision:0,"show-symbol":!1},null,8,["value"]),n[1]||(n[1]=S(" RSUP "))]),t("div",Qe,[t("div",{class:"support",style:T({width:`${p(s)}%`})},null,4),t("div",{class:"quorum",style:T({width:`${100-p(s)}%`})},null,4)]),n[3]||(n[3]=t("div",{class:"percentages"},[t("div",null,"0%"),t("div",null,"100%")],-1))])}}}),Je=y(je,[["__scopeId","data-v-877e1212"]]),Xe={class:"results"},Ge={class:"choice"},Oe={class:"amount"},Ze={class:"left"},es={class:"right"},ss={class:"choice"},os={class:"amount"},ts={class:"left"},as={class:"right"},R=4,ns=m({__name:"VotingResults",props:{votes:{}},setup(e){const s=h(()=>e.votes.sumBy(l=>l.weightYes)),a=h(()=>e.votes.sumBy(l=>l.weightNo)),n=h(()=>s.value+a.value),r=h(()=>s.value/n.value*100),o=h(()=>a.value/n.value*100);return(l,i)=>{const c=M;return u(),g("div",Xe,[i[8]||(i[8]=t("div",{class:"heading"},"Results",-1)),t("div",Ge,[i[3]||(i[3]=t("div",{class:"label"},"For",-1)),t("div",Oe,[t("div",Ze,[d(c,{"show-zero":"",type:"dollar",value:p(s),precision:0,"show-symbol":!1},null,8,["value"]),i[0]||(i[0]=t("span",null," RSUP",-1))]),t("div",es,[i[1]||(i[1]=t("span",null,"(",-1)),d(c,{"show-zero":"",type:"percentage",value:p(r),precision:2},null,8,["value"]),i[2]||(i[2]=t("span",null,")",-1))])]),t("div",{class:"bar",style:T({width:`${Math.max(R,p(r))}%`})},null,4)]),t("div",ss,[i[7]||(i[7]=t("div",{class:"label"},"Against",-1)),t("div",os,[t("div",ts,[d(c,{"show-zero":"",type:"dollar",value:p(a),precision:0,"show-symbol":!1},null,8,["value"]),i[4]||(i[4]=t("span",null," RSUP",-1))]),t("div",as,[i[5]||(i[5]=t("span",null,"(",-1)),d(c,{"show-zero":"",type:"percentage",value:p(o),precision:2},null,8,["value"]),i[6]||(i[6]=t("span",null,")",-1))])]),t("div",{class:"bar",style:T({width:`${Math.max(R,p(o))}%`})},null,4)])])}}}),ls=y(ns,[["__scopeId","data-v-03202824"]]),rs={class:"voting"},ps=m({__name:"Voting",props:{proposal:{},votes:{}},setup(e){return(s,a)=>(u(),g("div",rs,[d(ls,{votes:s.votes},null,8,["votes"]),d(Je,{proposal:s.proposal},null,8,["proposal"])]))}}),is=y(ps,[["__scopeId","data-v-10fc5a28"]]),cs={class:"proposal-details"},ds={class:"proposal-details-container"},us=m({__name:"ProposalDetails",props:{proposal:{}},setup(e){const{data:s}=ye({proposal_id:e.proposal.proposalId});return(a,n)=>(u(),g("div",cs,[t("div",ds,[d(Ke,{proposal:a.proposal,votes:p(s)??[]},null,8,["proposal","votes"]),d(is,{proposal:a.proposal,votes:p(s)??[]},null,8,["proposal","votes"])])]))}}),vs=y(us,[["__scopeId","data-v-c1dddb5e"]]);function _s(e){function s(I){return I<10?"0"+I.toString():I.toString()}const a=e.getTime()-new Date().getTime();if(a<=0)return"00:00:00:00";const n=1e3,r=n*60,o=r*60,l=o*24,i=Math.floor(a/l),c=Math.floor(a%l/o),$=Math.floor(a%o/r),P=Math.floor(a%r/n);return s(i)+":"+s(c)+":"+s($)+":"+s(P)}const U=m({__name:"Date",props:{proposal:{},type:{}},setup(e){let s;const a=k(""),n=h(()=>{switch(e.type){case"start":return"Start";case"end":return"End";default:return"Unk. Type"}}),r=h(()=>{switch(e.type){case"start":return e.proposal.createdAt.toLocaleDateString();case"end":return e.proposal.end>new Date?a.value:e.proposal.end.toLocaleDateString();default:return new Date(0).toLocaleDateString()}}),o=h(()=>{switch(e.type){case"start":return`
        ${e.proposal.createdAt.toLocaleDateString()} ${e.proposal.createdAt.toTimeString()}
      `;case"end":return`
        ${e.proposal.end.toLocaleDateString()} ${e.proposal.end.toTimeString()}
      `;default:return new Date(0).toLocaleDateString()}});se(()=>{l()});const l=()=>{s&&clearInterval(s),s=setInterval(()=>{a.value=_s(e.proposal.end)})};return(i,c)=>{const $=Y;return u(),C($,{"has-value":"",class:"date","tooltip-type":"underline",label:p(n),value:p(r),tooltip:p(o)},null,8,["label","value","tooltip"])}}}),hs=["href"],gs=m({__name:"Proposer",props:{proposal:{}},setup(e){return(s,a)=>{const n=Y;return u(),C(n,{"has-value":"",class:"proposer",label:"Proposer"},{default:x(()=>[t("a",{target:"_blank",href:`https://etherscan.io/address/${s.proposal.creator}`},f(s.proposal.creatorEns||("addressShort"in s?s.addressShort:p(V))(s.proposal.creator)),9,hs)]),_:1})}}}),ms=m({__name:"Status",props:{proposal:{}},setup(e){const s=h(()=>{switch(e.proposal.status){case"active":return"Active";case"failed":return"Failed";case"cancelled":return"Cancelled";case"executable":return"Executable";case"executed":return"Executed";case"all":return"All";default:return"Unk. Status"}});return(a,n)=>{const r=Y;return u(),C(r,{"has-value":"",class:"status","tooltip-type":"underline",label:"Status"},{default:x(()=>[t("span",{class:b(["status-value",a.proposal.status])},f(p(s)),3)]),_:1})}}}),fs=y(ms,[["__scopeId","data-v-39bb27db"]]),ys={class:"row"},$s=m({__name:"ProposalSummary",props:{proposal:{},expanded:{type:Boolean}},emits:["toggleExpand"],setup(e,{emit:s}){const a=s,n=h(()=>`/dao/proposal/${e.proposal.proposalId}`),r=async()=>{await navigator.clipboard.writeText(`${window.location.origin}/dao/proposal/${e.proposal.proposalId}`),ae({text:`Copied url for proposal ${e.proposal.proposalId}`,type:"success"})};return(o,l)=>{const i=le,c=oe("router-link"),$=K;return u(),g("div",{class:"proposal-summary",onClick:l[0]||(l[0]=P=>a("toggleExpand"))},[t("div",{class:b(["title",{"no-title":o.proposal.creatorLabel}])},[t("span",{class:"id",onClick:te(r,["stop"])},[d(i),S(" "+f(o.proposal.onChainId),1)]),d(c,{class:"metadata",to:p(n)},{default:x(()=>[S(f(o.proposal.description||"< No Title >"),1)]),_:1},8,["to"])],2),t("div",ys,[d(fs,{class:"item",proposal:o.proposal},null,8,["proposal"]),d(gs,{class:"item",proposal:o.proposal},null,8,["proposal"]),d(U,{class:"item",type:"start",proposal:o.proposal},null,8,["proposal"]),d(U,{class:"item",type:"end",proposal:o.proposal},null,8,["proposal"]),t("div",{class:b(["item expander",{expanded:o.expanded}])},[d($)],2)])])}}}),ws=y($s,[["__scopeId","data-v-ceb9cfbf"]]),bs=m({__name:"Proposal",props:{proposal:{},initExpanded:{type:Boolean,default:!1}},setup(e){const s=k(e.initExpanded);return(a,n)=>{const r=W,o=ne;return u(),C(o,{compact:"",class:"proposal"},{default:x(()=>[d(ws,{proposal:a.proposal,expanded:p(s),onToggleExpand:n[0]||(n[0]=l=>s.value=!p(s))},null,8,["proposal","expanded"]),d(r,{class:"proposal-details-collapsible",expanded:p(s)},{default:x(()=>[d(vs,{proposal:a.proposal,expanded:p(s)},null,8,["proposal","expanded"])]),_:1},8,["expanded"])]),_:1})}}}),Vs=y(bs,[["__scopeId","data-v-9a8a8fe5"]]);export{Vs as P,Is as a,Ts as u};
