import{aJ as me,am as P,d as E,c as $,b as k,o as w,e as f,g as p,h as a,_ as U,l as R,u as de,a as _e,w as ge,f as _,t as x,aw as V,m as A,ao as j,at as he,av as ve,ar as ye,ai as fe,j as be,n as X}from"./index-PoaDd28P.js";import{_ as we}from"./ChartBalances-hSvwKw-i.js";import{_ as ke}from"./DashboardHeader-ZOnZ-_d1.js";import{u as $e,c as Te,a as Pe,_ as Ce,D as Y}from"./UseLightweightChart-v9UZ1eMO.js";import{o as u,k as B,s as l,n as c,_ as Se,t as q,b as C,m as Fe,p as Q,d as K,l as S,g as F,i as I,f as H,a as D,j as ee,r as N,u as O}from"./timestamp-CnCs2YLF.js";import{p as te}from"./Pagination-vgbH7lYO.js";import{_ as He}from"./ChartApex-sUiAnWm-.js";import{c as De}from"./ChartStylesApex-DQeXy16i.js";import{_ as Ae}from"./BtnChartLWExport.vue_vue_type_script_setup_true_lang-CWTFpjdc.js";import{_ as z}from"./Table-o5-0HqXd.js";import{_ as J}from"./AsyncValue-CRYfR47y.js";import{u as qe,_ as se,a as Ee}from"./UsePagination-Cfj7UDOK.js";import{u as ne}from"./UseRelativeTime-B8Zq4E-K.js";import"./Tooltip-BACmjZtt.js";const ae=u({event_type:Se(["deposit","withdraw"]),block_timestamp:c(),tx_hash:l(),block_number:c(),assets:l(),shares:l(),sender:B,owner:B}),oe=e=>({eventType:e.event_type,blockTime:q(e.block_timestamp),txHash:e.tx_hash,blockNumber:e.block_number,assets:parseFloat(e.assets),shares:parseFloat(e.shares),sender:e.sender,owner:e.owner}),Ue=ae.refine(e=>e.event_type==="deposit",{message:"Expected deposit event type"}).transform(oe),xe=ae.extend({receiver:B}).refine(e=>e.event_type==="withdraw",{message:"Expected withdraw event type"}).transform(e=>({...oe(e),receiver:e.receiver})),Ve=u({events:C(Fe([Ue,xe])),count:c(),page:c(),total_pages:c()}).transform(e=>({events:e.events,count:e.count,page:e.page,totalPages:e.total_pages})),Re=u({account:B,amount:l(),end_timestamp:c(),block_timestamp:c(),tx_hash:l()}).transform(e=>({account:e.account,amount:parseFloat(e.amount),end:q(e.end_timestamp),blockTime:q(e.block_timestamp),txHash:e.tx_hash})),Ie=u({entries:C(Re)}).transform(e=>({entries:e.entries})),Be=u({timestamp:c(),token_address:l(),token_symbol:l(),apr:l()}).transform(e=>({timestamp:q(e.timestamp),tokenAddress:e.token_address,tokenSymbol:e.token_symbol,apr:parseFloat(e.apr)})),Qe=u({snapshots:C(Be),count:c(),page:c(),total_pages:c()}).transform(e=>({snapshots:e.snapshots,count:e.count,page:e.page,totalPages:e.total_pages})),Ke=u({timestamp:c(),tvl:l()}).transform(e=>({timestamp:q(e.timestamp),tvl:parseFloat(e.tvl)})),Le=u({data:C(Ke),count:c(),page:c(),total_pages:c()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),We=u({address:l(),label:l().nullable(),ens:l().nullable(),position_value:l()}).transform(e=>({address:e.address,label:e.label,ens:e.ens,positionValue:parseFloat(e.position_value)})),Ne=u({total_tvl:l(),top_users_tvl:l(),others_tvl:l(),users:C(We)}).transform(e=>({totalTvl:parseFloat(e.total_tvl),topUsersTvl:parseFloat(e.top_users_tvl),othersTvl:parseFloat(e.others_tvl),users:e.users})),Oe=u({min_value:l(),max_value:l(),count:c()}).transform(e=>({minValue:parseFloat(e.min_value),maxValue:parseFloat(e.max_value),count:e.count})),je=u({bins:C(Oe),total_users:c()}).transform(e=>({bins:e.bins,totalUsers:e.total_users})),ze=u({timestamp:c(),total_staked:l(),cooldown_amount:l(),cooldown_percentage:l(),active_staked_amount:l(),active_staked_percentage:l()}).transform(e=>({timestamp:q(e.timestamp),totalStaked:parseFloat(e.total_staked),cooldownAmount:parseFloat(e.cooldown_amount),cooldownPercentage:parseFloat(e.cooldown_percentage),activeStakedAmount:parseFloat(e.active_staked_amount),activeStakedPercentage:parseFloat(e.active_staked_percentage)})),Je=u({data:C(ze),count:c(),page:c(),total_pages:c()}).transform(e=>({data:e.data,count:e.count,page:e.page,totalPages:e.total_pages})),Me=u({...S,...K,...Q});async function Ge(e,s){const o=F(s),{chain:r,...t}=Me.parse(e),i=I(t),n=await H(`${o}/v1/insurance/${r}/events${i}`,void 0,s?.signal);return Ve.parse(n)}const Xe=u(S);async function Ye(e,s){const o=F(s),{chain:r}=Xe.parse(e),t=await H(`${o}/v1/insurance/${r}/cooldown_queue`,void 0,s?.signal);return Ie.parse(t)}const Ze=u({...S,...K,...Q});async function et(e,s){const o=F(s),{chain:r,...t}=Ze.parse(e),i=I(t),n=await H(`${o}/v1/insurance/${r}/apr_history${i}`,void 0,s?.signal);return Qe.parse(n)}const tt=u({...S,...K,...Q});async function st(e,s){const o=F(s),{chain:r,...t}=tt.parse(e),i=I(t),n=await H(`${o}/v1/insurance/${r}/tvl_history${i}`,void 0,s?.signal);return Le.parse(n)}const nt=u(S);async function at(e,s){const o=F(s),{chain:r}=nt.parse(e),t=await H(`${o}/v1/insurance/${r}/top_users`,void 0,s?.signal);return Ne.parse(t)}const ot=u({...S,bin_count:c().int().positive().optional()});async function rt(e,s){const o=F(s),{chain:r,...t}=ot.parse(e),i=I(t),n=await H(`${o}/v1/insurance/${r}/position_histogram${i}`,void 0,s?.signal);return je.parse(n)}const it=u({...S,...K,...Q});async function lt(e,s){const o=F(s),{chain:r,...t}=it.parse(e),i=I(t),n=await H(`${o}/v1/insurance/${r}/insurance_pool_distribution_history${i}`,void 0,s?.signal);return Je.parse(n)}function ct(e){return D({queryKey:["insurance-events",e],queryFn:()=>Ge(P(e)),placeholderData:me})}function ut(e){return D({queryKey:["insurance-cooldown-queue",e],queryFn:()=>Ye(P(e))})}function pt(e){const{start:s,end:o}=ee({daysRange:90});return D({queryKey:["insurance-apr-history",e],queryFn:()=>te((t,i)=>et({...P(e),page:t,per_page:i,start:s,end:o}).then(n=>n.snapshots),1,100)})}function mt(e){const{start:s,end:o}=ee({daysRange:90});return D({queryKey:["insurance-tvl-history",e],queryFn:()=>te((t,i)=>st({...P(e),page:t,per_page:i,start:s,end:o}).then(n=>n.data),1,100)})}function dt(e){return D({queryKey:["insurance-top-users",e],queryFn:()=>at(P(e))})}function _t(e){return D({queryKey:["insurance-position-hist",e],queryFn:()=>rt(P(e))})}function gt(e){return D({queryKey:["insurance-distribution-hist",e],queryFn:()=>lt(P(e))})}const ht=E({__name:"ChartPositions",props:{bins:{}},setup(e){const s=$(()=>De({chart:{type:"bar",animations:{enabled:!1},toolbar:{show:!1},zoom:{enabled:!1}},xaxis:{categories:o.value,labels:{formatter:t=>t,rotate:-60},tickPlacement:"on"},yaxis:{labels:{formatter:t=>t}},plotOptions:{bar:{columnWidth:"50%"}},dataLabels:{enabled:!1},tooltip:{followCursor:!1,enabled:!0,intersect:!0,custom:t=>{const i=t.series[0][t.dataPointIndex];return`<div><b>Range</b>: ${o.value[t.dataPointIndex]}</div><div><b>Users</b>: ${i}</div>`}}})),o=$(()=>e.bins.map(t=>{const i=t.minValue?`${N(t.minValue,0,"dollar")}${O(t.minValue)}`:"0",n=t.maxValue?`${N(t.maxValue,0,"dollar")}${O(t.maxValue)}`:"0";return`${i} - ${n}`})),r=$(()=>[{name:"Users",data:e.bins.map(t=>t.count)}]);return(t,i)=>{const n=He,m=U;return w(),k(m,{title:"User positions"},{default:f(()=>[p(n,{options:a(s),series:a(r)},null,8,["options","series"])]),_:1})}}}),vt=R(ht,[["__scopeId","data-v-525b8a17"]]),yt={style:{display:"flex"}},ft={ref:"chartRef",class:"chart"},bt=E({__name:"ChartTvl",props:{tvl:{}},setup(e){const s=de(),o=_e("card"),{chart:r,series:t}=$e({createChartOptions:Pe(),series:Te({name:"tvl",color:$(()=>s.value.colors.blue),formatter:n=>`${N(n,1,"dollar")}${O(n)}`})});ge(i);function i(){if(!r.value||!t.tvl)return;const n=e.tvl.map(m=>({time:m.timestamp.getUTCTimestamp(),value:m.tvl})).uniqWith((m,d)=>m.time===d.time).orderBy(m=>m.time,"asc");n.length>0&&t.tvl.setData(n),r.value.timeScale().fitContent()}return(n,m)=>{const d=Ae,h=Ce,T=U;return w(),k(T,{ref_key:"card",ref:o,title:"TVL (reUSD)"},{actions:f(()=>[_("div",yt,[p(d,{filename:"tvl",series:a(t)},null,8,["series"]),p(h,{chart:a(r),target:a(o)},null,8,["chart","target"])])]),default:f(()=>[_("div",ft,null,512)]),_:1},512)}}}),wt=["href"],kt={class:"end"},$t={class:"end"},Tt=["href"],Z=10,Pt=E({__name:"TableCooldowns",props:{cooldowns:{}},setup(e){const{page:s,rowsPage:o,onPage:r}=qe(x(()=>e.cooldowns),Z),{relativeTime:t}=ne();return(i,n)=>{const m=se,d=J,h=z,T=U;return w(),k(T,{title:"Cooldown Queue"},{actions:f(()=>[p(m,{"items-count":i.cooldowns.length,"items-per-page":Z,page:a(s),onPage:a(r)},null,8,["items-count","page","onPage"])]),default:f(()=>[p(h,{rows:a(o),columns:["User",{label:"Staked reUSD",align:"end"},{label:"Time",align:"end"}]},{row:f(({item:b})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${b.account.address}`,onClick:n[0]||(n[0]=V(()=>{},["stop"]))},A(b.account.ens||("addressShort"in i?i.addressShort:a(j))(b.account.address)),9,wt)]),_("div",kt,[p(d,{type:"dollar",value:b.amount,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",$t,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${b.txHash}`,onClick:n[1]||(n[1]=V(()=>{},["stop"]))},A(a(t)(b.end.getUTCTimestamp())),9,Tt)])]),_:1},8,["rows"])]),_:1})}}}),Ct=R(Pt,[["__scopeId","data-v-b4fa2168"]]),St=["href"],Ft={class:"end"},Ht={class:"end"},Dt=["href"],At=E({__name:"TableEvents",props:{events:{},count:{}},emits:["page"],setup(e,{emit:s}){const o=s,{page:r,onPage:t}=Ee(),i=he(r,200);ve(i,d=>{o("page",d)});const{relativeTime:n}=ne(),m=d=>{switch(d.eventType){case"deposit":return"Deposit";case"withdraw":return"Withdraw"}};return(d,h)=>{const T=se,b=J,L=z,W=U;return w(),k(W,{title:"Events"},{actions:f(()=>[p(T,{"items-count":d.count,"items-per-page":10,page:a(r),onPage:a(t)},null,8,["items-count","page","onPage"])]),default:f(()=>[p(L,{rows:d.events,columns:["Type","Owner",{label:"reUSD",align:"end"},{label:"Time",align:"end"}]},{row:f(({item:v})=>[_("div",{class:ye({green:v.eventType==="deposit",red:v.eventType==="withdraw"})},A(m(v)),3),_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${v.owner.address}`,onClick:h[0]||(h[0]=V(()=>{},["stop"]))},A(v.owner.ens||("addressShort"in d?d.addressShort:a(j))(v.owner.address)),9,St)]),_("div",Ft,[p(b,{type:"dollar",value:v.assets,precision:2,"show-symbol":!1},null,8,["value"])]),_("div",Ht,[_("a",{target:"_blank",href:`https://etherscan.io/tx/${v.txHash}`,onClick:h[1]||(h[1]=V(()=>{},["stop"]))},A(a(n)(v.blockTime.getUTCTimestamp())),9,Dt)])]),_:1},8,["rows"])]),_:1})}}}),qt=R(At,[["__scopeId","data-v-3718948b"]]),Et=["href"],Ut={class:"end"},xt=E({__name:"TableTopUsers",props:{topUsers:{}},setup(e){return(s,o)=>{const r=J,t=z,i=U;return w(),k(i,{title:"Top Users"},{default:f(()=>[p(t,{rows:s.topUsers,columns:["Address",{label:"Staked reUSD",align:"end"}]},{row:f(({item:n})=>[_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${n.address}`,onClick:o[0]||(o[0]=V(()=>{},["stop"]))},A(n.ens||("addressShort"in s?s.addressShort:a(j))(n.address)),9,Et)]),_("div",Ut,[p(r,{type:"dollar",value:n.positionValue,precision:2,"show-symbol":!1},null,8,["value"])])]),_:1},8,["rows"])]),_:1})}}}),Vt=R(xt,[["__scopeId","data-v-d27f5415"]]),Rt={class:"dashboard"},It=E({__name:"Insurance.page",setup(e){const{isFetching:s,data:o}=pt({chain:"ethereum"}),r=$(()=>(o.value??[]).groupBy(g=>g.tokenAddress).entries().orderBy(([,g])=>g[0].tokenSymbol,"desc").map(([,g])=>({symbol:g[0].tokenSymbol,balances:g.map(y=>({timestamp:y.timestamp,balance:y.apr,tokenPrice:1}))}))),{isFetching:t,data:i}=mt({chain:"ethereum"}),n=$(()=>(i.value??[]).map(g=>({timestamp:g.timestamp,tvl:g.tvl}))),m=fe(1),{isFetching:d,data:h}=ct($(()=>({chain:"ethereum",page:m.value,per_page:10}))),{isFetching:T,data:b}=dt(x(()=>({chain:"ethereum"}))),{isFetching:L,data:W}=ut(x(()=>({chain:"ethereum"}))),{isFetching:v,data:re}=_t(x(()=>({chain:"ethereum"}))),{isFetching:ie,data:le}=gt(x(()=>({chain:"ethereum"}))),ce=$(()=>{const g=le.value?.data??[];return g.length===0?[]:[{symbol:"In cooldown",balances:g.map(y=>({timestamp:y.timestamp,balance:y.cooldownAmount,tokenPrice:1}))},{symbol:"Active staked",balances:g.map(y=>({timestamp:y.timestamp,balance:y.activeStakedAmount,tokenPrice:1}))}]});return(g,y)=>{const ue=ke,M=we,G=U;return w(),be("div",Rt,[p(ue,{style:{"grid-area":"header"},title:"Insurance",description:"Insurance pool metrics for Resupply including APR, TVL and positions"}),a(s)?(w(),k(G,{key:1,loading:"",title:"APR",style:X(`grid-area: apr; min-height: ${a(Y)}`)},null,8,["style"])):(w(),k(M,{key:0,style:{"grid-area":"apr"},title:"APR",balances:a(r),loading:a(s),"show-dollars":!1},null,8,["balances","loading"])),p(bt,{style:{"grid-area":"tvl"},tvl:a(n),loading:a(t)},null,8,["tvl","loading"]),p(qt,{style:{"grid-area":"events"},events:a(h)?.events??[],count:a(h)?.count??0,loading:a(d),onPage:y[0]||(y[0]=pe=>m.value=pe)},null,8,["events","count","loading"]),p(Ct,{style:{"grid-area":"cooldowns"},cooldowns:a(W)?.entries??[],loading:a(L)},null,8,["cooldowns","loading"]),a(ie)?(w(),k(G,{key:3,loading:"",title:"Staked",style:X(`grid-area: chart-staked; min-height: ${a(Y)}`)},null,8,["style"])):(w(),k(M,{key:2,style:{"grid-area":"chart-staked"},title:"Staked",balances:a(ce),"show-dollars":!1},null,8,["balances"])),p(Vt,{style:{"grid-area":"top-users"},"top-users":a(b)?.users??[],loading:a(T)},null,8,["top-users","loading"]),p(vt,{style:{"grid-area":"positions"},bins:a(re)?.bins??[],loading:a(v)},null,8,["bins","loading"])])}}}),Zt=R(It,[["__scopeId","data-v-e4006c67"]]);export{Zt as default};
